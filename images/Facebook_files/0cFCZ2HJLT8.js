/*!CK:3198879249!*//*1418618257,*/

if (self.CavalryLogger) { CavalryLogger.start_js(["KdQcV"]); }

__d("MessageTranscriptWaitHandleState",[],function(a,b,c,d,e,f){e.exports={BUSY:"BUSY",READY:"READY",UNAVAILABLE:"UNAVAILABLE"};},null);
__d("PUWErrorCodes",[],function(a,b,c,d,e,f){e.exports={BAD_JPEG:9901,WORKER_TERMINATED:9902,UNKNOWN_RESIZE_ERROR:9903,WORKER_ABORT:9904};},null);
__d("StickerAssetType",[],function(a,b,c,d,e,f){e.exports={IMAGE:"BestEffortImage",SPRITE:"SpriteImage",PADDED_SPRITE:"PaddedSpriteImage"};},null);
__d("StoryAttachmentStyle",[],function(a,b,c,d,e,f){e.exports={FALLBACK:"fallback",SHARE:"share",OG_COMPOSER_SIMPLE:"og_composer_simple",SPORTS_MATCHUP:"sports_matchup",SHARE_LARGE_IMAGE:"share_large_image",PHOTO:"photo",COVER_PHOTO:"cover_photo",ALBUM:"album",NEW_ALBUM:"new_album",COUPON:"coupon",QUESTION:"question",ANSWER:"answer",OPTION:"option",GALLERY:"gallery",STREAM_PUBLISH:"stream_publish",MUSIC_AGGREGATION:"music_aggregation",ITEM_LIST:"list",HIGH_SCORE:"high_score",SCORE_LEADERBOARD:"score_leaderboard",FRIEND_LIST:"friend_list",CHECKIN:"checkin",POPULAR_OBJECTS:"popular_objects",AVATAR_LIST:"avatar_list",AVATAR:"avatar",AVATAR_WITH_VIDEO:"avatar_with_video",EVENT:"event",EXPERIENCE:"experience",LIFE_EVENT:"life_event",TRAVEL_SLIDESHOW_LIFE_EVENT:"travel_slideshow_life_event",GIFT:"gift",IMAGE_SHARE:"image_share",ANIMATED_IMAGE_SHARE:"animated_image_share",NOTE:"note",TOPIC:"topic",FILE_UPLOAD:"file_upload",NOTIFICATION_TARGET:"notification_target",UNAVAILABLE:"unavailable",PAGE_RECOMMENDATION:"page_recommendation",VIDEO:"video",VIDEO_INLINE:"video_inline",VIDEO_AUTOPLAY:"video_autoplay",VIDEO_SHARE:"video_share",VIDEO_SHARE_HIGHLIGHTED:"video_share_highlighted",VIDEO_SHARE_YOUTUBE:"video_share_youtube",MAP:"map",PRODUCT:"product",EXTERNAL_PRODUCT:"external_product",FITNESS_COURSE:"fitness_course",APPLICATION:"application",STICKER:"sticker",EXTERNAL_OG_PRODUCT:"external_og_product",TRAVEL_LOG:"travel_log",MULTI_SHARE:"multi_share",YEAR_IN_REVIEW:"year_in_review",AVATAR_LARGE_COVER:"avatar_large_cover",BROADCAST_REQUEST:"broadcast_request",COMMERCE_PRODUCT_ITEM:"commerce_product_item",THIRD_PARTY_PHOTO:"third_party_photo",PROMPT:"prompt",BIRTHDAY:"birthday",DONATIONS_CAMPAIGN:"donations_campaign",DONATE_PROMPT:"donate_prompt",DISCUSSION_CONVERSATION:"discussion_conversation",DISCUSSION_COMMENT:"discussion_comment",GROUP_SELL_PRODUCT_ITEM:"group_sell_product_item",GROUP_SELL_PRODUCT_ITEM_MARK_AS_SOLD:"group_sell_mark_as_sold",GAMETIME:"gametime",GROUP_REPORTED_POST_QUEUE:"group_reported_post_queue",GROUP_PENDING_POST_QUEUE:"group_pending_post_queue",GROUP_JOIN_REQUEST_QUEUE:"group_join_request_queue",GREETING_CARD:"greeting_card"};},null);
__d("TypingDetector",["ArbiterMixin","Event","Input","Run","TypingStates","copyProperties","createObjectFrom","emptyFunction"],function(a,b,c,d,e,f,g,h,i,j,k,l,m,n){function o(p,q){this._input=p;this._ignoreKeys={};this._getValueFn=q;}l(o.prototype,g,{_timeout:7000,_currentState:k.INACTIVE,init:function(){this.init=n;this.reset();this._subscription=h.listen(this._input,'keyup',this._update.bind(this));j.onUnload(this._onunload.bind(this));},reset:function(){clearTimeout(this._checkTimer);this._checkTimer=null;this._lastKeystrokeAt=null;this._currentState=k.INACTIVE;},setIgnoreKeys:function(p){this._ignoreKeys=m(p);},destroy:function(){this._subscription.remove();},_onunload:function(){if(this._currentState==k.TYPING)this._transition(k.QUITTING);},_update:function(event){var p=h.getKeyCode(event),q=this._currentState;if(!this._ignoreKeys[p]){var r=this._getValueFn?this._getValueFn():i.getValue(this._input);if(r.trim().length===0){if(q==k.TYPING)this._transition(k.INACTIVE);}else if(q==k.TYPING){this._recordKeystroke();}else if(q==k.INACTIVE){this._transition(k.TYPING);this._recordKeystroke();}}},_transition:function(p){this.reset();this._currentState=p;this.inform('change',p);},_recordKeystroke:function(){this._lastKeystrokeTime=Date.now();if(!this._checkTimer)this._checkTimer=setTimeout(this._checkTyping.bind(this),this._timeout);},_checkTyping:function(){var p=this._lastKeystrokeTime+this._timeout,q=Date.now();if(q>p){this._transition(k.INACTIVE);}else{clearTimeout(this._checkTimer);this._checkTimer=setTimeout(this._checkTyping.bind(this),p-q+10);}}});e.exports=o;},null);
__d("TypingDetectorController",["AsyncRequest","AvailableList","AvailableListConstants","ChannelConnection","ChatVisibility","Keys","PresencePrivacy","ShortProfiles","TypingDetector","TypingStates","copyProperties","emptyFunction","setTimeoutAcrossTransitions","shield"],function(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t){function u(v,w,x,y,z,aa){"use strict";this.userID=v;this.input=w;this.source=x;this.threadID=z;this.remoteState=p.INACTIVE;this.notifyTimer=null;y=y||{};this.notifyDelay=y.notifyDelay||this.notifyDelay;this._typingDetector=new o(w,aa);this._typingDetector.init(y);this._typingDetector.subscribe('change',this._stateChange.bind(this));}u.prototype.setUserAndThread=function(v,w){"use strict";if(this.userID!==v||this.threadID!==w){this.resetState();this.userID=v;this.threadID=w;}};u.prototype.setIgnoreEnter=function(v){"use strict";var w=v?[l.RETURN]:[];this._typingDetector.setIgnoreKeys(w);};u.prototype.resetState=function(){"use strict";this._notifyState(p.INACTIVE);this.remoteState=p.INACTIVE;this._typingDetector.reset();clearTimeout(this.notifyTimer);this.notifyTimer=null;};u.prototype.destroy=function(){"use strict";this.resetState();this._typingDetector.destroy();};u.prototype._stateChange=function(v,w){"use strict";if(w!=p.QUITTING){clearTimeout(this.notifyTimer);this.notifyTimer=s(t(this._notifyState,this,w),this.notifyDelay);}else this._notifyState(w,true);};u.prototype._notifyState=function(v,w){"use strict";if((!this.userID&&!this.threadID)||!k.isOnline()||v===this.remoteState||j.disconnected())return;var x=this.userID;if(x){n.get(x,function(y){if(y&&y.type=='friend'&&m.allows(x))this._sendRequest(v,x,w);}.bind(this));}else this._sendRequest(v,x,w);};u.prototype._sendRequest=function(v,w,x){"use strict";this.remoteState=v;var y={typ:v,to:w,source:this.source,thread:this.threadID};new g().setHandler(this._onTypResponse.bind(this,w)).setErrorHandler(r).setData(y).setURI('/ajax/messaging/typ.php').setAllowCrossPageTransition(true).setOption('asynchronous',!x).send();};u.prototype._onTypResponse=function(v,w){"use strict";var x=w.getPayload()||{};if(x.offline)h.set(v,i.OFFLINE,'typing_response');};q(u.prototype,{notifyDelay:1000});e.exports=u;},null);
__d("CroppedImage.react",["Image.react","React","ReactPropTypes","cx"],function(a,b,c,d,e,f,g,h,i,j){var k=h.createClass({displayName:"CroppedImage",propTypes:{center:i.shape({x:i.number.isRequired,y:i.number.isRequired}),crop:i.shape({height:i.number.isRequired,width:i.number.isRequired}).isRequired,size:i.shape({height:i.number.isRequired,width:i.number.isRequired}).isRequired,src:i.string.isRequired},getDefaultProps:function(){return {center:{x:.5,y:.5}};},_calculateMargin:function(l,m,n){return -1*Math.max(Math.min(((n*m)-(.5*l)),m-l),0);},render:function(){var l=this._calculateMargin(this.props.crop.width,this.props.size.width,this.props.center.x),m=this._calculateMargin(this.props.crop.height,this.props.size.height,this.props.center.y),n={left:l,height:this.props.size.height,top:m,width:this.props.size.width};return (h.createElement("div",{className:"_46-h",style:this.props.crop},h.createElement(g,{alt:this.props.alt||'',className:"_46-i",src:this.props.src,style:n})));}});e.exports=k;},null);
__d("MercuryMessageError.react",["CurrentUser","ImmutableObject","MercuryErrorInfo","MercuryMessageActions","React","cx","joinClasses"],function(a,b,c,d,e,f,g,h,i,j,k,l,m){'use strict';var n=k.PropTypes,o=k.createClass({displayName:"MercuryMessageError",propTypes:{authorFBID:n.string,message:n.instanceOf(h).isRequired},getDefaultProps:function(){return {authorFBID:g.getID()};},render:function(){var p=this.props.message,q=p.error_data;return (k.createElement("div",k.__spread({},this.props,{className:m(this.props.className,this._getClassNameFromStatus(p)),tabIndex:i.isTransient(q)?0:null,onClick:i.isTransient(q)?this.messageResend:null}),k.createElement("div",{className:"_2fs1"}),k.createElement("span",{dangerouslySetInnerHTML:{__html:this._getTextFromStatus(p)}})));},messageResend:function(){j.getForFBID(this.props.authorFBID).resend(this.props.message);},_getClassNameFromStatus:function(p){if(i.hasErrorStatus(p)){return (("_2fs2")+(' '+"_2fs3")+(i.isTransient(p.error_data)?' '+"_2fs4":'')+(i.isPermanent(p.error_data)?' '+"_2fs5":''));}else return "_2fs6 _2fs2";},_getTextFromStatus:function(p){var q='',r=p.error_data;if(i.hasErrorStatus(p))q=i.getMessage(r);if(typeof q==='object'&&q.__html)q=q.__html;return q;}});e.exports=o;},null);
__d("MercuryAudioPlayer",["Event","Arbiter","DOM","Flash","UserAgent_DEPRECATED","copyProperties"],function(a,b,c,d,e,f,g,h,i,j,k,l){var m=200;function n(){if(k.webkit()&&!k.chrome())return false;var w=i.create('audio'),x=false;try{if(!!w.canPlayType)if(w.canPlayType('video/mp4;').replace(/^no$/,''))x=true;}finally{return x;}}function o(){return j.isAvailable();}var p=function(){this.interval=null;this.arbiterInstance=null;this.audio=i.create('audio');g.listen(this.audio,'playing',function(){this.informAttachment('playing',this.audio.currentTime);this.interval=setInterval(function(){this.informAttachment('playing',this.audio.currentTime);}.bind(this),m);}.bind(this));g.listen(this.audio,'ended',function(){clearInterval(this.interval);this.informAttachment('finished');}.bind(this));};l(p.prototype,{setAudio:function(w,x){this.audio.setAttribute('src',w);this.arbiterInstance=x;},informAttachment:function(w,x){if(this.arbiterInstance)this.arbiterInstance.inform(w,x);},play:function(){this.audio.play();this.informAttachment('played');},resume:function(){this.audio.play();this.informAttachment('played');},pause:function(){this.audio.pause();clearInterval(this.interval);this.informAttachment('paused');},getType:function(){return 'html5';}});var q=function(){this.src=null;this.arbiterInstance=null;var w=i.create('div');document.body.appendChild(w);this.swf=j.embed('/swf/SoundStreamPlayer.swf',w,null,{});this.interval=null;h.subscribe('soundstream/finished',function(){clearInterval(this.interval);this.informAttachment('finished');}.bind(this));};l(q.prototype,{setAudio:function(w,x){this.src=w;this.arbiterInstance=x;},informAttachment:function(w,x){if(this.arbiterInstance)this.arbiterInstance.inform(w,x);},play:function(){this.swf.playSound(this.src);this.interval=setInterval(function(){var w=this.swf.getCurrentTime();this.informAttachment('playing',w);}.bind(this),m);this.informAttachment('played');},resume:function(){this.swf.resume();this.informAttachment('played');},pause:function(){clearInterval(this.interval);this.swf.pause();this.informAttachment('paused');},getType:function(){return 'flash';}});function r(){if(n()){return new p();}else if(o())return new q();return false;}var s=null,t=null,u=0;function v(w,x){this.src=w;this.arbiterInstance=x;this.audio_id=++u;s!==null||(s=r());if(!s)return false;}l(v.prototype,{getType:function(){if(!s){return false;}else return s.getType();},play:function(w){if(w&&t==this.audio_id){s.resume();}else{this.pause();t=this.audio_id;s.setAudio(this.src,this.arbiterInstance);s.play();}},pause:function(){s.pause();}});e.exports=v;},null);
__d("MercuryAttachmentAudioClip.react",["Arbiter","ArbiterMixin","MercuryAudioPlayer","CurrentUser","JSLogger","LeftRight.react","React","cx","fbt","shield"],function(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p){var q='MercuryAttachmentAudioClip/play',r=k.create('mercury_audio_clip'),s=m.createClass({displayName:"AudioClip",mixins:[h],getInitialState:function(){this.subscribe('playing',this.updateTime);this.subscribe('played',p(this.setState,this,{playing:true,started:true}));this.subscribe('paused',p(this.setState,this,{playing:false}));this.subscribe('finished',p(this.setState,this,{playing:false,started:false,time:this.props.duration}));this.logged=false;var t=this.props.downloadOnly?false:new i(this.props.src,this);g.subscribe(q,function(u,v){if(this.props.src!=v)this.setState({time:0});}.bind(this));return {time:0,playing:false,started:false,duration:this.props.duration,audioPlayer:t};},updateTime:function(t,u){this.setState({time:u});},play:function(){if(this.state.playing){this.state.audioPlayer.pause();}else{this.state.audioPlayer.play(this.state.started);g.inform(q,this.props.src);if(!this.logged){this.logged=true;r.log('play',{uid:j.getID(),duration:this.props.duration});}}},_formatSeconds:function(t){if(t){t=Math.ceil(t);var u=t%60;if(u<10)u='0'+u;var v=Math.floor(t/60);return v+':'+u;}else return null;},_renderPlayer:function(t,u){return (m.createElement("a",{className:"_1miz",href:"#",style:{width:t},onClick:this.play},m.createElement("span",{className:"_1mi-"},m.createElement("i",{className:"_1mi_"})),m.createElement("span",{className:"_1mj0"},u),m.createElement("div",{className:"_1mj1"})));},render:function(){var t=this.state.time,u=this.state.playing,v=this._formatSeconds(this.state.duration),w=this.props.width||170,x=null,y=Math.ceil((t*(w+2))/this.state.duration);if(this.state.audioPlayer&&this.state.audioPlayer.getType()){var z=this._renderPlayer(w,v),aa=this._renderPlayer(w,v),ba=(("_1mj2")+(u&&(t!==0)?' '+"_1mj3":'')+(u&&(t===0)?' '+"_4g4x":''));x=(m.createElement("div",{className:ba},z,m.createElement("div",{className:"_1mj4",style:{width:y}},aa)));}else x=(m.createElement("div",{className:"_1mj2"},m.createElement("div",{className:"_1miz"},m.createElement(l,null,m.createElement("a",{className:"_1mj5",href:this.props.src},m.createElement("span",{className:"_3qi6"},m.createElement("i",{className:"_1mj6"})),m.createElement("span",{className:"_1mj7"},"Voice Message"),m.createElement("span",{className:"_1mj8"},v)),m.createElement("a",{href:this.props.src,className:"_1mj9"},m.createElement("i",{className:"_1mja"}))))));return (m.createElement("div",{className:"_1mjb"},x));}});e.exports=s;},null);
__d("XMessageTranscriptControllerURIBuilder",["XControllerURIBuilder"],function(a,b,c,d,e,f){e.exports=b("XControllerURIBuilder").create("\/fetch_transcript\/",{message_id:{type:"String",required:true}});},null);
__d("MercuryAttachmentAudioClipTranscript.react",["AsyncRequest","React","XMessageTranscriptControllerURIBuilder","MessageTranscriptWaitHandleState","LoadingIndicator.react","cx","fbt"],function(a,b,c,d,e,f,g,h,i,j,k,l,m){var n=h.createClass({displayName:"Transcript",fetchTranscript:function(){var o=new i().setString('message_id',this.props.message_id).getURI();new g(o).setHandler(function(p){var q=p.getPayload();this.setState({transcript:q.transcript?q.transcript.text:null,transcriptState:q.status,transcriptRetryTimeout:q.retryTimeout});if(this.state.transcriptState===j.BUSY)setTimeout(this.fetchTranscript,Math.max(this.state.transcriptRetryTimeout,1000));}.bind(this)).send();},componentDidMount:function(){this.fetchTranscript();},getInitialState:function(){return {transcript:null,transcriptState:j.BUSY,transcriptRetryTimeout:null};},render:function(){var o=this.state.transcriptState,p=this.state.transcript,q=null,r=null;if(o===j.READY){q=h.createElement("p",null,p);}else if(o===j.UNAVAILABLE){q=(h.createElement("p",null,"Transcript unavailable"));}else if(o===j.BUSY)r=h.createElement(k,{size:"small",color:"white"});return (h.createElement("div",{className:"_44v-"},q,r));}});e.exports=n;},null);
__d("MercuryAttachmentVideo.react",["ActorURI","CroppedImage.react","Image.react","React","ReactPropTypes","XMessagingVideoAttachmentControllerURIBuilder","cx","getViewportDimensions","ix"],function(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o){var p=j.createClass({displayName:"MercuryAttachmentVideo",propTypes:{duration:k.number.isRequired,name:k.string.isRequired,pageID:k.number,size:k.shape({height:k.number,width:k.number}),thumbnailSize:k.shape({height:k.number,width:k.number}),thumbnail:k.string,videoID:k.string},_formatDuration:function(){var q=this.props.duration,r=Math.floor(q/60),s=q%60;if(s<10)return r+':0'+s;return r+':'+s;},render:function(){var q=!!this.props.thumbnail,r=(("_zow")+(' '+"_59go")+(!q?' '+"_59gq":'')),s=((!q?"_3l6h":'')+(!q?' '+"uiIconText":'')),t=n(),u=new l().setInt('video_id',this.props.videoID).setInt('window_width',t.width).setInt('window_height',t.height).getURI();if(this.props.pageID)u=g.create(u,this.props.pageID);if(this.props.thumbnail)return (j.createElement("div",{className:r,style:this.props.size},j.createElement("a",{className:s,href:u,role:"button",rel:"async"},j.createElement(h,{crop:this.props.size,size:this.props.thumbnailSize,src:this.props.thumbnail}),j.createElement("div",{className:"_zox"}),j.createElement("div",{className:"_zoy"},j.createElement(i,{src:o('/images/chat/chat_play_icon.png')})),j.createElement("span",{className:"_zoz"},this._formatDuration()))));return (j.createElement("div",{className:r},j.createElement("a",{className:s,href:u,role:"button",rel:"async"},j.createElement(i,{src:o('/images/icons/video.gif')}),j.createElement("span",{className:"_59gp"},this.props.name))));}});e.exports=p;},null);
__d("updatePhotoProgressBar",[],function(a,b,c,d,e,f){'use strict';function g(h,event){if(event.loaded!=event.total){h.setPosition(50*event.loaded/event.total);}else{h.setPosition(50);h.setTarget(100,2000);}}e.exports=g;},null);
__d("Emscripten",[],function(a,b,c,d,e,f){e.exports={isSupported:function(){return (typeof Int32Array!=='undefined'&&typeof Float64Array!=='undefined'&&!!new Int32Array(1).subarray&&!!new Int32Array(1).set);}};},null);
__d("XHRHttpError",[],function(a,b,c,d,e,f){var g='HTTP_CLIENT_ERROR',h='HTTP_PROXY_ERROR',i='HTTP_SERVER_ERROR',j='HTTP_TRANSPORT_ERROR',k='HTTP_UNKNOWN_ERROR';function l(m,n){if(n===0){var o=m.getProtocol();if(o==='file'||o==='ftp')return null;return j;}else if(n>=100&&n<200){return h;}else if(n>=200&&n<300){return null;}else if(n>=400&&n<500){return g;}else if(n>=500&&n<600){return i;}else if(n>=12001&&n<12156){return j;}else return k;}e.exports={getErrorCode:l,HTTP_CLIENT_ERROR:g,HTTP_PROXY_ERROR:h,HTTP_SERVER_ERROR:i,HTTP_TRANSPORT_ERROR:j,HTTP_UNKNOWN_ERROR:k};},null);
__d("xhrSimpleDataSerializer",[],function(a,b,c,d,e,f){function g(h){var i=[],j;for(j in h)i.push(encodeURIComponent(j)+'='+encodeURIComponent(h[j]));return i.join('&');}e.exports=g;},null);
__d("XHRRequest",["ErrorUtils","URI","XHRHttpError","getSameOriginTransport","invariant","xhrSimpleDataSerializer"],function(a,b,c,d,e,f,g,h,i,j,k,l){var m={errorCode:null,errorMsg:null,errorType:null},n={loadedBytes:null,totalBytes:null};function o(p){"use strict";this.setURI(p);this.setMethod('POST');this.setIsAsynchronous(true);this.setTransportBuilder(j);this.setDataSerializer(l);this.$XHRRequest0=this.$XHRRequest0.bind(this);}o.prototype.setURI=function(p){"use strict";this.$XHRRequest1=new h(p);return this;};o.prototype.getURI=function(){"use strict";return this.$XHRRequest1;};o.prototype.setMethod=function(p){"use strict";this.$XHRRequest2=p;return this;};o.prototype.getMethod=function(){"use strict";return this.$XHRRequest2;};o.prototype.setData=function(p){"use strict";this.$XHRRequest3=p;return this;};o.prototype.getData=function(){"use strict";return this.$XHRRequest3;};o.prototype.setRawData=function(p){"use strict";this.$XHRRequest4=p;return this;};o.prototype.setRequestHeader=function(p,q){"use strict";if(!this.$XHRRequest5)this.$XHRRequest5={};this.$XHRRequest5[p]=q;return this;};o.prototype.setTimeout=function(p){"use strict";this.$XHRRequest6=p;return this;};o.prototype.setResponseHandler=function(p){"use strict";this.$XHRRequest7=p;return this;};o.prototype.setErrorHandler=function(p){"use strict";this.$XHRRequest8=p;return this;};o.prototype.setAbortHandler=function(p){"use strict";this.$XHRRequest9=p;return this;};o.prototype.setTimeoutHandler=function(p){"use strict";this.$XHRRequesta=p;return this;};o.prototype.setUploadProgressHandler=function(p){"use strict";this.$XHRRequestb=p;return this;};o.prototype.setIsAsynchronous=function(p){"use strict";this.$XHRRequestc=p;return this;};o.prototype.setTransportBuilder=function(p){"use strict";this.$XHRRequestd=p;return this;};o.prototype.setDataSerializer=function(p){"use strict";this.$XHRRequeste=p;return this;};o.prototype.send=function(){"use strict";var p=this.$XHRRequest6,q=this.$XHRRequestd(),r=this.getURI();this.$XHRRequestf=q;var s;k(this.$XHRRequest2==='POST'||!this.$XHRRequest4);if(this.$XHRRequest2==='GET'||this.$XHRRequest4){r.addQueryData(this.$XHRRequest3);s=this.$XHRRequest4;}else s=this.$XHRRequeste(this.$XHRRequest3);q.onreadystatechange=this.$XHRRequest0;if(q.upload&&this.$XHRRequestb)q.upload.onprogress=this.$XHRRequestg.bind(this);if(p)this.$XHRRequesth=setTimeout(this.$XHRRequesti.bind(this),p);q.open(this.$XHRRequest2,r.toString(),this.$XHRRequestc);if(this.$XHRRequest5)for(var t in this.$XHRRequest5)q.setRequestHeader(t,this.$XHRRequest5[t]);q.send(s);if(!this.$XHRRequestc)q.onreadystatechange(null,true);};o.prototype.abort=function(){"use strict";this.$XHRRequestj();if(this.$XHRRequest9)g.applyWithGuard(this.$XHRRequest9,null,null,null,'XHRRequest:_abortHandler');};o.prototype.$XHRRequestj=function(){"use strict";var p=this.$XHRRequestf;if(p){p.onreadystatechange=null;p.abort();}this.$XHRRequestk();};o.prototype.$XHRRequesti=function(){"use strict";this.$XHRRequestj();if(this.$XHRRequesta)g.applyWithGuard(this.$XHRRequesta,null,null,null,'XHRRequest:_abortHandler');};o.prototype.$XHRRequest0=function(p,q){"use strict";if(!this.$XHRRequestc&&q!==true)return;var r=this.$XHRRequestf,s=r,t=s.readyState;if(t>=2){var u=t===4,v=this.getURI(),w=i.getErrorCode(v,r.status),x=this.$XHRRequest7;if(w!==null){if(u){m.errorCode=w;m.errorMsg=r.responseText;m.errorType='HTTP';if(this.$XHRRequest8)g.applyWithGuard(this.$XHRRequest8,null,[m],null,'XHRRequest:_errorHandler');}}else if(x){var y=null;if(x.includeHeaders)y=r.getAllResponseHeaders();if(u||(x.parseStreaming&&t===3))g.applyWithGuard(x,null,[r.responseText,y,u],null,'XHRRequest:handler');}if(u)this.$XHRRequestk();}};o.prototype.$XHRRequestg=function(p){"use strict";n.loadedBytes=p.loaded;n.totalBytes=p.total;if(this.$XHRRequestb)g.applyWithGuard(this.$XHRRequestb,null,[n],null,'XHRRequest:_uploadProgressHandler');};o.prototype.$XHRRequestk=function(){"use strict";clearTimeout(this.$XHRRequesth);delete this.$XHRRequestf;};e.exports=o;},null);
__d("getCrossOriginTransport",["ex","invariant"],function(a,b,c,d,e,f,g,h){function i(){try{var k=new XMLHttpRequest();if(!('withCredentials' in k)&&typeof XDomainRequest!=='undefined')k=new XDomainRequest();return k;}catch(j){throw new Error(g('getCrossOriginTransport: %s',j.message));}}i.withCredentials=function(){var j=i();h('withCredentials' in j);var k=j.open;j.open=function(){k.apply(this,arguments);this.withCredentials=true;};return j;};e.exports=i;},null);
__d("WebWorker",["BanzaiLogger","WebWorkerConfig","BlobFactory","EventListener","URI","areSameOrigin","destroyOnUnload","SubscriptionsHandler","XHRRequest","arrayContains","emptyFunction","getCrossOriginTransport","performanceNow","invariant","memoize","merge","filterObject"],function(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v,w){var x=a.URL||a.webkitURL;function y(ea){"use strict";this.$WebWorker0=false;this.$WebWorker1=null;this.$WebWorker2=ea;this.$WebWorker3=null;this.$WebWorker4=q;this.$WebWorker5=q;this.$WebWorker6=[];this.$WebWorker7=false;this.$WebWorker8=new n();m(function(){if(!this.$WebWorker7)this.terminate();}.bind(this));this.$WebWorker9('constructed');}y.prototype.setMessageHandler=function(ea){"use strict";this.$WebWorker4=ea||q;return this;};y.prototype.setErrorHandler=function(ea){"use strict";this.$WebWorker5=ea||q;return this;};y.prototype.postMessage=function(ea,fa){"use strict";t(!this.isCurrentState('constructed'));t(!this.isCurrentState('terminated'));if(this.isCurrentState('preparing')){this.$WebWorker6.push(this.postMessage.bind(this,ea,fa));return this;}var ga={type:'message',message:ea};if(fa){this.$WebWorker3.postMessage(ga,fa);}else this.$WebWorker3.postMessage(ga);return this;};y.prototype.terminate=function(){"use strict";if(this.isCurrentState('executing'))this.$WebWorker3.terminate();if(!this.isCurrentState('terminated')){this.$WebWorker9('terminated');this.$WebWorker3=null;this.$WebWorkera();this.$WebWorker6=[];}return this;};y.prototype.execute=function(){"use strict";t(!this.isCurrentState('terminated'));if(['preparing','executing'].some(this.isCurrentState,this))return this;this.$WebWorker9('preparing');y.prepareResource(this.$WebWorker2,this.$WebWorkerb.bind(this));return this;};y.prototype.setAllowCrossPageTransition=function(ea){"use strict";this.$WebWorker7=ea;return this;};y.prototype.isCurrentState=function(ea){"use strict";t(p(y.states,ea));return ea===this.$WebWorker1;};y.prototype.$WebWorkerb=function(){"use strict";t(!this.isCurrentState('executing'));if(this.isCurrentState('terminated'))return;t(this.$WebWorker2.sameOriginURL||this.$WebWorker2.source);if(this.$WebWorker2.sameOriginURL){this.$WebWorker3=new a.Worker(this.$WebWorker2.sameOriginURL);}else{this.$WebWorker3=new a.Worker(y.evalWorkerURL);this.$WebWorker3.postMessage(this.$WebWorker2.source);}this.$WebWorkerc('ping',Date.now());this.$WebWorkerd();this.$WebWorker9('executing');this.$WebWorker6.forEach(function(ea){return ea();});this.$WebWorker6=null;};y.prototype.$WebWorkera=function(){"use strict";this.$WebWorker8.release();};y.prototype.$WebWorkerc=function(ea){"use strict";for(var fa=[],ga=1,ha=arguments.length;ga<ha;ga++)fa.push(arguments[ga]);this.$WebWorker3.postMessage({type:ea,args:fa});};y.prototype.$WebWorkere=function(event,ea){"use strict";y.$WebWorkere(event,this.$WebWorker2.name,v(ea,{cross_page_transition:!!this.$WebWorker7,state:this.$WebWorker1}));};y.$WebWorkerf=function(){"use strict";return Object.keys(w({object_url:y.$WebWorkerg(),eval_url:ca(),data_url:y.$WebWorkerh(),worker:y.isSupported(),transferables:y.areTransferablesSupported()},function(ea){return !!ea;}));};y.prototype.$WebWorkerd=function(){"use strict";this.$WebWorker8.addSubscriptions(j.listen(this.$WebWorker3,'message',this.$WebWorkeri.bind(this)),j.listen(this.$WebWorker3,'error',this.$WebWorkerj.bind(this)));};y.prototype.$WebWorkerj=function(ea){"use strict";var fa=this.$WebWorker5(ea);if(!fa&&!ea.defaultPrevented)this.$WebWorkere('exception',{message:ea.message});};y.prototype.$WebWorkeri=function(event){"use strict";var ea=event.data;switch(ea.type){case 'message':this.$WebWorker4(ea.message);break;case 'pong':this.$WebWorker0=true;this.$WebWorkere('executed',{dt:Math.floor(ea.args[1]-ea.args[0]),bytes:this.$WebWorker2.source.length});break;case 'terminate':this.terminate();break;case 'haste-error':this.terminate();this.$WebWorkere('haste_error',{message:ea.message});break;case 'console':var fa=ea.args.shift();t(p(['log','error','info','debug','warn'],fa));a.console[fa].apply(a.console,ea.args);break;}};y.prototype.$WebWorker9=function(ea){"use strict";t(p(y.states,ea));this.$WebWorkere('transition',{next_state:ea});this.$WebWorker1=ea;};y.prepareResource=function(ea,fa){"use strict";fa=fa||q;t(ea.sameOriginURL||ea.url||ea.source);t(!!y.isSupported());if(ea.sameOriginURL){fa();}else if(ea.url&&l(new k(ea.url),new k(a.location.href))){ea.sameOriginURL=ea.url;fa();}else if(ea.source){if(y.$WebWorkerk())ea.sameOriginURL=y.$WebWorkerl(ea.source);fa();}else if(!ea.loading){var ga=s();ea.loading=[fa];y.$WebWorkerm(ea.url,function(ha){if(ha){ea.source=ha;if(y.$WebWorkerk())ea.sameOriginURL=y.$WebWorkerl(ha);}y.$WebWorkere('prepared',ea.name,{dt:Math.floor(s()-ga),bytes:ha.length});ea.loading.forEach(function(ia){return ia();});ea.loading=false;});}else ea.loading.push(fa);return ea;};y.releaseResource=function(ea){"use strict";if(ea.sameOriginURL.indexOf('blob:')===0){if(x.revokeObjectURL)x.revokeObjectURL(ea.sameOriginURL);ea.sameOriginURL=null;}return ea;};y.isSupported=function(){"use strict";return ba&&(y.$WebWorkerk()||ca());};y.areTransferablesSupported=function(){"use strict";return y.isSupported()&&da();};y.$WebWorkerm=function(ea,fa){"use strict";new o(ea).setTransportBuilder(r).setMethod('GET').setResponseHandler(function(ga){fa(ga);}).setErrorHandler(fa.bind(null,null)).send();};y.$WebWorkerl=function(ea){"use strict";t(y.$WebWorkerk());if(y.$WebWorkerg()){var fa=i.getBlob([ea],{type:'application/javascript'});return x.createObjectURL(fa);}if(y.$WebWorkerh())return 'data:application/javascript,'+encodeURIComponent(ea);};y.$WebWorkerg=function(){"use strict";return i.isSupported()&&z();};y.$WebWorkerh=function(){"use strict";return aa();};y.$WebWorkerk=function(){"use strict";return y.$WebWorkerg()||y.$WebWorkerh();};y.$WebWorkere=function(event,ea,fa){"use strict";if(!h.logging.enabled)return;g.log(h.logging.config,v(fa,{features_array:y.$WebWorkerf(),event:event,resource:ea}));};var z=u(function(){var ea,fa;if(!x||!x.createObjectURL)return false;try{ea=x.createObjectURL(i.getBlob([''],{type:'application/javascript'}));var ha=new a.Worker(ea);ha.terminate();fa=true;}catch(ga){fa=false;}finally{if(x.revokeObjectURL)x.revokeObjectURL(ea);}return fa;}),aa=u(function(){var ea;try{var ga=new a.Worker('data:application/javascript,');ga.terminate();ea=true;}catch(fa){ea=false;}return ea;}),ba=!!a.Worker,ca=u(function(){var ea;try{var ga=new a.Worker(y.evalWorkerURL);ga.terminate();ea=true;}catch(fa){ea=false;}return ea;}),da=u(function(){var ea;try{var ga=new a.Worker(y.evalWorkerURL),ha=new ArrayBuffer(0);ga.postMessage({buffer:ha},[ha]);ga.terminate();ea=true;}catch(fa){ea=false;}return ea;});y.states=['constructed','preparing','executing','terminated'];y.evalWorkerURL=h.evalWorkerURL;e.exports=y;},null);
__d("PooledWebWorker",["WebWorker"],function(a,b,c,d,e,f,g){for(var h in g)if(g.hasOwnProperty(h))j[h]=g[h];var i=g===null?null:g.prototype;j.prototype=Object.create(i);j.prototype.constructor=j;j.__superConstructor__=g;function j(k,l,m){"use strict";i.constructor.call(this,m);this.$PooledWebWorker0=l;this.$PooledWebWorker1=k;}j.prototype.getIndex=function(){"use strict";return this.$PooledWebWorker0;};j.prototype.getPool=function(){"use strict";return this.$PooledWebWorker1;};e.exports=j;},null);
__d("WebWorkerPool",["PooledWebWorker","emptyFunction"],function(a,b,c,d,e,f,g,h){i.isSupported=function(){"use strict";return g.isSupported();};function i(j,k){"use strict";this.$WebWorkerPool0=[];for(var l=0;l<k;l++)this.$WebWorkerPool0.push(new g(this,l,j).setErrorHandler(this.$WebWorkerPool1).setMessageHandler(this.$WebWorkerPool2).execute());this.$WebWorkerPool3=0;}i.prototype.setMessageHandler=function(j){"use strict";this.$WebWorkerPool4=j||h;return this;};i.prototype.setAllowCrossPageTransition=function(j){"use strict";this.$WebWorkerPool0.forEach(function(k){return k.setAllowCrossPageTransition(j);});return this;};i.prototype.setErrorHandler=function(j){"use strict";this.$WebWorkerPool5=j||h;return this;};i.prototype.postMessage=function(){"use strict";for(var j=[],k=0,l=arguments.length;k<l;k++)j.push(arguments[k]);var m=this.getWorker();m.postMessage.apply(m,j);return m;};i.prototype.$WebWorkerPool2=function(){"use strict";for(var j=[],k=0,l=arguments.length;k<l;k++)j.push(arguments[k]);j.unshift(this);this.getPool().$WebWorkerPool4.apply(this.getPool(),j);};i.prototype.$WebWorkerPool1=function(){"use strict";for(var j=[],k=0,l=arguments.length;k<l;k++)j.push(arguments[k]);j.unshift(this);return this.getPool().$WebWorkerPool5.apply(this.getPool(),j);};i.prototype.getWorker=function(){"use strict";var j=this.$WebWorkerPool0[this.$WebWorkerPool3];this.$WebWorkerPool3=(this.$WebWorkerPool3+1)%this.$WebWorkerPool0.length;return j;};e.exports=i;},null);
__d("JpegResizer",["Emscripten","JpegResizerConfig","JpegResizeWorkerResource","WebWorker","WebWorkerPool","PUWErrorCodes"],function(a,b,c,d,e,f,g,h,i,j,k,l){var m=null;n.isSupported=function(){"use strict";return k.isSupported()&&g.isSupported()&&!h.isGKBlacklisted;};n.getSingleton=function(){"use strict";if(!m)m=new n(n.DEFAULT_POOL_SIZE).setAllowCrossPageTransition(true);return m;};n.prepareResource=function(o){"use strict";j.prepareResource(i,o);};function n(o){"use strict";o=o||n.DEFAULT_POOL_SIZE;j.prepareResource(i);this.$JpegResizer0=(new k(i,o)).setErrorHandler(this.$JpegResizer1.bind(this)).setMessageHandler(this.$JpegResizer2.bind(this));this.$JpegResizer3={};this.$JpegResizer4=n.DEFAULT_RESIZE_HEIGHT;this.$JpegResizer5=n.DEFAULT_RESIZE_WIDTH;}n.prototype.setHighQuality=function(o){"use strict";if(o){this.$JpegResizer4=n.DEFAULT_RESIZE_HEIGHT;this.$JpegResizer5=n.DEFAULT_RESIZE_WIDTH;}else{this.$JpegResizer4=n.LOW_QUALITY_RESIZE_HEIGHT;this.$JpegResizer5=n.LOW_QUALITY_RESIZE_WIDTH;}return this;};n.prototype.setAllowCrossPageTransition=function(o){"use strict";this.$JpegResizer0.setAllowCrossPageTransition(o);return this;};n.prototype.resizeBlob=function(o,p,q){"use strict";var r=this.$JpegResizer0.getWorker();if(r.isCurrentState('terminated')){var s=new Error('Worker terminated');s.code=l.WORKER_TERMINATED;p(s);return this;}var t=r.postMessage({blob:o,height:this.$JpegResizer4,width:this.$JpegResizer5}).getIndex();this.$JpegResizer6(t).unshift({done:p,progress:q});return this;};n.prototype.$JpegResizer6=function(o){"use strict";if(!this.$JpegResizer3.hasOwnProperty(o))this.$JpegResizer3[o]=[];return this.$JpegResizer3[o];};n.prototype.$JpegResizer1=function(o,p){"use strict";o.terminate();var q=this.$JpegResizer6(o.getIndex());this.$JpegResizer7(p);q.forEach(function(r){return r.done(p);});q.length=0;};n.prototype.$JpegResizer2=function(o,p){"use strict";if(p.error)this.$JpegResizer7(p.error);if(p.done){this.$JpegResizer6(o.getIndex()).pop().done(p.error,p.blob,p.skipped);}else{var q=this.$JpegResizer6(o.getIndex()),r=q[q.length-1].progress;if(r)r({written:p.written,total:p.total});}};n.prototype.$JpegResizer7=function(o){"use strict";var p=o.message;if(p.indexOf('Not a JPEG file')!==-1){o.code=l.BAD_JPEG;}else if(p.indexOf('abort()')!==-1){o.code=l.WORKER_ABORT;}else o.code=l.UNKNOWN_RESIZE_ERROR;};n.DEFAULT_POOL_SIZE=3;n.DEFAULT_RESIZE_HEIGHT=2048;n.DEFAULT_RESIZE_WIDTH=2048;n.LOW_QUALITY_RESIZE_HEIGHT=960;n.LOW_QUALITY_RESIZE_WIDTH=960;e.exports=n;},null);
__d("WaterfallIDGenerator",["CurrentUser","md5"],function(a,b,c,d,e,f,g,h){function i(){var l=2147483647;return Math.random()*l;}function j(){return Math.floor(Date.now()/1000);}var k={generate:function(){return h([g.getID(),j(),i()].join(':'));}};e.exports=k;},null);
__d("MercuryFileUploader",["ArbiterMixin","CSS","Dialog","DOM","Event","FileForm","FileFormResetOnSubmit","FileInput","FormSubmitOnChange","MercuryAttachment","MercuryAttachmentTemplates","MercuryConstants","PhotosUploadID","SubscriptionsHandler","csx","fbt","getObjectValues","mixin","shield"],function(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v,w,x,y){var z=x(g);for(var aa in z)if(z.hasOwnProperty(aa))ca[aa]=z[aa];var ba=z===null?null:z.prototype;ca.prototype=Object.create(ba);ca.prototype.constructor=ca;ca.__superConstructor__=z;function ca(ea,fa,ga,ha){"use strict";this.$MercuryFileUploader0=ea;this.$MercuryFileUploader1={};this.$MercuryFileUploader2={};this.$MercuryFileUploader3={};this.$MercuryFileUploader4={};this.$MercuryFileUploader5={};this.$MercuryFileUploader6={};this.$MercuryFileUploader7={};this.$MercuryFileUploader8={};this.updateElements(fa,ga,ha);}ca.prototype.updateElements=function(ea,fa,ga){"use strict";this.$MercuryFileUploader9&&this.$MercuryFileUploader9.release();this.$MercuryFileUploader9=new t();this.$MercuryFileUploadera&&this.$MercuryFileUploadera.destroy();this.$MercuryFileUploadera=new l(ea,[o,m]);this.$MercuryFileUploadera.setAllowCrossOrigin(true);this.$MercuryFileUploadera.setUploadInParallel(true);var ha=j.find(ea,"._4q60"),ia=j.find(ha,"._4q61");new n(ha,ia,fa);this.$MercuryFileUploader9.addSubscriptions(this.$MercuryFileUploadera.subscribe('submit',function(){var ja={count:0,file_sizes:[]};if(fa.files){for(var ka=0;ka<fa.files.length;ka++)if(fa.files[ka].size>r.AttachmentMaxSize){this.showAttachmentSizeErrorDialog();return false;}var la={};for(var ma=0;ma<fa.files.length;ma++){var na=this.$MercuryFileUploaderb();this.$MercuryFileUploaderc(na,fa.files[ma].name);ja.count++;ja.file_sizes.push(fa.files[ma].size);la[na]=fa.files[ma];}this.$MercuryFileUploadera.setFiles(la);}else{ga.value=this.$MercuryFileUploaderb();this.$MercuryFileUploaderc(ga.value,fa.value);ja.count=1;}this.inform('submit',ja);}.bind(this)),this.$MercuryFileUploadera.subscribe('success',this.$MercuryFileUploaderd.bind(this)),this.$MercuryFileUploadera.subscribe('failure',this.$MercuryFileUploadere.bind(this)),k.listen(ia,'click',y(this.inform,this,'open')));};ca.prototype.showAttachmentSizeErrorDialog=function(){"use strict";this.$MercuryFileUploadera.abort();this.$MercuryFileUploadera.clear();new i().setTitle("The file you have selected is too large").setBody("The file you have selected is too large. The maximum size is 25MB.").setButtons(i.OK).setSemiModal(true).show();};ca.prototype.addDroppedFiles=function(ea){"use strict";if(!this.$MercuryFileUploadera||!this.$MercuryFileUploadera.canUseXHR())return;var fa={},ga={count:0,file_sizes:[]};for(var ha=0;ha<ea.length;ha++){var ia=ea[ha];if(ia.size>r.AttachmentMaxSize){this.showAttachmentSizeErrorDialog();return false;}var ja=this.$MercuryFileUploaderb();this.$MercuryFileUploaderc(ja,ia.name);fa[ja]=ia;ga.file_sizes.push(ia.size);ga.count++;}this.$MercuryFileUploadera.setFiles(fa);this.$MercuryFileUploadera.forceSendViaXHR();this.inform('submit',ga);};ca.prototype.isUploading=function(){"use strict";return !!Object.keys(this.$MercuryFileUploader6).length;};ca.prototype.addCachedAttachments=function(ea){"use strict";ea.forEach(function(fa){var ga=this.$MercuryFileUploaderb();this.$MercuryFileUploaderc(ga,fa.filename);this.$MercuryFileUploaderf(ga,fa);}.bind(this));};ca.prototype.addCachedImageFiles=function(ea){"use strict";var fa="Photo";ea.forEach(function(ga){var ha=this.$MercuryFileUploaderb();this.$MercuryFileUploaderc(ha,fa);this.$MercuryFileUploaderf(ha,{filename:ga,image_id:ga,filetype:'image/jpeg'});}.bind(this));};ca.prototype.getAttachments=function(){"use strict";return w(this.$MercuryFileUploader1);};ca.prototype.getImageFiles=function(){"use strict";var ea=Object.keys(this.$MercuryFileUploader2).sort(),fa=[];ea.forEach(function(ga){return fa.push(this.$MercuryFileUploader2[ga]);}.bind(this));return fa;};ca.prototype.getVideoFiles=function(){"use strict";return w(this.$MercuryFileUploader3);};ca.prototype.getAudioFiles=function(){"use strict";return w(this.$MercuryFileUploader4);};ca.prototype.getFiles=function(){"use strict";return w(this.$MercuryFileUploader5);};ca.prototype.removeAttachments=function(){"use strict";j.empty(this.$MercuryFileUploader0);this.$MercuryFileUploader1={};this.$MercuryFileUploader2={};this.$MercuryFileUploader3={};this.$MercuryFileUploader4={};this.$MercuryFileUploader5={};this.$MercuryFileUploader7={};this.$MercuryFileUploader6={};this.$MercuryFileUploader8={};h.hide(this.$MercuryFileUploader0);this.inform('dom-updated');};ca.prototype.destroy=function(){"use strict";this.$MercuryFileUploader9&&this.$MercuryFileUploader9.release();this.$MercuryFileUploadera&&this.$MercuryFileUploadera.destroy();this.removeAttachments();};ca.prototype.$MercuryFileUploaderc=function(ea,fa){"use strict";var ga=q[':fb:mercury:upload-file-row'].build();this.$MercuryFileUploader7[ea]=ga;this.$MercuryFileUploader6[ea]=true;this.$MercuryFileUploader8[ea]=Date.now();j.appendContent(ga.getNode('iconText'),da(fa));k.listen(ga.getNode('closeFileUpload'),'click',this.$MercuryFileUploaderg.bind(this,ea));j.appendContent(this.$MercuryFileUploader0,ga.getRoot());h.show(this.$MercuryFileUploader0);this.inform('dom-updated');};ca.prototype.$MercuryFileUploaderg=function(ea,event){"use strict";if(this.$MercuryFileUploader6[ea]){this.inform('upload-canceled-during-upload');}else if(this.$MercuryFileUploader1[ea]||this.$MercuryFileUploader2[ea]||this.$MercuryFileUploader3[ea]||this.$MercuryFileUploader4[ea]||this.$MercuryFileUploader5[ea])this.inform('upload-canceled-after-uploaded');delete this.$MercuryFileUploader1[ea];delete this.$MercuryFileUploader2[ea];delete this.$MercuryFileUploader3[ea];delete this.$MercuryFileUploader4[ea];delete this.$MercuryFileUploader5[ea];delete this.$MercuryFileUploader6[ea];delete this.$MercuryFileUploader8[ea];var fa=this.$MercuryFileUploader7[ea];delete this.$MercuryFileUploader7[ea];if(fa){j.remove(fa.getRoot());this.inform('dom-updated');}this.inform('upload-canceled');return false;};ca.prototype.$MercuryFileUploaderh=function(ea,fa){"use strict";var ga=this.$MercuryFileUploader7[ea],ha=p.getAttachIconClassByMime(fa);h.addClass(ga.getNode('iconText'),ha);h.addClass(ga.getRoot(),'done');};ca.prototype.$MercuryFileUploaderf=function(ea,fa){"use strict";if(this.$MercuryFileUploader6[ea]){delete this.$MercuryFileUploader6[ea];if(fa.image_id){this.$MercuryFileUploader2[ea]=fa.image_id;}else if(fa.video_id){this.$MercuryFileUploader3[ea]=fa.video_id;}else if(fa.audio_id){this.$MercuryFileUploader4[ea]=fa.audio_id;}else if(fa.file_id){this.$MercuryFileUploader5[ea]=fa.file_id;}else this.$MercuryFileUploader1[ea]=fa;this.$MercuryFileUploaderh(ea,fa.filetype);this.inform('one-upload-completed',{upload_time_ms:Date.now()-this.$MercuryFileUploader8[ea]});}if(!this.isUploading())this.inform('all-uploads-completed',{count:this.getAttachments().length});};ca.prototype.$MercuryFileUploaderd=function(event,ea){"use strict";var fa=ea.response.getPayload();this.$MercuryFileUploaderf(this.$MercuryFileUploaderi(ea),fa.metadata[0]);};ca.prototype.$MercuryFileUploadere=function(event,ea){"use strict";this.inform('one-upload-failed');this.$MercuryFileUploaderg(this.$MercuryFileUploaderi(ea),event);};ca.prototype.$MercuryFileUploaderb=function(){"use strict";return 'upload_'+s.getNewID();};ca.prototype.$MercuryFileUploaderi=function(ea){"use strict";var fa=ea.response.getPayload();if(ea.upload){return ea.upload.getName();}else return fa.uploadID;};function da(ea){if(ea&&ea.startsWith('C:\\fakepath\\'))return ea.substring(12);return ea;}e.exports=ca;},null);
__d("URLScraper",["ArbiterMixin","DataStore","Event","URLMatcher","copyProperties","mixin"],function(a,b,c,d,e,f,g,h,i,j,k,l){var m='scraperLastPermissiveMatch',n=l(g);for(var o in n)if(n.hasOwnProperty(o))q[o]=n[o];var p=n===null?null:n.prototype;q.prototype=Object.create(p);q.prototype.constructor=q;q.__superConstructor__=n;function q(r,s){"use strict";this.input=r;this.enable();this.getValueFn=s;}q.prototype.reset=function(){"use strict";h.set(this.input,m,null);};q.prototype.enable=function(){"use strict";if(this.events)return;var r=function(s){setTimeout(this.check.bind(this,s),30);};this.events=i.listen(this.input,{paste:r.bind(this,false),keydown:r.bind(this,true)});};q.prototype.disable=function(){"use strict";if(!this.events)return;for(var event in this.events)this.events[event].remove();this.events=null;};q.prototype.check=function(r){"use strict";var s=this.getValueFn?this.getValueFn():this.input.value;if(r&&q.trigger(s))return;var t=q.match(s),u=j.permissiveMatch(s);if(u&&(u!=h.get(this.input,m))){h.set(this.input,m,u);this.inform('match',{url:t||u,alt_url:u});}};k(q,j);e.exports=q;},null);
__d("MercuryShareLinkUploader",["ArbiterMixin","AsyncRequest","CSS","DOM","Event","Form","URLScraper","WebMessengerEvents","mixin","isEmpty"],function(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p){var q=o(g);for(var r in q)if(q.hasOwnProperty(r))t[r]=q[r];var s=q===null?null:q.prototype;t.prototype=Object.create(s);t.prototype.constructor=t;t.__superConstructor__=q;function t(u,v,w,x,y){"use strict";this.$MercuryShareLinkUploader0=u;this.$MercuryShareLinkUploader1=v;this.$MercuryShareLinkUploader2=w;this.$MercuryShareLinkUploader3=y;this.$MercuryShareLinkUploader4=false;this.$MercuryShareLinkUploader5=null;this.$MercuryShareLinkUploader6=null;k.listen(x,'click',this.close.bind(this));k.listen(y,'keyup',function(){!y.value.length&&this.$MercuryShareLinkUploader7.enable();}.bind(this));this.$MercuryShareLinkUploader7=new m(y);this.$MercuryShareLinkUploader7.subscribe('match',function(z,aa){this.loadShare(aa&&aa.url);}.bind(this));}t.prototype.getAttachData=function(){"use strict";return this.loadAttachData(this.$MercuryShareLinkUploader4,this.$MercuryShareLinkUploader0,this.$MercuryShareLinkUploader3);};t.prototype.loadAttachData=function(u,v,w,x){"use strict";if(u){var y=l.serialize(v),z=y.attachment&&y.attachment.params,aa=y.link_metrics?y.link_metrics.no_image:true;if(!z||p(z))return null;var ba=x?x():w.value;if(ba.indexOf(z.url)===-1)return y;if(!z.summary&&!z.favicon&&aa&&z.title&&z.url&&z.url.substr(0,z.title.length)===z.title)return null;return y;}return null;};t.prototype.check=function(){"use strict";this.$MercuryShareLinkUploader7.check();};t.prototype.close=function(){"use strict";this.$MercuryShareLinkUploader8();this.$MercuryShareLinkUploader7.disable();this.inform('closed');};t.prototype.clear=function(){"use strict";this.$MercuryShareLinkUploader8();this.$MercuryShareLinkUploader7.enable();};t.prototype.enable=function(){"use strict";this.$MercuryShareLinkUploader7.enable();};t.prototype.disable=function(){"use strict";this.$MercuryShareLinkUploader7.disable();};t.prototype.loadShare=function(u){"use strict";this.$MercuryShareLinkUploader5=u;this.$MercuryShareLinkUploader6&&this.$MercuryShareLinkUploader6.abort();this.$MercuryShareLinkUploader6=new h().setMethod('POST').setURI('/ajax/share_scrape.php').setData({u:u}).setHandler(this.$MercuryShareLinkUploader9.bind(this).bind(null,u)).setStatusElement(this.$MercuryShareLinkUploader2);this.$MercuryShareLinkUploader6.send();this.inform('link-detected');};t.prototype.$MercuryShareLinkUploader9=function(u,v){"use strict";if(this.$MercuryShareLinkUploader5!==u)return;this.$MercuryShareLinkUploader5=null;this.$MercuryShareLinkUploader6=null;i.show(this.$MercuryShareLinkUploader0);j.empty(this.$MercuryShareLinkUploader1);j.setContent(this.$MercuryShareLinkUploader1,v.payload);this.$MercuryShareLinkUploader4=true;if(!this.getAttachData()){this.close();return;}n.detailDOMChanged();};t.prototype.$MercuryShareLinkUploader8=function(){"use strict";i.hide(this.$MercuryShareLinkUploader0);this.$MercuryShareLinkUploader4=false;this.$MercuryShareLinkUploader5=null;this.$MercuryShareLinkUploader6&&this.$MercuryShareLinkUploader6.abort();this.$MercuryShareLinkUploader6=null;this.$MercuryShareLinkUploader7.reset();n.detailDOMChanged();};e.exports=t;},null);
__d("FBRTCLogger",["Log","LogHistory","MarauderLogger","formatDate","pageID"],function(a,b,c,d,e,f,g,h,i,j,k){var l='webrtc',m='sent_message',n='received_message',o='send_succeeded',p='send_failed',q='info',r='call_action',s='client_event',t='client_error',u='type',v='msg_id',w='ack_msg_id',x='call_id',y='from',z='to',aa='content',ba='tag',ca='peer_id',da='error_code',ea='trigger',fa='endcallstats',ga=null;ha.getInstance=function(){"use strict";if(!ga)ga=new ha();return ga;};function ha(){"use strict";this.$FBRTCLogger0=h.getInstance(l);}ha.prototype.logToConsole=function(ia){"use strict";var ja='Console';this.$FBRTCLogger1(null,null,ja,ia);this.$FBRTCLogger0.log(ja,ia);};ha.prototype.logReceivedMessage=function(ia,ja,ka){"use strict";var la={};la[y]=ia;la[x]=ja;la[u]=ka.type;la[v]=ka.msg_id;if(ka.sdp)la[aa]=ka.sdp;if(ka.ack_id)la[w]=ka.ack_id;this.$FBRTCLogger2(n,la);this.$FBRTCLogger1(ia,ja,'Received',ka.type+', '+ka.msg_id);};ha.prototype.logSentMessage=function(ia,ja,ka){"use strict";var la={};la[z]=ia;la[x]=ja;la[u]=ka.type;la[v]=ka.msg_id;if(ka.sdp)la[aa]=ka.sdp;if(ka.ack_id)la[w]=ka.ack_id;this.$FBRTCLogger2(m,la);this.$FBRTCLogger1(ia,ja,'Sent',ka.type+', '+ka.msg_id);};ha.prototype.logSentMessageSuccess=function(ia,ja,ka,la){"use strict";var ma={};ma[ca]=ia;ma[x]=ja;ma[u]=ka;ma[v]=la;this.$FBRTCLogger2(o,ma);};ha.prototype.logSentMessageFailure=function(ia,ja,ka,la,ma){"use strict";var na={};na[ca]=ia;na[x]=ja;na[u]=ka;na[v]=la;na[da]=ma;this.$FBRTCLogger2(p,na);this.$FBRTCLogger1(ia,ja,'Send Failed',ka+', '+ma);};ha.prototype.logCallAction=function(ia,ja,ka,la,ma){"use strict";var na={};na[ca]=ia;na[x]=ja;na[r]=ka;na[aa]=la;if(ma)na[ea]=ma;this.$FBRTCLogger2(r,na);this.$FBRTCLogger1(ia,ja,'CallAction',ka+', '+la);};ha.prototype.logEvent=function(ia,ja,event){"use strict";var ka={};ka[ca]=ia;ka[x]=ja;ka[aa]=event;this.$FBRTCLogger2(s,ka);this.$FBRTCLogger1(ia,ja,'Event',event);};ha.prototype.logInfo=function(ia,ja,ka){"use strict";var la={};la[ca]=ia;la[x]=ja;la[aa]=ka;this.$FBRTCLogger2(q,la);this.$FBRTCLogger1(ia,ja,'Info',ka);};ha.prototype.logError=function(ia,ja,ka){"use strict";var la={};la[ca]=ia;la[x]=ja;la[aa]=ka;this.$FBRTCLogger2(t,la);this.$FBRTCLogger1(ia,ja,'Error',ka);};ha.prototype.logErrorWithoutID=function(ia){"use strict";this.logError(null,null,ia);};ha.prototype.logEndCallSummary=function(ia){"use strict";if(!ia)return;var ja={};ja[ca]=ia.peerID;ja[x]=ia.callID;ja[ba]=fa;ja[aa]=ia.toString();var ka=ia.getExtraInfo();for(var la in ka)if(ka.hasOwnProperty(la))ja[la]=ka[la];this.$FBRTCLogger2(q,ja);this.$FBRTCLogger1(ia.peerID,ia.callID,'Call Summary',ja);};ha.prototype.$FBRTCLogger2=function(ia,ja){"use strict";ja.page_id=k;this.$FBRTCLogger0.log(ia,ja);i.log(ia,l,ja);};ha.prototype.$FBRTCLogger1=function(ia,ja,ka,la){"use strict";};ha.CallAction={START_CALL:'start_call',RECEIVED_CALL:'received_call',ANSWER_CALL:'answer_call',END_CALL:'end_call',DENIED_PERMISSION:'denied_permission',SET_MUTE:'set_mute',SET_VIDEO_ON:'set_video_on',SET_SELF_VIEW_ON:'set_self_view_on',SET_FULLSCREEN_ON:'set_fullscreen_on',START_SKYPE:'start_skype',TRY_NEW:'try_new',OPEN_POPUP:'open_popup',POPUP_OPENED:'popup_opened',AUTO_DISABLE_VIDEO:'auto_disable_video'};ha.Trigger={ADMIN_MESSAGE:'admin_message',CHAT_TAB_ICON:'chat_tab_icon',CHAT_TAB_ICON_TOUR:'chat_tab_icon_tour',SKYPE_DEPRECATION_DIALOG:'skype_deprecation_dialog',REDIAL_BUTTON:'redial_button',RETURN_CALL:'return_call',UNKNOWN:'unknown'};ha.Key={DEVICE_INFO:'device_info',RATING:'rating5',RATING_SHOWN:'rating_shown',SURVEY_CHOICE:'survey_choice',SURVEY_DETAILS:'survey_details',SURVEY_SHOWN:'survey_shown',INITIATED_BY_PAGE_ID:'initiated_by_page_id'};e.exports=ha;},null);
__d("FBRTCSoundController",["ChatConfig","Sound"],function(a,b,c,d,e,f,g,h){var i=[g.get('sound.ringtone_mp3_url'),g.get('sound.ringtone_ogg_url')],j={playIncomingRingtone:function(k,l,m){var n=['incoming_ringtone',k.toString(),l.toString()].join('_');h.play(i,n,m);},stopIncomingRingtone:function(){h.stop(i);}};e.exports=j;},null);
__d("VideoCallSkypeDeprecationWarning",["AsyncDialog","AsyncRequest","CacheStorage","VideoCallSupport","XSkypeDeprecationWarningDialogControllerURIBuilder","FBRTCLogger","FBRTCUnsupportedBrowserMessage"],function(a,b,c,d,e,f,g,h,i,j,k,l,m){var n='localstorage',o='RTC_',p='SKYPE_DEPRECATION_STATE',q=1000*60*60*24;function r(s){"use strict";this.$VideoCallSkypeDeprecationWarning0=new i(n,o);this.$VideoCallSkypeDeprecationWarning1=s;this.$VideoCallSkypeDeprecationWarning2=l.getInstance();}r.prototype.showWarningOrStartCall=function(s,t){"use strict";if(j.isSkypeDeprecated()){if(j.isWebrtcSupported()){this.$VideoCallSkypeDeprecationWarning1.makeWebRTCCall(s,t||l.Trigger.CHAT_TAB_ICON);}else m.showForOutgoingCall();}else if(this.$VideoCallSkypeDeprecationWarning3(s)){this.$VideoCallSkypeDeprecationWarning4(s);}else if(this.$VideoCallSkypeDeprecationWarning5(s)){this.$VideoCallSkypeDeprecationWarning1.makeWebRTCCall(s,t||l.Trigger.CHAT_TAB_ICON);}else this.$VideoCallSkypeDeprecationWarning1.makeSkypeCall(s);};r.prototype.$VideoCallSkypeDeprecationWarning5=function(s){"use strict";if(!this.$VideoCallSkypeDeprecationWarning1.canCallByWebrtc(s))return false;if(!j.isPluginInstalled(false))return true;return this.$VideoCallSkypeDeprecationWarning6().optedInToWebRTC;};r.prototype.$VideoCallSkypeDeprecationWarning3=function(s){"use strict";if(!j.isPluginInstalled(false))return false;var t=this.$VideoCallSkypeDeprecationWarning6();return !t.optedInToWebRTC&&(Date.now()-t.updatedAt)>q;};r.prototype.$VideoCallSkypeDeprecationWarning4=function(s){"use strict";this.$VideoCallSkypeDeprecationWarning2.logInfo(s,null,'Show Deprecation Dialog');this.$VideoCallSkypeDeprecationWarning7();if(!j.isWebrtcSupported()){m.warnForOutgoingCall(function(){this.$VideoCallSkypeDeprecationWarning1.makeSkypeCall(s);}.bind(this));return;}var t=new k().getURI(),u=new h(t),v=this;g.send(u,function(w){w.subscribe('confirm',function(){w.hide();v.$VideoCallSkypeDeprecationWarning8();v.$VideoCallSkypeDeprecationWarning1.makeWebRTCCall(s,l.Trigger.SKYPE_DEPRECATION_DIALOG);v.$VideoCallSkypeDeprecationWarning2.logCallAction(s,null,l.CallAction.TRY_NEW);});w.subscribe('cancel',function(){v.$VideoCallSkypeDeprecationWarning1.makeSkypeCall(s);v.$VideoCallSkypeDeprecationWarning2.logCallAction(s,null,l.CallAction.START_SKYPE);});});};r.prototype.$VideoCallSkypeDeprecationWarning7=function(){"use strict";this.$VideoCallSkypeDeprecationWarning0.set(p,{optedInToWebRTC:false,updatedAt:Date.now()});};r.prototype.$VideoCallSkypeDeprecationWarning8=function(){"use strict";this.$VideoCallSkypeDeprecationWarning0.set(p,{optedInToWebRTC:true,updatedAt:Date.now()});};r.prototype.$VideoCallSkypeDeprecationWarning6=function(){"use strict";var s=this.$VideoCallSkypeDeprecationWarning0.get(p);if(s)return s;return {optedInToWebRTC:false,updatedAt:0};};r.prototype.ut_setStorage=function(s){"use strict";this.$VideoCallSkypeDeprecationWarning0=s;};e.exports=r;},null);
__d("VideoCallCore",["Event","Arbiter","AsyncRequest","AvailableListConstants","Bootloader","ChannelConstants","Cookie","CSS","Dialog","UserAgent_DEPRECATED","VideoCallSupport","VideoCallSkypeDeprecationWarning","emptyFunction","ge","PresenceStatus","randomInt","VideoCallUI","VideoCallIncomingCallController","VideoCallTemplates","ShortProfiles","VideoCallRecordMessageDialog"],function(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v){var w=b('VideoCallUI').module,x=b('VideoCallIncomingCallController').module;b('VideoCallTemplates');var y=[],z=[],aa=null,ba={mightReloadPostInstall:function(){return p.windows();},onVideoMessage:function(ga){y.push(ga);k.loadModules(["VideoCallController"],s);},onRTCMessage:function(ga){if(q.isReceiveWebrtcSupported()&&x){z.push(ga);ca();}},setMessageHandler:function(ga){this.onVideoMessage=ga;if(ga)while(y.length)ga(y.shift());},setRTCMessageHandler:function(ga){this.onRTCMessage=ga;if(ga)while(z.length)ga(z.shift());},availableForCall:function(ga){if(!q.isSkypeDeprecated()){var ha=u.get(ga);if(ha===j.ACTIVE){var ia=u.getDetailedActivePresence(ga);if(ia===j.ACTIVE_ON_WEB)return true;}}return ea(ga);},attachListenerToProfileButton:function(ga){var ha=t('videoCallProfileButton');if(ha){if(!q.isVideoCallSupported()){n.hide(ha);return;}g.listen(ha,'click',function(event){ba.startCallOrLeaveMessage(ga,'profile_button_click_timeline');});}},startCallOrLeaveMessage:function(ga,ha){if(this.availableForCall(ga)){ba.showOutgoingCallDialog(ga,ha);}else b('ShortProfiles').get(ga,function(ia){b('VideoCallRecordMessageDialog').get(ga,ia.firstName).show();});},showOutgoingCallDialog:function(ga,ha,ia){ba.logClick(ga,(ha||'unknown'));var ja=new r(ba);ja.showWarningOrStartCall(ga,ia);},canCallByWebrtc:function(ga){if(q.isSendWebrtcSupported()&&w)return ea(ga);return false;},makeWebRTCCall:function(ga,ha){var ia=parseInt(ga,10);ca();var ja=da();aa.startingCallTo(ia,ja);w.openAsCaller(ga,ja,ha);},makeSkypeCall:function(ga){var ha=q.isPluginInstalled()?'outgoing_dialog.php':'intro.php',ia='/ajax/chat/video/'+ha+'?idTarget='+ga;new o().setAllowCrossPageTransition(true).setAsync(new i(ia).setHandler(s).setServerDialogCancelHandler(s)).show();},logClick:function(ga,ha){new i().setURI('/ajax/chat/video/log_click.php').setData({targetUserID:ga,clickSource:ha}).setAllowCrossPageTransition(true).setErrorHandler(s).send();}};function ca(){if(!aa)aa=new x(ba);}function da(){return v(0,4294967295);}function ea(ga){var ha=u.getCapabilities(ga),ia=l.CAPABILITY_VOIP_INTEROP|l.CAPABILITY_VIDEO,ja=ha&ia;return ja!==0;}function fa(){if(!ba.mightReloadPostInstall())return;var ga=m.get('vcpwn');if(ga){m.clear('vcpwn');var ha=m.get('vctid');if(ha){m.clear('vctid');if(m.get('vctid'))return;if(ha&&q.isPluginInstalled()){var ia='/ajax/chat/video/outgoing_dialog.php?idTarget='+ha;new o().setAllowCrossPageTransition(true).setAsync(new i(ia)).show();}}}}h.subscribe(l.getArbiterType('video'),function(ga,ha){ba.onVideoMessage(ha.obj);});h.subscribe(l.getArbiterType('webrtc'),function(ga,ha){ba.onRTCMessage(ha.obj);});h.subscribe(l.getArbiterType('chat_event'),function(ga,ha){if(ha.obj.event_name=="missed-call")k.loadModules(["VideoCallController"],function(ia){ia.onMissedCallEvent(ha.obj);});});fa();if(q.isReceiveWebrtcSupported()&&x)ca();e.exports=ba;},null);
__d("ChatActivity",["Event","Arbiter","AvailableList","AvailableListConstants","JSLogger","MercuryConfig","PresenceState","UserActivity","copyProperties"],function(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o){var p=l.activity_limit||60000,q=l.idle_limit||1800000,r=l.idle_poll_interval||300000,s=k.create('chat_activity'),t=Date.now(),u=t,v=true;function w(){var aa=Date.now();return !!(v&&(aa-t<p));}var x=o(new h(),{isActive:w});function y(){var aa=t;t=Date.now();if(t-aa>q){s.debug('idle_to_active',aa);m.doSync();}x.inform('activity');}i.subscribe(j.ON_AVAILABILITY_CHANGED,function(){if(!i.isUserIdle())u=Date.now();});g.listen(window,'focus',function(){v=true;y();});g.listen(window,'blur',function(){v=false;});n.subscribe(function(){y();});function z(aa){var ba=aa&&aa.at&&m.verifyNumber(aa.at);if(typeof ba!=='number')ba=null;return ba||0;}setInterval(function(){var aa=Date.now(),ba=z(m.get()),ca=Math.max(t,ba,u);if(aa-ca>q){s.debug('idle',{cookie:ba,local:t,presence:u});x.inform('idle',aa-ca);}},r);m.registerStateStorer(function(aa){var ba=z(aa);if(ba<t)aa.at=t;return aa;});h.subscribe(k.DUMP_EVENT,function(aa,ba){ba.chat_activity={activity_limit:p,idle_limit:q,idle_poll_interval:r,last_active_time:t,last_global_active_time:u};});e.exports=x;},null);
__d("ChatAnimatedGifs",["URI"],function(a,b,c,d,e,f,g){var h={shouldHideBody:function(i){if(!i.has_attachment)return false;for(var j=0;j<i.attachments.length;j++){var k=i.attachments[j];if(k.preview_url){var l=h.getRawUrlFromSafeUrl(k.preview_url);if(i.body==l)return true;}}return false;},getRawUrlFromSafeUrl:function(i){return g(i).getQueryData().url;}};e.exports=h;},null);
__d("ChatEmployeeAwayWarning",["MercuryIDs","MercuryParticipants","MercuryViewer"],function(a,b,c,d,e,f,g,h,i){var j={updateEmployeeAwayWarning:function(k,l,m){h.get(i.getID(),function(n){var o=n.employee;if(o)h.getMulti(k.participants,function(p){var q=false,r=g.getUserIDFromThreadID(k.thread_id);if(!r)return;var s='fbid:'+r;for(var t in p)if(s==p[t].id&&p[t].is_employee_away)q=true;if(q){l();}else m();});});}};e.exports=j;},null);
__d("MercuryTimestampTracker",["MercuryActionType","MercuryPayloadSource","MercurySingletonMixin","MercuryServerRequests","copyProperties"],function(a,b,c,d,e,f,g,h,i,j,k){function l(m){this._fbid=m;this._serverRequests=j.getForFBID(this._fbid);this._lastTimestamp=0;this._serverRequests.subscribe('update-messages',function(n,o){if(!o.actions||!o.actions.length)return;if(o.payload_source==h.CLIENT_SEND_MESSAGE||o.payload_source==h.UNKNOWN)return;for(var p=0;p<o.actions.length;p++){var q=o.actions[p],r=q.action_type;if(r==g.USER_GENERATED_MESSAGE&&q.thread_id&&q.timestamp>this._lastTimestamp)this._lastTimestamp=q.timestamp;}}.bind(this));}k(l.prototype,{getLastUserMessageTimestamp:function(){return this._lastTimestamp;}});k(l,i);e.exports=l;},null);
__d("ChatTabModel",["Arbiter","ArbiterMixin","ChatBehavior","ChatConfig","LogHistory","JSLogger","MercuryAssert","MercuryLocalIDs","PresenceInitialData","PresenceState","PresenceUtil","areJSONRepresentationsEqual","arrayContains","copyProperties","MercuryServerRequests","MercuryThreads","MercuryTimestampTracker"],function(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t){var u=b('MercuryServerRequests').get(),v=b('MercuryThreads').get(),w=b('MercuryTimestampTracker').get(),x=[],y=null,z=null,aa=null;function ba(){return parseInt(o.serverTime,10);}var ca=j.get('tab_max_load_age')||3600000,da=ba()-ca,ea=0,fa=20,ga=k.getInstance('chat_tab_model'),ha=false;function ia(bb){var cb=p.verifyNumber(bb.uct2);if(!cb||typeof cb!=='number'){ga.warn('bad_cookie_version',bb);return null;}if(cb<ea||cb<da)return null;return cb;}function ja(bb){if(bb.uct2==ea)return;var cb=ia(bb),db={};if(!cb){db.old_tabs=bb&&bb.t2&&JSON.stringify(bb.t2);db.old_promoted=bb&&bb.lm2;db.old_time=bb&&bb.uct2;db.old_reason=bb&&bb.tr;db.old_window=bb&&bb.tw;var eb=[];x.forEach(function(fb){if(!fb.fragile){var gb={i:fb.id,si:fb.server_id};if(fb.raised)gb.r=1;eb.push(gb);}});bb.t2=eb;bb.lm2=y;bb.uct2=ea;bb.tr=aa;bb.tw=q.getSessionID();db.new_tabs=JSON.stringify(bb.t2);db.new_promoted=bb.lm2;db.new_time=bb.uct2;db.new_reason=bb.tr;db.new_window=bb.tw;ga.debug('store',db);}else{db.tabs=bb&&bb.t2&&JSON.stringify(bb.t2);db.promoted=bb&&bb.lm2;db.time=bb&&bb.uct2;db.reason=bb&&bb.tr;db.window=bb&&bb.tw;db.last_change_time=ea;db.last_change_reason=aa;db.min_change_time=da;ga.warn('store_bad_state',db);}return bb;}function ka(bb){if(bb){var cb=ia(bb);if(cb&&cb!==ea){var db={};db.old_tabs=JSON.stringify(x);db.old_promoted=y;db.old_time=ea;db.old_reason=aa;db.window_id=q.getSessionID();db.cookie_tabs=bb&&bb.t2&&JSON.stringify(bb.t2);db.cookie_promoted=bb&&bb.lm2;db.cookie_time=bb&&bb.uct2;db.cookie_reason=bb&&bb.tr;db.cookie_window=bb&&bb.tw;ea=cb;aa='load';var eb=la(bb.t2,bb.lm2||null);db.load_result=eb;db.new_tabs=JSON.stringify(x);db.new_promoted=y;db.new_time=ea;db.new_reason=aa;var event='load';if(!ha)event+='_init';ga.log(event,db);return eb;}}else ga.warn('load_bad_state',bb);return false;}function la(bb,cb){if(ma(bb,cb)){var db=x.filter(function(gb){return gb.fragile;}),eb={};y=null;x=bb.map(function(gb){var hb={id:gb.i,server_id:gb.si};if(hb.id==cb)y=hb.id;if(gb.r)hb.raised=true;eb[hb.id]=hb;return hb;});x=x.filter(function(gb){return gb!=null;});if(z)for(var fb in z)if(!eb[fb]||!eb[fb].raised)delete z[fb];db=db.filter(function(gb){return !eb[gb.id];});x=x.concat(db);qa();return true;}return false;}function ma(bb,cb){if(cb!=y)return true;var db=x.filter(function(gb){return !gb.fragile;});if(bb.length!=db.length)return true;for(var eb=0,fb=bb.length;eb<fb;eb++)if(!r(bb[eb],db[eb]))return true;return false;}function na(bb,cb,db){var eb=ka(p.get());if(cb===(void 0)||cb>ea){if(bb()){eb=true;aa=db||null;pa(cb);}}else ga.error('rejected',{change_time:cb,state_time:ea});eb&&oa();}function oa(){if(ha)za.inform('chat/tabs-changed',za.get());}function pa(bb){if(bb===(void 0))bb=Math.max(w.getLastUserMessageTimestamp()||1,ea+1);ea=bb;p.doSync();}function qa(bb){var cb=x.length-fa;if(cb>0)x=x.filter(function(db){return db.raised||db.id==bb||cb--<=0;});if(cb>0)x=x.filter(function(db){return db.id==y||db.id==bb||cb--<=0;});}function ra(bb){for(var cb=0;cb<x.length;cb++)if(x[cb].id==bb)return cb;return -1;}function sa(bb,cb){var db=v.getThreadMetaNow(bb);if(!db)return false;if(db.is_canonical_user){return va(bb,cb);}else{var eb=ta(bb);if(eb)u.getServerThreadID(bb,function(fb){if(xa(bb,fb)){pa();oa();}});return eb;}}function ta(bb){if(ra(bb)===-1){x.push({id:bb,fragile:true});ga.log('open_fragile_tab',{tabs:JSON.stringify(x),opened:bb,window_id:q.getSessionID()});return true;}return false;}function ua(bb){var cb=[];bb.forEach(function(db){var eb=ra(db);if(eb!==-1)cb.push(x[eb]);});x.forEach(function(db){if(!s(bb,db.id))cb.push(db);});na(function(){if(ma(cb,y)){x=cb;return true;}return false;});}function va(bb,cb){var db=ra(bb);if(db!=-1)if(x[db].fragile){x.splice(db,1);}else{cb&&(x[db].signatureID=cb);return true;}for(var eb=0;eb<=x.length;eb++)if(eb==x.length||x[eb].fragile){x.splice(eb,0,{id:bb,signatureID:cb});qa(bb);ga.log('open_tab',{tabs:JSON.stringify(x),opened:bb,window_id:q.getSessionID()});return true;}}function wa(bb){var cb=ra(bb);if(cb!=-1&&(!x[cb].raised||y!==bb)){x[cb].raised=true;y=bb;return true;}return false;}function xa(bb,cb){var db=ra(bb);if(db!=-1&&x[db].fragile){var eb=x[db];eb.fragile=false;eb.server_id=cb;var fb=[];x.forEach(function(gb){if(gb.id!=bb){if(eb&&gb.fragile){fb.push(eb);eb=null;}fb.push(gb);}});if(eb)fb.push(eb);x=fb;ga.log('make_permanent',{tabs:JSON.stringify(x),tab_id:bb,window_id:q.getSessionID()});return true;}return false;}function ya(bb){var cb=ra(bb);if(bb==y)y=null;if(cb!=-1){x.splice(cb,1);ga.log('close_tab',{tabs:JSON.stringify(x),closed:bb,window_id:q.getSessionID()});return true;}return false;}p.registerStateStorer(ja);p.registerStateLoader(function(bb){if(ka(bb))oa();});function za(){}t(za,h,{isTabPromoted:function(bb){if(bb)return bb==y;return false;},indexOf:function(bb){return ra(bb);},getTab:function(bb){m.isThreadID(bb);var cb=this.indexOf(bb);if(cb>-1){var db=x[cb];return t({},db);}return null;},getEmptyTab:function(){var bb;for(var cb=0;cb<x.length;cb++){bb=x[cb].id;if(v.isNewEmptyLocalThread(bb))return bb;}bb=n.generateThreadID();v.createNewLocalThread(bb,[]);return bb;},getServerTime:function(){return ba();},changeShowingTabs:function(bb){return ua(bb);},closeAllTabs:function(){if(x.length){ga.log('close_all_tabs',{closed_tabs:JSON.stringify(x),window_id:q.getSessionID()});x=[];y=null;if(z)z={};pa();oa();}},closeFragileTabs:function(){var bb=[];for(var cb=0;cb<x.length;cb++)if(x[cb].fragile&&!v.isNewEmptyLocalThread(x[cb].id)){bb.push(x[cb]);x.splice(cb);oa();break;}ga.log('close_fragile_tabs',{tabs:JSON.stringify(x),fragile_closed:bb,window_id:q.getSessionID()});},closeTab:function(bb,cb){m.isThreadID(bb);var db=false;if(z){delete z[bb];db=true;}na(function(){if(ya(bb))db=true;return db;},(void 0),cb);},raiseTab:function(bb,cb,db){m.isThreadID(bb);var eb=false;if(z&&cb){z[bb]=true;eb=true;}na(function(){if(sa(bb,db))eb=true;var fb=ra(bb);if(fb!=-1&&!x[fb].raised){x[fb].raised=true;eb=true;ga.log('raise_tab',{tabs:JSON.stringify(x),raised:bb,window_id:q.getSessionID()});}return eb;});},get:function(){var bb=x.map(function(cb){var db=t({},cb);delete db.fragile;if(z)db.raised=z[db.id];return db;});return {tabs:bb,promoted:y};},openFragileTab:function(bb){m.isThreadID(bb);if(ta(bb))oa();},openTab:function(bb){m.isThreadID(bb);na(sa.bind(null,bb));},lowerTab:function(bb){m.isThreadID(bb);var cb=false;if(z){delete z[bb];cb=true;}na(function(){var db=ra(bb);if(db!=-1&&x[db].raised){delete x[db].raised;ga.log('lower_tab',{tabs:JSON.stringify(x),lowered:bb,window_id:q.getSessionID()});cb=true;}return cb;});},raiseAndPromoteTab:function(bb,cb,db,eb,fb){m.isThreadID(bb);var gb=false;if(z&&cb){z[bb]=true;gb=true;}na(function(){if(sa(bb,db))gb=true;if(wa(bb)){gb=true;ga.log('raise_and_promote_tab',{tabs:JSON.stringify(x),promoted:bb,window_id:q.getSessionID()});}return gb;},eb,fb);},setPromotedTab:function(bb){m.isThreadID(bb);na(wa.bind(null,bb));},promoteThreadInPlaceOfThread:function(bb,cb,db,eb){m.isThreadID(bb);m.isThreadID(cb);na(function(){var fb=ra(bb),gb=ra(cb);if(eb){y=bb;}else if(y===cb)return true;var hb=x[fb];if(db){m.isThreadID(db);var ib=ra(db),jb=x[gb];x[gb]=hb;x.splice(fb,1);x.splice(ib,0,jb);}else{x[fb]=x[gb];x[gb]=hb;}return true;});},persistLocalRaised:function(){if(z){na(function(){var bb=false;x.forEach(function(cb){if(cb.raised!=z[cb.id]){bb=true;if(z[cb.id]){cb.raised=true;}else delete cb.raised;}});return bb;});ga.log('persist_local_raise',{tabs:JSON.stringify(x),window_id:q.getSessionID()});}}});g.subscribe(l.DUMP_EVENT,function(bb,cb){cb.chat_tabs={promoted:y,tabs:x.map(function(db){return t({},db);}),time:ea,max_load_age:ca};});function ab(){var bb=i.ignoresRemoteTabRaise();if(bb&&!z){ga.log('start_ignore_remote_raise');z={};oa();}else if(!bb&&z){ga.log('stop_ignore_remote_raise');z=null;oa();}}i.subscribe(i.ON_CHANGED,ab);ab();ka(p.getInitial(),true);if(ea===0)ea=ba()-600000;ha=true;e.exports=za;},null);
__d("MessagesEmoticons.react",["Grid.react","React","cx","emptyFunction","fbt"],function(a,b,c,d,e,f,g,h,i,j,k){var l=g.GridItem,m=8,n={smile:"smile",frown:"frown",tongue:"tongue",grin:"grin",gasp:"gasp",wink:"wink",pacman:"pacman",grumpy:"grumpy",unsure:"unsure",cry:"cry",kiki:"kiki",glasses:"glasses",sunglasses:"sunglasses",heart:"heart",devil:"devil",angel:"angel",squint:"squint",confused:"confused",upset:"upset",colonthree:"colonthree",like:"like"},o=h.createClass({displayName:"MessagesEmoticons",propTypes:{onEmoticonSelect:h.PropTypes.func},getDefaultProps:function(){return {onEmoticonSelect:j};},getEmoticons:function(){return Object.keys(n).map(function(p){return (h.createElement(l,{key:p},h.createElement("div",{className:"panelCell"},h.createElement("a",{"aria-label":n[p],className:'emoticon emoticon_'+p,onClick:function(){return this.props.onEmoticonSelect(p);}.bind(this)}))));}.bind(this));},render:function(){return (h.createElement("div",{className:"emoticonsTable"},h.createElement(g,{cols:m,alignv:"middle",alignh:"center",spacing:"pam"},this.getEmoticons())));}});e.exports=o;},null);
__d("StickerActions",["BanzaiLogger","StickerConstants","StickersDispatcher"],function(a,b,c,d,e,f,g,h,i){'use strict';var j={addPack:function(k){i.handleUpdateFromViewActions({actions:[{actionType:h.ActionTypes.ADD_PACK,packID:k}]});},removePack:function(k){i.handleUpdateFromViewActions({actions:[{actionType:h.ActionTypes.REMOVE_PACK,packID:k}]});},selectPack:function(k,l){if(!l)g.log('StickersLoggerConfig',{event:'select_pack',packid:k});i.handleUpdateFromViewActions({actions:[{actionType:h.ActionTypes.SELECT_PACK,packID:k}]});},resetNumNewPacks:function(){i.handleUpdateFromViewActions({actions:[{actionType:h.ActionTypes.RESET_NUM_NEW_PACKS}]});}};e.exports=j;},null);
__d("XStickerPackImagesControllerURIBuilder",["XControllerURIBuilder"],function(a,b,c,d,e,f){e.exports=b("XControllerURIBuilder").create("\/stickers\/{pack_id}\/images\/",{pack_id:{type:"Int",required:true},sticker_size:{type:"Int"}});},null);
__d("XStickerStateInitialDataControllerURIBuilder",["XControllerURIBuilder"],function(a,b,c,d,e,f){e.exports=b("XControllerURIBuilder").create("\/stickers\/state\/",{});},null);
__d("XStickerStatePackDataControllerURIBuilder",["XControllerURIBuilder"],function(a,b,c,d,e,f){e.exports=b("XControllerURIBuilder").create("\/stickers\/state\/pack\/",{pack_id:{type:"Int",required:true}});},null);
__d("XStickerStateStoreDataControllerURIBuilder",["XControllerURIBuilder"],function(a,b,c,d,e,f){e.exports=b("XControllerURIBuilder").create("\/stickers\/state\/store\/",{});},null);
__d("XStickerSearchPromotePackControllerURIBuilder",["XControllerURIBuilder"],function(a,b,c,d,e,f){e.exports=b("XControllerURIBuilder").create("\/stickers\/search\/promotePack\/",{sticker_id:{type:"Int",required:true}});},null);
__d("XStickerSearchNUXSeenControllerURIBuilder",["XControllerURIBuilder"],function(a,b,c,d,e,f){e.exports=b("XControllerURIBuilder").create("\/stickers\/searchNUX\/seen\/",{});},null);
__d("XStickerTagDataControllerURIBuilder",["XControllerURIBuilder"],function(a,b,c,d,e,f){e.exports=b("XControllerURIBuilder").create("\/stickers\/tag\/data\/",{});},null);
__d("StickerServerRequests",["AsyncRequest","Promise","XStickerPackImagesControllerURIBuilder","XStickersAddPackControllerURIBuilder","XStickersRemovePackControllerURIBuilder","XStickerStateInitialDataControllerURIBuilder","XStickerStatePackDataControllerURIBuilder","XStickerStateStoreDataControllerURIBuilder","XStickerSearchPromotePackControllerURIBuilder","XStickerSearchNUXSeenControllerURIBuilder","XStickerTagImagesControllerURIBuilder","XStickerTagDataControllerURIBuilder","XStickerQueryImagesControllerURIBuilder"],function(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s){'use strict';var t={addPack:function(v,w,x){var y=new j().setInt('pack_id',v).setBool('is_promoted',w).getURI();new g(y).setHandler(function(z){return x(z.payload);}).send();},removePack:function(v,w){var x=new k().setInt('pack_id',v).getURI();new g(x).setHandler(function(y){return w(y.payload);}).send();},getStickersForPack:function(v,w){var x=new i().setInt('pack_id',v).setInt('sticker_size',w).getURI();return new h(function(y,z){return new g().setURI(x).setMethod("POST").setHandler(function(aa){return y(aa.payload);}).send();});},getStickersForTags:function(v,w){new g().setURI(new q().setIntVector('tag_ids',v).getURI()).setMethod("POST").setHandler(function(x){return w(x);}).send();},getStickersForQuery:function(v,w){new g().setURI(new s().setString('query',v).getURI()).setMethod("POST").setHandler(function(x){return w(x);}).send();},fetchTrayData:function(v){return u(new l().getURI(),v,true);},fetchStoreData:function(v){return u(new n().getURI(),v);},fetchPackData:function(v,w){return u(new m().setInt('pack_id',v).getURI(),w);},fetchTagData:function(v){return u(new r().getURI(),v,true);},markSeenSearchNUX:function(){new g(new p().getURI().toString()).send();},promotePackSentFromSearch:function(v,w){var x=new o().setInt('sticker_id',v).getURI();u(x,w,true);}};function u(v,w,x){return new h(function(y,z){return new g(v).setHandler(function(aa){return y(aa.getPayload());}).setAllowCrossPageTransition(x).send();}).then(w);}e.exports=t;},null);
__d("StickerImages",["StickerServerRequests"],function(a,b,c,d,e,f,g){'use strict';var h={},i={},j={},k={requestStickersForTags:function(l,m){var n=l.filter(function(o){return !j[o.id];}).map(function(o){return o.id;});if(n.length>0){g.getStickersForTags(n,function(o){for(var p in o.payload)j[p]=o.payload[p];m();});}else m();},getStickerTagsData:function(){return j;},requestStickersForPack:function(l,m,n){if(!l)return;if(!i[l]){i[l]=g.getStickersForPack(l,m);i[l].then(function(o){o.forEach(function(p){return this.cacheSticker(p);}.bind(this));}.bind(this));}i[l].then(function(o){return n(o);});},cacheSticker:function(l){h[l.id]=l;},getSticker:function(l){return h[l];}};e.exports=k;},null);
__d("DialogFitHeight",["CSS","DOM","Event","Style","SubscriptionsHandler","Vector","csx","cx","throttle"],function(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o){var p=450,q=100,r=67,s=67;function t(u){"use strict";this.$DialogFitHeight0=u;}t.prototype.enable=function(){"use strict";this.$DialogFitHeight1=new k();this.$DialogFitHeight1.addSubscriptions(this.$DialogFitHeight0.subscribe('beforeshow',this.$DialogFitHeight2.bind(this)),i.listen(window,'resize',o(this.$DialogFitHeight2.bind(this))));this.$DialogFitHeight3=h.find(this.$DialogFitHeight0.getRoot(),"._4-i2");g.addClass(this.$DialogFitHeight3,"_5pfh");this.$DialogFitHeight4=q;if(h.scry(this.$DialogFitHeight0.getRoot(),"._4-i0").length)this.$DialogFitHeight4+=r;if(h.scry(this.$DialogFitHeight0.getRoot(),"._5a8u").length)this.$DialogFitHeight4+=s;};t.prototype.disable=function(){"use strict";this.$DialogFitHeight1.release();this.$DialogFitHeight1=null;g.removeClass(this.$DialogFitHeight3,"_5pfh");};t.prototype.$DialogFitHeight2=function(){"use strict";var u=l.getViewportDimensions().y,v=u-this.$DialogFitHeight4;j.set(this.$DialogFitHeight3,'height',Math.max(p,v)+'px');this.$DialogFitHeight0.updatePosition();};e.exports=t;},null);
__d("StickerStoreController",["Bootloader","DialogFitHeight","DOM","LayerAutoFocus","LayerFadeOnHide","LayerHideOnEscape","React","XUIDialog.react","XUIDialogBody.react","XUISpinner.react","cx","requestAnimationFrame"],function(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r){'use strict';var s=688,t=null,u=m.createClass({displayName:"StoreLayer",getInitialState:function(){return {renderStore:function(){return (m.createElement("div",{className:"_5r5e"},m.createElement(p,{background:"light",size:"large"})));}};},componentDidMount:function(){g.loadModules(["StickerStore.react"],function(x){this.setState({renderStore:function(){return (m.createElement(x,{currentPackID:this.props.packID,onPackSelect:this._packSelected,shown:this.props.shown}));}.bind(this)});}.bind(this));},_packSelected:function(x){this.setProps({packID:x});},_onToggle:function(x){r(this.setProps.bind(this,{shown:x},null));},render:function(){return (m.createElement(n,{behaviors:{DialogFitHeight:h,LayerAutoFocus:j,LayerFadeOnHide:k,LayerHideOnEscape:l},onToggle:this._onToggle,shown:this.props.shown,width:s},m.createElement(o,{className:"_5rq- autofocus"},this.state.renderStore())));}});function v(x){var y=i.create('div');i.appendContent(document.body,y);t=m.render(m.createElement(u,{packID:x,shown:true}),y);}var w={showStore:function(x){if(!t){v(x);}else t.setProps({shown:true,packID:x});}};e.exports=w;},null);
__d("StickersFlyoutPackSelector.react",["Animation","ImmutableObject","Locale","React","Image.react","StickerActions","StickerConfig","StickerConstants","StickerState","StickerStoreController","XUIBadge.react","cx","emptyFunction","fbt","ix"],function(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u){'use strict';var v=4,w=200,x="Sticker Store",y=j.createClass({displayName:"StickersFlyoutPackSelector",propTypes:{isComments:j.PropTypes.bool,numNewPacks:j.PropTypes.number,packs:j.PropTypes.arrayOf(j.PropTypes.instanceOf(h)).isRequired,onPackClick:j.PropTypes.func,selectedPackID:j.PropTypes.string,resetTagSelectorFunc:j.PropTypes.func},getInitialState:function(){return {animating:false,page:0};},getDefaultProps:function(){return {isComments:false,numNewPacks:0};},shouldComponentUpdate:function(aa,ba){return !ba.animating;},onFlyoutShown:function(){if(this.props.packs.length>0){var aa=this._calculatePageForPack(this.props.selectedPackID);if(this.state.page!==aa)this._setPage(aa,0);}},_calculatePageForPack:function(aa){for(var ba=0;ba<this.props.packs.length;ba++)if(this.props.packs[ba].id==aa)return ba<=v?0:Math.floor((ba-1)/v);return 0;},_setPage:function(aa,ba){if(this.state.animating)return;this.setState({animating:true,page:aa},function(){var ca=this.refs.positioner.getDOMNode(),da=this._calculatePosition(aa);new g(ca).to(da.reference,da.offset+'px').ondone(function(){return this.setState({animating:false});}.bind(this)).duration(ba).go();});},_calculatePosition:function(aa){var ba=this.refs.positioner.getDOMNode(),ca=ba.childNodes[aa].offsetLeft;if(i.isRTL()){var da=ba.offsetWidth,ea=ba.childNodes[aa].offsetWidth;return {reference:'right',offset:ca+ea-da};}return {reference:'left',offset:-ca};},_numPages:function(){return Math.max(1,Math.ceil((this.props.packs.length-1)/v));},_canGoPrev:function(){return this.state.page>0;},_canGoNext:function(){return this.state.page+1<this._numPages();},_goPrev:function(){this._canGoPrev()&&this._setPage(this.state.page-1,w);},_goNext:function(){this._canGoNext()&&this._setPage(this.state.page+1,w);},_openStore:function(){l.resetNumNewPacks();p.showStore();},render:function(){return (j.createElement("div",{className:"_5r85"},this._renderStoreButton(),this._renderPrevArrow(),this._renderNextArrow(),j.createElement("div",{className:"_5r88"},j.createElement("div",{className:"_5r89",ref:"positioner"},this._renderPages()))));},_selectPack:function(aa){var ba=o.getPack(aa);if(ba&&ba.isPromoted)l.addPack(aa);if(aa===n.SEARCH_PACK_ID)this.props.resetTagSelectorFunc();if(this.props.onPackClick){this.props.onPackClick(aa);}else l.selectPack(aa);},_renderPages:function(){var aa=this.props.packs.map(function(ea,fa){return j.createElement(z,{key:ea.id,onClick:function(){return this._selectPack(ea.id);}.bind(this),pack:ea,selected:this.props.selectedPackID===ea.id,index:fa,isComments:this.props.isComments});}.bind(this)),ba=[];for(var ca=0;ca<aa.length;ca+=v){var da=ca;ca===0&&ca++;ba.push(j.createElement("div",{className:"_5r81",key:ca},aa.slice(da,ca+v)));}return ba;},_renderStoreButton:function(){return (j.createElement("a",{"aria-label":x,className:"_5r86 rfloat","data-hover":"tooltip",onClick:this._openStore},j.createElement(k,{className:"_5r87",src:u('/images/messaging/stickers/selector/sticker_store.png')}),this._renderJewel()));},_renderJewel:function(){var aa=this.props.numNewPacks;if(!aa)return null;return (j.createElement(q,{className:"rfloat _3fhs",count:aa,maxcount:9,type:"special"}));},_renderPrevArrow:function(){if(!this._canGoPrev())return null;var aa=i.isRTL()?u('/images/messaging/stickers/selector/right.png'):u('/images/messaging/stickers/selector/left.png');return (j.createElement("a",{className:(("_37wu")+(' '+"lfloat")),onClick:this._goPrev},j.createElement(k,{className:"_5r84",src:aa})));},_renderNextArrow:function(){if(!this._canGoNext())return null;var aa=i.isRTL()?u('/images/messaging/stickers/selector/left.png'):u('/images/messaging/stickers/selector/right.png');return (j.createElement("a",{className:(("_37wv")+(' '+"rfloat")),onClick:this._goNext},j.createElement(k,{className:"_5r84",src:aa})));}}),z=j.createClass({displayName:"PackIcon",propTypes:{index:j.PropTypes.number,isComments:j.PropTypes.bool,onClick:j.PropTypes.func,pack:j.PropTypes.instanceOf(h).isRequired,selected:j.PropTypes.bool},getDefaultProps:function(){return {isComments:false,onClick:s};},_getPackIcon:function(aa){if(aa.id==n.SEARCH_PACK_ID)return u('/images/messaging/stickers/icons/search.png');if(aa.id==n.MRU_STICKER_PACK)return u('/images/messaging/stickers/icons/recent.png');if(aa.id==n.EMOTICON_PACK_ID)return u('/images/messaging/stickers/icons/emoji.png');return aa.icon;},render:function(){var aa=this.props.pack,ba=m.WebStickerSearch&&!m.StickerSearchInRecent?this.props.index===1||this.props.index===2:this.props.index===1,ca=(("_5r8a")+(this.props.selected?' '+"_5r8b":'')+(aa.id==n.MRU_STICKER_PACK?' '+"_5qcj":'')+(aa.id==n.SEARCH_PACK_ID?' '+"_5qck":'')+(ba?' '+"_eb3":'')),da=this.props.isComments&&aa.isMessengerOnly,ea="This pack is only available in messages",fa=da?s:function(){return this.props.onClick(aa.id);}.bind(this);return (j.createElement("a",{"aria-label":da?ea:aa.name,className:ca,"data-id":aa.id,"data-hover":"tooltip",ref:"search_icon",onClick:fa,tabIndex:"0"},j.createElement(k,{className:((da?"_2ji6":'')+(' '+"_5r8c")+(m.WebStickerSearch?' '+"_1viy":'')),src:this._getPackIcon(aa)})));}});e.exports=y;},null);
__d("StickerUtils",[],function(a,b,c,d,e,f){var g={getScaledDimensions:function(h,i,j){var k,l,m;if(i>h){m=j/i;k=h*m;l=i*m;}else{m=j/h;k=h*m;l=i*m;}return {height:Math.round(k),width:Math.round(l)};},capitalizeWords:function(h){var i=h.split(" ");for(var j=0;j<i.length;j++){var k=i[j].charAt(0).toUpperCase();i[j]=k+i[j].substr(1);}return i.join(" ");}};e.exports=g;},null);
__d("StickersFlyoutStickerSelector.react",["BanzaiLogger","Grid.react","Image.react","ScrollableArea.react","React","Sticker.react","StickerConstants","StickerConfig","StickerImages","StickerSearch","StickerState","StickerUtils","XUISpinner.react","areEqual","cx","debounce","emptyFunction","fbt","ix","throttle"],function(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v,w,x,y,z){'use strict';var aa=h.GridItem,ba=320,ca=278,da=m.MRU_STICKER_PACK,ea=44,fa=112,ga=n.AutoAnimateStickerTray?'load_and_hover':'hover',ha=v(function(ja,ka){if(!ja)return;g.log('StickersLoggerConfig',{event:'search_sticker',searchtoken:ja,numsearchresults:ka.length});},1000),ia=k.createClass({displayName:"StickersFlyoutStickerSelector",propTypes:{height:k.PropTypes.number,onScroll:k.PropTypes.func,packID:k.PropTypes.string,userInput:k.PropTypes.string,typeaheadTags:k.PropTypes.array,singleWordTags:k.PropTypes.array,onQueryResultsFound:k.PropTypes.func},getDefaultProps:function(){return {isComments:false,onScroll:w,shown:false};},getInitialState:function(){return {loading:false,stickers:[]};},componentDidMount:function(){if(this.props.packID){this.requestStickersForPack(this.props.packID);return;}if((this.props.typeaheadTags&&this.props.typeaheadTags.length>0)||(this.props.singleWordTags&&this.props.singleWordTags.length>0)){this.requestStickersForTags(this.props.typeaheadTags,this.props.singleWordTags,this.props.userInput);return;}if(this.props.userInput)this.requestStickersForQuery(this.props.userInput);},componentWillReceiveProps:function(ja){if(ja.packID&&ja.packID!==this.props.packID){this.requestStickersForPack(ja.packID);}else if(!t(ja.typeaheadTags,this.props.typeaheadTags)||!t(ja.singleWordTags,this.props.singleWordTags)){this.requestStickersForTags(ja.typeaheadTags,ja.singleWordTags,ja.userInput);}else if(!p.getTags()&&ja.userInput!==this.props.userInput)this.requestStickersForQuery(ja.userInput);},requestStickersForTags:function(ja,ka,la){this.setState({loading:true});p.requestStickersForTags(ja,ka,la,function(ma){if(!this.props.tagChosen)ha(la,ma);if(this.props.isComments)ma=ma.filter(function(na){return !na.isMessengerOnly;});this.isMounted()&&this.setState({loading:false,stickers:ma.slice(0,40)});}.bind(this));},requestStickersForQuery:function(ja){this.setState({loading:true});p.requestStickersForQuery(ja,function(ka){ka.map(function(la){return o.cacheSticker(la);});if(!this.props.tagChosen)ha(ja,ka);if(this.props.isComments)ka=ka.filter(function(la){return !la.isMessengerOnly;});if(this.isMounted()){this.setState({loading:false,stickers:ka});if(n.EnterToSendSticker)this.props.onQueryResultsFound&&this.props.onQueryResultsFound(ka);}}.bind(this));},requestStickersForPack:function(ja){this.setState({loading:true});o.requestStickersForPack(ja,m.TRAY_SIZE,function(ka){if(ja==da){ka=q.getMRUStickerPack(ka);if(this.props.isComments)ka=ka.filter(function(la){return !la.isMessengerOnly;});}this.setState({loading:false,stickers:ka});}.bind(this));},renderStickers:function(){return this.state.stickers.map(function(ja){var ka=r.getScaledDimensions(ja.height,ja.width,m.TRAY_SIZE);return (k.createElement(aa,{key:ja.id},k.createElement("div",{className:"_5r8h","data-id":ja.id},k.createElement(l,{animationTrigger:ga,className:"_5r8i",frameCount:ja.frameCount,frameRate:ja.frameRate||83,framesPerCol:ja.framesPerCol,framesPerRow:ja.framesPerRow,shown:this.props.shown,sourceHeight:ka.height,sourceURI:ja.sourceURI,sourceWidth:ka.width,spriteURI:ja.spriteURI,paddedSpriteURI:ja.paddedSpriteURI,stickerID:ja.id,style:{cursor:'pointer'}}))));}.bind(this));},_onScroll:function(){var ja=this.refs.stickerScrollable;if(ja){var ka=ja.getArea().getScrollTop();this.props.onScroll(ka);}},render:function(){if(this.state.loading){return (k.createElement("div",{className:"_e0r"},k.createElement(s,{size:"large"})));}else if(this.state.stickers.length===0){var ja=(ba-ea*2-fa)/2+"px";return (k.createElement("div",{className:"_5jdt",style:{marginTop:ja}},k.createElement(i,{src:y("/images/messaging/stickers/icons/sad_face.png")}),k.createElement("p",null,"No Stickers to Show")));}return (k.createElement(j,{ref:"stickerScrollable",height:this.props.height||ba,onScroll:z(this._onScroll,200),width:ca,fade:true},k.createElement("div",{className:"_5r8k"},k.createElement(h,{cols:4,fixed:true},this.renderStickers()))));}});e.exports=ia;},null);
__d("StickersFlyoutTagSelector.react",["BanzaiLogger","Grid.react","ScrollableArea.react","Parent","React","Image.react","StickerConfig","StickerConstants","StickersFlyoutStickerSelector.react","StickerSearch","StickerState","StickerUtils","Toggler","XUIButton.react","XUICloseButton.react","XUITextInput.react","cx","emptyFunction","fbt"],function(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v,w,x,y){'use strict';var z=h.GridItem,aa=320,ba=278,ca=44,da=k.createClass({displayName:"StickersFlyoutTagSelector",propTypes:{trigger:k.PropTypes.string,isComments:k.PropTypes.bool,resetTrigger:k.PropTypes.func,shown:k.PropTypes.bool,onSelectSticker:k.PropTypes.func},getInitialState:function(){return {input:'',isScrolling:false,tagChosen:false,typeaheadTags:[],singleWordTags:[],matchedStickers:[]};},getDefaultProps:function(){return {trigger:null,isComments:false,resetTrigger:x,shown:false,onSelectSticker:x};},componentDidMount:function(){var ea=j.byClass(this.getDOMNode(),'uiToggle');if(ea)this._togglerSub=s.listen('show',ea,function(){this.isMounted()&&this.focusInput();}.bind(this));this.focusInput();this.selectTrigger(this.props.trigger);},componentWillUnmount:function(){this._togglerSub&&this._togglerSub.unsubscribe();},componentWillReceiveProps:function(ea){this.selectTrigger(ea.trigger);},focusInput:function(){this.refs.inputField.focusInput&&this.refs.inputField.focusInput();},_setMatchedStickers:function(ea){this.setState({matchedStickers:ea?ea:[]});},_onEnter:function(ea){ea.preventDefault();ea.stopPropagation();if(!m.EnterToSendSticker)return;var fa=this.state.matchedStickers;if(fa&&fa.length===1){this.props.onSelectSticker(fa[0].id,ea);this.setState({matchedStickers:[]});}},_inputChanged:function(ea){var fa=this._normalizeInput(ea.target.value),ga=p.getTags();if(ga){var ha=ga.filter(function(ka){return ka.name.indexOf(fa)===0;}),ia=fa.split(/\s+/),ja=ia.map(function(ka){return p.getTagByName(ka);}).filter(function(ka){return ka!==(void 0);});if(ja.length!==ia.length)ja=[];this.setState({input:ea.target.value,tagChosen:false,typeaheadTags:ha,singleWordTags:ja,isScrolling:false});}else this.setState({input:ea.target.value,tagChosen:false,isScrolling:false});},_normalizeInput:function(ea){return ea.trim().replace(/\s+/,' ').toLowerCase();},_handleResetButtonClick:function(ea){ea.preventDefault();this.reset();},reset:function(){this.setState(this.getInitialState());},renderContentArea:function(){if(this.state.tagChosen||this._normalizeInput(this.state.input).length>1){return this.renderStickers();}else return m.StickerSearchInRecent?this.renderRecentStickers():this.renderTags();},render:function(){return (k.createElement("div",{className:(("_217a")+(this.state.isScrolling?' '+"_1hg1":''))},k.createElement("div",{className:"_5jdr"},k.createElement("span",{className:"_5jds"}),k.createElement(v,{onEnter:this._onEnter,onChange:this._inputChanged,ref:"inputField",placeholder:"Search stickers",value:this.state.input}),k.createElement(u,{size:"small",onClick:this._handleResetButtonClick,className:((this.state.input.length===0?"hidden_elem":''))})),this.renderContentArea()));},selectTag:function(ea){g.log('StickersLoggerConfig',{event:'select_tag',tagid:ea.id});this.setState({tagChosen:true,typeaheadTags:[ea],singleWordTags:[],input:r.capitalizeWords(ea.name)});this.focusInput();},selectTrigger:function(ea){if(ea!==null){var fa=p.getTagByName(ea);this.setState({tagChosen:true,typeaheadTags:[fa],singleWordTags:[],input:r.capitalizeWords(fa.name)});this.props.resetTrigger();}},_onScroll:function(ea){this.setState({isScrolling:!!ea});},renderStickers:function(){var ea=this._normalizeInput(this.state.input);return (k.createElement(o,{ref:"selector",height:aa-ca,userInput:ea,typeaheadTags:this.state.typeaheadTags,singleWordTags:this.state.singleWordTags,onScroll:this._onScroll,isComments:this.props.isComments,tagChosen:this.state.tagChosen,shown:this.props.shown,onQueryResultsFound:this._setMatchedStickers}));},renderRecentStickers:function(){if(this._normalizeInput(this.state.input).length===1)return k.createElement("div",null);return (k.createElement(o,{ref:"selector",height:aa-ca,packID:n.MRU_STICKER_PACK,onScroll:this._onScroll,isComments:this.props.isComments,shown:this.props.shown}));},renderTags:function(){var ea=q.getFeaturedTags().filter(function(fa){return fa.sourceURI!==null;}).sort(function(fa,ga){return fa.order-ga.order;}).map(function(fa,ga){return k.createElement(z,{key:ga},k.createElement("div",{className:(("_t5c")+(ga<2?' '+"_1b27":'')+(ga%2===0?' '+"_t5d":'')+(ga%2!==0?' '+"_t5e":''))},k.createElement(t,{image:k.createElement(l,{src:fa.sourceURI}),label:fa.name,onClick:this.selectTag.bind(this,fa),className:"_5jdu",style:{background:'#'+fa.color_code},disabled:this._normalizeInput(this.state.input).length===1})));}.bind(this));return (k.createElement(i,{height:aa-ca,width:ba-16,shadow:true,fade:true,className:"_5jei"},k.createElement(h,{spacing:"pas",cols:2,fixed:true,ref:"grid"},ea)));}});e.exports=da;},null);
__d("StickersFlyout.react",["BanzaiLogger","Event","Keys","MessagesEmoticons.react","Parent","ReactComponentWithPureRenderMixin","React","StickersFlyoutPackSelector.react","StickersFlyoutStickerSelector.react","StickerActions","StickerConstants","StickerConfig","StickersFlyoutTagSelector.react","StickerSearch","StickerState","SubscriptionsHandler","Toggler","XUISpinner.react","arrayContains","cx"],function(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v,w,x,y,z){'use strict';var aa=q.SEARCH_PACK_ID,ba=m.createClass({displayName:"StickersFlyout",mixins:[l],propTypes:{isComments:m.PropTypes.bool,onStickerSelect:m.PropTypes.func.isRequired,onEmoticonSelect:m.PropTypes.func,onShown:m.PropTypes.func,onHidden:m.PropTypes.func,onEscKeyDown:m.PropTypes.func,onPackSelect:m.PropTypes.func,packID:m.PropTypes.string,shown:m.PropTypes.bool,trigger:m.PropTypes.string},getDefaultProps:function(){return {isComments:false,packID:u.getTrayPackID(),shown:false,trigger:null};},getInitialState:function(){return {dataReady:false,numNewPacks:0,shown:false};},componentDidMount:function(){if(r.LoadStickerEarly&&!this.state.dataReady)this.loadTrayData();this._toggle=k.byClass(this.getDOMNode(),'uiToggle');this._subscriptions=new v();if(this._toggle){this._subscriptions.addSubscriptions(w.listen('show',this._toggle,this._onShownWrapper),w.listen('hide',this._toggle,this._onHidden));}else if(!r.LoadStickerEarly&&this.props.shown&&!this.state.dataReady)this.loadTrayData();this._subscriptions.addSubscriptions(h.listen(this.getDOMNode(),'keydown',this._onKeyDown),u.addListener(u.PACKS_CHANGED,this.packsUpdated),u.addListener(u.NUM_NEW_PACKS_CHANGED,function(ca){this.setState({numNewPacks:ca});}.bind(this)));},_onShownWrapper:function(){if(this.props.onShown){this.props.onShown(this._onShown);}else this._onShown();},_onShown:function(){g.log('StickersLoggerConfig',{event:'open_tray'});if(!r.LoadStickerEarly&&!this.state.dataReady)this.loadTrayData();if(this.props.packID===aa)this.refs.tagSelector&&this.refs.tagSelector.focusInput();this.refs.packSelector.onFlyoutShown();this.setState({shown:true});},_onHidden:function(){this.resetTagSelector();this.props.onHidden&&this.props.onHidden();this.setState({shown:false});},componentWillUnmount:function(){this._subscriptions.release();},componentWillReceiveProps:function(ca){if(!this.state.dataReady&&ca.shown)this.loadTrayData();},componentDidUpdate:function(ca){if(!ca.shown&&this.props.shown){this._onShown();}else if(ca.shown&&!this.props.shown)this._onHidden();},_onKeyDown:function(event){if(event.keyCode===i.ESC&&this.props.onEscKeyDown){this.props.onEscKeyDown();event.kill();}},resetTagSelector:function(){this.refs.tagSelector&&this.refs.tagSelector.reset();},loadTrayData:function(){u.onTrayDataReady(function(){var ca=u.getNumNewPacks();this.setState({dataReady:true,numNewPacks:ca});var da=u.getPacksInTray()[0].id,ea=this.props.packID;if(!ea||!y(u.getPackIDsInTray(),ea)){p.selectPack(da,true);this.props.onPackSelect&&this.props.onPackSelect(da);}}.bind(this));if(r.WebStickerSearch&&!r.StickerSearchOnServer)t.prepareTagsData();},_isShown:function(){return this._toggle?this.state.shown:this.props.shown;},loadPack:function(){if(!this.state.dataReady)return (m.createElement("div",{className:"_e0r"},m.createElement(x,{size:"large"})));if(this.props.packID===q.EMOTICON_PACK_ID)return (m.createElement("div",{className:"_5r8l","data-id":this.props.packID},m.createElement(j,{onEmoticonSelect:this.props.onEmoticonSelect})));if(this.props.packID===aa&&r.WebStickerSearch)return (m.createElement("div",{className:"_5r8l"},m.createElement(s,{ref:"tagSelector",className:"fbStickersFlyoutTagSelector",trigger:this.props.trigger,resetTrigger:function(){return this.setProps({trigger:null});}.bind(this),isComments:this.props.isComments,shown:this._isShown(),onSelectSticker:this.onSelectSticker})));return (m.createElement("div",{className:"_5r8l","data-id":this.props.packID},m.createElement(o,{ref:"selector",packID:this.props.packID,isComments:this.props.isComments,shown:this._isShown()})));},packsUpdated:function(){var ca=u.getPackIDsInTray();if(!y(ca,this.props.packID)){p.selectPack(ca[0]);return;}this.forceUpdate(null);},onSelectSticker:function(ca,event){if(ca){u.updateRecentlyUsed(ca);this.props.onStickerSelect(ca,event);if(r.PromotePackFromSearch&&this.props.packID===q.SEARCH_PACK_ID)u.promotePackSentFromSearch(ca);u.clearShowStickerReplyNUX();}},selectedSticker:function(event){var ca=k.byClass(event.target,"_5r8h");if(ca){var da=ca.getAttribute('data-id');this.onSelectSticker(da,event);}},render:function(){var ca=this.props.isComments?u.getPacksInCommentsTray():u.getPacksInTray();return (m.createElement("div",{className:"_5r8f"},m.createElement("div",{className:"_5r8e"},m.createElement(n,{ref:"packSelector",numNewPacks:this.state.numNewPacks,onPackClick:this.props.onPackSelect,selectedPackID:this.props.packID,packs:ca,isComments:this.props.isComments,resetTagSelectorFunc:this.resetTagSelector})),m.createElement("div",{className:"_5r8m",onClick:this.selectedSticker},this.loadPack())));}});e.exports=ba;},null);
__d("MercuryShareAttachmentReactShape",["React"],function(a,b,c,d,e,f,g){'use strict';function h(){return g.PropTypes.shape({description:g.PropTypes.string,media:g.PropTypes.shape({image:g.PropTypes.string,duration:g.PropTypes.number,playable:g.PropTypes.bool,source:g.PropTypes.string}),source:g.PropTypes.string,style_list:g.PropTypes.arrayOf(g.PropTypes.string),title:g.PropTypes.string,uri:g.PropTypes.string}).isRequired;}e.exports=h;},null);
__d("MercuryShareAttachmentRenderLocations",[],function(a,b,c,d,e,f){'use strict';var g={CHAT:'chat',CHAT_PREVIEW:'chat_preview',getValues:function(){return [g.CHAT,g.CHAT_PREVIEW];},isPreview:function(h){return h===g.CHAT_PREVIEW;}};e.exports=g;},null);
__d("MercuryFallbackShareAttachment.react",["Image.react","ImageBlock.react","Link.react","MercuryShareAttachmentRenderLocations","MercuryShareAttachmentReactShape","React","cx","joinClasses"],function(a,b,c,d,e,f,g,h,i,j,k,l,m,n){'use strict';var o=l.createClass({displayName:"MercuryFallbackShareAttachment",propTypes:{attachment:k(),location:l.PropTypes.oneOf(j.getValues())},renderLink:function(p){if(j.isPreview(location))return p;return l.createElement(i,{href:this.props.attachment.uri},p);},render:function(){var p=this.props.attachment,q=this.props.location,r=((j.CHAT===q?"_49or":'')+(j.CHAT_PREVIEW===q?' '+"_tig":'')+(' '+"_tih")+(!(p&&p.media)?' '+"_49ou":'')),s=(l.createElement("div",null,l.createElement("div",{className:"_49ov"},p.title),l.createElement("div",{className:"_49ow"},p.description),l.createElement("div",{className:"_49ox"},p.source)));if(p.media&&p.media.image)return this.renderLink(l.createElement(h,{className:n(this.props.className,r)},l.createElement(g,{src:p.media.image,width:68}),s,this.props.children));return this.renderLink(l.createElement("div",{className:n(this.props.className,r)},s,this.props.children));}});e.exports=o;},null);
__d("XStickerAssetControllerURIBuilder",["XControllerURIBuilder"],function(a,b,c,d,e,f){e.exports=b("XControllerURIBuilder").create("\/stickers\/asset\/",{sticker_id:{type:"Int",required:true},image_type:{type:"Enum"}});},null);
__d("MercuryAttachmentRenderer",["MercuryAttachmentTemplates","MercuryAttachmentAudioClip.react","Bootloader","ChatAnimatedGifs","SyncRequest.react","CSS","MercuryConstants","DOM","Event","MercuryAttachment","MercuryAttachmentType","MercuryAttachmentVideo.react","MercuryConfig","MercuryIDs","MercuryParticipants","MercuryShareAttachment.react","MercuryShareAttachmentRenderLocations","MercuryViewer","ProgressBar","React","Sticker.react","StickerAssetType","StickerConstants","StickerImages","StickerUtils","Style","URI","UserAgent_DEPRECATED","cx","fbt","invariant","updatePhotoProgressBar","XStickerAssetControllerURIBuilder","OrionMercuryAttachment","MercuryMessages","MercuryAttachmentAudioClipTranscript.react"],function(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v,w,x,y,z,aa,ba,ca,da,ea,fa,ga,ha,ia,ja,ka,la,ma){'use strict';var na=b('OrionMercuryAttachment').module,oa=b('MercuryMessages').get(),pa=ha.ie()<=8;function qa(ta,ua){var va=g[ua].build().setNodeContent('filename',ta.name),wa=va.getNode('link');wa.setAttribute('href',ta.url);ta.rel&&wa.setAttribute('rel',ta.rel);l.addClass(va.getRoot(),p.getAttachIconClass(ta.icon_type));return va;}function ra(ta,ua){var va=g[ua].build().setNodeContent('filename',ta.name);l.addClass(va.getRoot(),p.getAttachIconClass(ta.icon_type));return va;}var sa={renderAttachment:function(ta,ua,va,wa,xa,ya){var za=100,ab=ta?160:400,bb=null,cb=null,db=m.MercurySupportedShareType;if(this.isErrorAttachment(ua))bb=sa.renderError(ua);if(this.isShareAttachment(ua)&&ua.share){cb=n.create('div');z.render(z.createElement(v,{attachment:ua.share,location:w.CHAT}),cb);}if(!cb&&this.isShareAttachment(ua)&&ua.share_xhp&&(ua.share_data_type===db.FB_BROWSE_QUERY||!ta))cb=sa.renderShareXHP(ua,va.id);if(this.isStickerAttachment(ua))cb=sa.renderSticker(ua,va,ta,ya);if(!cb&&this.isShareAttachment(ua)){var eb=ua.share_data_type;switch(eb){case db.FB_PHOTO:cb=sa.renderPreview(ua,va,wa,xa);break;case db.FB_VIDEO:cb=sa.renderVideoThumb(ua);break;case db.FB_MUSIC_ALBUM:case db.FB_SONG:case db.FB_PLAYLIST:case db.FB_MUSICIAN:case db.FB_RADIO_STATION:cb=sa.renderMusic(ua);break;case db.EXTERNAL:case db.FB_TEMPLATE:case db.FB_SOCIAL_REPORT_PHOTO:cb=sa.renderExternalLink(ua);break;case db.FB_COUPON:case db.FB_EVENT:case db.FB_SHOERACK_INVITATION:cb=sa.renderChatXHP(ua);break;case db.FB_SOCIAL_RESOLUTION:case db.FB_STATUS:cb=sa.renderSocialResolution(ua);break;case db.FB_SYNC_REQUEST:cb=sa.renderSyncRequest(ua);break;case db.FB_OPEN_GRAPH:cb=sa.renderOpenGraph(ua);break;case db.FB_ORION:if(na)cb=sa.renderOrionMercuryAttachment(ua);break;default:if(ua.name)cb=sa.renderShareLink(ua,va&&va.id,ta);break;}}if(!cb&&ua.preview_loading)cb=sa.renderPreview(ua,va,wa,xa);if(!cb&&this.isVideoAttachment(ua)){cb=n.create('div');z.render(sa.renderVideo(ua,ta),cb);}if(!cb&&ua.preview_url)cb=sa.renderPreview(ua,va,wa,xa);if(!cb&&this.isFileAttachment(ua))if(ua.metadata&&p.isVoiceMessage(ua.metadata.type)){cb=n.create('div');var fb=sa.renderAudioClip(ua,va.message_id,za,ab);z.render(fb,cb);}else cb=ta?sa.renderFileLink(ua):sa.renderExtendedFileLink(ua);return {error:bb,content:cb,bubblePreferred:this.isBubblePreferred(ua)};},isBubblePreferred:function(ta){return !this.isStickerAttachment(ta)&&!this.isSyncRequestAttachment(ta);},renderError:function(ta){var ua=g[':fb:mercury:attachment:error'].build();n.appendContent(ua.getNode('error'),ta.error_msg);return ua.getRoot();},renderSocialResolution:function(ta){var ua=g[':fb:mercury:attachment:social-resolution'].build();ua.setNodeContent('post',ta.share_xhp);return ua.getRoot();},renderChatXHP:function(ta){var ua=g[':fb:mercury:attachment:social-resolution'].build();ua.setNodeContent('post',ta.chat_xhp);return ua.getRoot();},renderOpenGraph:function(ta){var ua=ta.share_xhp.cloneNode(true);if(ha.firefox())fa.set(ua,'minWidth','180px');return ua;},renderExternalLink:function(ta){var ua=g[':fb:mercury:attachment:external-link'].build().setNodeContent('name',ta.name);ta.base_url&&ua.setNodeContent('shortLink',ta.base_url);var va=ua.getNode('preview'),wa=ua.getNode('image-link');wa.setAttribute('href',ta.url);ta.rel&&wa.setAttribute('rel',ta.rel);if(ta.preview_url){var xa=ua.getNode('preview-image'),ya=ta.preview_url,za=ga(j.getRawUrlFromSafeUrl(ya));if(ta.animated_gif_uri){ya=ga(ta.animated_gif_uri);l.addClass(va,"_dri");if(ta.name&&ta.name.__html==za.toString())ua.setNodeContent('name','');}xa.setAttribute('src',ya);l.addClass(va,ta.preview_class);l.show(xa);}else{l.addClass(ua.getRoot(),'noMedia');l.hide(va);}ua.getNode('name').setAttribute('href',ta.url);d(['LinkshimHandler'],function(ab){ab.setUpLinkshimHandling(ua.getNode('name'));ab.setUpLinkshimHandling(ua.getNode('image-link'));});if(ta.rel)ua.getNode('name').setAttribute('rel',ta.rel);return ua.getRoot();},renderFileLink:function(ta){var ua=null;if(ta.url===''){ua=':fb:mercury:attachment:file-name';return ra(ta,ua).getRoot();}else{ua=':fb:mercury:attachment:file-link';return qa(ta,ua).getRoot();}},renderAudioClip:function(ta,ua,va,wa){var xa=ta.metadata.duration/1000,ya=200;if(va&&wa)if(xa<5){ya=va;}else ya=(1-Math.pow(10,(xa-5)/-30))*(wa-va)+va;var za=null;if(s.WebMessengerTranscriptRenderGK){var ab=b('MercuryAttachmentAudioClipTranscript.react');za=z.createElement(ab,{message_id:ua,attachment:ta});}return (z.createElement("div",null,z.createElement(h,{src:ta.url,duration:ta.metadata.duration/1000,showHelp:false,width:ya}),za));},renderVideo:function(ta,ua){var va={height:ta.preview_height,width:ta.preview_width},wa=ua?{width:160,height:120}:{width:266,height:200};return z.createElement(r,{duration:ta.metadata.duration,name:ta.name,pageID:ta.metadata.pageid,size:wa,thumbnailSize:va,thumbnail:ta.thumbnail_url,videoID:ta.metadata.fbid});},renderExtendedFileLink:function(ta){var ua=null;if(ta.url===''){ua=':fb:mercury:attachment:file-name';return ra(ta,ua).getRoot();}ua=':fb:mercury:attachment:extended-file-link';var va=qa(ta,ua);if(ta.open_url){var wa=va.getNode('openLinkContainer');l.show(wa);var xa=va.getNode('openFile');xa.setAttribute('href',ta.open_url);}var ya=va.getNode('downloadFile');ya.setAttribute('href',ta.url);ta.rel&&ya.setAttribute('rel',ta.rel);return va.getRoot();},renderMusic:function(ta){var ua=g[':fb:mercury:attachment:music'].build().setNodeContent('filename',ta.name),va=ua.getNode('link');va.setAttribute('href',ta.url);va.setAttribute('target','_blank');ta.rel&&va.setAttribute('rel',ta.rel);var wa=ua.getNode('image-link');wa.setAttribute('href',ta.url);ta.rel&&wa.setAttribute('rel',ta.rel);var xa=ua.getNode('preview-image');xa.setAttribute('src',ta.preview_url);l.show(xa);l.addClass(ua.getNode('icon_link'),'MercuryMusicIcon');return ua.getRoot();},renderSyncRequest:function(ta){var ua=k(ta.metadata),va=n.create('div');z.render(ua,va);return va;},renderOrionMercuryAttachment:function(ta){var ua=z.createElement(na,z.__spread({},ta.metadata)),va=n.create('div');z.render(ua,va);return va;},resizeContain:function(ta,ua){var va=ta.width/ta.height,wa=ua.width/ua.height;if(wa<va){return {width:Math.min(ta.height*wa,ua.width),height:Math.min(ta.height,ua.height)};}else return {width:Math.min(ta.width,ua.width),height:Math.min(ta.width/wa,ua.height)};},renderPreview:function(ta,ua,va,wa){var xa=g[':fb:mercury:attachment:preview'].build(),ya=xa.getNode('image-link');if(ta){if(ta.url){var za=new ga(ta.url).getQueryData().uri;if(za&&ta.rel==='async'){ya.setAttribute('href',za);ya.setAttribute('ajaxify',ta.url);}else ya.setAttribute('href',ta.url);}ta.rel&&ya.setAttribute('rel',ta.rel);var ab;if(ta.preview_uploading){var bb=xa.getNode('cancel-button-container');l.show(bb);var cb=xa.getNode('cancel-button'),db=o.listen(cb,'click',function(){ta.upload_canceled(ta.upload_id);l.hide(xa.getRoot());db.remove();});ta.on_success(function(event,lb){if(lb.upload_id==ta.upload_id){l.hide(bb);db.remove();}});var eb=xa.getNode('progress-bar'),fb=new y(eb),gb=xa.getNode('progress-bar-container');ka(ta.upload_id);ta.on_progress(function(event,lb){if(lb.upload_id==ta.upload_id){l.removeClass(gb,"_395w");l.show(gb);la(fb,lb.event);}});if(ta.on_resizing_progress)ta.on_resizing_progress(function(event,lb){if(lb.upload_id==ta.upload_id){l.addClass(gb,"_395w");l.show(gb);fb.setPosition(100*lb.event.written/lb.event.total);}});l.addClass(ya,"_57jm");if(va>=176){ab='/images/photos/dots_large.png';}else if(va>=86){ab='/images/photos/dots_medium.png';}else ab='/images/photos/dots_small.png';fa.set(ya,'width',va+'px');fa.set(ya,'max-width',va+'px');if(ta.preview_width&&ta.preview_height)fa.set(ya,'padding-bottom',((ta.preview_height/ta.preview_width)*100)+'%');}else if(ta.preview_loading){l.addClass(ya,"_5xdv");if(wa==='contain'&&ta.preview_width&&ta.preview_height){fa.set(ya,'width',ta.preview_width+'px');fa.set(ya,'height',ta.preview_height+'px');}if(wa==='cover'&&!pa)l.addClass(ya,"_55pj");}else if(ta.metadata&&ta.metadata.fbid){ab=ga('/ajax/mercury/attachments/photo.php').addQueryData({fbid:ta.metadata.fbid,request_user_id:ta.metadata.pageid,mode:wa,width:va,height:va}).toString();var hb=ya.getAttribute('ajaxify');ya.removeAttribute('ajaxify');ya.removeAttribute('rel');o.listen(ya,'click',function(event){event.prevent();i.loadModules(["MessagesViewer"],function(lb){lb.bootstrapWithConfig({src:ab,endpoint:hb,fbid:ta.metadata.fbid,dimensions:ta.metadata.dimensions,disablePaging:ua&&ua.attachments.length==1},ya);});});}else{var ib=ga(ta.preview_url);wa&&ib.addQueryData({mode:wa});va&&ib.addQueryData({width:va,height:va});ab=ib.toString();}var jb=xa.getNode('preview-image');if(ab){if(wa==='contain'&&ta.preview_width&&ta.preview_height){var kb=sa.resizeContain({width:va,height:va},{width:ta.preview_width,height:ta.preview_height});jb.setAttribute('width',kb.width);jb.setAttribute('height',kb.height);}if(ta.preview_uploading||(wa==='cover'&&!pa)){l.addClass(ya,"_55pj");fa.set(ya,'backgroundImage','url('+ab+')');}else{jb.onload=function(){jb.removeAttribute('width');jb.removeAttribute('height');};jb.setAttribute('src',ab);}}if(ua)this.renderReportRespondLink(xa.getRoot(),ta,ua.message_id);}return xa.getRoot();},renderShareLink:function(ta,ua,va){var wa=g[':fb:mercury:attachment:share-link'].build().setNodeContent('name',ta.name),xa=wa.getNode('link');xa.setAttribute('href',ta.url);ta.rel&&xa.setAttribute('rel',ta.rel);return wa.getRoot();},renderVideoThumb:function(ta){var ua=g[':fb:mercury:attachment:video-thumb'].build(),va=ua.getNode('thumb');va.setAttribute('href',ta.url);va.setAttribute('rel',ta.rel);var wa=n.find(ua.getRoot(),'img');wa.src=ta.preview_url;return ua.getRoot();},renderShareXHP:function(ta,ua){var va=n.create('div');if(ta){n.appendContent(va,ta.share_xhp);this.renderReportRespondLink(va,ta,ua);}return va;},renderSticker:function(ta,ua,va,wa){var xa=va?'chatScrolled/':'messengerScrolled/';xa+=ua.thread_id;var ya=n.create('div');l.addClass(ya,'stickerContainer');if(!ta.metadata){var za=da.getSticker(ua.sticker_id),ab=Object.assign({},za),bb=ea.getScaledDimensions(za.height,za.width,ca.THREAD_SIZE),cb=bb.height,db=bb.width;ab.height=cb;ab.width=db;ab.stickerID=ua.sticker_id;ab.spriteURI='';ab.spriteURI2x='';ab.paddedSpriteURI='';ab.paddedSpriteURI2x='';ta.metadata=ab;}var eb=null;if(ta.metadata.stickerID)eb=ta.metadata.stickerID.toString();var fb=null;if(ta.metadata.packID)fb=ta.metadata.packID.toString();var gb=new ma().setInt('sticker_id',eb),hb=null,ib=null;if(window.devicePixelRatio&&window.devicePixelRatio>1){ib=ta.metadata.paddedSpriteURI2x;hb=ta.metadata.spriteURI2x;}else{ib=ta.metadata.paddedSpriteURI;hb=ta.metadata.spriteURI;}var jb=z.createElement(aa,{animationTrigger:"hover",className:"mvs",frameCount:ta.metadata.frameCount||1,frameRate:ta.metadata.frameRate||83,framesPerCol:ta.metadata.framesPerCol||1,framesPerRow:ta.metadata.framesPerRow||1,onStickerClick:wa,packID:fb,paddedSpriteURI:ib,sourceHeight:ta.metadata.height,sourceURI:gb.setEnum('image_type',ba.IMAGE).getURI().toString(),sourceWidth:ta.metadata.width,spriteURI:hb,stickerID:eb,subscribedThreadID:xa});z.render(jb,ya);return ya;},renderReportRespondLink:function(ta,ua,va){if(!ua.is_social_report_attachment)return null;switch(ua.share_data_type){case m.MercurySupportedShareType.FB_PHOTO:break;case m.MercurySupportedShareType.FB_SOCIAL_REPORT_PHOTO:return null;default:return null;}var wa=null;if(va)wa=oa.getMessagesFromIDs([va])[0];if(!wa)return null;if(wa.author===x.getID())return null;var xa=null;u.get(wa.author,function(ya){xa=n.create('a',{rel:'dialog-post',className:"_z6l",id:'respond-link',ajaxify:ga('/ajax/report/social_resolution/post/').setQueryData({attachment_fbid:ua.attach_id,post_fbid:ua.shared_object_id,sender_id:t.getUserIDFromParticipantID(ya.id)}).toString()});n.setContent(xa,ja._("Respond to {name}'s request",[ja.param("name",ya.name)]));n.appendContent(ta,xa);});},renderPhotoAttachments:function(ta,ua,va,wa){var xa=ta.length;if(!xa)return null;var ya=n.create('div',{className:"_55pk"});if(xa===1){var za=sa.renderPreview(ta[0],ua,va,'contain');n.appendContent(ya,za);return ya;}var ab=(xa==2||xa==4)?2:3,bb=(va-(ab-1)*wa)/ab,cb=Math.ceil(xa/ab),db=cb*bb+(cb-1)*wa,eb=n.create('div',{className:"_55pm",style:'padding-bottom: '+(db/va*100)+'%;'});n.appendContent(ya,eb);for(var fb=0;fb<xa;++fb){var gb=sa.renderPreview(ta[fb],ua,bb,'cover'),hb=fb%ab,ib=Math.floor(fb/ab);l.addClass(gb,"_55pn");fa.apply(gb,{width:(bb/va*100)+'%',left:((hb*(bb+wa))/va*100)+'%',top:((ib*(bb+wa))/db*100)+'%'});n.appendContent(eb,gb);}return ya;},isPhotoAttachment:function(ta){return ta.attach_type==q.PHOTO||(ta.attach_type==q.FILE&&ta.preview_url);},isVideoAttachment:function(ta){return ta.attach_type==q.VIDEO;},isShareAttachment:function(ta){return ta.attach_type==q.SHARE;},isFileAttachment:function(ta){return ta.attach_type==q.FILE;},isErrorAttachment:function(ta){return ta.attach_type==q.ERROR;},isStickerAttachment:function(ta){return ta.attach_type==q.STICKER;},isSyncRequestAttachment:function(ta){var ua=m.MercurySupportedShareType;return this.isShareAttachment(ta)&&ta.share_data_type==ua.FB_SYNC_REQUEST;},sortAttachmentsStablyByType:function(ta){var ua=[sa.isPhotoAttachment,sa.isShareAttachment,sa.isFileAttachment,sa.isErrorAttachment];ua.push(function(wa){return true;});var va=ua.map(function(wa){return [];});ta.forEach(function(wa){for(var xa=0;xa<ua.length;xa++)if(ua[xa](wa)){va[xa].push(wa);break;}});return Array.prototype.concat.apply([],va);}};e.exports=sa;},null);
__d("MercuryLogMessageRenderer",["MercuryAttachmentRenderer","CSS","DOM","HovercardLink","MercuryViewer","MercuryLogMessageType","MercuryParticipants","React","Image.react","TooltipLink.react","cx","fbt","ix","OrionMercuryLogMessage"],function(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s){var t=b('OrionMercuryLogMessage').module,u={renderText:function(oa,pa){switch(oa.log_message_type){case l.SUBSCRIBE:w(oa,pa);break;case l.UNSUBSCRIBE:ba(oa,pa);break;case l.VIDEO_CALL:ca(oa,pa);break;case l.PHONE_CALL:ea(oa,pa);break;case l.THREAD_NAME:fa(oa,pa);break;case l.THREAD_IMAGE:ga(oa,pa);break;case l.WALLPAPER:ha(oa,pa);break;case l.SERVER_ERROR:ia(oa,pa);break;case l.ORION:if(t)ja(oa,pa);break;}},renderIcon:function(oa){return (n.createElement(o,{className:v(oa),src:s('images/spacer.gif')}));},renderLegacy:function(oa,pa,qa,ra){v(ra).split(' ').forEach(function(sa){return sa&&h.addClass(oa,sa);});this.renderText(ra,function(sa){n.render(n.createElement("span",null,sa),pa);});this.renderAttachmentLegacy(qa,ra);},renderAttachmentLegacy:function(oa,pa){if(pa.log_message_type==l.THREAD_IMAGE){var qa=pa.log_message_data.image;if(qa){var ra=g.renderPreview(qa.preview_url?qa:null);i.setContent(oa,ra);h.addClass(ra,"_z6a");h.show(oa);}}}};e.exports=u;function v(oa){var pa=oa.log_message_type,qa=oa.log_message_data;return (("_5wzu")+(pa==l.SUBSCRIBE?' '+"_5wzj":'')+(pa==l.UNSUBSCRIBE?' '+"_5wzk":'')+(pa==l.THREAD_NAME?' '+"_5wzl":'')+(pa==l.THREAD_IMAGE?' '+"_5wzm":'')+(pa==l.VIDEO_CALL&&(qa.answered||na(oa))?' '+"_5wzn":'')+(pa==l.VIDEO_CALL&&!(qa.answered||na(oa))?' '+"_5wzo":'')+(pa==l.PHONE_CALL&&qa.answered?' '+"_5wzp":'')+(pa==l.PHONE_CALL&&!qa.answered?' '+"_5wzq":'')+(pa==l.SERVER_ERROR?' '+"_5wzr":''));}function w(oa,pa){var qa=ma(oa.log_message_data.added_participants);switch(qa.length){case 1:x(oa,pa,qa);break;case 2:y(oa,pa,qa);break;case 3:z(oa,pa,qa);break;default:aa(oa,pa,qa);break;}}function x(oa,pa,qa){var ra=[oa.author,qa[0]];m.getMulti(ra,function(sa){if(oa.author==k.getID()){pa(r._("You added {subscriber1}.",[r.param("subscriber1",la(sa[qa[0]]))]));}else if(qa[0]==k.getID()){pa(r._("{actor} added you.",[r.param("actor",la(sa[oa.author]))]));}else pa(r._("{actor} added {subscriber1}.",[r.param("actor",la(sa[oa.author])),r.param("subscriber1",la(sa[qa[0]]))]));});}function y(oa,pa,qa){var ra=[oa.author].concat(qa);m.getMulti(ra,function(sa){if(oa.author==k.getID()){pa(r._("You added {subscriber1} and {subscriber2}.",[r.param("subscriber1",la(sa[qa[0]])),r.param("subscriber2",la(sa[qa[1]]))]));}else if(qa[0]==k.getID()){pa(r._("{actor} added you and {subscriber2}.",[r.param("actor",la(sa[oa.author])),r.param("subscriber2",la(sa[qa[1]]))]));}else pa(r._("{actor} added {subscriber1} and {subscriber2}.",[r.param("actor",la(sa[oa.author])),r.param("subscriber1",la(sa[qa[0]])),r.param("subscriber2",la(sa[qa[1]]))]));});}function z(oa,pa,qa){var ra=[oa.author].concat(qa);m.getMulti(ra,function(sa){if(oa.author==k.getID()){pa(r._("You added {subscriber1}, {subscriber2} and {subscriber3}.",[r.param("subscriber1",la(sa[qa[0]])),r.param("subscriber2",la(sa[qa[1]])),r.param("subscriber3",la(sa[qa[2]]))]));}else if(qa[0]==k.getID()){pa(r._("{actor} added you, {subscriber2} and {subscriber3}.",[r.param("actor",la(sa[oa.author])),r.param("subscriber2",la(sa[qa[1]])),r.param("subscriber3",la(sa[qa[2]]))]));}else pa(r._("{actor} added {subscriber1}, {subscriber2} and {subscriber3}.",[r.param("actor",la(sa[oa.author])),r.param("subscriber1",la(sa[qa[0]])),r.param("subscriber2",la(sa[qa[1]])),r.param("subscriber3",la(sa[qa[2]]))]));});}function aa(oa,pa,qa){var ra=[oa.author].concat(qa);m.getMulti(ra,function(sa){function ta(va){var wa=n.createElement("div",null,va.map(function(xa){return n.createElement("div",null,xa.name);}));return (n.createElement(p,{alignH:"center",position:"above",tooltip:wa},r._("{num} more",[r.param("num",va.length)])));}var ua=qa.map(function(va){return sa[va];});if(oa.author==k.getID()){pa(r._("You added {subscriber1}, {subscriber2} and {more_people}.",[r.param("subscriber1",la(ua[0])),r.param("subscriber2",la(ua[1])),r.param("more_people",ta(ua.slice(2)))]));}else if(qa[0]==k.getID()){pa(r._("{actor} added you, {subscriber2} and {more_people}.",[r.param("actor",la(sa[oa.author])),r.param("subscriber2",la(ua[1])),r.param("more_people",ta(ua.slice(2)))]));}else pa(r._("{actor} added {subscriber1}, {subscriber2} and {more_people}.",[r.param("actor",la(sa[oa.author])),r.param("subscriber1",la(ua[0])),r.param("subscriber2",la(ua[1])),r.param("more_people",ta(ua.slice(2)))]));});}function ba(oa,pa){var qa=[oa.author],ra=oa.log_message_data.removed_participants,sa;if(ra.length===1){sa=ra[0];qa.push(sa);}m.getMulti(qa,function(ta){var ua=ta[oa.author],va=ta[sa];if(oa.author==k.getID()){if(!sa||sa==oa.author){pa("You left the conversation.");}else pa(r._("You removed {name} from the conversation.",[r.param("name",la(va))]));}else if(!sa||sa==oa.author){pa(r._("{actor} left the conversation.",[r.param("actor",la(ua))]));}else if(sa==k.getID()){pa(r._("{actor} removed you from the conversation.",[r.param("actor",la(ua))]));}else pa(r._("{actor} removed {name} from the conversation.",[r.param("actor",la(ua)),r.param("name",la(va))]));});}function ca(oa,pa){if(na(oa)){da(oa,pa);return;}var qa=oa.log_message_data.caller,ra=oa.log_message_data.callee,sa=[qa,ra];m.getMulti(sa,function(ta){var ua=ka(ta[ra]);if(qa==k.getID()){if(oa.log_message_data.answered){pa(r._("You called {firstname}.",[r.param("firstname",ua)]));}else pa(r._("{firstname} missed a call from you.",[r.param("firstname",ua)]));}else{var va=ka(ta[qa]);if(oa.log_message_data.answered){pa(r._("{firstname} called you.",[r.param("firstname",va)]));}else pa(r._("You missed a call from {firstname}.",[r.param("firstname",va)]));}});}function da(oa,pa){m.get(oa.log_message_data.callee,function(qa){var ra=ka(qa);switch(oa.log_message_data.event_name){case 'installing':pa(r._("{firstname} is setting up video calling...",[r.param("firstname",ra)]));break;case 'installed':pa(r._("{firstname} finished setting up video calling.",[r.param("firstname",ra)]));break;case 'install_canceled':pa("You canceled the video calling installation.");break;}});}function ea(oa,pa){var qa=oa.log_message_data.caller,ra=oa.log_message_data.callee,sa=[qa,ra];m.getMulti(sa,function(ta){if(qa==k.getID()){var ua=ka(ta[ra]);if(oa.log_message_data.answered){pa(r._("You called {firstname}.",[r.param("firstname",ua)]));}else pa(r._("{firstname} missed a call from you.",[r.param("firstname",ua)]));}else{var va=ka(ta[qa]);if(oa.log_message_data.answered){pa(r._("{firstname} called you.",[r.param("firstname",va)]));}else pa(r._("You missed a call from {firstname}.",[r.param("firstname",va)]));}});}function fa(oa,pa){var qa=oa.log_message_data.name;if(oa.author==k.getID()){if(qa){pa(r._("You named the conversation: {name}.",[r.param("name",n.createElement("span",{className:"_5wzs"},qa))]));}else pa("You removed the conversation name.");}else m.get(oa.author,function(ra){var sa=la(ra);if(qa){pa(r._("{actor} named the conversation: {name}.",[r.param("actor",sa),r.param("name",n.createElement("span",{className:"_5wzs"},qa))]));}else pa(r._("{actor} removed the conversation name.",[r.param("actor",sa)]));});}function ga(oa,pa){if(oa.author==k.getID()){if(oa.log_message_data.image){pa("You changed the conversation picture.");}else pa("You removed the conversation picture.");}else m.get(oa.author,function(qa){var ra=la(qa);if(oa.log_message_data.image){pa(r._("{actor} changed the conversation picture.",[r.param("actor",ra)]));}else pa(r._("{actor} removed the conversation picture.",[r.param("actor",ra)]));});}function ha(oa,pa){if(oa.author==k.getID()){pa("You changed the wallpaper.");}else m.get(oa.author,function(qa){var ra=la(qa);pa(r._("{actor} changed the wallpaper.",[r.param("actor",ra)]));});}function ia(oa,pa){pa("Couldn't find previous messages.");}function ja(oa,pa){var qa=oa.log_message_data,ra=qa.senderId,sa=qa.receiverId,ta=ra===k.getID();m.getMulti([ra,sa],function(ua){pa(n.createElement(t,n.__spread({},qa,{receiverParticipant:ua[sa],senderParticipant:ua[ra],viewerIsSender:ta})));});}function ka(oa){return la(oa,true);}function la(oa,pa){var qa=oa.fbid,ra=j.constructEndpoint({id:qa});if(oa.href)return (n.createElement("a",{className:"_5wzt",href:oa.href,"data-hovercard":ra},pa?oa.short_name:oa.name));return oa.name;}function ma(oa){var pa=oa.indexOf(k.getID());if(pa>0){var qa=oa.filter(function(ra){return ra!==k.getID();});return [k.getID()].concat(qa);}return oa;}function na(oa){return oa.log_message_data.event_name==='installing'||oa.log_message_data.event_name==='installed'||oa.log_message_data.event_name==='install_canceled';}},null);
__d("MercuryTypingReceiver",["Arbiter","ChannelConstants","MercuryActionType","MercuryIDs","MercuryPayloadSource","MercuryViewer","TypingStates","mixInEventEmitter","setTimeoutAcrossTransitions","MercuryServerRequests"],function(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o){var p=b('MercuryServerRequests').get(),q,r={},s=30000,t={};n(t,{'state-changed':true});function u(aa){var ba=r[aa]||{},ca=Object.keys(ba);ca.sort(function(da,ea){return ba[da]-ba[ea];});return ca;}function v(){q=null;var aa=Date.now(),ba={},ca=false;for(var da in r){var ea=false;for(var fa in r[da]||{})if(r[da][fa]<aa-s){delete r[da][fa];ea=true;}else ca=true;if(ea)ba[da]=u(da);}for(var ga in ba){x(ba);break;}if(ca)q=o(v,3000);}function w(aa,ba){if(aa in r)if(ba in r[aa]){delete r[aa][ba];y(aa);}}function x(aa){t.releaseHeldEventType('state-changed');t.emitAndHold('state-changed',aa);}function y(aa){var ba={};ba[aa]=u(aa);x(ba);}function z(aa){if(aa.thread_fbid)return p.getClientThreadIDNow(aa.thread_fbid);if(aa.type==='typ')return j.getThreadIDFromUserID(aa.from);return null;}g.subscribe([h.getArbiterType('typ'),h.getArbiterType('ttyp')],function(aa,ba){var ca=ba.obj,da=z(ca);if(da){var ea=j.getParticipantIDFromUserID(ca.from);if(ca.st==m.TYPING){r[da]=r[da]||{};var fa=r[da][ea];r[da][ea]=Date.now();if(!q)q=o(v,3000);!fa&&y(da);}else if(ca.st==m.INACTIVE)w(da,ea);}});p.subscribe('update-typing-state',function(aa,ba){var ca=ba.payload_source;if(ca!=k.CLIENT_CHANNEL_MESSAGE)return;var da=ba.actions;if(!da||!da.length)return;var ea=i.USER_GENERATED_MESSAGE;da.forEach(function(fa){if(fa.action_type==ea&&fa.author!=l.getID())w(fa.thread_id,fa.author);});});e.exports=t;},null);
__d("MercuryIndicatorController",["ArbiterMixin","DOM","MercuryActionType","MercuryDelayedRoger","MercuryIDs","MercuryMessageSourceTags","MercuryParticipants","MercuryRoger","MercuryTypingReceiver","MercuryViewer","arrayContains","copyProperties","formatDate","removeFromArray","fbt","MercuryThreads"],function(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u){var v=b('MercuryThreads').get(),w=[];function x(y){this._threadID=y;this._canonicalUser=k.getUserIDFromThreadID(y);w.push(this);}r(x.prototype,g,{destroy:function(){t(w,this);},setLastMessage:function(y){this._lastMsg=y;this._handleStateChange();},_informStateChanged:function(y){if(y.activity=='none'&&this._currentActivity=='none')return;if(this._lastMsg&&p.isViewer(this._lastMsg.author))y.self_authored=true;this._currentActivity=y.activity;this.inform('state-changed',y);},_notifySentFrom:function(){var y,z,aa=this._lastMsg.location_text,ba=this._lastMsg.source_tags||[];if(aa){y=u._("Sent from {location}",[u.param("location",aa)]);z='sentFromMobile';}else if(q(ba,l.MESSENGER)){y=h.create('a',{href:'/mobile/messenger','class':'fcg',target:'_blank'},"Sent from Messenger");z='sentFromMobile';}else if(q(ba,l.MOBILE)){y=h.create('a',{href:'/mobile','class':'fcg',target:'_blank'},"Sent from Mobile");z='sentFromMobile';}else if(q(ba,l.EMAIL)){y="Sent from email";z='sentFromEmail';}else{this._informStateChanged({activity:'none'});return;}this._informStateChanged({activity:z,text:y});},_notifySeenTimestamp:function(y){var z=n.getSeenTimestamp(this._threadID,y[0])*.001,aa=Date.now()*.001,ba;if(z<aa-518400){ba='M j';}else if(z<aa-86400){ba='D g:ia';}else ba='g:ia';this._informStateChanged({activity:'seen-timestamp',text:u._("Seen {timestamp}",[u.param("timestamp",s(z,ba))])});},_nameNormalizer:function(y){var z;m.getMulti(y,function(aa){function ba(da){if(aa[da]!==(void 0)){return aa[da].short_name.toLowerCase();}else return da;}var ca=y.map(ba);z=function(da){var ea=ba(da),fa=ca.indexOf(ea)!==ca.lastIndexOf(ea);return fa?aa[da].name:aa[da].short_name;};});return z;},_notifySeenBy:function(y){var z=this._lastMsg,aa=true;m.getMulti(y,function(ba){aa=false;if(this._lastMsg!=z)return;var ca=v.getThreadMetaNow(this._threadID),da=ca?ca.participants.length:0,ea=y.length+(z.author!=p.getID()),fa,ga=false,ha=da>2&&ea>=da-1,ia;if(ca)ia=this._nameNormalizer(ca.participants);if(!ia)ia=function(ma){return ba[ma].short_name;};if(ha){fa="Seen by everyone";}else if(y.length==1){fa=u._("Seen by {user}",[u.param("user",ba[y[0]].short_name)]);}else if(y.length==2){fa=u._("Seen by {user1}, {user2}",[u.param("user1",ba[y[0]].short_name),u.param("user2",ba[y[1]].short_name)]);}else if(y.length==3){fa=u._("Seen by {user1}, {user2}, {user3}",[u.param("user1",ba[y[0]].short_name),u.param("user2",ba[y[1]].short_name),u.param("user3",ba[y[2]].short_name)]);}else if(y.length>3){var ja=Object.keys(ba).length-2,ka=u._("{num} more",[u.param("num",ja)]),la=h.create('span',{className:'more'},ka);fa=u._("Seen by {user1}, {user2}, {=num more link}",[u.param("user1",ba[y[0]].short_name),u.param("user2",ba[y[1]].short_name),u.param("=num more link",la)]);ga=true;}this._informStateChanged({activity:'seen-by',text:fa,seenBy:y,tooltip:ga});}.bind(this));aa&&this._informStateChanged({activity:'none'});},_notifyTyping:function(y){var z=this._lastMsg,aa=true;m.getMulti(y,function(ba){aa=false;if(this._lastMsg!=z)return;var ca=v.getThreadMetaNow(this._threadID),da=ca?ca.participants.length:0,ea;if(ca)ea=this._nameNormalizer(ca.participants);if(!ea)ea=function(ka){return ba[ka].short_name;};var fa,ga=false;if(da>2&&y.length>=da-1){fa="Everyone is typing...";}else if(y.length==1){fa=u._("{name} is typing...",[u.param("name",ba[y[0]].short_name)]);}else if(y.length==2){fa=u._("{user1} and {user2} are typing...",[u.param("user1",ba[y[0]].short_name),u.param("user2",ba[y[1]].short_name)]);}else if(y.length==3){fa=u._("{user1}, {user2}, and {user3} are typing...",[u.param("user1",ba[y[0]].short_name),u.param("user2",ba[y[1]].short_name),u.param("user3",ba[y[2]].short_name)]);}else if(y.length>3){var ha=Object.keys(ba).length-2,ia=u._("{num} more",[u.param("num",ha)]),ja=h.create('a',{href:'#'},ia);fa=u._("{user1}, {user2}, and {=num more link} are typing...",[u.param("user1",ba[y[0]].short_name),u.param("user2",ba[y[1]].short_name),u.param("=num more link",ja)]);ga=true;}this._informStateChanged({activity:'typing',text:fa,typing:y,tooltip:ga});}.bind(this));aa&&this._informStateChanged({activity:'none'});},_handleStateChange:function(){var y=i.LOG_MESSAGE;if(!this._lastMsg||this._lastMsg.action_type==y){this._informStateChanged({activity:'none'});return;}if(this._typing&&this._typing.length){this._notifyTyping(this._typing);return;}if(this._canonicalUser&&this._lastMsg.author!=p.getID()){this._notifySentFrom();return;}var z=j.getSeenBy(this._threadID,true);if(z.length)if(this._canonicalUser){this._notifySeenTimestamp(z);return;}else{this._notifySeenBy(z);return;}this._informStateChanged({activity:'none'});}});o.addRetroactiveListener('state-changed',function(y){w.forEach(function(z){var aa=y[z._threadID];if(aa!==(void 0)){z._typing=aa;z._handleStateChange();}});});j.subscribe('state-changed',function(y,z){w.forEach(function(aa){z[aa._threadID]&&aa._handleStateChange();});});e.exports=x;},null);
__d("MercuryLastMessageIndicator.react",["DOM","MercuryIndicatorController","MercuryParticipants","ReactPropTypes","React","Tooltip","cx","emptyFunction","joinClasses"],function(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o){var p=k.createClass({displayName:"MercuryLastMessageIndicator",propTypes:{hideTyping:j.bool,indicatorWillShow:j.func,indicatorDidShow:j.func,lastMessage:j.object,threadID:j.string.isRequired},getDefaultProps:function(){return {indicatorWillShow:n,indicatorDidShow:n};},getInitialState:function(){return {data:{}};},componentDidMount:function(){this._setup(this.props);},componentWillReceiveProps:function(q){if(q.threadID!=this.props.threadID){this._destroy();this._setup(q);}else if(q.lastMessage!=this.props.lastMessage)this._controller.setLastMessage(q.lastMessage);},componentWillUpdate:function(q,r){if(this.isVisible(q,r))this.props.indicatorWillShow();},componentDidUpdate:function(){if(!this.isVisible())return;this.setText();this.setTooltip();this.props.indicatorDidShow();},componentWillUnmount:function(){this._destroy();},render:function(){return (k.createElement("div",{className:this.getRootClass()},k.createElement("div",{className:"_510h"}),k.createElement("span",{className:"_510f",ref:"text"}," ")));},getRootClass:function(){var q=(("_510g")+(this.state.data.self_authored?' '+"_510e":'')),r=this.state.data.activity,s=null;if(String(r).startsWith('seen')){s='seen';}else if(r=='typing'){s=this.props.hideTyping?null:r;}else s=r;return o(q,s,this.props.className);},isVisible:function(q,r){q=q||this.props;r=r||this.state;return (r.data&&r.data.activity!='none'&&!(q.hideTyping&&r.data.activity=='typing'));},setText:function(){if(this.state.data.text)g.setContent(this.refs.text.getDOMNode(),this.state.data.text);},setTooltip:function(){if(this.state.data.activity=='seen-by'&&this.state.data.tooltip)i.getMulti(this.state.data.seenBy,function(q){var r=g.create('div',null,this.state.data.seenBy.map(function(s){return g.create('div',null,q[s].name);}));l.set(g.find(this.getDOMNode(),'span.more'),r,'above','center');}.bind(this));},_setup:function(q){this._controller=new h(q.threadID);this._subscription=this._controller.subscribe('state-changed',function(r,s){return this.setState({data:s});}.bind(this));q.lastMessage&&this._controller.setLastMessage(q.lastMessage);},_destroy:function(){this._subscription.unsubscribe();this._controller.destroy();}});e.exports=p;},null);
__d("MercuryTypeahead",["Event","ArbiterMixin","DOM","DOMDimensions","Input","Keys","MercuryTypeaheadTemplates","Tokenizer","Typeahead","TypeaheadCore","copyProperties","cx"],function(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r){var s=function(t,u){this._domElement=null;this._typeahead=null;this._tokenizer=null;this._placeholder='';this._exclusions=[];this._viewNodeOrID=null;this._viewOptions={renderer:'compact',autoSelect:true};this._tokenizerBehaviors=[];this._heightPrev=null;this._dataSource=t;this._view=u;};q(s.prototype,h);q(s.prototype,{setPlaceholder:function(t){this._placeholder=t;return this;},setExcludedParticipantsFromThreadMeta:function(t){if(!t)return;if(!t.former_participants){this.setExcludedParticipants(t.participants);return;}var u=t.former_participants.filter(function(v){return v.is_friend===false;}).map(function(v){return v.id;});this.setExcludedParticipants(u.concat(t.participants));},setExcludedParticipants:function(t){this._exclusions=[];t.forEach(function(u){var v=u.indexOf(':');if(u.substr(0,v)=='fbid')this._exclusions.push(u.substr(v+1));}.bind(this));return this;},setViewNodeID:function(t){this._viewNodeOrID=t;},setViewNode:function(t){this._viewNodeOrID=t;},setFullWidthView:function(t){var u=i.create('div',{className:"_4ck uiTypeaheadView"});i.setContent(t,u);this.setViewNode(u);},setViewOption:function(t,u){this._viewOptions[t]=u;},addTokenizerBehavior:function(t){this._tokenizerBehaviors.push(t);},build:function(t){if(this._domElement)return;var u=m[':fb:mercury:tokenizer'].build(),v=m[':fb:mercury:typeahead'].build();this._domElement=u.getRoot();i.appendContent(this._domElement,v.getRoot());var w=v.getNode('textfield');k.setPlaceholder(w,this._placeholder);w.setAttribute('data-placeholder',this._placeholder);this._input=w;var x={node_id:this._viewNodeOrID,ctor:this._view,options:this._viewOptions},y={ctor:p,options:{setValueOnSelect:true}};this._typeahead=new o(this._dataSource,x,y,v.getRoot());this._typeahead.init();var z={inline:true,behaviors:this._tokenizerBehaviors};this._tokenizer=new n(this._domElement,this._typeahead);this._tokenizer.init(u.getNode('tokenarea'),'participants',[],z);this._tokenizer.subscribe(['addToken','removeToken','removeAllTokens'],this._tokensChanged.bind(this));this._tokenizer.subscribe('resize',function(){this.inform('resize');}.bind(this));g.listen(w,'focus',function(){this._resetDataSource();this._typeahead.init();}.bind(this));g.listen(this._domElement,'click',this.focus.bind(this));g.listen(w,'keydown',this.keydown.bind(this));this._heightPrev=j.getElementDimensions(this._domElement).height;},getElement:function(){return this._domElement;},getSelectedParticipantIDs:function(){var t=[];if(this._tokenizer)(this._tokenizer.getTokenValues()||[]).forEach(function(u){t.push('fbid:'+u);});return t;},getTokens:function(){var t=[];if(this._tokenizer)t=this._tokenizer.getTokens();return t;},getTokenizer:function(){return this._tokenizer;},keydown:function(event){if(this._tokenizer.inline&&event.keyCode==l.ESC){if(k.isEmpty(this._input)){var t=this._tokenizer.getLastToken();if(t&&t.isRemovable())this._tokenizer.removeToken(t);}else this._typeahead.getCore().reset();return false;}if(k.isEmpty(this._input)&&this._tokenizer.inline&&event.keyCode===l.RETURN){event.preventDefault();return this.inform('tokens-return');}},reset:function(){this._tokenizer&&this._tokenizer.removeAllTokens();this._typeahead&&this._typeahead.getCore().reset();},focus:function(){this._tokenizer&&this._tokenizer.focusInput();},getTypeahead:function(){return this._typeahead;},_resetDataSource:function(){this._dataSource.setExclusions(this._exclusions);},_tokensChanged:function(){this.inform('tokens-changed');}});e.exports=s;},null);
__d("MercuryReadOnlyReason",["React","fbt"],function(a,b,c,d,e,f,g,h){var i={getReason:function(j){if(j.has_email_participant){return (h._("Sorry, this conversation isn't active anymore because messages can no longer be sent to email addresses. Messages sent to facebook.com email addresses will now be forwarded to primary email addresses, so you can continue this conversation over email. {Learn more}.",[h.param("Learn more",g.createElement("a",{href:"/help/224049364288051"},"Learn more"))]));}else return ("You cannot reply to this conversation.");}};e.exports=i;},null);
__d("MercurySheetPolicy",[],function(a,b,c,d,e,f){var g={canReplaceOpenSheet:function(h,i){if(h.isSheetWithInput&&h.isSheetWithInput())return i.getType()!=h.getType()&&i.isSheetWithInput&&i.isSheetWithInput();if(h.getType()==i.getType())return false;if(h.isPermanent()&&!i.isPermanent())return false;return true;}};e.exports=g;},null);
__d("MercurySheetView",["Animation","ArbiterMixin","MercurySheetPolicy","CSS","DOM","Style","MercurySheetTemplates","Vector","copyProperties","cx","setTimeoutAcrossTransitions"],function(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q){var r=5000,s=function(t,u,v){this._threadID=t;this._rootElement=u;this._tabMainElement=v;this._openSheet=null;};o(s.prototype,h,{destroy:function(){k.empty(this._rootElement);},_openCommon:function(t,u){if(this._openSheet&&!i.canReplaceOpenSheet(this._openSheet,t)){if(t.couldNotReplace)t.couldNotReplace();return;}this.clear(function(){this._openSheet=t;var v=m[':fb:mercury:tab-sheet:loading'].build().getRoot();k.setContent(this._rootElement,v);j.show(v);j.show(this._rootElement);t.render();if(u){j.addClass(this._tabMainElement,'sheetSlide');j.addClass(this._tabMainElement,"_1sk4");var w=n.getElementDimensions(this._rootElement).y;l.set(this._rootElement,'bottom',w+'px');this.resize();this._animation=new g(this._rootElement).to('bottom',0).duration(150).ease(g.ease.both).ondone(function(){j.removeClass(this._tabMainElement,'sheetSlide');j.removeClass(this._tabMainElement,"_1sk4");this.resize();}.bind(this)).go();}else this.resize();if(!t.isPermanent()){var x=r;if(t.getCloseTimeout)x=t.getCloseTimeout();var y=this.getAutoCloseCallback(t);this._sheetCloseHandler=q(this.close.bind(this,t,y),x);if(t.timeoutCanBeReset)t.setResetTimeoutCallback(this.resetTimeout.bind(this));}}.bind(this));},getAutoCloseCallback:function(t){if(!t.autoCloseCallback)return null;return t.autoCloseCallback.bind(t);},resetTimeout:function(t,u){clearTimeout(this._sheetCloseHandler);var v=this.getAutoCloseCallback(t);this._sheetCloseHandler=q(this.close.bind(this,t,v),u);},set:function(t){return this._openCommon(t,false);},open:function(t){return this._openCommon(t,true);},close:function(t,u){if(this._openSheet!=t)return;if(!this._openSheet){u&&u();return;}if(this._animation)this._animation.stop();if(this._sheetCloseHandler){clearTimeout(this._sheetCloseHandler);this._sheetCloseHandler=null;}j.addClass(this._tabMainElement,'sheetSlide');j.addClass(this._tabMainElement,"_1sk4");var v=n.getElementDimensions(this._rootElement).y;this.resize();this._animation=new g(this._rootElement).to('bottom',v+'px').duration(100).ease(g.ease.begin).ondone(function(){k.empty(this._rootElement);j.hide(this._rootElement);j.removeClass(this._tabMainElement,'sheetSlide');j.removeClass(this._tabMainElement,"_1sk4");this._openSheet=null;this.resize();u&&u();}.bind(this)).go();},clear:function(t){this.close(this._openSheet,t);},resize:function(){this.inform('resize');}});e.exports=s;},null);
__d("MercurySeenByAll",["CSS","DataStore","MercuryDelayedRoger","DOM","MercuryIDs","MercuryViewer","MercuryThreads"],function(a,b,c,d,e,f,g,h,i,j,k,l){var m=b('MercuryThreads').get(),n={},o={updateOnSeenChange:function(q,r,s){n[q.tagName]=true;h.set(q,'thread-id',r.thread_id);g.addClass(q,'seenByListener');p(q,r,s);}};function p(q,r,s){var t=null;if(s){t=k.getParticipantIDFromUserID(s);}else t=l.getID();var u=r.participants.filter(function(w){return w!==t;}),v=r.participants.length>0&&r.participants[0]===t;g.conditionClass(q,'repliedLast',v);g.conditionClass(q,'seenByAll',v&&i.getSeenBy(r.thread_id).length===u.length);}i.subscribe('state-changed',function(q,r){for(var s in n){var t=j.scry(document.body,s+'.seenByListener');for(var u=0;u<t.length;u++){var v=t[u],w=h.get(v,'thread-id');if(r[w])m.getThreadMeta(w,function(x){p(v,x);});}}});e.exports=o;},null);
__d("MercuryThreadMetadataRenderer",["CSS","DOM","Emoji","HTML","JSLogger","MercuryAttachmentType","MercuryIDs","MercuryMessageSourceTags","MercurySingletonMixin","MercuryThreadImage.react","MercuryThreadMetadataRawRenderer","MercuryThreadTitle.react","MercuryParticipants","React","MercurySeenByAll","MercuryServerRequests","Style","MercuryThreads","Tooltip","URI","WebMessengerThreadPermalinks","arrayContains","createArrayFromMixed","copyProperties","cx","formatDate","fbt"],function(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v,w,x,y,z,aa,ba,ca,da,ea,fa,ga){var ha=k.create('wm_timestamp');function ia(na){this._fbid=na;this._serverRequests=v.getForFBID(na);this._threads=x.getForFBID(na);}da(ia,o);da(ia.prototype,{renderTimestamp:function(na,oa,pa,qa){if(qa){if(!oa){ha.warn('no_title');oa=(new Date(qa)).toLocaleDateString();}na.setAttribute('title',oa);na.setAttribute('data-utime',qa/1000);if(!pa){ha.warn('no_display');pa=fa(new Date(qa),'g:ia');}h.setContent(na,pa);g.show(na);}},renderMessageSourceTags:function(na,oa,pa,qa){var ra='',sa='',ta='';if(ba(pa,n.MESSENGER)){ra="Sent from Messenger";sa=new z('/mobile/messenger');ta="_9g";}else if(ba(pa,n.MOBILE)){ra="Sent from Mobile";sa=new z('/mobile/');ta="_9j";}else if(ba(pa,n.CHAT)){ra="Sent from chat";ta="_9h";}else if(ba(pa,n.EMAIL)){if(qa){ra=ga._("Sent from {email}",[ga.param("email",qa)]);}else ra="Sent from email";ta="_9i";}if(ta){y.set(na,ra);g.addClass(oa,ta);if(sa){na.setAttribute('href',sa);}else na.removeAttribute('href');}else g.hide(na);},renderMessageLocation:function(na,oa,pa){var qa=z('/ajax/messaging/hovercard/map.php').setQueryData(pa);na.setAttribute('data-hovercard',qa);g.removeClass(na,"_b9");g.show(oa);},renderSpoofWarning:function(na,oa,pa){if(oa){g.addClass(na,"_sa");y.set(na,ga._("Unable to confirm {name_or_email} as the sender.",[ga.param("name_or_email",pa.name)]));}},renderChatSpoofWarning:function(na,oa,pa){if(oa)h.appendContent(na,ga._("Unable to confirm {name_or_email} as the sender.",[ga.param("name_or_email",pa.name)]));},renderCoreThreadlist:function(na,oa,pa,qa,ra){qa=qa||{};this.renderThreadImage(na,oa.getNode('image'));var sa=oa.getNode('accessibleName'),ta=[oa.getNode('name')];if(sa)ta.push(sa);ma(this,na,ta,qa);if(na.folder&&ra)la(oa.getNode('folderBadge'),na.folder);var ua=oa.getNode('timestamp');this.renderTimestamp(ua,na.timestamp_absolute,na.timestamp_relative,na.timestamp);this.renderSnippet(na,oa.getNode('snippet'));ka(oa,na);pa(oa,na);},renderAndSeparatedParticipantList:function(na,oa,pa){pa=pa||{};pa.last_separator_uses_and=true;this._threads.getThreadMeta(na,function(qa){ma(this,qa,oa,pa);}.bind(this));},renderSnippet:function(na,oa){var pa=false,qa=h.create('span');g.addClass(qa,'MercuryRepliedIndicator');h.appendContent(oa,qa);u.updateOnSeenChange(qa,na,this._fbid);var ra=na.snippet;if(ra){if(na.snippet_has_attachment)h.appendContent(oa,h.create('span',{className:'MercuryAttachmentIndicator'}));if(na.is_forwarded_snippet)h.appendContent(oa,h.create('strong',{className:"_55q_"},"Forwarded Message:"));if(ra.substr(0,4)=='?OTR'){ra="[encrypted message]";}else ra=ra.replace(/\r\n|[\r\n]/g," ");ra=j(i.htmlEmojiAndEmote(ra));}else{if(na.is_forwarded_snippet)h.appendContent(oa,h.create('strong',{className:"_55q_"},"Forwarded Message"));if(na.snippet_has_attachment&&na.snippet_attachments&&na.snippet_attachments.length){pa=true;ra=h.create('span');d(['MercuryAttachmentSnippet.react'],function(ua){t.render(t.createElement(ua,{thread:na,viewer:this._fbid}),ra);}.bind(this));}}var sa=na.participants.length;if(na.is_subscribed)sa--;var ta=na.snippet_sender;if(!pa&&ta&&m.getParticipantIDFromUserID(this._fbid)!=ta&&sa>1){s.get(ta,function(ua){if(ua.short_name){h.appendContent(oa,ga._("{name}: {conversation_snippet}",[ga.param("name",ua.short_name),ga.param("conversation_snippet",ra)]));}else h.appendContent(oa,ra);});}else h.appendContent(oa,ra);},renderWebMessengerLink:function(na,oa,pa,qa){aa.getThreadURI(na,function(ra){oa.setAttribute('href',ra);pa&&pa();},qa);},renderThreadImage:function(na,oa){t.render(t.createElement(p,{thread:na,viewer:this._fbid}),oa);},renderParticipantList:function(na,oa,pa,qa){return q.renderRawParticipantList(this._serverRequests.getServerThreadIDNow(na),oa,pa,qa);},renderThreadNameAndParticipantList:function(na,oa,pa,qa){var ra=q.renderRawParticipantList(this._serverRequests.getServerThreadIDNow(na),oa,pa,qa),sa=this._threads.getThreadMetaNow(na);if(!sa.name)return ra;return ga._("{conversation_name} [with {participant_list}]",[ga.param("conversation_name",sa.name),ga.param("participant_list",ra)]);},renderParticipantCount:function(na,oa){return q.renderRawParticipantCount(oa);}});function ja(na){if(!na.snippet_attachments)return [];return na.snippet_attachments.filter(function(oa){return oa.attach_type===l.PHOTO;});}function ka(na,oa){var pa=ja(oa);if(pa.length===0)return;var qa=pa[0].thumbnail_url;if(!qa)return;var ra=(pa.length==1)?'snippet-thumbnail-single':'snippet-thumbnail-multiple',sa=na.getNode(ra);if(!sa)return;var ta=h.find(sa,'i');w.set(ta,'background-image','url('+qa+')');g.show(sa);}function la(na,oa){ca(na).forEach(function(pa){h.setContent(pa,oa);});}function ma(na,oa,pa,qa){pa=ca(pa);var ra=na._fbid;if(oa.name){pa.forEach(function(ta){t.render(t.createElement(r,{thread:oa,viewer:ra,showUnreadCount:!!qa.show_unread_count}),ta);});return;}var sa=oa.participants;if(oa.participants.length>1)sa=oa.participants.filter(function(ta){return ta!=m.getParticipantIDFromUserID(ra);});s.getMulti(sa,function(ta){q.renderParticipantListWithNoThreadName(na._serverRequests.getServerThreadIDNow(oa.thread_id),oa,sa,ta,pa,qa);});}e.exports=ia;},null);
__d("ChatTabView",["Arbiter","ArbiterMixin","AsyncDialog","AsyncRequest","AsyncSignal","AvailableListConstants","BanzaiODS","ChatAddToThreadButton.react","ChatArchiveWarning.react","ChatBehavior","ChatCloseButton.react","ChatConfig","ChatContextualDialogController","ChatEmployeeAwayWarning","ChatOpenTab","ChatPhotoUploader.react","ChatPrivacyActionController","ChatQuietLinks","ChatShareLinkUploader","ChatStickerButton.react","ChatStickerTriggerController","ChatTabMenu.react","ChatTabMessagesView","ChatTabSheetController","ChatTitleLink.react","ChatVisibility","ChatVideoCallButton.react","MercuryConstants","CurrentUser","CSS","CurrentLocale","Dialog","Dock","DOM","DOMEvent","DOMQuery","DragDropTarget","EmoticonsList","EmoticonUtils","Event","Focus","ImmutableObject","Input","Keys","Locale","LogHistory","MercuryConfig","MercuryIDs","MercuryFileUploader","MercuryLogMessageType","MercuryParticipants","MercuryShareAttachmentRenderLocations","MercurySharePreview.react","MercurySourceType","MercuryThreadMetadataRawRenderer","MercuryThreadMuter","MercuryTypingAnimation.react","MercuryTypingReceiver","MercuryViewer","NubController","Parent","PhotosUploadWaterfall","PresencePrivacy","PresenceStatus","React","Run","SelectionPosition","StickerActions","StickerConfig","StickerConstants","StickersFlyout.react","StickerState","Style","SubscriptionsHandler","SyntheticMouseEvent","ChatTabTemplates","TextAreaControl","Toggler","Tooltip","TypingDetectorController","URLScraper","URI","UserAgent_DEPRECATED","VideoCallCore","WaterfallIDGenerator","WebMessengerThreadPermalinks","XStickerReplyNUXControllerURIBuilder","copyProperties","cx","csx","fbt","getActiveElement","isEmpty","setIntervalAcrossTransitions","ChatReactInput","OrionTrigger","MercuryMessageActions","MercuryMessages","MercuryMessageObject","MercuryServerRequests","MercuryThreadInformer","MercuryThreadMetadataRenderer","MercuryThreadActions","MercuryThreads"],function(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v,w,x,y,z,aa,ba,ca,da,ea,fa,ga,ha,ia,ja,ka,la,ma,na,oa,pa,qa,ra,sa,ta,ua,va,wa,xa,ya,za,ab,bb,cb,db,eb,fb,gb,hb,ib,jb,kb,lb,mb,nb,ob,pb,qb,rb,sb,tb,ub,vb,wb,xb,yb,zb,ac,bc,cc,dc,ec,fc,gc,hc,ic,jc,kc,lc,mc,nc,oc,pc,qc,rc,sc,tc,uc,vc){"use strict";var wc=b('ChatReactInput').module,xc=b('OrionTrigger').module,yc=b('MercuryMessageActions').get(),zc=b('MercuryMessages').get(),ad=b('MercuryMessageObject').get(),bd=b('MercuryServerRequests').get(),cd=b('MercuryThreadInformer').get(),dd=b('MercuryThreadMetadataRenderer').get(),ed=b('MercuryThreadActions').get(),fd=b('MercuryThreads').get(),gd=/^\s*$/,hd={},id=null,jd,kd=10,ld=za.getInstance('chat_tab_view');function md(he,ie){var je=na.create('div');ie=ie&&ie.filter(function(me){return me!=mb.getID();});if(uc(ie))return gc.remove(he);var ke=ie.length,le=ke-kd;if(le>1)ie=ie.slice(0,kd);eb.getMulti(ie,function(me){for(var ne in me){var oe=me[ne],pe=dc[':fb:mercury:chat:multichat-tooltip-item'].build();na.setContent(pe.getNode('name'),oe.name);var qe=bb.getUserIDFromParticipantID(ne),re=qe&&rb.get(qe)==l.ACTIVE;ja.conditionShow(pe.getNode('icon'),re);ja.conditionClass(pe.getNode('name'),'tooltipItemWithIcon',re);na.appendContent(je,pe.getRoot());}if(le>1){var se=sc._("and {number of hidden chat participants} more.",[sc.param("number of hidden chat participants",le)]);na.appendContent(je,na.create('div',{},se));}gc.set(he,je,'above');});}var nd={},od=null,pd=false;function qd(he,ie,je){if(je){nd[he]=ie;if(!od)od=vc(rd,600);}else{ja.removeClass(ie,'highlightTitle');delete nd[he];}}function rd(){for(var he in nd){var ie=nd[he];if(ie.parentNode){ja.conditionClass(ie,'highlightTitle',pd);}else delete nd[he];}pd=!pd;if(!Object.keys(nd).length){clearInterval(od);od=null;}}function sd(he){var ie=bb.tokenize(he);switch(ie.type){case 'user':return dc[':fb:mercury:chat:user-tab'].build();}return dc[':fb:mercury:chat:multichat-tab'].build();}function td(he){var ie=he._getInputValue(),je=he._fileUploader.getAttachments();if(zd(he))vd(he,ie,je,function(ke){var le=he._fileUploader.getImageFiles();if(le.length>0){ke.image_ids=le;ke.has_attachment=true;}var me=he._fileUploader.getVideoFiles();if(me.length>0){ke.video_ids=me;ke.has_attachment=true;}var ne=he._fileUploader.getAudioFiles();if(ne.length>0){ke.audio_ids=ne;ke.has_attachment=true;}var oe=he._fileUploader.getFiles();if(oe.length>0){ke.file_ids=oe;ke.has_attachment=true;}yc.send(ke);he._fileUploader.removeAttachments();he._shareLinkUploader&&he._shareLinkUploader.clear();if(he._sharePreview)he._sharePreview.setProps({share:null,uri:null});if(!r.get('chat_react_input'))he._getNode('input').value='';he._typingDetector&&he._typingDetector.resetState();he._messagesView&&he._messagesView.setShouldScrollToBottom(true);});}function ud(he,ie){if(ie===0)return;ce(he,pb.POST_PUBLISHED,{count:ie});he._waterfallID=mc.generate();}function vd(he,ie,je,ke){fd.getThreadMeta(he._threadID,function(le){var me=ad.constructUserGeneratedMessageObject(ie,hb.CHAT_WEB,he._threadID);if(je.length>0){me.has_attachment=true;me.raw_attachments=je;}if(he._shareLinkUploader){var ne=he._shareLinkUploader.getAttachData();if(ne){me.has_attachment=true;me.content_attachment=ne;}}if(he._sharePreview){var oe=he._sharePreview.getShareData();if(oe){me.has_attachment=true;me.shareable_attachment=oe;}}if(fd.isNewEmptyLocalThread(he._threadID)){var pe=he._sheetController.getAddFriendsParticipants();if(pe===null||pe.length===0)return;pe=pe.filter(function(re){return re!=mb.getID();});if(pe.length===0){me.thread_id=bb.getThreadIDFromUserID(ia.getID());}else if(pe.length===1){me.thread_id=bb.getThreadIDFromParticipantID(pe[0]);}else ed.addParticipants(he._threadID,pe);}if(fd.isEmptyLocalThread(he._threadID)){me.message_id=bb.tokenize(he._threadID).value;var qe=fd.getThreadMetaNow(le.thread_id);me.specific_to_list=Array.from(qe.participants);}if(typeof me!='undefined')me.signatureID=he._signatureID;me.ui_push_phase=ha.UIPushPhase;ke(me);if(he._threadID!==me.thread_id&&!he._photoUploader.isUploading()){de.inform('closed-tab',he._threadID);u.openThread(me.thread_id,'ChatTabView');}});}function wd(he){he._blocked=true;he._sheetController.openUploadWarningTabSheet();}function xd(he){return (he._fileUploader.isUploading()||he._photoUploader.isUploading()||(he._sharePreview&&he._sharePreview.isLoading()));}function yd(he){return (he._fileUploader.isUploading()||(he._sharePreview&&he._sharePreview.isLoading()));}function zd(he){var ie=he._getInputValue();if(!gd.test(ie))return true;if(he._fileUploader.getAttachments().length>0||he._fileUploader.getImageFiles().length>0||he._fileUploader.getVideoFiles().length>0||he._fileUploader.getAudioFiles().length>0||he._fileUploader.getFiles().length>0)return true;if(he._shareLinkUploader&&he._shareLinkUploader.getAttachData())return true;if(he._sharePreview&&he._sharePreview.getShareData())return true;return false;}function ae(he){if(he._blocked){if(yd(he))return;he._blocked=false;td(he);he._sheetController.closeUploadWarningTabSheet();}}function be(he){he._nubController.flyoutContentChanged();var ie=he._getNode('attachmentShelf');ie.scrollTop=ie.scrollHeight;}function ce(he,ie,je){pb.sendSignal(pc({qn:he._waterfallID,step:ie,uploader:pb.APP_CHAT},je||{}));}function de(he,ie,je,ke,le){if(ie)bd.ensureThreadIsFetched(ie);this._threadID=he;this._signatureID=je;this._eventListeners=[];this._isDragDropActive=false;this._tabTemplate=sd(he);this._tabElem=this._tabTemplate.getRoot();if(le){this.insertBefore(le);}else this.appendTo(ke);this._titlebar=this._getNode('nubFlyoutTitlebar');this._iconsContainerNode=this._getNode('iconsContainer');this._inputContainerNode=this._getNode('inputContainer');this._waterfallID=mc.generate();this._subscriptionsHandler=new bc();this._initializeAutoSendPhotoUploader();this._stickersFlyoutShown=false;var me=pa.scry(this._tabElem,"._1ia");if(me&&me.length>0){this._dropTarget=new qa(me[0]);this._dropTarget.setOnFilesDropCallback(this._filesDropped.bind(this));this._dropTarget.setOnURLDropCallback(this._linkDropped.bind(this));this._dropTarget.enable();}this._sheetController=new da(this._threadID,this._getNode('sheet'),this._tabElem);if(r.get('chat_react_option_menu')){this._initializeReactMenu(this._getNode('fileAttachmentShelf'));}else{this._fileUploader=new cb(this._getNode('fileAttachmentShelf'),this._tabTemplate.getNode('attachButtonForm'),this._tabTemplate.getNode('fileInput'),this._tabTemplate.getNode('attachID'));this._initializeUploader(this._fileUploader);}this._initializeArchiveWarning();this._initializeAddToThreadButton();this._initializeVideoCallButton();this._initializeCloseButton();this._initializeTitle();this._sheetController.onClickNewMessagesSheet(function(){this._messagesView&&this._messagesView.scrollToBottom();this.focus();de.inform('read',this._threadID);}.bind(this));this._sheetController.onClickThreadIsMutedSheet(function(){ed.unmute(this._threadID);this.focus();}.bind(this));this._nubController=new nb().init(this._tabElem);this._sheetController.onResize(this._nubController.flyoutContentChanged.bind(this._nubController));this._sheetController.onTokensChanged(function(re,se){fd.getThreadMeta(this._threadID,function(te){this._updateControls(te,se.token_count);}.bind(this));}.bind(this));if(id===null)id=!r.get('seen_autosend_photo_nux');this._messagesView=null;if(r.get('chat_react_option_menu')){nc.getThreadURI(he,function(re){return this._setTitleHref(re);}.bind(this));}else{var ne=this._getNode('conversationLink');ja.hide(ne);dd.renderWebMessengerLink(he,ne,function(){ja.show(ne);this._setTitleHref(ne.href);}.bind(this));}if(!bb.getUserIDFromThreadID(this._threadID))this._titlebarTooltipAnchor=this._getNode('titlebarText');var oe=this._getCanonicalUserID();if(this._getCanonicalUserID()){eb.get(bb.getParticipantIDFromUserID(oe),function(re){if(re.href)this._setTitleHref(re.href);}.bind(this));}else if(r.get('chat_react_option_menu')&&this._reactChatTabMenu.getURL()){this._setTitleHref(this._reactChatTabMenu.getURL());}else if(ne&&ne.href)this._setTitleHref(ne.href);this._nubController.subscribe('resize',function(){this._resizeInputContainer();}.bind(this));this._setNameConversationLink();this._listen('closeButton','click',this._closeClicked);this._listen('dockButton','click',this._nubClicked);this._listen('dockButton','keydown',this._dockKeyDown);this._listen('nubFlyoutTitlebar','click',this._titleClicked);this._listen('chatConv','click',this._chatConvClicked);this._listen('inputContainer','click',this._inputContainerClicked);this._listen('addFriendLink','click',this._addFriendLinkClicked,true);this._listen('nameConversationLink','click',this._nameConversationLinkClicked,true);this._listen('clearWindowLink','click',this._clearHistory,true);this._listen('unsubscribeLink','click',this._unsubscribeLinkClicked,true);this._listen('reportSpamLink','click',this._reportSpamClicked,true);this._listen('createGroupLink','click',this._createGroupClicked,true);this._listen('enableDesktopNotif','click',this._enableDesktopNotif,true);this._listen('muteThreadLink','click',jb.showMuteChangeDialog.bind(null,this._threadID),true);this._listen('unmuteThreadLink','click',function(){ed.unmute(this._threadID);fc.hide();}.bind(this),true);this._listen('switchToWorkUserLink','click',this._switchToWorkUserClicked,true);this._listen('sheet','keydown',function(event){if(!event.getModifiers().any&&event.keyCode===xa.TAB){this._focusInput();event.kill();}}.bind(this));this._stickersFlyoutToggler=this._getNode('emoticons');if(wb.WebStickerTrigger)this._stickerTriggerController=new aa(this._getNode('stickersTriggerFlyoutContainer'),this._getNode('emoticonIndicator'),this._stickersFlyoutToggler,this._stickerSelected.bind(this),this._searchStickers.bind(this));this._initializeInput();if(zb.shouldShowStickerSearchNUX())this._listen('emoticons','click',function(){if(zb.shouldShowStickerSearchNUX()){vb.selectPack(xb.SEARCH_PACK_ID);zb.clearShowStickerSearchNUX();}},true);if(r.get('chat_react_sticker_button')){this._stickerButton=sb.render(sb.createElement(z,{className:"_4vui",flyoutAlignment:"left",onFlyoutShown:this._onFlyoutShown.bind(this),onFlyoutHidden:this._onFlyoutHidden.bind(this),onStickerSelect:this._stickerSelected.bind(this),onEmoticonSelect:this._emoticonSelected.bind(this)}),this._getNode('stickerButtonContainer'));m.bumpEntityKey('chat.web','sticker_button.mounting_attempted');}else{var pe=this._getNode('stickers');if(pe)this._stickersFlyout=sb.render(sb.createElement(yb,{onStickerSelect:function(re){this._stickerSelected(re);}.bind(this),onShown:this._onFlyoutShown.bind(this),onHidden:this._onFlyoutHidden.bind(this),onEmoticonSelect:this._emoticonSelected.bind(this),onEscKeyDown:this._hideStickersFlyoutIfShown.bind(this)}),pe);this._eventListeners.push(zb.addListener(zb.PACK_SELECTED,function(re){if(this._stickersFlyout&&this._stickersFlyout.isMounted())this._stickersFlyout.setProps({packID:re});}.bind(this)));}if(xc){this._orionTriggerContainer=this._getNode('orionTriggerContainer');this._orionTrigger=sb.render(sb.createElement(xc,{onTrigger:this._orionTriggered.bind(this)}),this._orionTriggerContainer);}this._privacyLink=this._getNode('privacyLink');if(this._privacyLink){this._privacyActionController=new w(oe,this._updatePrivacyLink.bind(this));this._eventListeners.push(ta.listen(this._privacyLink,'click',this._privacyActionController.togglePrivacy.bind(this._privacyActionController)));}fd.getThreadMeta(this._threadID,function(re){this._setUpMutingSettings(re);}.bind(this));x.removeEmptyHrefs(this._tabElem);hd[he]=this;this.updateAvailableStatus();this.updateTab();this._setCloseTooltip(false);var qe={threadID:he,userID:oe,signatureID:this._signatureID};new k('/ajax/chat/opentab_tracking.php',qe).send();tb.onBeforeUnload(function(){if(this._hasUnfinishedPost())return "You haven't sent your message yet. Do you want to leave without sending?";if(zc.getNumberLocalMessages(this._threadID))return "Your message is still being sent. Are you sure you want to leave?";return null;}.bind(this),false);tb.onUnload(function(){ee(this);}.bind(this));}function ee(he){if(he._photoUploader.isUploading())ce(he,pb.CANCEL_DURING_UPLOAD);}function fe(){for(var he in hd){hd[he].updateAvailableStatus();hd[he].updateMultichatTooltip();}}g.subscribe(['buddylist/availability-changed'],fe);qb.subscribe(['privacy-changed','privacy-availability-changed'],fe);p.subscribe(p.ON_CHANGED,function(){for(var he in hd)fd.getThreadMeta(he,function(ie){hd[he]._updateUnreadCount(ie);});});lb.addRetroactiveListener('state-changed',function(he){for(var ie in he){var je=he[ie]&&he[ie].length,ke=hd[ie];ke&&ke.showTypingIndicator(je);}});cd.subscribe('threads-updated',function(he,ie){for(var je in hd){var ke=hd[je];ie[je]&&ke.updateTab();if(ke._newThreadIDFromPhotoUpload&&!ke._photoUploader.isUploading()&&ie[ke._newThreadIDFromPhotoUpload]){de.inform('closed-tab',ke._threadID);u.openThread(ke._newThreadIDFromPhotoUpload,'ChatTabView');ke._newThreadIDFromPhotoUpload=null;}}});cd.subscribe('threads-deleted',function(he,ie){for(var je in hd)ie[je]&&de.inform('thread-deleted',je);});pc(de,h,{get:function(he){return hd[he];}});pc(de.prototype,{getThreadID:function(){return this._threadID;},showAddFriend:function(){setTimeout((function(){this._sheetController.openAddFriendsSheet();}).bind(this),0);},showNameConversation:function(he){setTimeout((function(){this._sheetController.openNameConversationSheet(he);}).bind(this),0);},hideAutomaticNameConversation:function(){setTimeout((function(){this._sheetController.closeAutomaticNameConversationSheet();}).bind(this),0);},isVisible:function(){return ja.shown(this._tabElem);},setVisibleState:function(he,ie){var je=ja.shown(this._tabElem),ke=ja.hasClass(this._tabElem,'opened');ja.conditionShow(this._tabElem,he);ja.conditionClass(this._tabElem,'opened',ie);if(!(je&&ke)&&he&&ie){if(!this._messagesView)this._messagesView=new ca(this._threadID,this._sheetController,this._getNode('chatConv'),this._getNode('conversation'),this._getNode('loadingIndicator'),this._getNode('lastMessageIndicator'),this._getNode('typingIndicator'),this);this._nubController.flyoutContentChanged();this._messagesView.scrollToBottom();}if(je&&ke&&!(he&&ie))this._contextualDialogController&&this._contextualDialogController.tabNotActive();},focus:function(){if(ja.hasClass(this._tabElem,'opened')){this._focusInput();}else this._getNode('dockButton').focus();},isFocused:function(){var he=tc();return ob.byClass(he,"_50mz")===this._tabElem;},hasEmptyInput:function(){var he;if(r.get('chat_react_input')){if(!this._chatInput||!this._chatInput.isMounted())return false;he=this._chatInput.getValue();}else he=this._getNode('input').value;return gd.test(he);},getInputElem:function(){if(r.get('chat_react_input')){if(!this._chatInput||!this._chatInput.isMounted())return null;return this._chatInput.getDOMNode();}else return this._getNode('input');},setStickersFlyoutPackID:function(he){if(this._stickerButton){this._setPackIDReact(he);}else this._setPackIDLegacy(he);},loadShareFromParams:function(he,ie){this._shareLinkUploader&&this._shareLinkUploader.loadShareFromParams(he,ie);if(this._sharePreview)this._sharePreview.setProps({share:{params:ie,type:he},uri:null});},_linkDropped:function(he){this._shareLinkUploader&&this._shareLinkUploader.loadShare(he);if(this._sharePreview)this._sharePreview.setProps({share:null,uri:he});},_filesDropped:function(he){if(this._fileUploader)this._fileUploader.addDroppedFiles(he);},_setPackIDLegacy:function(he){var ie=this._stickersFlyout;if(!this._stickersFlyoutToggler||!ie||!ie.isMounted())return;vb.selectPack(he);this._toggleStickersFlyoutShownLegacy(true);},_setPackIDReact:function(he){if(!this._stickerButton.isMounted())return;vb.selectPack(he);this._toggleStickersFlyoutShownReact(true);},_toggleStickersFlyoutShownReact:function(he){this._stickerButton.showFlyout();this._stickersFlyoutShown=he;},_toggleStickersFlyoutShownLegacy:function(he){if(he){fc.show(this._stickersFlyoutToggler);}else fc.hide(this._stickersFlyoutToggler);this._stickersFlyoutShown=he;},_hideStickersFlyoutIfShown:function(){if(this._stickersFlyoutToggler&&this._stickersFlyout&&this._stickersFlyoutShown)this._toggleStickersFlyoutShownLegacy(false);},showStickerReplyNUX:function(){if(jd)return;var he=this._getNode('stickerButtonContainer')||this._getNode('emoticons');new j(new oc().getURI()).setRelativeTo(he).setData({thread_id:this._threadID}).setHandler(function(ie){zb.clearShowStickerReplyNUX();}).send();},insertBefore:function(he){na.insertBefore(he._tabElem,this._tabElem);},appendTo:function(he){na.appendContent(he,this._tabElem);},nextTabIs:function(he){var ie=he&&he._tabElem;return this._tabElem.nextSibling==ie;},getScrollTop:function(){return na.find(this._tabElem,'.fbNubFlyoutBody.scrollable').scrollTop;},setScrollTop:function(he){na.find(this._tabElem,'.fbNubFlyoutBody.scrollable').scrollTop=he;},_unmountComponentAtNodeSafe:function(he){var ie=this._getNode(he);ie&&sb.unmountComponentAtNode(ie);},destroy:function(){this._selectionPosition&&this._selectionPosition.disable();while(this._eventListeners.length)this._eventListeners.pop().remove();if(this._dropTarget)this._dropTarget.disable();this._messagesView&&this._messagesView.destroy();this._sheetController&&this._sheetController.destroy();if(r.get('chat_react_option_menu')){sb.unmountComponentAtNode(this._getNode('menuContainer'));}else this._fileUploader&&this._fileUploader.destroy();if(r.get('chat_react_header')){sb.unmountComponentAtNode(this._getNode('addToThreadContainer'));this._unmountComponentAtNodeSafe('archiveContainer');this._unmountComponentAtNodeSafe('videoCallButtonContainer');sb.unmountComponentAtNode(this._getNode('closeButtonContainer'));sb.unmountComponentAtNode(this._getNode('titleContainer'));}if(r.get('chat_react_share_uploader')&&this._sharePreview&&this._sharePreview.isMounted()){sb.unmountComponentAtNode(this._sharePreview.getDOMNode());}else this._shareLinkUploader&&this._shareLinkUploader.clear();sb.unmountComponentAtNode(this._getNode('photoUploaderContainer'));if(r.get('chat_react_sticker_button')){sb.unmountComponentAtNode(this._getNode('stickerButtonContainer'));}else sb.unmountComponentAtNode(this._getNode('stickers'));if(wb.WebStickerTrigger)this._stickerTriggerController.destroy();this._subscriptionsHandler&&this._subscriptionsHandler.release();this._contextualDialogController&&this._contextualDialogController.destroy();this._privacyActionController&&this._privacyActionController.destroy();if(r.get('chat_react_input')){sb.unmountComponentAtNode(this._getNode('inputContainer'));}else wa.reset(this._getNode('input'));na.remove(this._tabElem);delete hd[this._threadID];ma.unregisterNubController(this._nubController);},updateAvailableStatus:function(){fd.getThreadMeta(this._threadID,function(he){var ie=l.OFFLINE,je=false,ke=this._getCanonicalUserID();if(ke){ie=rb.get(ke);je=lc.availableForCall(ke);}else{var le=he.participants.map(function(ne){return bb.getUserIDFromParticipantID(ne);});ie=rb.getGroup(le);}if(!fa.isOnline())ie=l.OFFLINE;if(ke)this._updateCallLink(ie);ja.conditionClass(this._tabElem,"_5238",ie===l.ACTIVE);ja.conditionClass(this._tabElem,"_4hwz",je);ja.conditionClass(this._tabElem,"_5239",ie===l.MOBILE);var me=this._getNode('presenceIndicator');switch(ie){case l.ACTIVE:me.setAttribute('alt',"Online");break;case l.MOBILE:me.setAttribute('alt',"Mobile");break;default:me.removeAttribute('alt');break;}}.bind(this));},updateTab:function(){this._setNameConversationLink();fd.getThreadMeta(this._threadID,function(he){var ie=[this._getNode('name')];if(!r.get('chat_react_header')){ie.push(this._getNode('titlebarText'));}else if(this._title.isMounted())this._title.setProps({thread:he},function(){this._getNode('chatWrapper').setAttribute('aria-label',this._title.getTitle());}.bind(this));dd.renderAndSeparatedParticipantList(this._threadID,ie,{names_renderer:ib.renderShortNames,check_length:true});this._updateControls(he);this._updateMutingSettings(he);this._updateUnreadCount(he);this.updateMultichatTooltip();this._updateArchiveWarning(he);this._updateEmployeeAwayWarning(he);this._updateNewThread(he);this._updateNameConversationSheet(he);this._updateReadOnlySheet(he);this._updateSwitchToWork(he);}.bind(this));},_setNameConversationLink:function(){var he=this._getNode('nameConversationLink');if(he)fd.isEmptyLocalThread(this._threadID)?ja.hide(he):ja.show(he);},_updateNameConversationSheet:function(he){if(fd.canReply(he.thread_id)&&!he.name&&!he.is_canonical&&!he.name_conversation_sheet_dismissed&&!he.has_email_participant&&!he.read_only&&!fd.isEmptyLocalThread(he.thread_id)){this.showNameConversation(true);}else this.hideAutomaticNameConversation();},_updateReadOnlySheet:function(he){var ie=fd.canReply(he.thread_id),je=fd.isEmptyLocalThread(he.thread_id);if(!ie&&!je)this._sheetController.openReadOnlySheet();},updateSignatureID:function(he){this._signatureID=he;},_showPhotoNUXIfNecessary:function(){if(id){id=false;new j('/ajax/chat/photo_nux.php').setRelativeTo(this._getNode('photoUploaderContainer')).setData({threadID:this._threadID}).send();return true;}},_setUpMutingSettings:function(he){var ie=jb.isThreadMuted(he);if(ie)this._sheetController.openThreadIsMutedTabSheet();this._updateActionMenu(ie);},_updateMutingSettings:function(he){var ie=jb.isThreadMuted(he),je;if(r.get('chat_react_option_menu')){je=this._reactChatTabMenu.props.isMuted;}else je=ja.shown(this._getNode('unmuteThreadLink').parentNode);if(ie&&!je){this._sheetController.openThreadIsMutedTabSheet();}else if(!ie&&je)this._sheetController.closeThreadIsMutedTabSheet();this._updateActionMenu(ie);},_updateActionMenu:function(he){if(r.get('chat_react_option_menu')){this._reactChatTabMenu.isMounted()&&this._reactChatTabMenu.setProps({isMuted:he});}else{ja.conditionShow(this._getNode('muteThreadLink').parentNode,!he);ja.conditionShow(this._getNode('unmuteThreadLink').parentNode,he);}},_updateArchiveWarning:function(he){var ie=false;eb.get(mb.getID(),function(je){ie=je.employee;if(ie)eb.getMulti(he.participants,this._showArchiveWarningIfAllParticipantsAreEmployees.bind(this));}.bind(this));},_updateEmployeeAwayWarning:function(he){t.updateEmployeeAwayWarning(he,function(){this._sheetController.openEmployeeAwaySheet();}.bind(this),function(){});},_updateSwitchToWork:function(he){var ie=false;eb.get(mb.getID(),function(je){ie=je.employee;if(ie)eb.getMulti(he.participants,this._showSwitchToWorkIfAllParticipantsAreEmployees.bind(this));}.bind(this));},_updateControls:function(he,ie){var je=false;if(he&&he.thread_id){var ke=bb.tokenize(he.thread_id);if(ke.type==='user'){var le=ke.value;je=!bd.isUser(le);}}var me=fd.canReply(he.thread_id)&&(!uc(he.participants)||!!ie);ja.conditionShow(this._inputContainerNode,me);ja.conditionShow(this._iconsContainerNode,me);if(!r.get('chat_react_option_menu')){ja.conditionShow(this._getNode('dropdown'),me);}else if(this._reactChatTabMenu.isMounted()){this._reactChatTabMenu.setProps({isEmptyChat:fd.isNewEmptyLocalThread(he.thread_id),show:me});if(je)this._reactChatTabMenu.setProps({showAddFriend:null});}var ne=me&&!je;if(r.get('chat_react_header')){this._addToThreadButton.isMounted()&&this._addToThreadButton.setProps({shown:ne});}else ja.conditionShow(this._getNode('addToThreadLink'),ne);this._resizeInputContainer();this._updateOrionTrigger(me);},_updateOrionTrigger:function(he){if(this._orionTrigger&&he){var ie=this.getParticipantIDForOrionNUX();ja.conditionShow(this._orionTriggerContainer,ie);if(ie){eb.get(ie,function(je){je=va.set(je,{userId:bb.getUserIDFromParticipantID(ie)});this._orionTrigger.setProps({receiver:je,disabled:!je.orion_eligible});if(je.orion_eligible&&this.isOrionNUXEligible())this.showOrionNUXTooltip();}.bind(this));}else this._orionTrigger.setProps({receiver:{}});}},getParticipantIDForOrionNUX:function(){var he=this._sheetController.getAddFriendsTabSheet(),ie=he.getParticipants(),je=this._getCanonicalUserID(),ke=null;if(je){ke=bb.getParticipantIDFromUserID(je);}else if(ie&&ie.length===1)ke=ie[0];return ke;},showOrionNUXTooltip:function(){if(this._orionTrigger&&ab.ShowOrionNUXTooltip)this._orionTrigger.setShouldShowNUXTooltip();},isOrionNUXEligible:function(){var he=this.getParticipantIDForOrionNUX();return he&&this.isVisible()&&ja.hasClass(this._tabElem,'opened');},_resizeInputContainer:function(){var he=this._tabElem.clientWidth,ie=2,je=he-(this._inputContainerNode.clientWidth+ie),ke=ya.isRTL()?'left':'right';ac.set(this._iconsContainerNode,ke,je+'px');if(!r.get('chat_react_input'))ec.getInstance(this._getNode('input')).update();},_updateNewThread:function(he){if(fd.isNewEmptyLocalThread(he.thread_id))this.showAddFriend();},_isEmployeesOnly:function(he){for(var ie in he)if(!he[ie].employee)return false;return true;},_showArchiveWarningIfAllParticipantsAreEmployees:function(he){var ie=this._isEmployeesOnly(he),je=r.get('chat_react_header'),ke=je?this._getNode('archiveContainer'):this._getNode('titanArchiveWarning');if(ke){if(this._titlebarTooltipAnchor)ja.conditionClass(this._titlebarTooltipAnchor,'narrowTitleBar',ie);if(je){this._archiveWarning.isMounted()&&this._archiveWarning.setProps({shown:ie});}else ja.conditionShow(ke,ie);}},_showSwitchToWorkIfAllParticipantsAreEmployees:function(he){var ie=this._isEmployeesOnly(he);if(!r.get('chat_react_option_menu')){var je=this._getNode('switchToWorkUserLink');if(je)ja.conditionShow(je,ie);}else if(this._reactChatTabMenu.isMounted())this._reactChatTabMenu.setProps({hasSwitchToWork:ie});},updateMultichatTooltip:function(){fd.getThreadMeta(this._threadID,function(he){if(!he.is_canonical){var ie;if(r.get('chat_react_header')){ie=this._title.getDOMNode();}else ie=this._titlebarTooltipAnchor;md(ie,he.participants);}}.bind(this));},_getNode:function(he){return this._tabTemplate.getNode(he);},_getCanonicalUserID:function(){return bb.getUserIDFromThreadID(this._threadID);},_listen:function(he,event,ie,je){var ke=this._getNode(he);if(ke){this._eventListeners.push(ta.listen(ke,event,ie.bind(this)));}else if(!je)throw new Error('Could not find node "'+he+'"');},_closePreClicked:function(he){this._closeMouseDown=true;},_closeClicked:function(he){ee(this);de.inform('closed-tab',this._threadID);if(he instanceof cc){he.stopPropagation();return;}he.kill();},_closeEnter:function(he){if(he.keyCode===xa.RETURN)this._closeClicked(he);},_nubClicked:function(he){if(!this._isDragDropActive){he.kill();return de.inform('nub-activated',this._threadID);}},_dockKeyDown:function(event){if(event.keyCode===xa.RETURN||event.keyCode===xa.SPACE){de.inform('nub-activated',this._threadID);event.kill();}else this._handleHotkeyPressed(event);},_handleHotkeyPressed:function(event){if(event.keyCode===xa.ESC){this._handleEscape();if(r.get('chat_react_input'))event=new oa(event);event.kill();}else if(event.keyCode===xa.TAB)this._handleTabPressed(event);},_handleTabPressed:function(event){if(!event.ctrlKey){var he=de.inform('tab-pressed',{id:this._threadID,shiftPressed:event.shiftKey});if(r.get('chat_react_input'))event=new oa(event);!he&&event.kill();return true;}},_handleEscape:function(){if(this._stickersFlyoutShown){this._stickerButton?this._toggleStickersFlyoutShownReact(false):this._toggleStickersFlyoutShownLegacy(false);return;}ee(this);if(this.hasEmptyInput()){de.inform('esc-pressed',this._threadID);}else{var he="Are you sure you want to close this chat window?",ie="You haven't sent your message.",je=new la().setTitle(he).setBody(ie).setButtons([la.CLOSE,la.CANCEL]).setHandler(de.inform.bind(de,'esc-pressed',this._threadID,null)).setModal(true).show(),ke=je.getButtonElement('yes');ke&&ua.set(ke);}},_titleClicked:function(event){var he=event.getTarget();if(!ob.byClass(he,'titlebarText')&&!ob.byClass(he,'uiSelector')&&!ob.byClass(he,'addToThread')&&!ob.byClass(he,'optionMenu')&&!ob.byClass(he,'videoicon')&&!ob.byClass(he,'close')&&!this._isDragDropActive){de.inform('lower-activated',this._threadID);event.kill();}},_callEnter:function(he){if(he.keyCode===xa.RETURN)this._callClicked(he);},_callClicked:function(he){if(he.target)he.target.blur();var ie=this._getCanonicalUserID();if(lc.availableForCall(ie)){var je='chat_tab_icon';if(he.target&&ja.hasClass(he.target,'video_call_tour'))je='chat_tab_icon_tour';de.inform('video-call-clicked',{threadID:this._threadID,userID:ie,clickSource:je});}if(r.get('chat_react_header')){he.stopPropagation();}else return false;},_addFriendLinkClicked:function(){this.showAddFriend();},_nameConversationLinkClicked:function(){this.showNameConversation();},_showParticipantsClicked:function(){bd.getServerThreadID(this._threadID,function(he){i.send(new j(jc('/ajax/browser/dialog/multichat_members/').addQueryData({id:he})));});},_clearHistory:function(){var he=fd.getThreadMetaNow(this._threadID);if(he){var ie=this._getCanonicalUserID();bd.clearChat(this._threadID,ie,he.timestamp);}},_unsubscribeLinkClicked:function(){var he=[];he.push({name:'unsubscribe',label:"Leave Conversation",handler:this._unsubscribeToThread.bind(this)});he.push(la.CANCEL);new la().setTitle("Leave Conversation?").setBody("You will stop receiving messages from this conversation and people will see that you left.").setButtons(he).show();},_switchToWorkUserClicked:function(){var he=[];he.push({name:'move',label:"Move Conversation",handler:this._switchToWork.bind(this)});he.push(la.CANCEL);new la().setTitle("Move Conversation to Work Account?").setBody("Do you want to move this conversation so that it shows in your work account instead?").setButtons(he).show();},_getUserParticipants:function(he){var ie=[];he.forEach(function(je){var ke=bb.getUserIDFromParticipantID(je);ke&&ie.push(ke);});return ie;},_createGroupClicked:function(){fd.getThreadMeta(this._threadID,function(he){if(!he.is_canonical){var ie=jc('/ajax/groups/create_get.php').addQueryData({ref:'web_messenger_dock',parent_id:'0'}),je=this._getUserParticipants(he.participants);ie.addQueryData({members:je});if(he.name)ie.addQueryData({name:he.name});i.send(new j(ie));}}.bind(this));},_enableDesktopNotif:function(){Notification.requestPermission();},_reportSpamClicked:function(){var he=this._getCanonicalUserID(),ie=jc('/ajax/chat/report.php').addQueryData({id:he}).addQueryData({src:'top_report_link'});i.send(new j(ie));},_inputPasted:function(event){if(kc.chrome()){var he=event.clipboardData||event.originalEvent.clipboardData;if(!he||!he.items||he.items.length<1)return;var ie=he.items[0].type;if(ie!=='image/png')return;if(he.items[0].getAsFile){var je=he.items[0].getAsFile();this._photoUploader.uploadFile(je);}}},_focusInput:function(){if(r.get('chat_react_input')){this._chatInput&&this._chatInput.isMounted()&&this._chatInput.focus();}else this._getNode('input').focus();},_focusTab:function(){ja.addClass(this._tabElem,'focusedTab');this.tryMarkAsRead();this._contextualDialogController&&this._contextualDialogController.tabFocused();if(!jd&&this._showPhotoNUXIfNecessary())g.subscribe(['ChatNUX/show','ChatNUX/hide'],function(event){jd=event==='ChatNUX/show';});this._closeMouseDown=false;this._setCloseTooltip(true);de.inform('focus-tab',this._threadID);},_blurTab:function(){ja.removeClass(this._tabElem,'focusedTab');!this._closeMouseDown&&this._setCloseTooltip(false);},_setCloseTooltip:function(he){if(r.get('chat_react_header')){this._closeButton.isMounted()&&this._closeButton.setProps({active:he});return;}var ie=this._getNode('titlebarCloseButton'),je=he?"Press Esc to close":"Close tab";gc.set(ie,je,'above');},_inputKeyDown:function(event){this.tryMarkAsRead();if(event.keyCode===xa.RETURN&&!event.shiftKey){if(yd(this)){wd(this);event.kill&&event.kill();return;}td(this);if(wb.WebStickerTrigger)this._stickerTriggerController.activateAfterparty();event.kill&&event.kill();return;}if(event.keyCode===xa.DOWN&&event.shiftKey&&this.hasEmptyInput()){de.inform('lower-activated',this._threadID);event.kill&&event.kill();return;}this._handleHotkeyPressed(event);},_initializeInput:function(){if(!r.get('chat_react_input')){var he=this._inputContainerNode.clientHeight;ec.getInstance(this._getNode('input')).subscribe('resize',function(){var ie=this._inputContainerNode.clientHeight;if(ie!=he)this._nubController.flyoutContentChanged();he=ie;}.bind(this));this._listen('input','focus',this._focusTab);this._listen('input','blur',this._blurTab);this._listen('input','paste',this._inputPasted);if(kc.firefox()&&ka.get()=='ko_KR'){this._listen('input','keyup',this._inputKeyDown);}else this._listen('input','keydown',this._inputKeyDown);this._initializeThingsWithInputFn(this._tabTemplate.getNode('input'));}else{this._chatInput=sb.render(sb.createElement(wc,{initializeThingsWithInputFn:this._initializeThingsWithInputFn.bind(this),inputChanged:function(ie){if(wb.WebStickerTrigger)this._stickerTriggerController.updateInput(ie);}.bind(this),inputKeyDown:this._inputKeyDown.bind(this),onAddMention:this._onAddMention.bind(this),onBlur:this._blurTab.bind(this),onEscape:this._handleEscape.bind(this),onFocus:this._focusTab.bind(this),onTab:this._handleTabPressed.bind(this),openFlyoutFn:this._toggleStickersFlyoutShownLegacy.bind(this,true),stickersFlyoutToggler:this._stickersFlyoutToggler,searchTriggeredWord:function(){this._toggleStickersFlyoutShownLegacy(true);this._searchStickers(this._stickerTriggerController.getTriggeredWord());}.bind(this),resizeFn:function(ie){ac.set(this._getNode('inputContainer'),'height',ie+'px');this._nubController.flyoutContentChanged();}.bind(this),uploadPhotoFn:this._photoUploader.uploadFile}),this._getNode('chatInputContainer'));if(wb.WebStickerTrigger)this._stickerTriggerController.setInput(this._chatInput);}},_initializeSharePreview:function(he,ie){this._sharePreview=sb.render(sb.createElement(gb,{imageSize:{width:68,height:68},location:fb.CHAT_PREVIEW,onClose:this._focusInput.bind(this),onUpdate:function(){be(this);ae(this);}.bind(this)}),this._getNode('shareAttachmentShelf'));ta.listen(he,'keyup',function(){var je=ie?ie():he.value;!je.length&&this._urlScraper.reset();}.bind(this));this._urlScraper=new ic(he,ie);this._urlScraper.subscribe('match',function(je,ke){this._sharePreview.setProps({share:null,uri:(ke&&ke.url)});}.bind(this));},_initializeThingsWithInputFn:function(he,ie){if(r.get('chat_react_share_uploader')){this._initializeSharePreview(he,ie);}else{this._shareLinkUploader=new y(this._getNode('shareAttachmentShelf'),he,this.focus.bind(this),ie,this._appendTextToInput.bind(this));this._initializeUploader(this._shareLinkUploader);}fd.getThreadMeta(this._threadID,function(je){bd.getServerThreadID(this._threadID,function(ke){this._typingDetector=new hc(this._getCanonicalUserID(),he,'mercury-chat',null,ke,ie);}.bind(this));}.bind(this));},_getInputValue:function(){if(r.get('chat_react_input')){if(!this._chatInput||!this._chatInput.isMounted())return '';return this._chatInput.getValue()||'';}else return this._tabTemplate.getNode('input').value||'';},_appendTextToInput:function(he){if(r.get('chat_react_input')){if(this._chatInput&&this._chatInput.isMounted())this._chatInput.appendText(he);}else this._getNode('input').value+=he;},_hasUnfinishedPost:function(){return zd(this)||xd(this);},tryMarkAsRead:function(){if(!this._messagesView||this._messagesView.isScrolledToBottom()){de.inform('read',this._threadID);return true;}return false;},_chatConvClicked:function(he){this.tryMarkAsRead();if(ob.byTag(he.getTarget(),'a')||na.getSelection())return;this.focus();},_inputContainerClicked:function(he){this.tryMarkAsRead();this.focus();},showTypingIndicator:function(he){if(r.get('chat_closed_tab_typing_indicator_animated')){var ie=na.find(this._tabElem,"._54m9");if(he){this._animatedTypingIndicator=sb.render(sb.createElement(kb,null),ie);this._updateAnimatedIndicatorColor();ja.addClass(this._tabElem,"_54m8");ja.show(ie);}else{ja.removeClass(this._tabElem,"_54m8");ja.hide(ie);sb.unmountComponentAtNode(ie);this._animatedTypingIndicator=null;}}else ja.conditionClass(this._tabElem,'typing',he);},_updateAnimatedIndicatorColor:function(){if(this._animatedTypingIndicator){var he=ja.hasClass(this._tabElem,'highlightTab')?'light':'dark';this._animatedTypingIndicator.setProps({color:he});}},_updateUnreadCount:function(he){var ie=he.unread_count;if(typeof ie!='undefined'){var je=!!ie&&(!p.showsTabUnreadUI||p.showsTabUnreadUI()),ke=this._getNode('numMessages');ja.conditionShow(ke,je);ja.conditionClass(this._tabElem,'highlightTab',je);this._updateAnimatedIndicatorColor();qd(this._threadID,this._tabElem,je);na.setContent(ke,ie);}},_updateCallLink:function(he){var ie=this._getCanonicalUserID();if(ie===ia.getID()){this._hideVideoCallouts();if(r.get('chat_react_header')){this._videoCallButton.isMounted()&&this._videoCallButton.setProps({shown:false});}else ja.hide(this._getNode('videoCallLink'));return;}if(fa.isOnline()){var je='fbid:'+ie;eb.get(je,function(ke){var le=null;if(lc.availableForCall(ie)){le=sc._("Start a video call with {firstname}",[sc.param("firstname",ke.short_name)]);}else{le=sc._("{firstname} is currently unavailable for video calling",[sc.param("firstname",ke.short_name)]);this._hideVideoCallouts();}this._setVideoCallTooltip(le);}.bind(this));}else{this._setVideoCallTooltip("You must be online to make a call.");this._hideVideoCallouts();}},_setVideoCallTooltip:function(he){if(r.get('chat_react_header')){this._videoCallButton.isMounted()&&this._videoCallButton.setProps({tooltipLabel:he});}else gc.set(this._getNode('videoCallLink'),he);},_hideVideoCallouts:function(){this._contextualDialogController.hideVideoCallouts();},_updatePrivacyLink:function(he){var ie;if(he==w.OFFLINE){ie="Go online";if(r.get('chat_react_option_menu')){this._reactChatTabMenu.isMounted()&&this._reactChatTabMenu.setProps({privacyText:ie});}else na.setContent(this._privacyLink,ie);return;}var je=this._getCanonicalUserID();if(!je)return;var ke='fbid:'+je;eb.get(ke,function(le){if(he==w.BLOCKED){ie=sc._("Turn On Chat for {name}",[sc.param("name",le.short_name)]);}else ie=sc._("Turn Off Chat for {name}",[sc.param("name",le.short_name)]);if(r.get('chat_react_option_menu')){this._reactChatTabMenu.isMounted()&&this._reactChatTabMenu.setProps({privacyText:ie});}else na.setContent(this._privacyLink,ie);}.bind(this));},_unsubscribeToThread:function(){if(!fd.isEmptyLocalThread(this._threadID)){var he=ad.constructLogMessageObject(hb.CHAT_WEB,this._threadID,db.UNSUBSCRIBE,{removed_participants:[mb.getID()]});yc.send(he);}de.inform('unsubscribed',this._threadID);return true;},_switchToWork:function(){if(!fd.isEmptyLocalThread(this._threadID)){var he=ad.constructLogMessageObject(hb.CHAT_WEB,this._threadID,db.SWITCH_TO_WORK,{removed_participants:[mb.getID()]});yc.send(he);}de.inform('unsubscribed',this._threadID);return true;},_initializeUploader:function(he){this._subscriptionsHandler.addSubscriptions(he.subscribe(['all-uploads-completed','upload-canceled'],function(){ae(this);}.bind(this)),he.subscribe('dom-updated',function(){be(this);}.bind(this)),he.subscribe('submit',function(){this._focusInput();}.bind(this)));},_initializeReactMenu:function(he){var ie=this._getNode('menuContainer'),je=bb.isMultichat(this._threadID),ke=fd.isNewEmptyLocalThread(this._threadID),le=this._sheetController.openAddFriendsSheet.bind(this._sheetController);if(ie)this._reactChatTabMenu=sb.render(sb.createElement(ba,{onFileUploaderMounted:this.setFileUploader.bind(this),updatePrivacyLinkFunc:this._updatePrivacyLink.bind(this),nameConversationFunc:this._nameConversationLinkClicked.bind(this),showParticipantsFunc:this._showParticipantsClicked.bind(this),leaveConversationFunc:this._unsubscribeLinkClicked.bind(this),clearHistoryFunc:this._clearHistory.bind(this),reportSpamFunc:this._reportSpamClicked.bind(this),createGroupFunc:this._createGroupClicked.bind(this),switchToWorkFunc:this._switchToWorkUserClicked.bind(this),isMultichat:je,isEmptyChat:ke,showAddFriend:le,threadID:this._threadID,attachmentsShelf:he,onUploadFinished:ae.bind(this,this),onUpdateAttachmentsShelf:be.bind(this,this),onSubmit:this._focusInput.bind(this),enableDesktopNotif:function(){this._enableDesktopNotif();}.bind(this)}),ie);},_initializeArchiveWarning:function(){if(r.get('chat_react_header'))this._archiveWarning=sb.render(sb.createElement(o,{isFBAtWork:r.IsWorkUser,shown:true}),this._getNode('archiveContainer'));},_initializeAddToThreadButton:function(){if(r.get('chat_react_header')){this._addToThreadButton=sb.render(sb.createElement(n,{isFBAtWork:r.get('IsWorkUser',false),onClick:this._addFriendLinkClicked.bind(this),shown:true}),this._getNode('addToThreadContainer'));}else this._listen('addToThreadLink','click',this._addFriendLinkClicked,true);},_initializeVideoCallButton:function(){if(!bb.getUserIDFromThreadID(this._threadID))return;var he=null;if(r.get('chat_react_header')){this._videoCallButton=sb.render(sb.createElement(ga,{shown:true,onClick:this._callClicked.bind(this),onKeyUp:this._callEnter.bind(this)}),this._getNode('videoCallButtonContainer'));he=this._videoCallButton.getDOMNode();}else{he=this._getNode('videoCallLink');this._listen('videoCallLink','click',this._callClicked,true);this._listen('videoCallLink','keyup',this._callEnter,true);}this._contextualDialogController=new s(this._threadID,he);},_initializeCloseButton:function(){if(r.get('chat_react_header')){this._closeButton=sb.render(sb.createElement(q,{onClick:this._closeClicked.bind(this),onKeyUp:this._closeEnter.bind(this),onMouseDown:this._closePreClicked.bind(this)}),this._getNode('closeButtonContainer'));}else{this._listen('titlebarCloseButton','click',this._closeClicked);this._listen('titlebarCloseButton','keyup',this._closeEnter);this._listen('titlebarCloseButton','mousedown',this._closePreClicked);}},_initializeTitle:function(){if(r.get('chat_react_header')){var he=fd.getThreadMetaNow(this._threadID);this._title=sb.render(sb.createElement(ea,{isNewThread:fd.isNewEmptyLocalThread(this._threadID),thread:he,viewer:ia.getID()}),this._getNode('titleContainer'));}},setFileUploader:function(he){this._fileUploader=he;},_initializeAutoSendPhotoUploader:function(){this._photoUploader=sb.render(sb.createElement(v,{onSubmit:this._handlePUSubmit.bind(this),onAllUploadsComplete:this._handlePUAllUploadsCompleted.bind(this),onLastUploadFail:this._handlePULastUploadFailed.bind(this),onLastUploadCancel:this._handlePULastUploadCanceled.bind(this)}),this._getNode('photoUploaderContainer'));},_handlePUSubmit:function(he,ie){ce(this,pb.UPLOAD_START,ie);vd(this,'',[],function(je){if(this._threadID!==je.thread_id){this._newThreadIDFromPhotoUpload=je.thread_id;if(this._messagesView)this._messagesView.setNewThreadID(je.thread_id);}je.content_attachment=null;yc.addAttachmentPlaceholder(je,ie.upload_id,ie);}.bind(this));ge('submit',ie);this._focusInput();},_handlePULastUploadFailed:function(he,ie){ce(this,pb.CLIENT_ERROR,ie);ge('failed',ie);yc.cancelAttachmentPlaceholder(ie.upload_id,ie);var je="Photo Upload Failed",ke="Please try again. Make sure you are uploading a valid photo.";new la().setTitle(je).setBody(ke).setButtons(la.OK).show();},_handlePULastUploadCanceled:function(he,ie){ce(this,pb.CANCEL_DURING_UPLOAD,ie);ge('canceled',ie);yc.cancelAttachmentPlaceholder(ie.upload_id,ie);},_handlePUAllUploadsCompleted:function(he,ie){ce(this,pb.ALL_UPLOADS_DONE,ie);ge('completed',ie);yc.confirmAttachmentPlaceholder(ie.upload_id,ie);var je=ie.image_ids.length||ie.attachments.length;ud(this,je);},_stickerSelected:function(he){vd(this,'',[],function(ie){ie.has_attachment=true;ie.sticker_id=he;yc.send(ie);this.focus();}.bind(this));this._messagesView&&this._messagesView.scrollToBottom();},_emoticonSelected:function(he){var ie=ra.symbols[he];if(!ie)return;if(r.get('chat_react_input')){this._chatInput.insertEmoticon(ie);return;}this._selectionPosition=this._selectionPosition||new ub(this._getNode('input'));var je=ec.getInstance(this._getNode('input')),ke=je.getValue(),le=sa.insertEmoticon(ie,ke,this._selectionPosition.getPos());je.setValue(le.result);this._selectionPosition.setPos(le.start,le.end);},_orionTriggered:function(){vd(this,'',[],function(he){this.focus();}.bind(this));this._messagesView&&this._messagesView.scrollToBottom();},_addStickerSearchNUXIndicator:function(){ja.addClass(this._getNode('emoticonIndicator'),'nux');jd=false;},_onFlyoutShown:function(he){if(r.get('chat_react_sticker_button')){var ie=this._stickersFlyout.props.packID;if(ie!==xb.SEARCH_PACK_ID)this.focus();}if(wb.WebStickerTrigger){this._stickerTriggerController.onFlyoutShown(he);}else he();this._stickersFlyoutShown=true;},_searchStickers:function(he,ie){this._stickersFlyout.isMounted()&&this._stickersFlyout.setProps({packID:xb.SEARCH_PACK_ID,trigger:he},ie);},_onFlyoutHidden:function(){this._stickersFlyoutShown=false;this.focus();},_setTitleHref:function(he){if(r.get('chat_react_header')){this._title.isMounted()&&this._title.setProps({href:he});}else{var ie=this._getNode('titlebarText');ie.setAttribute('href',he);ie.removeAttribute('rel');ja.removeClass(ie,'noLink');}},_onAddMention:function(he){this._linkDropped((new jc(he.getURI())).getQualifiedURI().toString());}});function ge(he,ie){ld.debug('photo_uploader:'+he,Object.assign({},ie));}e.exports=de;},null);
__d("MercuryNotificationRenderer",["MercuryAssert","MercuryParticipants","MercuryViewer","fbt","MercuryMessages","MercuryThreads"],function(a,b,c,d,e,f,g,h,i,j){var k=b('MercuryMessages').get(),l=b('MercuryThreads').get();function m(n,o){g.isThreadID(n);l.getThreadMeta(n,function(p){k.getThreadMessagesRange(n,0,1,function(q){var r=q.length&&q[q.length-1];if(r&&r.author!=i.getID()){h.get(r.author,function(s){if(p.name){o(j._("{senderName} messaged {groupName}",[j.param("senderName",s.short_name),j.param("groupName",p.name)]));}else o(j._("{name} messaged you",[j.param("name",s.short_name)]));});}else o("New message!");});});}e.exports={renderDocumentTitle:m};},null);
__d("ChatTitleBarBlinker",["ChatActivity","DocumentTitle","JSLogger","MercuryNotificationRenderer","PresenceState","MercuryThreadInformer","MercuryTimestampTracker"],function(a,b,c,d,e,f,g,h,i,j,k){var l=b('MercuryThreadInformer').get(),m=b('MercuryTimestampTracker').get(),n=i.create('chat_title'),o=null,p=0,q=false;function r(){if(o){o.stop();o=null;return true;}return false;}function s(x){var y=x||m.getLastUserMessageTimestamp();if(p<=y){p=y;if(r()||q)k.doSync();}}var t={blink:function(x,y){if(!o&&p<y)j.renderDocumentTitle(x,function(z){if(!o)o=h.blink(z);});},stopBlinking:function(){s();},blinkingElsewhere:function(){q=true;}};function u(x){var y=k.verifyNumber(x.sb2);if(!y||y<=p)return null;return y;}function v(x){var y=x&&u(x);if(y){p=y;n.debug('load',p);r();q=false;}}function w(x){var y=u(x);if(!y){n.debug('store',p);x.sb2=p;q=false;}return x;}k.registerStateStorer(w);k.registerStateLoader(v);l.subscribe('thread-read-changed',function(x,y){var z=m.getLastUserMessageTimestamp(),aa=0;for(var ba in y)if(y[ba].mark_as_read&&y[ba].timestamp>=z&&y[ba].timestamp>aa)aa=y[ba].timestamp;aa&&s(aa);});g.subscribe('activity',function(){s();});(function(){var x=k.getInitial();if(x)p=u(x)||0;})();e.exports=t;},null);
__d("MercuryDeliveryState",["MercuryConfig","MercuryIDs","MercuryServerRequests","MercurySingletonMixin","MercuryThreadInformer","PresencePrivacy","UserActivity","debounceAcrossTransitions"],function(a,b,c,d,e,f,g,h,i,j,k,l,m,n){'use strict';var o=30000;function p(q){this.$MercuryDeliveryState0=q;this.$MercuryDeliveryState1=i.getForFBID(this.$MercuryDeliveryState0);this.$MercuryDeliveryState2=k.getForFBID(this.$MercuryDeliveryState0);this.$MercuryDeliveryState3=[];if(!g.ChatWebDRGK)return;this.$MercuryDeliveryState2.subscribe('messages-received',this.$MercuryDeliveryState4.bind(this));m.subscribe(n(this.$MercuryDeliveryState5,300,this));}p.prototype.$MercuryDeliveryState4=function(q,r){for(var s in r){var t=r[s];t.forEach(function(u){if(this.$MercuryDeliveryState7(u))this.$MercuryDeliveryState3.push(u);}.bind(this));}if(m.isActive(o))this.$MercuryDeliveryState5();};p.prototype.$MercuryDeliveryState5=function(){if(this.$MercuryDeliveryState3.length===0)return;var q=this.$MercuryDeliveryState3.filter(this.$MercuryDeliveryState7,this).map(function(r){return r.message_id;});if(q)this.$MercuryDeliveryState1.sendDeliveryReceipts(q);this.$MercuryDeliveryState3=[];};p.prototype.$MercuryDeliveryState7=function(q){var r=h.getUserIDFromParticipantID(q.author);if(r===this.$MercuryDeliveryState0)return false;if(!q.is_unread)return false;if(!l.allows(r))return false;return true;};Object.assign(p,j);e.exports=p;},null);
__d("MercuryStateCheck",["Arbiter","ChannelConstants","MercuryFolders","MessagingTag","URI","copyProperties","MercuryServerRequests"],function(a,b,c,d,e,f,g,h,i,j,k,l){var m=b('MercuryServerRequests').get(),n=l(new g(),{initialize:function(){g.subscribe(h.ON_INVALID_HISTORY,o);d(['ChannelConnection'],function(p){p.subscribe(p.CONNECTED,function(q,r){if(!r.init)o();});});}});function o(){var p;if(k.getRequestURI().getPath().search(/messages/)!==-1){p=i.getSupportedFolders();}else p=[j.INBOX];m.fetchMissedMessages(p);}n.initialize();e.exports=n;},null);