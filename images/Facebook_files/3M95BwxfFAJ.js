/*!CK:2255399300!*//*1418846556,*/

if (self.CavalryLogger) { CavalryLogger.start_js(["ESirN"]); }

__d("StarsInput.react",["React","TooltipLink.react","cx","fbt"],function(a,b,c,d,e,f,g,h,i,j){var k=g.createClass({displayName:"StarsInput",propTypes:{allowMultipleSubmissions:g.PropTypes.bool,onClick:g.PropTypes.func.isRequired,starLabels:g.PropTypes.array},getDefaultProps:function(){return {allowMultipleSubmissions:false,starLabels:["Poor","Fair","Good","Very Good","Excellent"]};},getInitialState:function(){return {starRating:0,starsShown:0,canUpdate:true};},_getStarRating:function(l){return parseInt(l.split('.').pop(),10)+1;},onMouseEnter:function(event){if(this.state.canUpdate)this.setState({starsShown:this._getStarRating(event.dispatchMarker)});},onMouseLeave:function(event){if(this.state.canUpdate){var l=this.state.starRating;this.setState({starsShown:l});}},onClick:function(event){if(this.state.canUpdate){var l=this._getStarRating(event.dispatchMarker);this.setState({starRating:l,starsShown:l,canUpdate:this.props.allowMultipleSubmissions});this.props.onClick(l);}},getStars:function(){var l=this.props.starLabels.length,m=[];for(var n=0;n<l;n++)m.push(g.createElement(h,{className:(("mls")+(' '+"_22mm")+(n>=this.state.starsShown?' '+"_22mn":'')+(n<this.state.starsShown?' '+"_22mo":'')+(!this.state.canUpdate?' '+"_1g87":'')),tooltip:this.props.starLabels[n],onMouseEnter:this.onMouseEnter,onMouseLeave:this.onMouseLeave,onClick:this.onClick,position:"above",alignH:"center"}));return m;},render:function(){return (g.createElement("div",null,this.getStars()));}});e.exports=k;},null);
__d("FBRTCVersionDetection",[],function(a,b,c,d,e,f){var g={isChrome:function(){return !!navigator.webkitGetUserMedia;},isFirefox:function(){return !!navigator.mozGetUserMedia;},webrtcVersion:function(){if(this.isFirefox())return parseInt(navigator.userAgent.match(/Firefox\/([0-9]+)\./)[1],10);if(this.isChrome()){var h=navigator.userAgent.match(/Chrom(e|ium)\/([0-9]+)\./);if(h!==null){return parseInt(h[2],10);}else return 999;}return 0;}};e.exports=g;},null);
__d("FBRTCPCConfig",["FBRTCVersionDetection"],function(a,b,c,d,e,f,g){var h="stun:stun.fbsbx.com:3478",i=function(k,l,m){if(g.isChrome()&&g.webrtcVersion()>=34){var n={urls:k};if(l&&m){n.username=l;n.credential=m;}return [n];}var o=[];for(var p=0;p<k.length;p++)if(l&&m){o.push({url:k[p],username:l,credential:m});}else o.push({url:k[p]});return o;},j={setTurnCredentials:function(k){this.turnIP=k.ip;this.udpPort=k.udp_port;this.tcpPort=k.tcp_port;this.sslPort=k.ssl_tcp_port;this.turnUsername=k.username;this.turnPassword=k.password;},getConfig:function(){var k=i([h]).concat(i(this._turnUrls(),this.turnUsername,this.turnPassword));return {iceServers:k};},getConstraints:function(){return {mandatory:{},optional:[{DtlsSrtpKeyAgreement:'true'}]};},_turnUrls:function(){if(g.isFirefox()&&g.webrtcVersion()<27){return [("turn:"+this.turnIP+":"+this.udpPort)];}else return [("turn:"+this.turnIP+":"+this.udpPort+"?transport=udp"),("turn:"+this.turnIP+":"+this.tcpPort+"?transport=tcp"),("turn:"+this.turnIP+":"+this.sslPort+"?transport=tcp")];}};e.exports=j;},null);
__d("FBRTCSdpUtils",[],function(a,b,c,d,e,f){var g=function(j){return j.match(/^a=rtpmap:(\d+)\s/)[1];},h=function(j,k,l){var m=g(j[k]),n=j[l].split('RTP/SAVPF'),o=n[1].split(/\s+/),p=o.indexOf(m);o.splice(p,1);n[1]=o.join(' ');j[l]=n.join('RTP/SAVPF');j.splice(k,1);},i={addIceOptionToSdp:function(j,k){"use strict";var l="a=ice-options:",m=j.indexOf(l);if(m>=0){var n=j.indexOf("\r",m);return [j.slice(0,n)," ",k,j.slice(n)].join('');}var o=l+k,p=j.split("\r\n"),q=false,r=-1;for(var s=0;s<p.length;s++){var t=p[s].slice(0,2);if(t=="s="){q=true;continue;}if(q&&t=="a="){r=s;break;}}if(r>=0){p.splice(r,0,o);return p.join("\r\n");}return [j,o,"\r\n"].join('');},preferIsac:function(j){var k=j.split("\r\n"),l=-1,m=-1,n=-1,o=-1;for(var p=0;p<k.length;p++){var q=k[p];if(q.match(/m=audio\s+\d+\s+RTP\/SAVPF(\s+\d+)+/))l=p;if(o===-1&&l>-1&&q.match(/^a=rtpmap:/))o=p;if(q.match(/^a=rtpmap:\d+\s+ISAC\/16000/))m=p;if(q.match(/^a=rtpmap:\d+\s+ISAC\/32000/))n=p;}if(l===-1||m===-1||o===-1)return k.join("\r\n");var r=k[m];h(k,m,l);k.splice(o,0,r);k[l]=k[l].replace('RTP/SAVPF','RTP/SAVPF '+g(r));if(n>-1)h(k,n,l);return k.join("\r\n");},disableVideo:function(j){var k=/m=video\s+\d+(\/\d+)?\s/;j=j.replace(k,'m=video 0 ');return j;}};e.exports=i;},null);
__d("FBRTCStatsHelpers",["FBRTCLogger"],function(a,b,c,d,e,f,g){var h=function(j){if(j==='host'||j==='local')return 'local';if(j==='serverreflexive')return 'srflx';if(j==='peerreflexive')return 'prflx';if(j==='relayed'||j==='relay')return 'relay';return 'unknown';},i={connectionType:function(j,k,l,m){return ['l:',h(j),'-',k,';','r:',h(l),'-',m].join('');},logReport:function(j){var k=g.getInstance(),l=['connectionType','audioCodec','videoCodec','audioRtt','videoRtt','audioPacketsLost','videoPacketsLost','audioBytesSent','videoBytesSent','audioPacketsSent','videoPacketsSent'];for(var m=0;m<l.length;m++){var n=j[l[m]].call(j);k.logToConsole(l[m]+' => '+n);}}};e.exports=i;},null);
__d("FBRTCMozStatsReport",["Map","FBRTCLogger","FBRTCStatsHelpers"],function(a,b,c,d,e,f,g,h,i){function j(){"use strict";this.$FBRTCMozStatsReport0=null;this.$FBRTCMozStatsReport1=null;this.$FBRTCMozStatsReport2=null;this.$FBRTCMozStatsReport3=null;this.candidates=new g();this.candidatePairs=new g();this.$FBRTCMozStatsReport4=h.getInstance();}j.prototype.parseReport=function(k){"use strict";k.forEach(function(l){switch(l.type){case 'inboundrtp':if(!l.remoteId)break;var m={inbound:l,outbound:k[l.remoteId]};if(l.isRemote){if(m.outbound.hasOwnProperty('framerateMean')){this.$FBRTCMozStatsReport1=m;}else this.$FBRTCMozStatsReport0=m;}else if(m.outbound.hasOwnProperty('framerateMean')){this.$FBRTCMozStatsReport3=m;}else this.$FBRTCMozStatsReport2=m;break;case 'outboundrtp':break;case 'candidatepair':if(l.state==='succeeded')this.candidatePairs.set(l.id,l);break;case 'localcandidate':this.candidates.set(l.id,l);break;case 'remotecandidate':this.candidates.set(l.id,l);break;default:this.$FBRTCMozStatsReport4.logToConsole('unrecognized webrtc stats type '+l.type);break;}}.bind(this));};j.prototype.isConnected=function(){"use strict";return !!this.$FBRTCMozStatsReport0;};j.prototype.audioRtt=function(){"use strict";if(!this.$FBRTCMozStatsReport0)return 0;return this.$FBRTCMozStatsReport0.inbound.mozRtt;};j.prototype.videoRtt=function(){"use strict";if(!this.$FBRTCMozStatsReport1)return 0;return this.$FBRTCMozStatsReport1.inbound.mozRtt;};j.prototype.audioCodec=function(){"use strict";return 'opus';};j.prototype.videoCodec=function(){"use strict";return 'VP8';};j.prototype.audioPacketsLost=function(){"use strict";if(!this.$FBRTCMozStatsReport0)return 0;return this.$FBRTCMozStatsReport0.inbound.packetsLost;};j.prototype.setVideoPacketsLost=function(k){"use strict";};j.prototype.videoPacketsLost=function(){"use strict";if(!this.$FBRTCMozStatsReport1)return 0;return this.$FBRTCMozStatsReport1.inbound.packetsLost;};j.prototype.audioBytesSent=function(){"use strict";if(!this.$FBRTCMozStatsReport0)return 0;return this.$FBRTCMozStatsReport0.outbound.bytesSent;};j.prototype.videoBytesSent=function(){"use strict";if(!this.$FBRTCMozStatsReport1)return 0;return this.$FBRTCMozStatsReport1.outbound.bytesSent;};j.prototype.audioPacketsSent=function(){"use strict";if(!this.$FBRTCMozStatsReport0)return 0;return this.$FBRTCMozStatsReport0.outbound.packetsSent;};j.prototype.videoPacketsSent=function(){"use strict";if(!this.$FBRTCMozStatsReport1)return 0;return this.$FBRTCMozStatsReport1.outbound.packetsSent;};j.prototype.videoFrameRateSent=function(){"use strict";if(!this.$FBRTCMozStatsReport1)return 0;return this.$FBRTCMozStatsReport1.outbound.framerateMean;};j.prototype.videoFrameRateCaptured=function(){"use strict";if(!this.$FBRTCMozStatsReport1)return 0;return 30;};j.prototype.connectionType=function(){"use strict";var k='unknown',l='unknown',m='unknown',n='unknown';this.candidatePairs.forEach(function(o){var p=this.candidates.get(o.localCandidateId),q=this.candidates.get(o.remoteCandidateId);k=p.transport;m=q.transport;l=p.candidateType;n=q.candidateType;}.bind(this));return i.connectionType(l,k,n,m);};e.exports=j;},null);
__d("FBRTCChromeStatsReport",["FBRTCStatsHelpers"],function(a,b,c,d,e,f,g){var h=function(j,k){return parseInt(j.stat(k),10);};function i(){"use strict";this.$FBRTCChromeStatsReport0=[];this.$FBRTCChromeStatsReport1=null;this.$FBRTCChromeStatsReport2=null;this.$FBRTCChromeStatsReport3=null;this.$FBRTCChromeStatsReport4=null;this.$FBRTCChromeStatsReport5=null;}i.prototype.parseReport=function(j){"use strict";j.result().forEach(function(k){if(k.type==="googCandidatePair"&&k.stat('googActiveConnection')==='true')this.$FBRTCChromeStatsReport0.push(k);if(this.$FBRTCChromeStatsReport6(k))this.$FBRTCChromeStatsReport1=k;if(this.$FBRTCChromeStatsReport7(k))this.$FBRTCChromeStatsReport2=k;if(this.$FBRTCChromeStatsReport8(k))this.$FBRTCChromeStatsReport3=k;if(this.$FBRTCChromeStatsReport9(k))this.$FBRTCChromeStatsReport4=k;if(k.type==='VideoBwe')this.$FBRTCChromeStatsReport5=k;}.bind(this));};i.prototype.isConnected=function(){"use strict";return true;};i.prototype.audioRtt=function(){"use strict";if(!this.$FBRTCChromeStatsReport1)return 0;return h(this.$FBRTCChromeStatsReport1,'googRtt');};i.prototype.videoRtt=function(){"use strict";if(!this.$FBRTCChromeStatsReport2)return 0;return h(this.$FBRTCChromeStatsReport2,'googRtt');};i.prototype.audioCodec=function(){"use strict";if(!this.$FBRTCChromeStatsReport1)return 'unknown';return this.$FBRTCChromeStatsReport1.stat('googCodecName');};i.prototype.videoCodec=function(){"use strict";if(!this.$FBRTCChromeStatsReport2)return 'unknown';return this.$FBRTCChromeStatsReport2.stat('googCodecName');};i.prototype.audioPacketsLost=function(){"use strict";if(!this.$FBRTCChromeStatsReport1)return 0;return h(this.$FBRTCChromeStatsReport1,'packetsLost');};i.prototype.setVideoPacketsLost=function(j){"use strict";this.$FBRTCChromeStatsReporta=j;};i.prototype.videoPacketsLost=function(){"use strict";if(!this.$FBRTCChromeStatsReport2)return 0;if(this.$FBRTCChromeStatsReporta)return this.$FBRTCChromeStatsReporta;return h(this.$FBRTCChromeStatsReport2,'packetsLost');};i.prototype.audioBytesSent=function(){"use strict";if(!this.$FBRTCChromeStatsReport1)return 0;return h(this.$FBRTCChromeStatsReport1,'bytesSent');};i.prototype.videoBytesSent=function(){"use strict";if(!this.$FBRTCChromeStatsReport2)return 0;return h(this.$FBRTCChromeStatsReport2,'bytesSent');};i.prototype.audioPacketsSent=function(){"use strict";if(!this.$FBRTCChromeStatsReport1)return 0;return h(this.$FBRTCChromeStatsReport1,'packetsSent');};i.prototype.videoPacketsSent=function(){"use strict";if(!this.$FBRTCChromeStatsReport2)return 0;return h(this.$FBRTCChromeStatsReport2,'packetsSent');};i.prototype.videoFrameRateSent=function(){"use strict";if(!this.$FBRTCChromeStatsReport2)return 0;return h(this.$FBRTCChromeStatsReport2,'googFrameRateSent');};i.prototype.videoFrameRateCaptured=function(){"use strict";if(!this.$FBRTCChromeStatsReport2)return 0;return h(this.$FBRTCChromeStatsReport2,'googFrameRateInput');};i.prototype.connectionType=function(){"use strict";var j='unknown',k='unknown',l='unknown';for(var m=0;m<this.$FBRTCChromeStatsReport0.length;m++){var n=this.$FBRTCChromeStatsReport0[m];k=n.stat('googLocalCandidateType');l=n.stat('googRemoteCandidateType');j=n.stat('googTransportType');}return g.connectionType(k,j,l,j);};i.prototype.$FBRTCChromeStatsReport6=function(j){"use strict";return j.type==='ssrc'&&j.names().indexOf('audioInputLevel')>-1;};i.prototype.$FBRTCChromeStatsReport7=function(j){"use strict";return j.type==='ssrc'&&j.names().indexOf('googFrameHeightInput')>-1;};i.prototype.$FBRTCChromeStatsReport8=function(j){"use strict";return j.type==='ssrc'&&j.names().indexOf('audioOutputLevel')>-1;};i.prototype.$FBRTCChromeStatsReport9=function(j){"use strict";return j.type==='ssrc'&&j.names().indexOf('googFrameHeightReceived')>-1;};e.exports=i;},null);
__d("FBRTCStatsReportFactory",["FBRTCMozStatsReport","FBRTCChromeStatsReport","FBRTCLogger","FBRTCVersionDetection"],function(a,b,c,d,e,f,g,h,i,j){var k=function(n,o){n.getStats(null,function(p){var q=new g();q.parseReport(p);o(q);},function(){i.getInstance().logToConsole('Firefox stats collection failed');});},l=function(n,o){n.getStats(function(p){var q=new h();q.parseReport(p);o(q);});},m={getStats:function(n,o){if(j.isFirefox())k(n,o);if(j.isChrome())l(n,o);}};e.exports=m;},null);
__d("FBRTCCallConnection",["mixInEventEmitter","FBRTCLogger","FBRTCPCConfig","FBRTCSdpUtils","FBRTCStatsReportFactory"],function(a,b,c,d,e,f,g,h,i,j,k){var l=300000,m=12000,n=10000;function o(){"use strict";this.$FBRTCCallConnection0=h.getInstance();this.$FBRTCCallConnection1();this.$FBRTCCallConnection2=null;this.$FBRTCCallConnection3=null;this.$FBRTCCallConnection4=null;this.$FBRTCCallConnection5=false;this.$FBRTCCallConnection6=0;}o.prototype.init=function(p){"use strict";this.$FBRTCCallConnection0.logToConsole('Creating a new peer connection with: '+JSON.stringify(i.getConfig())+', '+JSON.stringify(i.getConstraints()));this.$FBRTCCallConnection7=p;};o.prototype.setStream=function(p){"use strict";this.$FBRTCCallConnection7=p;};o.prototype.$FBRTCCallConnection8=function(p){"use strict";p.onaddstream=null;p.onremovestream=null;p.onicecandidate=null;p.oniceconnectionstatechange=null;setTimeout(function(){if(p.iceConnectionState!=='closed')p.close();},5000);};o.prototype.$FBRTCCallConnection9=function(){"use strict";if(this.$FBRTCCallConnection2)this.$FBRTCCallConnection8(this.$FBRTCCallConnection2);var p=new this.nativePeerConnection(i.getConfig(),i.getConstraints());p.onaddstream=this.$FBRTCCallConnectiona.bind(this);p.onremovestream=this.$FBRTCCallConnectionb.bind(this);p.onicecandidate=this.$FBRTCCallConnectionc.bind(this);p.oniceconnectionstatechange=this.$FBRTCCallConnectiond.bind(this);p.addStream(this.$FBRTCCallConnection7.getStream());return p;};o.prototype.createOffer=function(){"use strict";this.$FBRTCCallConnection2=this.$FBRTCCallConnection9();this.$FBRTCCallConnection2.createOffer(this.$FBRTCCallConnectione.bind(this),this.$FBRTCCallConnectionf.bind(this,'CreateOfferFailed'),{mandatory:{OfferToReceiveAudio:true,OfferToReceiveVideo:true}});};o.prototype.end=function(){"use strict";this.$FBRTCCallConnection0.logToConsole('Ending connection...');if(this.$FBRTCCallConnection2){this.emit('isEnding');this.$FBRTCCallConnection8(this.$FBRTCCallConnection2);this.$FBRTCCallConnection2.close();this.$FBRTCCallConnection2=null;}};o.prototype.onReceivedOfferSDP=function(p){"use strict";this.$FBRTCCallConnection2=this.$FBRTCCallConnection9();var q=new this.nativeSessionDescription({type:'offer',sdp:p});this.$FBRTCCallConnection2.setRemoteDescription(q,this.$FBRTCCallConnectiong.bind(this,q),this.$FBRTCCallConnectionf.bind(this,'SetRemoteOfferFailed'));};o.prototype.onReceivedAnswerSDP=function(p){"use strict";var q=new this.nativeSessionDescription({type:'answer',sdp:p});this.$FBRTCCallConnection2.setRemoteDescription(q,this.$FBRTCCallConnectiong.bind(this,q),this.$FBRTCCallConnectionf.bind(this,'SetRemoteAnswerFailed'));};o.prototype.onReceivedRemoteIceCandidate=function(p){"use strict";var q=new this.nativeIceCandidate({sdpMLineIndex:p.label,candidate:p.sdp,sdpMid:p.sdp_mid});this.$FBRTCCallConnection2.addIceCandidate(q);};o.prototype.getStats=function(p){"use strict";k.getStats(this.$FBRTCCallConnection2,p);};o.prototype.$FBRTCCallConnectione=function(p){"use strict";this.$FBRTCCallConnection0.logToConsole('Created '+p.type+' sdp');if(!this.$FBRTCCallConnection2){this.$FBRTCCallConnection0.logToConsole('_onSDPCreated: pc has been deallocated');return;}p.sdp=j.addIceOptionToSdp(p.sdp,"fb-force-5245");p.sdp=j.preferIsac(p.sdp);this.$FBRTCCallConnection2.setLocalDescription(p,this.$FBRTCCallConnectionh.bind(this,p),this.$FBRTCCallConnectionf.bind(this,(p.type==='offer')?'SetLocalOfferFailed':'SetAnswerFailed'));};o.prototype.$FBRTCCallConnectionh=function(p){"use strict";if(p.type==='offer'){this.emit('offerSDPCreated',p.sdp);}else this.emit('answerSDPCreated',p.sdp);this.$FBRTCCallConnection0.logToConsole('Local '+p.type+' set');};o.prototype.$FBRTCCallConnectiong=function(p){"use strict";this.$FBRTCCallConnection0.logToConsole('Remote '+p.type+' set');if(!this.$FBRTCCallConnection2){this.$FBRTCCallConnection0.logToConsole('_onRemoteDescriptionSet: pc has been deallocated');return;}if(p.type==='offer')this.$FBRTCCallConnection2.createAnswer(this.$FBRTCCallConnectione.bind(this),this.$FBRTCCallConnectionf.bind(this,'CreateAnswerFailed'));this.emit('remoteDescriptionSet');};o.prototype.$FBRTCCallConnectiona=function(event){"use strict";this.$FBRTCCallConnection0.logToConsole('Remote stream added');this.emit('remoteStreamAdded',{stream:event.stream});};o.prototype.$FBRTCCallConnectionb=function(event){"use strict";this.$FBRTCCallConnection0.logToConsole('Remote stream removed');};o.prototype.$FBRTCCallConnectionc=function(event){"use strict";if(event.candidate)this.emit('localIceCandidateCreated',event.candidate);};o.prototype.$FBRTCCallConnectiond=function(event){"use strict";var p=event.target.iceConnectionState;this.$FBRTCCallConnection0.logToConsole('Ice candidate state changed from '+this.$FBRTCCallConnection3+' to '+p);if(p===this.$FBRTCCallConnection3)return;this.$FBRTCCallConnectioni();if(this.$FBRTCCallConnectionj(p)){if(!this.$FBRTCCallConnection5){this.emit('connected');this.$FBRTCCallConnection5=true;}}else if(p==='disconnected'){this.$FBRTCCallConnectionk();}else if(p==='failed')this.$FBRTCCallConnectionl();this.$FBRTCCallConnection3=p;};o.prototype.$FBRTCCallConnectionj=function(p){"use strict";return (p==='completed'||p==='connected');};o.prototype.$FBRTCCallConnectionk=function(){"use strict";if(this.$FBRTCCallConnectionj(this.$FBRTCCallConnection3)){var p=Date.now();if(this.$FBRTCCallConnectionm-p>=l)this.$FBRTCCallConnection6=0;this.$FBRTCCallConnection6=this.$FBRTCCallConnection6+1;this.$FBRTCCallConnectionm=p;if(this.$FBRTCCallConnection6>=2)this.emit('connectionUnstable');}var q=this;this.$FBRTCCallConnection4=setTimeout(function(){q.emit('disconnected');},m);};o.prototype.$FBRTCCallConnectionl=function(){"use strict";var p=this;this.$FBRTCCallConnection4=setTimeout(function(){var q={details:'Ice candidate state failed',endCallSubreason:'IceFailed'};p.emit('connectionError',q);},n);};o.prototype.$FBRTCCallConnectioni=function(){"use strict";if(this.$FBRTCCallConnection4)clearTimeout(this.$FBRTCCallConnection4);this.$FBRTCCallConnection4=null;};o.prototype.$FBRTCCallConnectionf=function(p,q){"use strict";var r={details:q,endCallSubreason:p};this.emit('connectionError',r);};o.prototype.$FBRTCCallConnection1=function(){"use strict";if(window.webkitRTCPeerConnection){this.$FBRTCCallConnection0.logToConsole('Using Chrome WebRTC APIs...');this.nativePeerConnection=window.webkitRTCPeerConnection;this.nativeIceCandidate=window.RTCIceCandidate;this.nativeSessionDescription=window.RTCSessionDescription;}else{this.$FBRTCCallConnection0.logToConsole('Using Firefox WebRTC APIs...');this.nativePeerConnection=window.mozRTCPeerConnection;this.nativeIceCandidate=window.mozRTCIceCandidate;this.nativeSessionDescription=window.mozRTCSessionDescription;}};g(o,{remoteStreamAdded:true,offerSDPCreated:true,answerSDPCreated:true,localIceCandidateCreated:true,remoteDescriptionSet:true,connected:true,disconnected:true,connectionUnstable:true,connectionError:true,isEnding:true});e.exports=o;},null);
__d("RingBuffer",[],function(a,b,c,d,e,f){function g(h){"use strict";this.$RingBuffer0=h;this.$RingBuffer1=-1;this.$RingBuffer2=[];}g.prototype.add=function(h){"use strict";this.$RingBuffer1=(this.$RingBuffer1+1)%this.$RingBuffer0;this.$RingBuffer2[this.$RingBuffer1]=h;};g.prototype.size=function(){"use strict";return this.$RingBuffer2.length;};g.prototype.head=function(){"use strict";if(this.$RingBuffer1===-1)return null;return this.$RingBuffer2[this.$RingBuffer1];};g.prototype.tail=function(){"use strict";if(this.$RingBuffer1===-1)return null;return this.$RingBuffer2[this.$RingBuffer3()];};g.prototype.forEach=function(h){"use strict";for(var i=0;i<this.$RingBuffer2.length;i++){var j=(this.$RingBuffer1+1+i)%this.$RingBuffer2.length;h(this.$RingBuffer2[j]);}};g.prototype.$RingBuffer3=function(){"use strict";return (this.$RingBuffer1+1)%this.$RingBuffer2.length;};e.exports=g;},null);
__d("FBRTCRttAggregator",[],function(a,b,c,d,e,f){function g(){"use strict";this.$FBRTCRttAggregator0=[{count:0,ave:0},{count:0,ave:0},{count:0,ave:0},{count:0,ave:0}];}g.prototype.addRtt=function(h){"use strict";var i=this.$FBRTCRttAggregator0[this.$FBRTCRttAggregator1(h)];i.ave=this.$FBRTCRttAggregator2(i.ave,i.count,h);i.count+=1;};g.prototype.toString=function(){"use strict";return [this.$FBRTCRttAggregator3('50',this.$FBRTCRttAggregator0[0]),this.$FBRTCRttAggregator3('100',this.$FBRTCRttAggregator0[1]),this.$FBRTCRttAggregator3('200',this.$FBRTCRttAggregator0[2]),this.$FBRTCRttAggregator3('0',this.$FBRTCRttAggregator0[3])].join('|');};g.prototype.$FBRTCRttAggregator3=function(h,i){"use strict";return (h+"="+i.count+","+Math.round(i.ave));};g.prototype.$FBRTCRttAggregator1=function(h){"use strict";if(h<50)return 0;if(h<100)return 1;if(h<200)return 2;return 3;};g.prototype.$FBRTCRttAggregator2=function(h,i,j){"use strict";return (h*i+j)/(i+1);};e.exports=g;},null);
__d("FBRTCStatsInterpreter",["FBRTCLogger"],function(a,b,c,d,e,f,g){var h={rtt_weight:2,frr_weight:800,plr_weight:500,score_threshold:1000,bad_score_count:3};function i(j){"use strict";this.$FBRTCStatsInterpreter0=Object.assign({},h,j||{});this.$FBRTCStatsInterpreter1=g.getInstance();this.$FBRTCStatsInterpreter2=0;}i.prototype.interpretStats=function(j,k){"use strict";var l=j.videoRtt(),m=this.$FBRTCStatsInterpreter3(j),n=this.$FBRTCStatsInterpreter4(j,k),o=this.$FBRTCStatsInterpreter5(l,m,n);this.$FBRTCStatsInterpreter1.logToConsole('the current network score is: '+o);if(o>=this.$FBRTCStatsInterpreter0.score_threshold&&!this.isNetworkPoor())this.$FBRTCStatsInterpreter2+=1;if(o<this.$FBRTCStatsInterpreter0.score_threshold&&this.$FBRTCStatsInterpreter2>0)this.$FBRTCStatsInterpreter2-=1;this.$FBRTCStatsInterpreter1.logToConsole('the bad score count is: '+this.$FBRTCStatsInterpreter2);};i.prototype.isNetworkPoor=function(){"use strict";return this.$FBRTCStatsInterpreter2>=this.$FBRTCStatsInterpreter0.bad_score_count;};i.prototype.$FBRTCStatsInterpreter5=function(j,k,l){"use strict";return j*this.$FBRTCStatsInterpreter0.rtt_weight+k*this.$FBRTCStatsInterpreter0.frr_weight+l*this.$FBRTCStatsInterpreter0.plr_weight;};i.prototype.$FBRTCStatsInterpreter4=function(j,k){"use strict";var l,m;if(k){l=j.videoPacketsLost()-k.videoPacketsLost();m=j.videoPacketsSent()-k.videoPacketsSent();}else{l=j.videoPacketsLost();m=j.videoPacketsSent();}if(l<0||m===0)return 0;return (l/m);};i.prototype.$FBRTCStatsInterpreter3=function(j){"use strict";if(j.videoFrameRateCaptured()===0)return 0;return 1-(j.videoFrameRateSent()/j.videoFrameRateCaptured());};e.exports=i;},null);
__d("FBRTCCallConnectionMonitor",["RingBuffer","FBRTCRttAggregator","FBRTCStatsInterpreter","FBRTCConfig","mixInEventEmitter"],function(a,b,c,d,e,f,g,h,i,j,k){var l=3000,m=1,n=0,o=3;function p(q,r){"use strict";this.$FBRTCCallConnectionMonitor0=new i(j.statsInterpreterConfig());this.$FBRTCCallConnectionMonitor1=new h();this.$FBRTCCallConnectionMonitor2=new h();this.$FBRTCCallConnectionMonitor3=q;this.$FBRTCCallConnectionMonitor4=r;this.$FBRTCCallConnectionMonitor5=null;this.$FBRTCCallConnectionMonitor6=[];this.$FBRTCCallConnectionMonitor7=new g(m);this.$FBRTCCallConnectionMonitor8=0;this.$FBRTCCallConnectionMonitor3.addListener('connected',this.$FBRTCCallConnectionMonitor9,this);this.$FBRTCCallConnectionMonitor3.addListener('isEnding',this.$FBRTCCallConnectionMonitora,this);}p.prototype.$FBRTCCallConnectionMonitor9=function(){"use strict";var q=this.$FBRTCCallConnectionMonitorb.bind(this);this.$FBRTCCallConnectionMonitor5=setInterval(q,l);this.$FBRTCCallConnectionMonitorb();};p.prototype.$FBRTCCallConnectionMonitora=function(){"use strict";if(this.$FBRTCCallConnectionMonitor5!==null){this.$FBRTCCallConnectionMonitorb();clearInterval(this.$FBRTCCallConnectionMonitor5);this.$FBRTCCallConnectionMonitor5=null;}};p.prototype.$FBRTCCallConnectionMonitorb=function(){"use strict";this.$FBRTCCallConnectionMonitor3.getStats(function(q){var r;if(this.$FBRTCCallConnectionMonitor7.size()>0){r=this.$FBRTCCallConnectionMonitor7.head();this.$FBRTCCallConnectionMonitorc(q,r);}if(this.$FBRTCCallConnectionMonitor6.length<n)this.$FBRTCCallConnectionMonitor6.push(q);if(r&&r.isConnected()&&!q.isConnected())this.$FBRTCCallConnectionMonitor8+=1;if(this.$FBRTCCallConnectionMonitor8>=o)this.$FBRTCCallConnectionMonitor3.emit('disconnected');if(q.isConnected()){this.$FBRTCCallConnectionMonitor8=0;this.$FBRTCCallConnectionMonitor7.add(q);this.$FBRTCCallConnectionMonitor1.addRtt(q.audioRtt());this.$FBRTCCallConnectionMonitor2.addRtt(q.videoRtt());this.$FBRTCCallConnectionMonitor4.setPcStats(this.$FBRTCCallConnectionMonitord());this.$FBRTCCallConnectionMonitore(q,r);}}.bind(this));};p.prototype.$FBRTCCallConnectionMonitord=function(){"use strict";var q=this.$FBRTCCallConnectionMonitor7.head();return {end:{conn_type:q.connectionType()},sender:{bytes:q.audioBytesSent(),codec:{'0':q.audioCodec()},plost:q.audioPacketsLost(),psent:q.audioPacketsSent(),rtt:this.$FBRTCCallConnectionMonitor1.toString()},video:{sender:{bytes:q.videoBytesSent(),codec:{'0':q.videoCodec()},plost:q.videoPacketsLost(),psent:q.videoPacketsSent(),rtt:this.$FBRTCCallConnectionMonitor2.toString()}}};};p.prototype.$FBRTCCallConnectionMonitorc=function(q,r){"use strict";if(r.videoPacketsLost()>q.videoPacketsLost())q.setVideoPacketsLost(r.videoPacketsLost());};p.prototype.$FBRTCCallConnectionMonitore=function(q,r){"use strict";this.$FBRTCCallConnectionMonitor0.interpretStats(q,r);if(this.$FBRTCCallConnectionMonitor0.isNetworkPoor())this.emit('connectionPoor');};k(p,{connectionPoor:true});e.exports=p;},null);
__d("FBRTCFullScreenController",[],function(a,b,c,d,e,f){var g,h,i=document.documentElement;if(i.requestFullscreen){g=i.requestFullscreen.bind(i);h='fullscreenchange';}else if(i.msRequestFullscreen){g=i.msRequestFullscreen.bind(i);h='msfullscreenchange';}else if(i.mozRequestFullScreen){g=i.mozRequestFullScreen.bind(i);h='mozfullscreenchange';}else if(i.webkitRequestFullscreen){g=i.webkitRequestFullscreen.bind(i,Element.ALLOW_KEYBOARD_INPUT);h='webkitfullscreenchange';}var j;if(document.exitFullscreen){j=document.exitFullscreen.bind(document);}else if(document.msExitFullscreen){j=document.msExitFullscreen.bind(document);}else if(document.mozCancelFullScreen){j=document.mozCancelFullScreen.bind(document);}else if(document.webkitExitFullscreen)j=document.webkitExitFullscreen.bind(document);var k={supportsFullScreen:function(){return g&&j;},isFullScreen:function(){return (document.fullscreenElement||document.mozFullScreenElement||document.webkitFullscreenElement||document.msFullscreenElement);},toggleFullScreen:function(){if(this.isFullScreen()){j();}else g();},onFullScreenChange:function(l){document.addEventListener(h,l);}};e.exports=k;},null);
__d("FBRTCStreamWrapper",["mixInEventEmitter","FBRTCUtils"],function(a,b,c,d,e,f,g,h){var i=100;function j(){"use strict";this.$FBRTCStreamWrapper0=true;this.$FBRTCStreamWrapper1=true;this.$FBRTCStreamWrapper2=null;this.$FBRTCStreamWrapper3=null;this.aspectRatio=j.aspectRatios.other;this.videoWidth=0;this.videoHeight=0;}j.prototype.setStream=function(k){"use strict";this.$FBRTCStreamWrapper2=k;this.$FBRTCStreamWrapper4();this.$FBRTCStreamWrapper2.onaddtrack=this.$FBRTCStreamWrapper5.bind(this);this.$FBRTCStreamWrapper2.onremovetrack=this.$FBRTCStreamWrapper5.bind(this);this.$FBRTCStreamWrapper2.onended=this.$FBRTCStreamWrapper6.bind(this);};j.prototype.getStream=function(){"use strict";return this.$FBRTCStreamWrapper2;};j.prototype.hasStream=function(){"use strict";return !!this.$FBRTCStreamWrapper2;};j.prototype.hasVideoTracks=function(){"use strict";if(this.$FBRTCStreamWrapper2)return this.$FBRTCStreamWrapper2.getVideoTracks().length>0;return true;};j.prototype.hasVideo=function(){"use strict";return this.$FBRTCStreamWrapper1&&this.hasVideoTracks();};j.prototype.hasAudio=function(){"use strict";return this.$FBRTCStreamWrapper0;};j.prototype.attachToVideoTag=function(k){"use strict";this.$FBRTCStreamWrapper3=k;h.attachMediaStream(k,this.$FBRTCStreamWrapper2);this.$FBRTCStreamWrapper7(k);};j.prototype.toggleMuteAudio=function(){"use strict";var k=this.$FBRTCStreamWrapper2.getAudioTracks();this.$FBRTCStreamWrapper0=!this.$FBRTCStreamWrapper0;for(var l=0;l<k.length;l++)k[l].enabled=this.$FBRTCStreamWrapper0;};j.prototype.toggleMuteVideo=function(){"use strict";this.$FBRTCStreamWrapper1=!this.$FBRTCStreamWrapper1;if(this.$FBRTCStreamWrapper1){this.$FBRTCStreamWrapper4();}else setTimeout(this.$FBRTCStreamWrapper4.bind(this),500);this.$FBRTCStreamWrapper5();};j.prototype.$FBRTCStreamWrapper4=function(){"use strict";if(this.$FBRTCStreamWrapper2){var k=this.$FBRTCStreamWrapper2.getVideoTracks();for(var l=0;l<k.length;l++)k[l].enabled=this.$FBRTCStreamWrapper1;}};j.prototype.setVideoEnabled=function(k){"use strict";this.$FBRTCStreamWrapper1=k;this.$FBRTCStreamWrapper4();this.$FBRTCStreamWrapper5();};j.prototype.$FBRTCStreamWrapper7=function(k){"use strict";if(!this.hasVideo()||k.currentTime>0){this.$FBRTCStreamWrapper8(k);}else setTimeout(this.$FBRTCStreamWrapper7.bind(this,k),i);};j.prototype.$FBRTCStreamWrapper9=function(k){"use strict";this.videoWidth=k.videoWidth;this.videoHeight=k.videoHeight;var l=k.videoWidth/k.videoHeight;if(h.aboutEqual(l,(16/9)))return j.aspectRatios['16:9'];if(h.aboutEqual(l,(4/3)))return j.aspectRatios['4:3'];return j.aspectRatios.other;};j.prototype.$FBRTCStreamWrapper8=function(k){"use strict";if(this.hasVideo()){this.aspectRatio=this.$FBRTCStreamWrapper9(k);}else this.aspectRatio=j.aspectRatios.other;this.emit('streamStarted');};j.prototype.$FBRTCStreamWrapper6=function(){"use strict";this.emit('streamEnded');};j.prototype.$FBRTCStreamWrapper5=function(event){"use strict";if(this.$FBRTCStreamWrappera(event))this.attachToVideoTag(this.$FBRTCStreamWrapper3);this.emit('tracksChanged');};j.prototype.$FBRTCStreamWrappera=function(k){"use strict";return this.$FBRTCStreamWrapper3&&k&&k.type==='addtrack'&&k.track.kind==='video';};j.aspectRatios={'16:9':1,'4:3':2,other:3};g(j,{streamStarted:true,streamEnded:true,tracksChanged:true});e.exports=j;},null);
__d("XVideoCallUserInfoControllerURIBuilder",["XControllerURIBuilder"],function(a,b,c,d,e,f){e.exports=b("XControllerURIBuilder").create("\/videocall\/userinfo\/",{user_id:{type:"Int",required:true}});},null);
__d("FBRTCPeerInfo",["ix","XVideoCallUserInfoControllerURIBuilder","FBRTCUtils"],function(a,b,c,d,e,f,g,h,i){function j(k){"use strict";this.peerID=k;this.peerPicUrl=null;this.selfPicUrl=g('/images/chat/webrtc/no_profile_pic.png');this.backgroundUrl=null;this.peerName='';}j.prototype.fetch=function(k,l){"use strict";var m=(new h()).setInt('user_id',this.peerID).getURI(),n=this;i.sendServerRequest(m,function(o){n.peerPicUrl=o.payload.profile_pic_url;n.backgroundUrl=o.payload.cover_pic_url;n.peerName=o.payload.name;if(o.payload.self_profile_pic_url)n.selfPicUrl=o.payload.self_profile_pic_url;if(k)k();},l);};e.exports=j;},null);
__d("FBRTCCallModel",["mixInEventEmitter","FBRTCFullScreenController","FBRTCLogger","FBRTCPCConfig","FBRTCStreamWrapper","FBRTCPeerInfo","FBRTCStruct"],function(a,b,c,d,e,f,g,h,i,j,k,l,m){function n(o){"use strict";this.$FBRTCCallModel0=i.getInstance();this.isCaller=o.isCaller;this.peerID=o.peerID;this.$FBRTCCallModel1=new l(o.peerID);this.$FBRTCCallModel2(o.callID);this.$FBRTCCallModel3(true);}n.prototype.resetForReconnect=function(o){"use strict";this.isCaller=false;this.$FBRTCCallModel2(o);this.$FBRTCCallModel3(false);};n.prototype.fetchPeerInfo=function(){"use strict";var o=this,p=function(){o.emit('changed');},q=function(){o.$FBRTCCallModel0.logError(o.peerID,o.callID,'Failed to get remote photos');};this.$FBRTCCallModel1.fetch(p,q);};n.prototype.$FBRTCCallModel2=function(o){"use strict";this.callID=o;this.startTime=new Date();this.endCallReason=null;this.isRemoteEnded=null;this.wasConnected=false;this.receivedNack=false;this.$FBRTCCallModel4=true;this.$FBRTCCallModel5=false;};n.prototype.$FBRTCCallModel3=function(o){"use strict";if(o){this.localStream=new k();this.localStream.addListener('tracksChanged',function(){if(!this.$FBRTCCallModel4&&this.localStream.hasVideo())this.$FBRTCCallModel5=true;this.emit('changed');}.bind(this));}this.remoteStream=new k();this.selfViewOpen=true;this.uiState=n.UIState.INIT;this.emit('changed');};n.prototype.setLocalStream=function(o){"use strict";this.localStream.setStream(o);};n.prototype.setRemoteStream=function(o){"use strict";this.remoteStream.setStream(o);};n.prototype.canStartCall=function(){"use strict";return this.localStream.hasStream()&&j.turnIP;};n.prototype.isInProgress=function(){"use strict";return this.uiState>=n.UIState.CONTACTING&&this.uiState<n.UIState.CALL_ENDED;};n.prototype.isUserMediaPending=function(){"use strict";return this.uiState===n.UIState.PENDING_LOCAL_MEDIA;};n.prototype.isUserMediaDenied=function(){"use strict";return this.uiState===n.UIState.USER_MEDIA_DENIED;};n.prototype.isEnded=function(){"use strict";return this.uiState>=n.UIState.CALL_ENDED;};n.prototype.isFullScreen=function(){"use strict";return h.isFullScreen();};n.prototype.peerPicUrl=function(){"use strict";return this.$FBRTCCallModel1.peerPicUrl;};n.prototype.selfPicUrl=function(){"use strict";return this.$FBRTCCallModel1.selfPicUrl;};n.prototype.backgroundUrl=function(){"use strict";return this.$FBRTCCallModel1.backgroundUrl;};n.prototype.peerName=function(){"use strict";return this.$FBRTCCallModel1.peerName;};n.prototype.autoDisableVideo=function(){"use strict";if(this.$FBRTCCallModel4){this.$FBRTCCallModel4=false;this.$FBRTCCallModel0.logCallAction(this.peerID,this.callID,i.CallAction.AUTO_DISABLE_VIDEO);this.localStream.setVideoEnabled(false);}};n.prototype.videoIsAutoDisabled=function(){"use strict";return !this.$FBRTCCallModel4&&!this.$FBRTCCallModel5&&!this.localStream.hasVideo();};n.prototype.setState=function(o){"use strict";if(o===this.uiState)return;var p=this.uiState;this.uiState=o;if(o===n.UIState.CALL_CONNECTED)this.wasConnected=true;this.$FBRTCCallModel0.logInfo(this.peerID,this.callID,'UI: state change - "'+n.UIState.strNames[p]+'" to "'+n.UIState.strNames[o]+'"');this.emit('changed',this.uiState);};n.prototype.setStateFrom=function(o,p){"use strict";if(this.uiState===o){this.setState(p);}else this.$FBRTCCallModel0.logInfo(this.peerID,this.callID,'UI: Not at "'+n.UIState.strNames[o]+'", not moving to "'+n.UIState.strNames[p]+'"');};n.UIState=new m(['INIT','PENDING_LOCAL_MEDIA','USER_MEDIA_DENIED','MORE_INIT','CONTACTING','RINGING','CALL_CONNECTING','CALL_CONNECTED','CALL_ENDED','COLLECT_RATING']);g(n,{changed:true});e.exports=n;},null);
__d("FBRTCCallMonitor",["FBRTCCallSummaryStore"],function(a,b,c,d,e,f,g){var h=10000,i=3000;function j(k){"use strict";this.$FBRTCCallMonitor0=k;this.$FBRTCCallMonitor1=null;this.$FBRTCCallMonitor2=g.getInstance();}j.prototype.startHeartbeat=function(k){"use strict";if(this.$FBRTCCallMonitor0.isEnded())return;var l=k();if(l)this.onCallHeartbeat(l);var m=this;setTimeout(function(){m.startHeartbeat(k);},h);};j.prototype.onCallHeartbeat=function(k){"use strict";var l=(new Date()).valueOf();if(!this.$FBRTCCallMonitor1||(l-this.$FBRTCCallMonitor1)>i)k.save(this.$FBRTCCallMonitor2);};e.exports=j;},null);
__d("XVideoCallTurnDiscoveryControllerURIBuilder",["XControllerURIBuilder"],function(a,b,c,d,e,f){e.exports=b("XControllerURIBuilder").create("\/videocall\/turndiscovery\/",{version:{type:"Int",required:true}});},null);
__d("FBRTCTurnDiscovery",["FBRTCLogger","FBRTCUtils","XVideoCallTurnDiscoveryControllerURIBuilder","mixInEventEmitter"],function(a,b,c,d,e,f,g,h,i,j){var k=3,l={requestTurnCreds:function(m,n){if(this._turnCreds)this.emit('receivedTurnCreds',this._turnCreds);if(n===(void 0))n=k;var o=1,p=(new i()).setInt('version',o).getURI();h.sendServerRequest(p,this._onServerRequestSuccess.bind(this),this._onServerRequestFailure.bind(this,m,n));},_onServerRequestSuccess:function(m){this._turnCreds=m.payload;this.emit('receivedTurnCreds',this._turnCreds);},_onServerRequestFailure:function(m,n,o){if(n>0){g.getInstance().logError(m.peerID,m.callID,'Failed turn; going to retry');this.requestTurnCreds(m,n-1);}else this.emit('failed');}};j(l,{receivedTurnCreds:true,failed:true});e.exports=l;},null);
__d("FBRTCStreamTester",["mixInEventEmitter","FBRTCUtils"],function(a,b,c,d,e,f,g,h){var i=100,j=30;function k(l){"use strict";if(!l)l={};this.$FBRTCStreamTester0=l.retries||j;this.$FBRTCStreamTester1=l.testInterval||i;this.$FBRTCStreamTester2=null;this.$FBRTCStreamTester3=null;this.$FBRTCStreamTester4=false;}k.prototype.testStream=function(l,m){"use strict";this.$FBRTCStreamTester2=l;if(!m){this.$FBRTCStreamTester4=true;this.$FBRTCStreamTester3=document.createElement('video');this.$FBRTCStreamTester3.muted=true;h.attachMediaStream(this.$FBRTCStreamTester3,this.$FBRTCStreamTester2);this.$FBRTCStreamTester3.play();}else{this.$FBRTCStreamTester4=false;this.$FBRTCStreamTester3=m;}this.$FBRTCStreamTester5(this.$FBRTCStreamTester0);};k.prototype.$FBRTCStreamTester5=function(l){"use strict";if(this.$FBRTCStreamTester2.getVideoTracks().length===0||this.$FBRTCStreamTester3.currentTime>0){this.emit('streamWorking');this.$FBRTCStreamTester6();}else if(l<1){this.emit('streamBroken');this.$FBRTCStreamTester6();}else setTimeout(this.$FBRTCStreamTester5.bind(this,l-1),this.$FBRTCStreamTester1);};k.prototype.$FBRTCStreamTester6=function(){"use strict";if(this.$FBRTCStreamTester4)this.$FBRTCStreamTester3.pause();this.$FBRTCStreamTester3=null;this.$FBRTCStreamTester2=null;};g(k,{streamWorking:true,streamBroken:true});e.exports=k;},null);
__d("FBRTCUserMediaRequest",["mixInEventEmitter","FBRTCStruct"],function(a,b,c,d,e,f,g,h){var i=960,j=720,k=640,l=480,m=30,n=function(r,s){if(!r)return {audio:true,video:false};var t=s?i:k,u=s?j:l;return {audio:true,video:{mandatory:{},optional:[{maxWidth:t},{minWidth:t},{minHeight:u},{maxHeight:u},{minFrameRate:m},{maxFrameRate:m},{googLeakyBucket:true}]}};},o=function(r,s,t){if(navigator.getUserMedia){navigator.getUserMedia(r,s,t);}else if(navigator.webkitGetUserMedia){navigator.webkitGetUserMedia(r,s,t);}else if(navigator.mozGetUserMedia){navigator.mozGetUserMedia(r,s,t);}else if(navigator.msGetUserMedia)navigator.msGetUserMedia(r,s,t);},p=new h(['NO_VIDEO','SD_VIDEO','HD_VIDEO']);function q(r){"use strict";if(r===(void 0))r=p.SD_VIDEO;this.streamType=r;}q.prototype.request=function(){"use strict";var r=this.streamType!==p.NO_VIDEO,s=this.streamType===p.HD_VIDEO,t=n(r,s);o(t,function(u){this.emit('success',u);}.bind(this),function(u){this.emit('failed',u);}.bind(this));};q.STREAM_TYPE=p;q.HD_WIDTH=i;q.SD_WIDTH=k;g(q,{success:true,failed:true});e.exports=q;},null);
__d("FBRTCUserMedia",["mixInEventEmitter","FBRTCLogger","FBRTCStreamTester","FBRTCUserMediaRequest"],function(a,b,c,d,e,f,g,h,i,j){var k={STREAM_TYPE:j.STREAM_TYPE,_localStream:null,_accessGranted:false,_pendingRequest:null,requestUserMedia:function(l){if(this._localStream){this.emit('streamReady',this._localStream);}else{this._startRequestListeners();this._pendingRequest=new j(l);this._pendingRequest.addListener('success',this._onRequestSuccess,this);this._pendingRequest.addListener('failed',this._onRequestFailure,this);this._pendingRequest.request();}},end:function(){this._stopEventListeners();if(this._localStream)this._localStream.stop();},_startRequestListeners:function(){if(navigator.mozGetUserMedia){this._evListener=this._onMediaPromptHidden.bind(this);document.addEventListener('mousedown',this._evListener);document.addEventListener('focus',this._evListener);}},_stopEventListeners:function(){if(navigator.mozGetUserMedia){if(this._promptTimeout)clearTimeout(this._promptTimeout);document.removeEventListener('mousedown',this._evListener);document.removeEventListener('focus',this._evListener);}},_onMediaPromptHidden:function(){this._promptTimeout=setTimeout(function(){if(!this._accessGranted&&this._pendingRequest)this._pendingRequest.request();}.bind(this),1500);},_onRequestSuccess:function(l){this._stopEventListeners();if(!this._accessGranted){this._accessGranted=true;this.emit('accessGranted');}var m=new i();m.addListener('streamWorking',function(){this._pendingRequest=null;this._localStream=l;this.emit('streamReady',l);}.bind(this));m.addListener('streamBroken',function(){this._onRequestFailure('StreamFailedToStart');}.bind(this));m.testStream(l);},_onRequestFailure:function(l){this._stopEventListeners();var m=this._getErrorName(l);if(this._shouldRerequestWithoutVideo(m,this._pendingRequest)){this._pendingRequest.streamType=this.STREAM_TYPE.NO_VIDEO;this._pendingRequest.request();return;}if(m==='InvalidStateError'){h.getInstance().logErrorWithoutID('Invalid state while requesting user media');return;}this._pendingRequest=null;if(m==='PERMISSION_DENIED'||m==='PermissionDeniedError'||m==='PermissionDismissedError'){this.emit('accessDenied',m);}else{if(m==='NO_DEVICES_FOUND')m='DevicesNotFoundError';h.getInstance().logErrorWithoutID('getUserMedia error: '+m);this.emit('accessFailed',m);}},_getErrorName:function(l){if(l.name)return l.name;return l;},_shouldRerequestWithoutVideo:function(l,m){return m.streamType!==this.STREAM_TYPE.NO_VIDEO&&(l==='DevicesNotFoundError'||l==='StreamFailedToStart');}};g(k,{streamReady:true,accessGranted:true,accessDenied:true,accessFailed:true});e.exports=k;},null);
__d("FBRTCRingback",["ChatConfig","Sound","FBRTCCallModel"],function(a,b,c,d,e,f,g,h,i){var j=[g.get('sound.ringback_mp3_url'),g.get('sound.ringback_ogg_url')],k={monitorCallModel:function(l){if(this._subscription)this._subscription.remove();this._callModel=l;this._subscription=l.addListener('changed',this._onChange.bind(this));},_soundIsPlaying:false,_onChange:function(){if(this._callModel.uiState===i.UIState.RINGING){this._startSound();}else this._stopSound();},_startSound:function(){if(!this._soundIsPlaying){h.play(j,this._syncToken(),true);this._soundIsPlaying=true;}},_syncToken:function(){return 'ring_back_'+this._callModel.callID.toString();},_stopSound:function(){if(this._soundIsPlaying){h.stop(j);this._soundIsPlaying=false;}}};e.exports=k;},null);
__d("FBRTCVideo.react",["React","cx"],function(a,b,c,d,e,f,g,h){var i=g.createClass({displayName:"FBRTCVideo",hideContextMenu:function(j){j.preventDefault();},componentDidMount:function(){this._attachStream();},shouldComponentUpdate:function(j,k){return this._streamDidChange();},componentDidUpdate:function(j,k){this._attachStream();},_attachStream:function(){if(this.props.stream){var j=this.getDOMNode();this.props.stream.attachToVideoTag(j);this._currentStream=this.props.stream.getStream();}},_streamDidChange:function(){var j=this.props.stream?this.props.stream.getStream():null;return j!==this._currentStream;},render:function(){return (g.createElement("video",{className:"_3vsh",autoPlay:'true',muted:this.props.muted,onContextMenu:this.hideContextMenu}));}});e.exports=i;},null);
__d("FBRTCVideoMuteOverlay.react",["React","cx","Image.react"],function(a,b,c,d,e,f,g,h,i){var j=g.createClass({displayName:"FBRTCVideoMuteOverlay",_className:function(k){var l=!k.localStream.hasVideo();return (("_3nx7")+(l?' '+"_3nx8":''));},render:function(){var k=this.props.callModel;return (g.createElement("div",{className:this._className(k)},g.createElement(i,{src:k.selfPicUrl(),alt:"video muted"})));}});e.exports=j;},null);
__d("FBRTCSelfView.react",["cx","ix","React","Image.react","FBRTCConstants","FBRTCVideo.react","FBRTCStreamWrapper","FBRTCVideoMuteOverlay.react"],function(a,b,c,d,e,f,g,h,i,j,k,l,m,n){var o=i.createClass({displayName:"FBRTCSelfView",toggleSelfView:function(p){this.props.publishFn(k.UIEventType.TOGGLE_SELF_VIEW);},toggleClass:function(p){return ((!p?"_hgl":''));},outerClasses:function(p){var q=(p.localStream.aspectRatio===m.aspectRatios['16:9']);return (("_1qmr")+(q?' '+"_yse":''));},wrapperClasses:function(p){return (("_1qmn")+(!p.selfViewOpen?' '+"_1qmo":''));},overlayClasses:function(p){var q=p.localStream.hasAudio();return (("_1qmp")+(q?' '+"_1qmq":''));},render:function(){var p=this.props.callModel,q=h('/images/chat/webrtc/expand.png'),r=h('/images/chat/webrtc/minimize.png'),s=h('/images/chat/webrtc/mic_mute_overlay.png');return (i.createElement("div",{className:this.outerClasses(p)},i.createElement("button",{onClick:this.toggleSelfView,className:"_1qms"},i.createElement(j,{src:q,className:this.toggleClass(!p.selfViewOpen),alt:"hide self view"}),i.createElement(j,{src:r,className:this.toggleClass(p.selfViewOpen),alt:"hide self view"})),i.createElement("div",{className:this.wrapperClasses(p)},i.createElement(n,{callModel:p}),i.createElement("div",{className:this.overlayClasses(p)},i.createElement(j,{src:s,alt:"muted"})),i.createElement(l,{muted:true,stream:p.localStream}))));}});e.exports=o;},null);
__d("FBRTCInCallView.react",["React","cx","FBRTCSelfView.react","FBRTCVideo.react","FBRTCCallModel"],function(a,b,c,d,e,f,g,h,i,j,k){var l=g.createClass({displayName:"FBRTCInCallView",_videoIsMuted:function(){var m=this.props.callModel.remoteStream;return m&&!m.hasVideo();},_containerClasses:function(m){var n=m===k.UIState.CALL_CONNECTED,o=m===k.UIState.CALL_ENDED;return (("_mdl")+(n||o?' '+"_mdm":'')+(n?' '+"_mdn":'')+(o?' '+"_2m5f":''));},_wrapperClasses:function(){var m=this._videoIsMuted();return (("_2tvg")+(m?' '+"_mdo":''));},render:function(){var m=this.props.callModel,n=this.props.publishFn;if(m.remoteStream.hasStream()){var o=m.uiState;return (g.createElement("div",{className:this._containerClasses(o)},g.createElement("div",{className:this._wrapperClasses()},g.createElement("div",{className:"_mdt"},g.createElement(j,{stream:m.remoteStream}))),g.createElement(i,{callModel:m,publishFn:n})));}else return g.createElement("div",{className:"_hgl"});}});e.exports=l;},null);
__d("FBRTCCallStateInfo.react",["React","cx","fbt","Image.react","XUISpinner.react","XUIOverlayButton.react","FBRTCCallModel","FBRTCCallTimer.react","FBRTCConstants"],function(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o){var p=function(s,t){switch(s){case o.CallEndReason.NO_ANSWER_TIMEOUT:case o.CallEndReason.IGNORE_CALL:return "No Answer";case o.CallEndReason.INCOMING_TIMEOUT:case o.CallEndReason.NO_PERMISSION:case o.CallEndReason.OTHER_NOT_CAPABLE:case o.CallEndReason.OTHER_CARRIER_BLOCKED:return "Not Reachable";case o.CallEndReason.SIGNALING_MESSAGE_FAILED:case o.CallEndReason.WEBRTC_ERROR:case o.CallEndReason.NO_UI_ERROR:case o.CallEndReason.UNSUPPORTED_VERSION:case o.CallEndReason.CALLER_NOT_VISIBLE:case o.CallEndReason.CLIENT_ERROR:return "Call Failed";case o.CallEndReason.IN_ANOTHER_CALL:return "In Another Call";case o.CallEndReason.CARRIER_BLOCKED:return "Switch to Wi-Fi to complete your call";case o.CallEndReason.CLIENT_INTERRUPTED:return "Call Interrupted";case o.CallEndReason.HANGUP_CALL:case o.CallEndReason.ACCEPT_AFTER_HANGUP:return "Call Ended";case o.CallEndReason.CONNECTION_DROPPED:return "Connection Lost";case o.CallEndReason.OTHER_INSTANCE_HANDLED:return '';default:return '';}},q=function(s){switch(s.uiState){case m.UIState.INIT:case m.UIState.PENDING_LOCAL_MEDIA:case m.UIState.MORE_INIT:case m.UIState.USER_MEDIA_DENIED:return (g.createElement(k,{background:"dark",size:"large"}));case m.UIState.CONTACTING:return "Contacting...";case m.UIState.RINGING:return "Ringing...";case m.UIState.CALL_CONNECTING:return "Connecting...";case m.UIState.CALL_CONNECTED:return s.peerName();case m.UIState.CALL_ENDED:return p(s.endCallReason,s.isRemoteEnded);default:return '';}},r=g.createClass({displayName:"FBRTCCallStateInfo",revealContainer:function(){var s="_4j_h",t=document.getElementsByClassName(s)[0];if(t)t.className=s;},onCloseButtonClicked:function(s){window.close();return;},componentDidMount:function(){setTimeout(function(){this.revealContainer();}.bind(this),2000);},render:function(){var s=this.props.callModel,t=q(s);return (g.createElement("div",{className:"_4j_i"},this.renderPeerImage(s),g.createElement("p",{className:"_4j_k"},t),this.renderCallStateTimer(s),this.renderCloseWindowButton()));},renderCallStateTimer:function(s){if(s.uiState===m.UIState.CALL_CONNECTED)return g.createElement(n,null);},renderPeerImage:function(s){if(s.peerPicUrl())return (g.createElement(j,{className:"_4j_j",src:s.peerPicUrl(),alt:"profile pic",onLoad:this.revealContainer,onError:this.revealContainer}));return '';},shouldRenderCloseButton:function(){var s=this.props.callModel;return s.uiState===m.UIState.CALL_ENDED&&(!s.wasConnected||s.endCallReason!==o.CallEndReason.HANGUP_CALL);},renderCloseWindowButton:function(){if(this.shouldRenderCloseButton()){return (g.createElement(l,{className:"_1-7l",label:"Close Window",onClick:this.onCloseButtonClicked}));}else return '';}});e.exports=r;},null);
__d("FBRTCCallControls.react",["cx","fbt","React","ReactLayeredComponentMixin","XUIContextualDialog.react","XUIContextualDialogBody.react","XUIContextualDialogTitle.react","LayerFadeOnHide","LayerFadeOnShow","FBRTCCallModel","FBRTCConstants","FBRTCStruct"],function(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r){var s=10000,t=new r(['READY','SHOWN','COMPLETE']),u=function(x,y,z){var aa=(!y||x===p.UIState.CALL_ENDED);return (("_hgk")+(aa?' '+"_hgl":'')+(z===t.SHOWN?' '+"_2727":''));},v=function(x,y,z,aa){return ((x?"_hgm":'')+(' '+"_hgn")+(y?' '+"_hgp":'')+(z?' '+"_hgq":'')+(aa?' '+"_hgr":''));},w=i.createClass({displayName:"FBRTCCallControls",mixins:[j],getInitialState:function(){return {forceVisible:t.READY};},_shouldForceVisible:function(x){var y=x.localStream;return x.videoIsAutoDisabled()||(y.hasStream()&&!y.hasVideoTracks());},componentWillReceiveProps:function(x){if(this._shouldForceVisible(x.callModel)){if(this.state.forceVisible===t.READY){this.setState({forceVisible:t.SHOWN});setTimeout(function(){this.setState({forceVisible:t.COMPLETE});}.bind(this),s);}}else if(this.state.forceVisible===t.SHOWN)this.setState({forceVisible:t.COMPLETE});},_popoverProps:function(){var x={contextRef:'videoButton',position:'above',alignment:'left',width:255,hoverContext:this.refs.videoButton.getDOMNode(),behaviors:{LayerFadeOnHide:n,LayerFadeOnShow:o}};if(this.state.forceVisible===t.SHOWN)x.shown=true;return x;},renderLayers:function(){var x,y={};if(!this.props.callModel.localStream.hasVideoTracks()){x=(i.createElement(k,i.__spread({},this._popoverProps()),i.createElement(m,null,"Can't Find Camera"),i.createElement(l,null,"Connect your camera and refresh the page to turn on video.")));}else if(this.props.callModel.videoIsAutoDisabled())x=(i.createElement(k,i.__spread({},this._popoverProps()),i.createElement(l,null,"Video is paused because the connection is slow.")));if(x)y.videoPopover=x;return y;},toggleMuteAudio:function(x){this.props.publishFn(q.UIEventType.TOGGLE_MUTE_AUDIO,x);},toggleMuteVideo:function(x){this.props.publishFn(q.UIEventType.TOGGLE_MUTE_VIDEO,x);},toggleFullScreen:function(x){this.props.publishFn(q.UIEventType.TOGGLE_FULL_SCREEN,x);},endCall:function(x){this.props.publishFn(q.UIEventType.HANG_UP,x);},render:function(){var x=this.props.callModel.uiState,y=this.props.callModel.localStream.hasStream(),z=!this.props.callModel.localStream.hasVideo(),aa=!this.props.callModel.localStream.hasAudio(),ba=this.props.callModel.isFullScreen(),ca=v(z,true,false,false),da=v(aa,false,false,false),ea=v(false,false,false,true),fa=v(false,false,true,false),ga=u(x,y,this.state.forceVisible);return (i.createElement("div",{className:ga},i.createElement("button",{onClick:this.toggleMuteVideo,className:ca,ref:"videoButton"},i.createElement("i",{className:(("_qor")+(!z?' '+"_qos":'')+(z?' '+"_qot":''))})),i.createElement("button",{onClick:this.toggleMuteAudio,className:da},i.createElement("i",{className:(("_qor")+(!aa?' '+"_qou":'')+(aa?' '+"_qov":''))})),i.createElement("button",{onClick:this.endCall,className:ea},i.createElement("i",{className:"_qor _hgs"}),i.createElement("i",{className:"_qor _hgt"})),i.createElement("button",{onClick:this.toggleFullScreen,className:fa},i.createElement("i",{className:(("_qor")+(!ba?' '+"_qow":'')+(ba?' '+"_qox":''))}))));}});e.exports=w;},null);
__d("FBRTCFeedbackCompleteView.react",["cx","fbt","React","XUIOverlayButton.react","FBRTCFadeInMixin"],function(a,b,c,d,e,f,g,h,i,j,k){var l=i.createClass({displayName:"FBRTCFeedbackCompleteView",mixins:[k],onCallBackButtonClicked:function(){return;},onCloseButtonClicked:function(){window.close();return;},messageString:function(){if(this.props.skipped)return "Your call has ended";return "Thank you for your feedback!";},render:function(){return (i.createElement("div",{className:"_1-7k"},i.createElement("p",{className:"_4j_k"},this.messageString()),i.createElement("div",null,i.createElement(j,{className:"_1-7l",label:"Close Window",onClick:this.onCloseButtonClicked}))));}});e.exports=l;},null);
__d("FBRTCFeedbackView.react",["cx","fbt","React","XUIOverlayButton.react","FBRTCConstants","FBRTCFadeInMixin","FBRTCFeedbackCompleteView.react"],function(a,b,c,d,e,f,g,h,i,j,k,l,m){var n=i.createClass({displayName:"FBRTCFeedbackView",mixins:[l],getInitialState:function(){return {submitted:false,skipped:false,feedbackText:''};},onSubmitButtonClicked:function(){if(this.canSubmitFeedback()){this.setState({submitted:true});this.props.publishFn(k.UIEventType.SUBMIT_FEEDBACK,this.state.feedbackText);}},onNotNowClicked:function(){this.setState({skipped:true,submitted:true});return;},canSubmitFeedback:function(){return this.state.feedbackText!=='';},feedbackChanged:function(o){this.setState({feedbackText:o.target.value});o.preventDefault();},render:function(){if(this.state.submitted)return i.createElement(m,{skipped:this.state.skipped});return (i.createElement("div",{className:"_1-7k"},i.createElement("p",{className:"_4j_k"},"Give Feedback"),i.createElement("div",{className:"_4ru1"},i.createElement("label",{htmlFor:"fbwebrtcfeedback",className:"_4j_k _4ru2"},"What was the worst problem you experienced?"),i.createElement("textarea",{className:"_4ru3",id:"fbwebrtcfeedback",rows:"4",onChange:this.feedbackChanged,placeholder:"Enter your feedback"}),i.createElement("div",{className:"_s97"},i.createElement(j,{className:"_1-7l",label:"Submit",disabled:!this.canSubmitFeedback(),onClick:this.onSubmitButtonClicked}),i.createElement(j,{className:"_1-7l",label:"Not Now",onClick:this.onNotNowClicked})))));}});e.exports=n;},null);
__d("FBRTCStarRatingView.react",["cx","fbt","FBRTCConstants","FBRTCFadeInMixin","React","StarsInput.react","XUIOverlayButton.react","FBRTCFeedbackCompleteView.react","FBRTCFeedbackView.react"],function(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o){var p=k.createClass({displayName:"FBRTCStarRatingView",mixins:[j],getInitialState:function(){return {rating:0,submitted:false,skipped:false,feedbackText:''};},onCallBackButtonClicked:function(){return;},onCloseButtonClicked:function(){window.close();return;},onStarClicked:function(q){this.setState({rating:q});},onSubmitButtonClicked:function(){if(this.state.rating>0){this.setState({submitted:true});this.props.publishFn(i.UIEventType.SUBMIT_STAR_RATING,this.state.rating);}},onNotNowClicked:function(){this.setState({skipped:true,submitted:true});return;},getRatingString:function(){switch(this.state.rating){case 1:return "Poor";case 2:return "Fair";case 3:return "Good";case 4:return "Very Good";case 5:return "Excellent";default:return '---';}},shouldAskForFeedback:function(){return this.state.rating===1&&this.state.submitted&&!this.state.skipped;},render:function(){if(this.shouldAskForFeedback()){return k.createElement(o,{publishFn:this.props.publishFn});}else if(this.state.submitted)return k.createElement(n,{skipped:this.state.skipped});var q=this.getRatingString();return (k.createElement("div",{className:"_1-7k"},k.createElement("p",{className:"_4j_k"},"Please rate the quality of your video call"),k.createElement("p",{className:"_4j_k _a16"},q),k.createElement(l,{allowMultipleSubmissions:true,onClick:this.onStarClicked}),k.createElement("div",{className:"_s97"},k.createElement(m,{className:"_1-7l",label:"Not Now",onClick:this.onNotNowClicked}),k.createElement(m,{className:"_1-7l",label:"Submit",disabled:this.state.rating===0,onClick:this.onSubmitButtonClicked}))));}});e.exports=p;},null);
__d("FBRTCMediaAccessPrompt.react",["React","cx","fbt","UserAgent","Link.react","XUIText.react","FBRTCCallModel","FBRTCConfig"],function(a,b,c,d,e,f,g,h,i,j,k,l,m,n){var o=g.createClass({displayName:"FBRTCMediaAccessPrompt",isVisible:function(p){return (j.isBrowser('Chrome')||j.isBrowser('Firefox'))&&p===m.UIState.PENDING_LOCAL_MEDIA;},componentWillUpdate:function(p,q){var r=p.callModel.uiState;if(this.isVisible(r)){clearTimeout(this.timeout);this.getDOMNode().style.display='block';}},componentDidUpdate:function(p,q){var r=this.props.callModel.uiState;if(!this.isVisible(r))this.timeout=setTimeout(function(){this.getDOMNode().style.display='none';}.bind(this),500);},componentWillUnmount:function(){clearTimeout(this.timeout);},dialogTitle:function(){if(j.isBrowser('Chrome')){return "Click \"Allow\" to Make a Call";}else return "Click the camera and choose \"Share Selected Devices\"";},dialogBody:function(){return "To make a video call on Facebook, you need to turn on your camera and microphone. This will let your friend see and hear you during the call. You can always turn these off later.";},learnMoreLink:function(){return (g.createElement(k,{href:n.userMediaPermissionErrorUrl(),target:"_blank"},"Learn more"));},render:function(){var p=this.props.callModel.uiState;return (g.createElement("div",{className:(("_250-")+(!this.isVisible(p)?' '+"_250_":''))},g.createElement("i",{className:"_2510"}),g.createElement("i",{className:"_2511"}),g.createElement("div",{className:"_2514"},g.createElement("h1",{className:"_2515"},this.dialogTitle()),g.createElement(l,{size:"small",display:"block"},this.dialogBody()," ",this.learnMoreLink()))));}});e.exports=o;},null);
__d("FBRTCMediaDeniedPrompt.react",["React","cx","fbt","UserAgent","XUIContextualDialog.react","XUIContextualDialogBody.react","XUIContextualDialogTitle.react","ReactLayeredComponentMixin","FBRTCCallModel"],function(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o){var p=g.createClass({displayName:"FBRTCMediaDeniedPrompt",mixins:[n],showDialog:function(){var q=this.props.callModel;return q.uiState===o.UIState.USER_MEDIA_DENIED;},arrowAlignment:function(){return j.isBrowser('Chrome')?'right':'left';},dialogTitle:function(){return "Click to Turn on Camera\/Microphone";},dialogBody:function(){return "To use video calling, you need to turn on your camera and microphone during the call.";},renderLayers:function(){return {popover:(g.createElement(k,{contextRef:"mpTarget",shown:this.showDialog(),position:"below",alignment:this.arrowAlignment(),width:k.WIDTH.NORMAL},g.createElement(m,null,this.dialogTitle()),g.createElement(l,null,this.dialogBody())))};},render:function(){return (g.createElement("div",{className:"_3wrz",ref:"mpTarget"}));}});e.exports=p;},null);
__d("FBRTCBackgroundView.react",["React","Image.react","cx"],function(a,b,c,d,e,f,g,h,i){var j=g.createClass({displayName:"FBRTCBackgroundView",getInitialState:function(){return {showCoverPhoto:true};},imageError:function(){this.setState({showCoverPhoto:false});},render:function(){var k=this.props.callModel.backgroundUrl();if(this.state.showCoverPhoto&&k){return (g.createElement("div",{className:"_6qv"},g.createElement("div",{className:"_6qw"}),g.createElement(h,{src:k,className:"_6q_",alt:"",onError:this.imageError})));}else return g.createElement("div",{className:"_6qv"});}});e.exports=j;},null);
__d("FBRTCView.react",["React","cx","ix","Image.react","FBRTCInCallView.react","FBRTCCallStateInfo.react","FBRTCCallControls.react","FBRTCStarRatingView.react","FBRTCStreamWrapper","FBRTCMediaAccessPrompt.react","FBRTCMediaDeniedPrompt.react","FBRTCCallModel","FBRTCBackgroundView.react"],function(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s){var t=g.createClass({displayName:"FBRTCView",_aspectRatioClass:function(u){var v=u.remoteStream.aspectRatio===o.aspectRatios['16:9'];return (("_mdp")+(!v?' '+"_mdq":'')+(v?' '+"_mds":''));},render:function(){var u=this.props.callModel,v=this.props.publishFn;if(u.uiState===r.UIState.COLLECT_RATING){return (g.createElement("div",{className:"_3ref"},g.createElement("div",{className:this._aspectRatioClass(u)},g.createElement(s,{callModel:u}),g.createElement(j,{src:i('/images/chat/webrtc/facebook_logo.png'),className:"_263g",alt:"Facebook"}),g.createElement(n,{publishFn:v}))));}else return (g.createElement("div",{className:"_3ref"},g.createElement(p,{callModel:u}),g.createElement(q,{callModel:u}),g.createElement(l,{callModel:u}),g.createElement("div",{className:this._aspectRatioClass(u)},g.createElement(s,{callModel:u}),g.createElement(j,{src:i('/images/chat/webrtc/facebook_logo.png'),className:"_263g",alt:"Facebook"}),g.createElement(k,{callModel:u,publishFn:v}),g.createElement(m,{callModel:u,publishFn:v}))));}});e.exports=t;},null);
__d("FBRTCViewController",["React","FBRTCCallModel","FBRTCConstants","FBRTCFullScreenController","FBRTCLogger","FBRTCRingback","FBRTCView.react"],function(a,b,c,d,e,f,g,h,i,j,k,l,m){var n=500;function o(p,q,r){"use strict";this.$FBRTCViewController0=p;this.$FBRTCViewController1=q;this.$FBRTCViewController2=r;this.$FBRTCViewController3=false;this.$FBRTCViewController4=k.getInstance();}o.prototype.init=function(){"use strict";var p=this;this.$FBRTCViewController0.addListener('changed',function(s){if(s===h.UIState.COLLECT_RATING)p.$FBRTCViewController5();p.$FBRTCViewController6();});l.monitorCallModel(this.$FBRTCViewController0);var q=this.$FBRTCViewController6.bind(this);j.onFullScreenChange(q);this.$FBRTCViewController0.fetchPeerInfo();this.$FBRTCViewController6();var r=this.$FBRTCViewController0;setTimeout(function(){r.setStateFrom(h.UIState.INIT,h.UIState.PENDING_LOCAL_MEDIA);},n);};o.prototype.onLocalStreamReady=function(p){"use strict";this.$FBRTCViewController0.setLocalStream(p);if(this.$FBRTCViewController0.uiState>h.UIState.MORE_INIT){this.$FBRTCViewController4.logInfo(this.$FBRTCViewController0.peerID,this.$FBRTCViewController0.callID,'UI: Already @ MORE_INIT, no update');}else if(this.$FBRTCViewController0.canStartCall()&&!this.$FBRTCViewController0.isCaller){this.$FBRTCViewController0.setState(h.UIState.CALL_CONNECTING);}else this.$FBRTCViewController0.setState(h.UIState.MORE_INIT);};o.prototype.userMediaGranted=function(){"use strict";this.$FBRTCViewController0.setState(h.UIState.MORE_INIT);};o.prototype.userMediaDenied=function(){"use strict";this.$FBRTCViewController0.setState(h.UIState.USER_MEDIA_DENIED);};o.prototype.onTurnCredentialsReady=function(p){"use strict";if(!this.$FBRTCViewController0.isCaller)this.$FBRTCViewController0.setStateFrom(h.UIState.MORE_INIT,h.UIState.CALL_CONNECTING);};o.prototype.onMessageTypeSent=function(p){"use strict";if(p!==i.PayloadType.OFFER&&p!==i.PayloadType.ICERESTART_OFFER)return;if(p===i.PayloadType.ICERESTART_OFFER)this.$FBRTCViewController3=true;this.$FBRTCViewController0.setState(h.UIState.CONTACTING);};o.prototype.onMessageTypeReceived=function(p){"use strict";if(this.$FBRTCViewController3){if(p===i.PayloadType.ANSWER)this.$FBRTCViewController0.setStateFrom(h.UIState.CONTACTING,h.UIState.CALL_CONNECTING);}else if(p===i.PayloadType.OFFER_ACK){this.$FBRTCViewController0.setStateFrom(h.UIState.CONTACTING,h.UIState.RINGING);}else if(p===i.PayloadType.ANSWER)if(this.$FBRTCViewController0.uiState===h.UIState.CONTACTING||this.$FBRTCViewController0.uiState===h.UIState.RINGING)this.$FBRTCViewController0.setState(h.UIState.CALL_CONNECTING);};o.prototype.onRemoteStreamAdded=function(event){"use strict";this.$FBRTCViewController0.setRemoteStream(event.stream);var p=this;this.$FBRTCViewController0.remoteStream.addListener('streamStarted',function(){p.$FBRTCViewController0.setStateFrom(h.UIState.CALL_CONNECTING,h.UIState.CALL_CONNECTED);});this.$FBRTCViewController0.remoteStream.addListener('tracksChanged',function(){p.$FBRTCViewController6();});this.$FBRTCViewController6();};o.prototype.end=function(p,q){"use strict";this.$FBRTCViewController0.endCallReason=p;this.$FBRTCViewController0.isRemoteEnded=q;this.$FBRTCViewController0.setState(h.UIState.CALL_ENDED);};o.prototype.reset=function(p,q){"use strict";this.$FBRTCViewController0.resetForReconnect(p);this.$FBRTCViewController1=q;this.$FBRTCViewController0.setState(h.UIState.CALL_CONNECTING);};o.prototype.$FBRTCViewController7=function(p,q){"use strict";switch(p){case i.UIEventType.HANG_UP:this.$FBRTCViewController8(q);break;case i.UIEventType.TOGGLE_MUTE_AUDIO:this.$FBRTCViewController9(q);break;case i.UIEventType.TOGGLE_MUTE_VIDEO:this.$FBRTCViewControllera(q);break;case i.UIEventType.TOGGLE_FULL_SCREEN:this.$FBRTCViewControllerb(q);break;case i.UIEventType.TOGGLE_SELF_VIEW:this.$FBRTCViewControllerc(q);break;case i.UIEventType.SUBMIT_STAR_RATING:this.$FBRTCViewControllerd(q);break;case i.UIEventType.SUBMIT_FEEDBACK:this.$FBRTCViewControllere(q);break;default:break;}};o.prototype.$FBRTCViewController8=function(p){"use strict";if(this.onHangup)this.onHangup();};o.prototype.$FBRTCViewController9=function(p){"use strict";this.$FBRTCViewController0.localStream.toggleMuteAudio();this.$FBRTCViewController6();this.$FBRTCViewControllerf(k.CallAction.SET_MUTE,!this.$FBRTCViewController0.localStream.hasAudio());};o.prototype.$FBRTCViewControllera=function(p){"use strict";this.$FBRTCViewController0.localStream.toggleMuteVideo();this.$FBRTCViewControllerf(k.CallAction.SET_VIDEO_ON,this.$FBRTCViewController0.localStream.hasVideo());};o.prototype.$FBRTCViewControllerb=function(p){"use strict";j.toggleFullScreen();this.$FBRTCViewControllerf(k.CallAction.SET_FULLSCREEN_ON,j.isFullScreen());};o.prototype.$FBRTCViewControllerc=function(p){"use strict";this.$FBRTCViewController0.selfViewOpen=!this.$FBRTCViewController0.selfViewOpen;this.$FBRTCViewController6();this.$FBRTCViewControllerf(k.CallAction.SET_SELF_VIEW_ON,this.$FBRTCViewController0.selfViewOpen);};o.prototype.$FBRTCViewController5=function(){"use strict";this.$FBRTCViewController1.addExtraInfo(k.Key.RATING_SHOWN,'1');this.$FBRTCViewController1.save(this.$FBRTCViewController2);};o.prototype.$FBRTCViewControllerd=function(p){"use strict";if(p<1||p>5){this.$FBRTCViewControllerg(this.$FBRTCViewController0.peerID,this.$FBRTCViewController0.callID,'Bad rating: '+p);return;}this.$FBRTCViewController1.addExtraInfo(k.Key.RATING,p);this.$FBRTCViewController1.save(this.$FBRTCViewController2);};o.prototype.$FBRTCViewControllere=function(p){"use strict";this.$FBRTCViewController1.addExtraInfo(k.Key.SURVEY_DETAILS,p);this.$FBRTCViewController1.save(this.$FBRTCViewController2);};o.prototype.$FBRTCViewControllerf=function(p,q){"use strict";this.$FBRTCViewController4.logCallAction(this.$FBRTCViewController0.peerID,this.$FBRTCViewController0.callID,p,q?'true':'false');};o.prototype.$FBRTCViewController6=function(){"use strict";if(this.$FBRTCViewController0.invalidated)return;var p=document.getElementById('fbRTC/container');g.render(g.createElement(m,{callModel:this.$FBRTCViewController0,publishFn:this.$FBRTCViewController7.bind(this)}),p);};e.exports=o;},null);
__d("FBRTCCallModelStatePusher",["FBRTCCallModel","FBRTCConstants"],function(a,b,c,d,e,f,g,h){function i(j){"use strict";this.$FBRTCCallModelStatePusher0=j;this.$FBRTCCallModelStatePusher0.addListener('changed',this.$FBRTCCallModelStatePusher1.bind(this));}i.prototype.$FBRTCCallModelStatePusher2=function(){"use strict";return this.$FBRTCCallModelStatePusher0.uiState===g.UIState.CALL_ENDED&&this.$FBRTCCallModelStatePusher0.wasConnected&&this.$FBRTCCallModelStatePusher0.endCallReason===h.CallEndReason.HANGUP_CALL;};i.prototype.$FBRTCCallModelStatePusher1=function(){"use strict";if(this.$FBRTCCallModelStatePusher2())this.$FBRTCCallModelStatePusher3(3000,g.UIState.CALL_ENDED,g.UIState.COLLECT_RATING);};i.prototype.$FBRTCCallModelStatePusher3=function(j,k,l){"use strict";var m=this.$FBRTCCallModelStatePusher0;setTimeout(function(){m.setStateFrom(k,l);},j);};e.exports=i;},null);
__d("FBRTCMediaAccessErrorDialog.react",["React","fbt","Link.react","XUIDialog.react","XUIDialogBody.react","XUIDialogFooter.react","XUIDialogTitle.react","FBRTCConfig"],function(a,b,c,d,e,f,g,h,i,j,k,l,m,n){var o=g.createClass({displayName:"FBRTCMediaAccessErrorDialog",render:function(){return (g.createElement(j,{shown:true,width:440,layerHideOnBlur:false},g.createElement(m,{showCloseButton:false},g.createElement("span",null,"Can't Make Call")),g.createElement(k,null,this._dialogBody()),g.createElement(l,{leftContent:this._footerContent()})));},_dialogBody:function(){return (g.createElement("p",null,"Connect a camera and a microphone to make a call. If they're already connected, try restarting your browser and closing any other applications that use a camera or microphone."));},_footerContent:function(){return (g.createElement("span",null,h._("Still need help? See our {troubleShootingGuideLink}",[h.param("troubleShootingGuideLink",g.createElement(i,{href:n.userMediaErrorUrl(),target:"_blank"},"Troubleshooting Guide"))])));}});e.exports=o;},null);
__d("FBRTCPeerBrowserUnsupportedDialog.react",["React","fbt","Link.react","XUIDialog.react","XUIDialogBody.react","XUIDialogFooter.react","XUIDialogTitle.react","FBRTCConfig"],function(a,b,c,d,e,f,g,h,i,j,k,l,m,n){var o=g.createClass({displayName:"FBRTCPeerBrowserUnsupportedDialog",render:function(){return (g.createElement(j,{shown:true,width:440},g.createElement(m,{showCloseButton:true},g.createElement("span",null,"Failed to Connect Call")),g.createElement(k,null,this._dialogBody()),g.createElement(l,{leftContent:this._footerContent()})));},_dialogBody:function(){var p=this.props.peerName;return (g.createElement("p",null,h._("We were not able to connect your call because {name} is using a browser that does not support our video calling feature.",[h.param("name",p)])));},_footerContent:function(){return (g.createElement("span",null,h._("Still need help? See our {troubleShootingGuideLink}",[h.param("troubleShootingGuideLink",g.createElement(i,{href:n.unsupportedBrowserUrl(),target:"_blank"},"Troubleshooting Guide"))])));}});e.exports=o;},null);
__d("FBRTCCallDialogController",["React","ReactLayeredComponentMixin","FBRTCStruct","FBRTCMediaAccessErrorDialog.react","FBRTCPeerBrowserUnsupportedDialog.react"],function(a,b,c,d,e,f,g,h,i,j,k){var l=new i(['ERROR_ACCESSING_MEDIA','PEER_BROWSER_UNSUPPORTED']),m=g.createClass({displayName:"DialogOwner",mixins:[h],renderLayers:function(){if(this.props.dialogType===l.ERROR_ACCESSING_MEDIA)return {dialog:g.createElement(j,null)};if(this.props.dialogType===l.PEER_BROWSER_UNSUPPORTED){var o=this.props.callModel.peerName();return {dialog:g.createElement(k,{peerName:o})};}return {};},render:function(){return g.createElement("div",null);}}),n={dialogTypes:l,setDialogContainer:function(o){this.container=o;this.currentDialogType=null;this.callModel=null;this._render();},showDialog:function(o,p){this.currentDialogType=o;this.callModel=p;this._render();},hideDialog:function(){this.currentDialogType=null;this._render();},_render:function(){g.render(g.createElement(m,{dialogType:this.currentDialogType,callModel:this.callModel}),this.container);}};e.exports=n;},null);
__d("FBRTCRetriableMessage",["mixInEventEmitter","FBRTCConstants"],function(a,b,c,d,e,f,g,h){var i=10000,j=7000,k=1;function l(m){"use strict";this.$FBRTCRetriableMessage0=m;this.$FBRTCRetriableMessage1=i;this.$FBRTCRetriableMessage2=k;this.$FBRTCRetriableMessage3=null;this.$FBRTCRetriableMessage4=null;}l.prototype.sendMessage=function(m,n,o,p,q){"use strict";switch(m){case h.PayloadType.ICERESTART_OFFER:this.$FBRTCRetriableMessage3=this.$FBRTCRetriableMessage0.sendIcerestartOffer(n,o,p);break;case h.PayloadType.OFFER:this.$FBRTCRetriableMessage3=this.$FBRTCRetriableMessage0.sendOffer(n,o,p,q);break;case h.PayloadType.ANSWER:this.$FBRTCRetriableMessage1=j;this.$FBRTCRetriableMessage3=this.$FBRTCRetriableMessage0.sendAnswer(n,o,p,q);break;}this.$FBRTCRetriableMessage5();};l.prototype.stopRetrying=function(){"use strict";if(this.$FBRTCRetriableMessage4){clearTimeout(this.$FBRTCRetriableMessage4);this.$FBRTCRetriableMessage4=null;}};l.prototype.$FBRTCRetriableMessage5=function(){"use strict";this.$FBRTCRetriableMessage4=setTimeout(this.$FBRTCRetriableMessage6.bind(this),this.$FBRTCRetriableMessage1);};l.prototype.$FBRTCRetriableMessage6=function(){"use strict";if(this.$FBRTCRetriableMessage2<1){this.emit('timeoutFailure');}else{this.emit('sendingRetry');this.$FBRTCRetriableMessage3();this.$FBRTCRetriableMessage5();this.$FBRTCRetriableMessage2-=1;}};g(l,{sendingRetry:true,timeoutFailure:true});e.exports=l;},null);
__d("FBRTCWindowManager",[],function(a,b,c,d,e,f){var g={init:function(h,i){this._window=h;this._callModel=i;i.addListener('changed',this._setProgressIndicator,this);this._setProgressIndicator();this._monitorOpenerForChanges();},_setProgressIndicator:function(){if(this._callModel.isEnded()){this._window.rtcCallInProgessWith=null;}else this._window.rtcCallInProgessWith=this._callModel.peerID.toString();},_monitorOpenerForChanges:function(){if(this._window.opener)this._window.opener.addEventListener("unload",function(event){this._passWindowToOpener(10);}.bind(this));},_passWindowToOpener:function(h){setTimeout(function(){setTimeout(function(){if(this._window.opener&&!this._window.opener.closed)this._window.opener.rtcCallChildWindow=this._window;}.bind(this),1);if(h>1)this._passWindowToOpener(h-1);}.bind(this),1000);}};e.exports=g;},null);
__d("FBRTCCallController",["ErrorUtils","MissedVideoCallHandler","Run","VideoCallCore","VideoCallSupport","FBRTCCallConnection","FBRTCCallConnectionMonitor","FBRTCCallModel","FBRTCCallMonitor","FBRTCCallSummary","FBRTCCallSummaryStore","FBRTCConfig","FBRTCConstants","FBRTCExperiments","FBRTCIceCache","FBRTCLocalMessageQueue","FBRTCLogger","FBRTCMessageDedup","FBRTCMessageUtils","FBRTCMessageSender","FBRTCPCConfig","FBRTCTurnDiscovery","FBRTCUserMedia","FBRTCViewController","FBRTCCallModelStatePusher","FBRTCCallDialogController","FBRTCRetriableMessage","FBRTCUserMediaRequest","FBRTCWindowManager","emptyFunction","fbt","randomInt","AvailableList"],function(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v,w,x,y,z,aa,ba,ca,da,ea,fa,ga,ha,ia,ja,ka,la){b('AvailableList');var ma=60000;function na(){return la(0,4294967295);}oa.startCall=function(pa,qa,ra){"use strict";var sa=w.getInstance();sa.logInfo(pa,qa,'Starting Call Controller');document.documentElement.style.overflow='hidden';if(!k.isWebrtcSupported()){sa.logError(pa,qa,'Webrtc not supported');}else new oa(pa,qa,ra);};function oa(pa,qa,ra){"use strict";this.$FBRTCCallController0=w.getInstance();this.$FBRTCCallController1=new v();this.$FBRTCCallController2=q.getInstance();this.$FBRTCCallController3=null;this.$FBRTCCallController4=false;if(!ra){this.$FBRTCCallController3=this.$FBRTCCallController1.getOffer(pa);if(this.$FBRTCCallController3){x.check(pa,this.$FBRTCCallController3.call_id,this.$FBRTCCallController3.msg_id);}else{ra=true;this.$FBRTCCallController4=true;}}if(!qa)qa=this.$FBRTCCallController3?this.$FBRTCCallController3.call_id:na();this.$FBRTCCallController0.logCallAction(pa,qa,w.CallAction.POPUP_OPENED);this.$FBRTCCallController5=new n({peerID:pa,callID:qa,isCaller:ra});this.$FBRTCCallController6=new ea(this.$FBRTCCallController5);this.$FBRTCCallController7=p.restoreOrInitialize(this.$FBRTCCallController2,pa,qa,ra,this.$FBRTCCallController3);this.$FBRTCCallController7.onPopupOpened();ia.init(window,this.$FBRTCCallController5);this.$FBRTCCallController8=new da(this.$FBRTCCallController5,this.$FBRTCCallController7,this.$FBRTCCallController2);this.$FBRTCCallController8.onHangup=this.$FBRTCCallController9.bind(this,s.CallEndReason.HANGUP_CALL,false,true,false);this.$FBRTCCallController8.init();this.$FBRTCCallControllera=new l();this.$FBRTCCallControllera.addListener('remoteStreamAdded',this.$FBRTCCallController8.onRemoteStreamAdded,this.$FBRTCCallController8);this.$FBRTCCallControllera.addListener('offerSDPCreated',this.$FBRTCCallControllerb,this);this.$FBRTCCallControllera.addListener('answerSDPCreated',this.$FBRTCCallControllerc,this);this.$FBRTCCallControllera.addListener('localIceCandidateCreated',this.$FBRTCCallControllerd,this);this.$FBRTCCallControllera.addListener('remoteDescriptionSet',this.$FBRTCCallControllere,this);this.$FBRTCCallControllera.addListener('connected',this.$FBRTCCallControllerf,this);this.$FBRTCCallControllera.addListener('disconnected',this.$FBRTCCallControllerg,this);this.$FBRTCCallControllera.addListener('connectionUnstable',this.$FBRTCCallControllerh,this);this.$FBRTCCallControllera.addListener('connectionError',this.$FBRTCCallControlleri,this);this.$FBRTCCallControllerj=new m(this.$FBRTCCallControllera,this.$FBRTCCallController7);this.$FBRTCCallControllerj.addListener('connectionPoor',this.$FBRTCCallControllerk,this);this.$FBRTCCallControllerl=new z();this.$FBRTCCallControllerl.onMessageSent=this.$FBRTCCallControllerm.bind(this);this.$FBRTCCallControllerl.onSendFailure=this.$FBRTCCallControllern.bind(this);this.$FBRTCCallControllero=null;this.$FBRTCCallControllerp=null;this.$FBRTCCallControllerq();this.$FBRTCCallControllerr=new u();this.$FBRTCCallControllers=new u();this.$FBRTCCallControllert=false;i.onBeforeUnload(this.$FBRTCCallControlleru.bind(this),false);i.onUnload(this.$FBRTCCallControllerv.bind(this));g.addListener(this.$FBRTCCallControllerw.bind(this),true);h.setSuppressAll(true);j.setMessageHandler(ja);j.setRTCMessageHandler(this.$FBRTCCallControllerx.bind(this));var sa=this;this.$FBRTCCallControllery=new o(this.$FBRTCCallController5);this.$FBRTCCallControllery.startHeartbeat(function(){return sa.$FBRTCCallController7;});this.$FBRTCCallControllerz=null;ba.addListener('receivedTurnCreds',this.$FBRTCCallControllerA,this);ba.addListener('failed',this.$FBRTCCallControllerB,this);ba.requestTurnCreds(this.$FBRTCCallController5);}oa.prototype.$FBRTCCallControllerq=function(){"use strict";ca.addListener('streamReady',this.$FBRTCCallControllerC,this);ca.addListener('accessDenied',this.$FBRTCCallControllerD,this);ca.addListener('accessFailed',this.$FBRTCCallControllerE,this);ca.addListener('accessGranted',this.$FBRTCCallControllerF,this);var pa=r.shouldUseHdVideo(),qa=pa?ca.STREAM_TYPE.HD_VIDEO:ca.STREAM_TYPE.SD_VIDEO;ca.requestUserMedia(qa);this.$FBRTCCallController5.localStream.addListener('streamStarted',function(){var ra=this.$FBRTCCallController5.localStream.videoWidth,sa=this.$FBRTCCallController5.localStream.videoHeight;this.$FBRTCCallController7.setVideoCaptureStats(ra,sa);if((pa&&ra===ha.HD_WIDTH)||(!pa&&ra===ha.SD_WIDTH))t.logExposure(t.QE.VIDEO_QUALITY);}.bind(this));};oa.prototype.$FBRTCCallControllerh=function(){"use strict";this.$FBRTCCallController0.logInfo(this.$FBRTCCallController5.peerID,this.$FBRTCCallController5.callID,'Network unstable');};oa.prototype.$FBRTCCallControllerk=function(){"use strict";this.$FBRTCCallController0.logInfo(this.$FBRTCCallController5.peerID,this.$FBRTCCallController5.callID,'Network poor');t.logExposure(t.QE.AUTO_DISABLE);if(r.shouldAutoDisableVideo())this.$FBRTCCallController5.autoDisableVideo();};oa.prototype.$FBRTCCallControllerG=function(pa,qa){"use strict";var ra=[];if(pa)ra.push('peer_id='+pa.toString());if(qa)ra.push('call_id='+qa.toString());var sa='?'+ra.join('&'),ta=window.location.origin+window.location.pathname+sa;window.history.replaceState({},'',ta);};oa.prototype.$FBRTCCallControllerw=function(pa){"use strict";var qa=pa.message+'; '+pa.stackFrames[0].identifier;this.$FBRTCCallController0.logError(this.$FBRTCCallController5.peerID,this.$FBRTCCallController5.callID,'JSError: '+qa);};oa.prototype.$FBRTCCallControlleru=function(){"use strict";if(this.$FBRTCCallController5.isInProgress())return "Leaving this page will end your call.";};oa.prototype.$FBRTCCallControllerv=function(){"use strict";if(this.$FBRTCCallController5.isInProgress())if(this.$FBRTCCallControllerz){this.$FBRTCCallController9(s.CallEndReason.HANGUP_CALL,false,true,true);return;}if(!this.$FBRTCCallController5.isEnded()){var pa=this.$FBRTCCallController5.isUserMediaPending(),qa=this.$FBRTCCallController5.isUserMediaDenied(),ra=s.CallEndReason.HANGUP_CALL,sa='BrowserClosed';if(pa||qa){ra=s.CallEndReason.CLIENT_ERROR;sa=pa?'MediaPending':'MediaDenied';}this.$FBRTCCallController7.onCallEnded(ra,false,true,sa);this.$FBRTCCallController7.save(this.$FBRTCCallController2);}};oa.prototype.$FBRTCCallControllerA=function(pa){"use strict";this.$FBRTCCallController0.logInfo(this.$FBRTCCallController5.peerID,this.$FBRTCCallController5.callID,'Received Turn Creds');aa.setTurnCredentials(pa);this.$FBRTCCallController8.onTurnCredentialsReady(pa);this.$FBRTCCallControllerH();};oa.prototype.$FBRTCCallControllerB=function(){"use strict";this.$FBRTCCallController0.logError(this.$FBRTCCallController5.peerID,this.$FBRTCCallController5.callID,'Failed to get turn creds');this.$FBRTCCallController9(s.CallEndReason.CLIENT_ERROR,false,!this.$FBRTCCallController5.isCaller,false,'NoTurnCreds');};oa.prototype.$FBRTCCallControllerH=function(){"use strict";if(this.$FBRTCCallController5.canStartCall()){this.$FBRTCCallControllerG(this.$FBRTCCallController5.peerID,this.$FBRTCCallController5.callID);this.$FBRTCCallControllera.init(this.$FBRTCCallController5.localStream);if(!this.$FBRTCCallController3){this.$FBRTCCallControllera.createOffer();}else{if(this.$FBRTCCallController3.hasOwnProperty('videoon'))this.$FBRTCCallControllerI(this.$FBRTCCallController3.videoon);this.$FBRTCCallControllera.onReceivedOfferSDP(this.$FBRTCCallController3.sdp);this.$FBRTCCallController1.removeOffer(this.$FBRTCCallController5.peerID);this.$FBRTCCallController3=null;}this.$FBRTCCallController1.enableDequeuing(this.$FBRTCCallController5.peerID,this.$FBRTCCallControllerx.bind(this));}};oa.prototype.$FBRTCCallControllerC=function(pa){"use strict";this.$FBRTCCallController8.onLocalStreamReady(pa);this.$FBRTCCallController5.localStream.addListener('tracksChanged',this.$FBRTCCallControllerJ.bind(this));this.$FBRTCCallControllerH();};oa.prototype.$FBRTCCallControllerD=function(){"use strict";this.$FBRTCCallController0.logCallAction(this.$FBRTCCallController5.peerID,this.$FBRTCCallController5.callID,w.CallAction.DENIED_PERMISSION);this.$FBRTCCallController8.userMediaDenied();};oa.prototype.$FBRTCCallControllerE=function(pa){"use strict";this.$FBRTCCallController9(s.CallEndReason.CLIENT_ERROR,false,true,false,pa);fa.showDialog(fa.dialogTypes.ERROR_ACCESSING_MEDIA,this.$FBRTCCallController5);};oa.prototype.$FBRTCCallControllerF=function(){"use strict";this.$FBRTCCallController8.userMediaGranted();};oa.prototype.$FBRTCCallControllerb=function(pa){"use strict";var qa;if(!this.$FBRTCCallController4){qa=s.PayloadType.OFFER;}else{qa=s.PayloadType.ICERESTART_OFFER;this.$FBRTCCallController4=false;}this.$FBRTCCallControllero=new ga(this.$FBRTCCallControllerl);this.$FBRTCCallControllero.addListener('sendingRetry',this.$FBRTCCallControllerK.bind(this));this.$FBRTCCallControllero.addListener('timeoutFailure',this.$FBRTCCallControllerL.bind(this));this.$FBRTCCallControllero.sendMessage(qa,this.$FBRTCCallController5.peerID,this.$FBRTCCallController5.callID,pa,this.$FBRTCCallController5.localStream.hasVideo());this.$FBRTCCallControllerz=setTimeout(function(){this.$FBRTCCallController9(s.CallEndReason.NO_ANSWER_TIMEOUT,false,true,false);}.bind(this),ma);};oa.prototype.$FBRTCCallControllerL=function(){"use strict";var pa;if(this.$FBRTCCallController5.receivedNack){pa=s.CallEndReason.UNSUPPORTED_VERSION;fa.showDialog(fa.dialogTypes.PEER_BROWSER_UNSUPPORTED,this.$FBRTCCallController5);}else pa=s.CallEndReason.OTHER_NOT_CAPABLE;this.$FBRTCCallController9(pa,false,true,false,'TimedOut');};oa.prototype.$FBRTCCallControllerJ=function(){"use strict";this.$FBRTCCallControllerl.sendMuteStateUpdate(this.$FBRTCCallController5.peerID,this.$FBRTCCallController5.callID,this.$FBRTCCallController5.localStream.hasVideo());};oa.prototype.$FBRTCCallControllerI=function(pa){"use strict";this.$FBRTCCallController5.remoteStream.setVideoEnabled(pa);};oa.prototype.$FBRTCCallControllerc=function(pa){"use strict";this.$FBRTCCallControllerp=new ga(this.$FBRTCCallControllerl);this.$FBRTCCallControllerp.addListener('sendingRetry',this.$FBRTCCallControllerK.bind(this));this.$FBRTCCallControllerp.sendMessage(s.PayloadType.ANSWER,this.$FBRTCCallController5.peerID,this.$FBRTCCallController5.callID,pa,this.$FBRTCCallController5.localStream.hasVideo());};oa.prototype.$FBRTCCallControllerK=function(){"use strict";var pa=this;this.$FBRTCCallControllerr.drainCandidates(this.$FBRTCCallController5.peerID,this.$FBRTCCallController5.callID,function(qa){pa.$FBRTCCallControllerM(qa);});};oa.prototype.$FBRTCCallControllerM=function(pa){"use strict";this.$FBRTCCallControllerl.sendIceCandidate(this.$FBRTCCallController5.peerID,this.$FBRTCCallController5.callID,pa);};oa.prototype.$FBRTCCallControllerd=function(pa){"use strict";this.$FBRTCCallControllerr.cacheCandidate(this.$FBRTCCallController5.peerID,this.$FBRTCCallController5.callID,pa);this.$FBRTCCallControllerM(pa);};oa.prototype.$FBRTCCallControllere=function(){"use strict";this.$FBRTCCallControllert=true;var pa=this;this.$FBRTCCallControllers.drainCandidates(this.$FBRTCCallController5.peerID,this.$FBRTCCallController5.callID,function(qa){pa.$FBRTCCallControllera.onReceivedRemoteIceCandidate(qa);});};oa.prototype.$FBRTCCallControllerf=function(){"use strict";this.$FBRTCCallControllerN();this.$FBRTCCallController7.onCallConnected();this.$FBRTCCallControllery.onCallHeartbeat(this.$FBRTCCallController7);this.$FBRTCCallController0.logInfo(this.$FBRTCCallController5.peerID,this.$FBRTCCallController5.callID,'Call Connected');};oa.prototype.$FBRTCCallControllerg=function(){"use strict";this.$FBRTCCallController9(s.CallEndReason.CONNECTION_DROPPED,false,true,false);};oa.prototype.$FBRTCCallControlleri=function(pa){"use strict";this.$FBRTCCallController9(s.CallEndReason.WEBRTC_ERROR,false,true,false,pa.endCallSubreason);this.$FBRTCCallController0.logError(this.$FBRTCCallController5.peerID,this.$FBRTCCallController5.callID,'webrtc error: '+JSON.stringify(pa.details));};oa.prototype.$FBRTCCallControllern=function(pa,qa){"use strict";this.$FBRTCCallController9(pa,false,false,false,qa);};oa.prototype.$FBRTCCallControllerm=function(pa,qa){"use strict";var ra=qa.call_id,sa=qa.type;if(this.$FBRTCCallController5.isEnded()){this.$FBRTCCallController0.logError(this.$FBRTCCallController5.peerID,this.$FBRTCCallController5.callID,'Message sent after call ended: '+sa);return;}if(this.$FBRTCCallController5.peerID!==pa||this.$FBRTCCallController5.callID!==ra)return;this.$FBRTCCallController8.onMessageTypeSent(sa);this.$FBRTCCallController7.onMessageTypeSent(qa);};oa.prototype.$FBRTCCallControllerx=function(pa){"use strict";if(!pa.payload||!pa.call_id||!pa.from){this.$FBRTCCallController0.logError(this.$FBRTCCallController5.peerID,this.$FBRTCCallController5.callID,'Unknown data: '+JSON.stringify(pa));return;}var qa=pa.from,ra=parseInt(pa.call_id,10),sa=JSON.parse(pa.payload),ta=sa.type,ua=pa.source;this.$FBRTCCallController0.logReceivedMessage(qa,ra,sa);if(this.$FBRTCCallController5.isEnded()){this.$FBRTCCallController0.logInfo(this.$FBRTCCallController5.peerID,this.$FBRTCCallController5.callID,'Ignoring message (call ended): '+sa.msg_id);return;}if(!x.check(qa,ra,sa.msg_id)){this.$FBRTCCallController0.logInfo(this.$FBRTCCallController5.peerID,this.$FBRTCCallController5.callID,'Ignoring message (duplicate): '+sa.msg_id);return;}if(this.$FBRTCCallController5.peerID&&this.$FBRTCCallController5.peerID!==qa){if(ta===s.PayloadType.OFFER)this.$FBRTCCallControllerO(qa,ra,sa);this.$FBRTCCallController0.logInfo(this.$FBRTCCallController5.peerID,this.$FBRTCCallController5.callID,'Ignoring message (different peer): '+sa.msg_id);return;}if(this.$FBRTCCallController5.callID&&this.$FBRTCCallController5.callID!==ra&&ta!==s.PayloadType.OFFER&&ta!==s.PayloadType.ICERESTART_OFFER&&ta!==s.PayloadType.ICE_CANDIDATE){this.$FBRTCCallController0.logInfo(this.$FBRTCCallController5.peerID,this.$FBRTCCallController5.callID,'Ignoring message (different call): '+sa.msg_id);return;}this.$FBRTCCallController8.onMessageTypeReceived(ta);if(this.$FBRTCCallController5.callID&&this.$FBRTCCallController5.callID===ra)this.$FBRTCCallController7.onMessageTypeReceived(sa);switch(ta){case s.PayloadType.OFFER:sa=y.maybeDisableVideoInOffer(sa,ua);this.$FBRTCCallControllerP(sa);break;case s.PayloadType.ANSWER:this.$FBRTCCallControllerQ(sa);this.$FBRTCCallControllery.onCallHeartbeat(this.$FBRTCCallController7);break;case s.PayloadType.ICE_CANDIDATE:this.$FBRTCCallControllerR(sa);break;case s.PayloadType.HANGUP:this.$FBRTCCallControllerS(sa);break;case s.PayloadType.ICERESTART_OFFER:this.$FBRTCCallControllerP(sa);break;case s.PayloadType.OFFER_ACK:this.$FBRTCCallControllerT();this.$FBRTCCallControllery.onCallHeartbeat(this.$FBRTCCallController7);break;case s.PayloadType.OFFER_NACK:this.$FBRTCCallController5.receivedNack=true;break;case s.PayloadType.ANSWER_ACK:this.$FBRTCCallControllerN();break;case s.PayloadType.SET_VIDEO:this.$FBRTCCallControllerI(sa.videoon);break;case s.PayloadType.OK:case s.PayloadType.OTHER_DISMISS:case s.PayloadType.MSG_ACK:case s.PayloadType.PRANSWER:case s.PayloadType.ICERESTART_ANSWER:break;default:break;}};oa.prototype.$FBRTCCallControllerO=function(pa,qa,ra){"use strict";var sa=new p({peerID:pa,callID:qa,isCaller:false});sa.onMessageTypeReceived(ra);this.$FBRTCCallControllerl.sendOfferAck(pa,qa,ra);sa.onOfferAckSent(ra);var ta=s.CallEndReason.IN_ANOTHER_CALL;this.$FBRTCCallControllerU(pa,qa,ta);sa.onCallEnded(ta,false);sa.save(this.$FBRTCCallController2);};oa.prototype.$FBRTCCallControllerP=function(pa){"use strict";this.$FBRTCCallControllerl.sendOfferAck(this.$FBRTCCallController5.peerID,pa.call_id,pa);this.$FBRTCCallControllerl.sendOtherDismiss(pa.call_id);if(this.$FBRTCCallControllerV(pa)){this.$FBRTCCallControllerW(pa);}else this.$FBRTCCallControllerX();};oa.prototype.$FBRTCCallControllerV=function(pa){"use strict";if(pa.call_id===this.$FBRTCCallController5.callID)return true;return ((this.$FBRTCCallControllerz||!this.$FBRTCCallController3)&&(!this.$FBRTCCallController5.callID||pa.call_id!==this.$FBRTCCallController5.callID)&&this.$FBRTCCallController5.isCaller&&(!pa.handlescollision||pa.call_id<this.$FBRTCCallController5.callID));};oa.prototype.$FBRTCCallControllerW=function(pa){"use strict";if(pa.hasOwnProperty('videoon'))this.$FBRTCCallControllerI(pa.videoon);this.$FBRTCCallControllerT();this.$FBRTCCallControllerY();this.$FBRTCCallControllerN();if(this.$FBRTCCallController5.callID!==pa.call_id){var qa=s.CallEndReason.OTHER_INSTANCE_HANDLED;this.$FBRTCCallControllerU(this.$FBRTCCallController5.peerID,this.$FBRTCCallController5.callID,qa);this.$FBRTCCallController7.onCallEnded(qa,false);this.$FBRTCCallController7.save(this.$FBRTCCallController2);this.$FBRTCCallController7=new p({peerID:this.$FBRTCCallController5.peerID,callID:pa.call_id,isCaller:false});this.$FBRTCCallController7.onMessageTypeReceived(pa);this.$FBRTCCallController7.onOfferAckSent(pa);this.$FBRTCCallController0.logEvent(this.$FBRTCCallController5.peerID,this.$FBRTCCallController5.callID,'Handling offer collision');}else this.$FBRTCCallController0.logEvent(this.$FBRTCCallController5.peerID,this.$FBRTCCallController5.callID,'Handling offer refresh');this.$FBRTCCallControllera.end();this.$FBRTCCallControllert=false;this.$FBRTCCallController8.reset(pa.call_id,this.$FBRTCCallController7);if(this.$FBRTCCallController5.canStartCall()){this.$FBRTCCallControllera.onReceivedOfferSDP(pa.sdp);this.$FBRTCCallControllerG(this.$FBRTCCallController5.peerID,this.$FBRTCCallController5.callID);this.$FBRTCCallControllerJ();}else this.$FBRTCCallController3=pa;};oa.prototype.$FBRTCCallControllerX=function(){"use strict";this.$FBRTCCallController0.logEvent(this.$FBRTCCallController5.peerID,this.$FBRTCCallController5.callID,'Ignoring offer');};oa.prototype.$FBRTCCallControllerQ=function(pa){"use strict";this.$FBRTCCallControllerT();this.$FBRTCCallControllerY();this.$FBRTCCallControllerl.sendAnswerAck(this.$FBRTCCallController5.peerID,this.$FBRTCCallController5.callID,pa);this.$FBRTCCallControllera.onReceivedAnswerSDP(pa.sdp);if(pa.hasOwnProperty('videoon'))this.$FBRTCCallControllerI(pa.videoon);this.$FBRTCCallControllerJ();};oa.prototype.$FBRTCCallControllerR=function(pa){"use strict";if(pa.call_id===this.$FBRTCCallController5.callID&&this.$FBRTCCallControllert){this.$FBRTCCallControllera.onReceivedRemoteIceCandidate(pa);}else this.$FBRTCCallControllers.cacheCandidate(this.$FBRTCCallController5.peerID,pa.call_id,pa);};oa.prototype.$FBRTCCallControllerS=function(pa){"use strict";if(pa.call_id===this.$FBRTCCallController5.callID){this.$FBRTCCallController9(pa.reason,true,false);}else this.$FBRTCCallController0.logError(this.$FBRTCCallControllerZ.peerID,this.$FBRTCCallControllerZ.callID,'Reciving hangup for a different call: '+pa.call_id.toString());};oa.prototype.$FBRTCCallController9=function(pa,qa,ra,sa,ta){"use strict";var ua=s.fullCallEndReasonString(pa,qa);this.$FBRTCCallController0.logCallAction(this.$FBRTCCallController5.peerID,this.$FBRTCCallController5.callID,w.CallAction.END_CALL,ua);this.$FBRTCCallControllerT();this.$FBRTCCallControllerY();this.$FBRTCCallControllerN();if(this.$FBRTCCallController5.isEnded()){this.$FBRTCCallController0.logError(this.$FBRTCCallController5.peerID,this.$FBRTCCallController5.callID,'Ending an already-ended call');return;}if(ra)this.$FBRTCCallControllerU(this.$FBRTCCallController5.peerID,this.$FBRTCCallController5.callID,pa,sa);this.$FBRTCCallControllera.end();ca.end();this.$FBRTCCallController8.end(pa,qa);this.$FBRTCCallController7.onCallEnded(pa,qa,null,ta);this.$FBRTCCallControllerG(this.$FBRTCCallController5.peerID,null);this.$FBRTCCallController7.save(this.$FBRTCCallController2);};oa.prototype.$FBRTCCallControllerU=function(pa,qa,ra,sa){"use strict";this.$FBRTCCallControllerl.sendHangup(pa,qa,ra,sa);this.$FBRTCCallControllerl.sendOtherDismiss(qa);};oa.prototype.$FBRTCCallControllerT=function(){"use strict";if(this.$FBRTCCallControllero)this.$FBRTCCallControllero.stopRetrying();};oa.prototype.$FBRTCCallControllerN=function(){"use strict";if(this.$FBRTCCallControllerp)this.$FBRTCCallControllerp.stopRetrying();};oa.prototype.$FBRTCCallControllerY=function(){"use strict";if(this.$FBRTCCallControllerz)clearTimeout(this.$FBRTCCallControllerz);this.$FBRTCCallControllerz=null;};e.exports=oa;},null);