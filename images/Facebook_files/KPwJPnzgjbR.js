/*!CK:3217721009!*//*1418624678,*/

if (self.CavalryLogger) { CavalryLogger.start_js(["kbCsr"]); }

__d("AbstractRangeInput.react",["Event","Keys","React","UserAgent","cx","joinClasses"],function(a,b,c,d,e,f,g,h,i,j,k,l){var m={BLOCK:'block',PUSH:'push',FREE:'free'},n=i.createClass({displayName:"AbstractRangeInput",propTypes:{name:i.PropTypes.string,min:i.PropTypes.number,max:i.PropTypes.number,step:i.PropTypes.number,disabled:i.PropTypes.bool,values:i.PropTypes.array,behavior:i.PropTypes.oneOf([m.BLOCK,m.PUSH,m.FREE]),onChange:i.PropTypes.func},getDefaultProps:function(){return {name:'',min:0,max:1,step:.01,disabled:false,values:[.5],behavior:m.FREE};},componentWillReceiveProps:function(o){this.setState({values:o.values});},componentDidMount:function(){var o=j.isBrowser('IE < 9')?document.documentElement:window;this._listeners=g.listen(o,{selectstart:function(p){this._thumbData&&g.prevent(p);}.bind(this),mousemove:this._onMouseMove,mouseup:this._onMouseUp});},componentWillUnmount:function(){for(var o in this._listeners){this._listeners[o]&&this._listeners[o].remove();this._listeners[o]=null;}},getInitialState:function(){var o=this.props.values;if(this.props.behavior!==m.FREE)o.sort();return {values:o};},_onKeyDown:function(o,event){switch(g.getKeyCode(event)){case h.DOWN:case h.LEFT:this._updateThumbData(o);this._moveThumbByX(-1);break;case h.RIGHT:case h.UP:this._updateThumbData(o);this._moveThumbByX(1);break;}},_onMouseDown:function(o,event){g.prevent(event);this._updateThumbData(o);this._thumbData.dragStartX=event.nativeEvent.clientX;},_onMouseMove:function(event){if(this._thumbData)this._moveThumbByX(event.clientX-this._thumbData.dragStartX);},_updateThumbData:function(o){this._thumbData={draggingIdx:o,dragStartValue:this.state.values[o],scale:this.getDOMNode().clientWidth};},_moveThumbByX:function(o){var p=(this.props.max-this.props.min)/this._thumbData.scale,q=this._thumbData.dragStartValue+(o*p),r=this.state.values,s=r.length,t=this._thumbData.draggingIdx;if(this.props.step){var u=1/this.props.step;q=Math.round(q*u)/u;}var v=this.props.min,w=this.props.max;if(this.props.behavior===m.BLOCK){v=t>0?r[t-1]:v;w=t<s-1?r[t+1]:w;}q=q<v?v:q;q=q>w?w:q;r[t]=q;if(this.props.behavior===m.PUSH){for(var x=t+1,y=r.length;x<y;x++){if(r[x]>=q)break;r[x]=q;}for(x=t-1;x>=0;x--){if(r[x]<=q)break;r[x]=q;}}this.setState({values:r});this.props.onChange&&this.props.onChange(r);},_onMouseUp:function(event){if(this._thumbData)this._thumbData=null;},render:function(){var o=this.state.values,p=this.props.disabled,q=o.length>1,r=this.props.max-this.props.min,s=o.map(function(t,u){var v=(t-this.props.min)/r,w=this.props.name+(q?'['+u+']':'');return (i.createElement("div",{className:(("_4qwr")+(p?' '+"_4qws":'')),key:'thumb-'+u,onDragStart:g.prevent,onKeyDown:p?null:function(x){return this._onKeyDown(u,x);}.bind(this),onMouseDown:p?null:function(x){return this._onMouseDown(u,x);}.bind(this),style:{left:(v*100)+'%'},tabIndex:0},i.createElement("input",{onChange:this.props.onChange,name:w,value:t,type:"hidden"})));}.bind(this));return (i.createElement("div",i.__spread({},this.props,{className:l(this.props.className,"_4qwt")}),i.createElement("div",{className:"_4qwu"}),s));}});e.exports=n;},null);
__d("XUIDialogCloseButton.react",["React","XUIDialogButton.react","fbt"],function(a,b,c,d,e,f,g,h,i){var j=g.createClass({displayName:"XUIDialogCloseButton",render:function(){return (g.createElement(h,g.__spread({},this.props,{action:"cancel",label:"Close"})));}});e.exports=j;},null);
__d("clamp",[],function(a,b,c,d,e,f){function g(h,i,j){if(i<h)return h;if(i>j)return j;return i;}e.exports=g;},null);
__d("PhotoStoreCore",[],function(a,b,c,d,e,f){var g={actions:{UPDATE:'update'},_photoCache:{},_postCreateCallbacks:{},getPhotoCache:function(h){if(!this._photoCache[h])throw new Error('Photo cache requested for unknown set ID');return this._photoCache[h];},hasBeenCreated:function(h){return !!this._photoCache[h];},clearSetCache:function(h){delete this._photoCache[h];delete this._postCreateCallbacks[h];},getByIndex:function(h,i,j){this.getPhotoCache(h).getItemAtIndex(i,j);},getByIndexImmediate:function(h,i){if(this._photoCache[h])return this._photoCache[h].getItemAtIndexImmediate(i);return (void 0);},getItemsInAvailableRange:function(h){var i=this.getAvailableRange(h),j=[];for(var k=i.offset;k<i.length;k++)j.push(this.getByIndexImmediate(h,k));return j;},getItemsAfterIndex:function(h,i,j,k){var l=this.getCursorByIndexImmediate(h,i);this.fetchForward(h,l,j,k);},getAllByIDImmediate:function(h){var i=Object.keys(this._photoCache);return i.map(function(j){return this.getByIndexImmediate(j,this.getIndexForID(j,h));}.bind(this)).filter(function(j){return !!j;});},getIndexForID:function(h,i){if(this._photoCache[h])return this._photoCache[h].getIndexForID(i);return (void 0);},getEndIndex:function(h){var i=this.getAvailableRange(h);return i.offset+i.length-1;},getCursorByIndexImmediate:function(h,i){var j=this.getByIndexImmediate(h,i);if(j)return this._photoCache[h].getCursorForID(j.id);return (void 0);},hasNextPage:function(h){var i=this.getCursorByIndexImmediate(h,this.getEndIndex(h));return this.getPhotoCache(h).hasNextPage(i);},getAvailableRange:function(h){return this.getPhotoCache(h).getAvailableRange();},hasLooped:function(h){return this.getPhotoCache(h).hasLooped();},fetchForward:function(h,i,j,k){this.getPhotoCache(h).getItemsAfterCursor(i,j,k);},fetchBackward:function(h,i,j,k){this.getPhotoCache(h).getItemsBeforeCursor(i,j,k);},executePostCreate:function(h,i){if(this._photoCache[h]){i&&i();}else this._postCreateCallbacks[h]=i;},runPostCreateCallback:function(h){var i=this._postCreateCallbacks[h];if(i){i();delete this._postCreateCallbacks[h];}},setPreFetchCallback:function(h,i){this.getPhotoCache(h).setPreFetchCallback(i);},updateData:function(h){var i=h.set_id;if(!this._photoCache[i]){this._photoCache[i]=new h.cache_class(h);this.runPostCreateCallback(i);}else if(h.query_metadata.action==g.actions.UPDATE){this._photoCache[i].updateData(h);}else this._photoCache[i].addData(h);},updateFeedbackData:function(h){var i=Object.keys(h);i.forEach(function(j){return g.getAllByIDImmediate(j).forEach(function(k){k.feedback=h[j].feedback;});});},reset:function(){Object.keys(this._photoCache).forEach(function(h){return this.clearSetCache(h);}.bind(this));}};e.exports=g;},null);
__d("PhotoZoomCropDimensions",["BasicVector","confine"],function(a,b,c,d,e,f,g,h){var i=320,j=.5,k=.5,l=180,m=.05,n=3;function o(q,r){return Number(q.toFixed(r||n));}p.prototype.clone=function(){"use strict";return new p(this.$PhotoZoomCropDimensions0).setSize(this.$PhotoZoomCropDimensions1.x,this.$PhotoZoomCropDimensions1.y).setSmallestSize(this.$PhotoZoomCropDimensions2.x,this.$PhotoZoomCropDimensions2.y).setCenter(this.$PhotoZoomCropDimensions3.x,this.$PhotoZoomCropDimensions3.y).setZoom(this.$PhotoZoomCropDimensions4);};function p(q){"use strict";this.$PhotoZoomCropDimensions0=q;this.setSmallestSize(l,l).setCenter(j,j);this.setSize(i,i).setZoom(k);}p.prototype.getArea=function(){"use strict";var q=this.getPosition(),r=this.$PhotoZoomCropDimensions1.div(this.$PhotoZoomCropDimensions4);return {height:Math.round(r.y),width:Math.round(r.x),x:Math.round(Math.abs(q.left)/this.$PhotoZoomCropDimensions4),y:Math.round(Math.abs(q.top)/this.$PhotoZoomCropDimensions4)};};p.prototype.getPosition=function(){"use strict";var q=this.$PhotoZoomCropDimensions5();return {height:o(q.imageSize.y),left:o(this.$PhotoZoomCropDimensions1.x/2-q.center.x),top:o(this.$PhotoZoomCropDimensions1.y/2-q.center.y),width:o(q.imageSize.x)};};p.prototype.getRect=function(){"use strict";var q=this.$PhotoZoomCropDimensions5(),r=this.$PhotoZoomCropDimensions1.div(this.$PhotoZoomCropDimensions4);return {center:{x:q.center.x/q.imageSize.x,y:q.center.y/q.imageSize.y},size:{x:r.x,y:r.y}};};p.prototype.getSize=function(){"use strict";return this.$PhotoZoomCropDimensions1;};p.prototype.getZoom=function(){"use strict";return this.$PhotoZoomCropDimensions4;};p.prototype.getZoomRange=function(){"use strict";var q=Math.min(this.$PhotoZoomCropDimensions0.x,this.$PhotoZoomCropDimensions0.y);return {max:this.$PhotoZoomCropDimensions1.x/Math.min(this.$PhotoZoomCropDimensions2.x,q),min:this.$PhotoZoomCropDimensions1.x/q};};p.prototype.hasSpaceToDrag=function(){"use strict";return !p.isSquare(this.$PhotoZoomCropDimensions0);};p.prototype.moveByPixels=function(q,r){"use strict";var s=this.$PhotoZoomCropDimensions5();return this.moveBy(q/s.imageSize.x,r/s.imageSize.y);};p.prototype.moveBy=function(q,r){"use strict";this.setCenter(this.$PhotoZoomCropDimensions3.x+q,this.$PhotoZoomCropDimensions3.y+r);var s=this.$PhotoZoomCropDimensions5();this.$PhotoZoomCropDimensions3=s.center.div(s.imageSize.x,s.imageSize.y);return this;};p.prototype.setCenter=function(q,r){"use strict";this.$PhotoZoomCropDimensions3=new g(h(q,0,1),h(r,0,1));return this;};p.prototype.setSize=function(q,r){"use strict";this.$PhotoZoomCropDimensions1=new g(q,r);return this;};p.prototype.setSmallestSize=function(q,r){"use strict";this.$PhotoZoomCropDimensions2=new g(q,r);return this;};p.prototype.setZoom=function(q){"use strict";var r=this.getZoomRange();this.$PhotoZoomCropDimensions4=h(q,r.min,r.max);return this;};p.prototype.$PhotoZoomCropDimensions6=function(q,r){"use strict";var s=this.$PhotoZoomCropDimensions1.x/2,t=this.$PhotoZoomCropDimensions1.y/2;return new g(h(r.x,s,q.x-s),h(r.y,t,q.y-t));};p.prototype.$PhotoZoomCropDimensions5=function(){"use strict";var q=this.$PhotoZoomCropDimensions0.mul(this.$PhotoZoomCropDimensions4);return {imageSize:q,center:this.$PhotoZoomCropDimensions6(q,this.$PhotoZoomCropDimensions3.mul(q.x,q.y))};};p.isSquare=function(q){"use strict";return Math.abs(q.x/q.y-1)<m;};e.exports=p;},null);
__d("SpotlightProfilePicCropOptions",[],function(a,b,c,d,e,f){var g=2.5,h=.8,i=320,j={getOptions:function(k,l){var m={},n=Math.min(l.x,l.y),o,p,q=k.facebox;if(q){p=Math.max(q.size.x*l.x,q.size.y*l.y)*g;o=q.center;}else{p=h*n;if(k.focus)o=k.focus;}var r=l.x/k.original.width;m.height=m.width=Math.min(Math.max(p,i*r),n);if(o){m.center_x=Math.min(Math.max(o.x*l.x,m.width/2),l.x-m.width/2);m.center_y=Math.min(Math.max(o.y*l.y,m.height/2),l.y-m.height/2);}return m;},getOptionsAsRatio:function(k,l){var m=j.getOptions(k,l),n=Math.min(l.x,l.y);return {center:{x:m.center_x?m.center_x/l.x:.5,y:m.center_y?m.center_y/l.y:.5},size:{x:m.width/n,y:m.height/n}};}};e.exports=j;},null);
__d("Optimus",["Event","Parent"],function(a,b,c,d,e,f,g,h){"use strict";var i={};function j(l,m){var n=m.getTarget();if(!n)return;var o=i[l];for(var p in o){var q=h.byAttribute(n,p);if(q)do{var r=o[p][q.getAttribute(p)];r&&r.handleOptimus(l,q,m);}while(q=h.byAttribute(q.parentNode,p));}}function k(l,m,n,o){if(!i[l]){i[l]={};g.listen(document.documentElement,l,j.bind(null,l));}if(!i[l][m])i[l][m]={};if(!i[l][m][n])i[l][m][n]=o;}e.exports={addRelClick:function(l,m){k('click','rel',l,m);}};},null);
__d("PhotoTagApproval",["Arbiter","CSS","DOM","Event","Parent","PhotosConst","ge"],function(a,b,c,d,e,f,g,h,i,j,k,l,m){function n(o){"use strict";this.viewer=o;this.units=[];this.currentUnit=0;var p=o.getVersionConst();if(p==l.VIEWER_SNOWLIFT){this._root=m('fbPhotoSnowliftTagApproval');}else this._root=m('fbPhotoPageTagApproval');g.subscribe(o.getEventString('DATA_CHANGE'),this.restartTagApproval.bind(this));g.subscribe('PhotoTagApproval.PENDING_TAG_PHOTO_CLICK',this.pendingTagPhotoClick.bind(this));j.listen(this._root,'click',this.handleClick.bind(this));j.listen(this._root,'mousemove',function(q){this.hiliteCurrentPendingTag();j.kill(q);}.bind(this));this.restartTagApproval();}n.prototype.handleClick=function(event){"use strict";var o=event.getTarget();if(h.hasClass(o,'nextPager')&&h.hasClass(o,'enabled')){this.showNextUnit();}else if(h.hasClass(o,'prevPager')&&h.hasClass(o,'enabled')){this.showPrevUnit();}else if(k.byClass(o,'fbPhotoApprovalPendingButtons')){var p=this.units[this.currentUnit],q=this.getTagNameID(p);if(q){var r=k.byClass(o,'approve');g.inform('PhotoTagApproval.UPDATE_TAG_BOX',{id:q,approve:r,version:this.viewer.getVersionConst()});}setTimeout(this.removeSelectedUnit.bind(this),0);}return true;};n.prototype.loadUnits=function(o){"use strict";this.units=i.scry(this._root,'div.fbPhotoApprovalUnit');if(this.units.length){h.show(this._root);this.showUnit(o);h.conditionClass(this._root,'hidePagers',this.units.length==1);}else{h.hide(this._root);g.inform('PhotoTagApproval.HILITE_TAG',{tag:null,version:this.viewer.getVersionConst()});}};n.prototype.restartTagApproval=function(){"use strict";this.loadUnits(0);};n.prototype.pendingTagPhotoClick=function(o,p){"use strict";if(p.version!==l.VIEWER_PERMALINK&&p.version!==l.VIEWER_SNOWLIFT)return true;var q='approve:'+p.id;for(var r=0;r<this.units.length;r++)if(this.units[r].id===q){this.showUnit(r);return false;}return true;};n.prototype.removeSelectedUnit=function(){"use strict";var o=this.units[this.currentUnit];i.remove(o);this.loadUnits(this.currentUnit);};n.prototype.showNextUnit=function(){"use strict";this.showUnit(this.currentUnit+1);};n.prototype.showPrevUnit=function(){"use strict";this.showUnit(this.currentUnit-1);};n.prototype.getTagNameID=function(o){"use strict";var p=o.id.indexOf(':');return o.id.slice(p+1);};n.prototype.showUnit=function(o){"use strict";this.units.forEach(h.hide);this.currentUnit=(o+this.units.length)%this.units.length;var p=this.units[this.currentUnit];h.show(p);this.hiliteCurrentPendingTag();h.conditionClass(i.find(this._root,'a.prevPager'),'enabled',this.currentUnit>0);h.conditionClass(i.find(this._root,'a.nextPager'),'enabled',this.currentUnit<this.units.length-1);};n.prototype.hiliteCurrentPendingTag=function(){"use strict";var o=this.units[this.currentUnit],p=this.getTagNameID(o);g.inform('PhotoTagApproval.HILITE_TAG',{tag:p,version:this.viewer.getVersionConst()});};e.exports=n;},null);
__d("legacy:photo-tag-approval",["PhotoTagApproval"],function(a,b,c,d){a.PhotoTagApproval=b('PhotoTagApproval');},3);
__d("PhotoStore",["Arbiter","PhotoStoreCore"],function(a,b,c,d,e,f,g,h){g.subscribe('update-photos',function(i,j){h.updateData(j);});e.exports=h;},null);
__d("PhotoViewState",["ArbiterMixin","PhotoStore","PhotoUtils","SpotlightViewerLoggingEvents","copyProperties","mixin"],function(a,b,c,d,e,f,g,h,i,j,k,l){var m=l(g);for(var n in m)if(m.hasOwnProperty(n))p[n]=m[n];var o=m===null?null:m.prototype;p.prototype=Object.create(o);p.prototype.constructor=p;p.__superConstructor__=m;function p(q,r,s,t,u){"use strict";this._viewer=q;this._setID=r;this._updateCallback=t;this._position=s||0;this._preloaded={};this._reverse=u;}p.prototype._fetchCallback=function(q){"use strict";if(!this._viewer.isOpen())return;this._preload(q);this._log(j.DATA_FETCH_COMPLETE);};p.prototype._preload=function(q){"use strict";i.preload(this._viewer,q,function(r){this._preloaded[i.getFBIDFromData(r)]=true;}.bind(this));};p.prototype._preloadPhotosInRange=function(q,r){"use strict";var s=[];for(var t=q;t<=r;++t){var u=h.getByIndexImmediate(this._setID,t);if(u&&!this._isPreloaded(u))s.push(u);}this._preload(s);};p.prototype._isPreloaded=function(q){"use strict";return this._preloaded[i.getFBIDFromData(q)];};p.prototype.getPosition=function(){"use strict";return this._position;};p.prototype.isValidMovement=function(q){"use strict";if(!h.hasBeenCreated(this._setID))return false;if(h.hasLooped(this._setID))return true;var r=this._position+q,s=h.getAvailableRange(this._setID),t=s.offset+s.length-1;return r>=s.offset-1&&r<=t+1;};p.prototype.getRelativeMovement=function(q){"use strict";return h.getIndexForID(this._setID,q)-this._position;};p.prototype.moveCursor=function(q){"use strict";if(!this.isValidMovement(q))return false;this._position+=q;return true;};p.prototype._page=function(q){"use strict";if(!this.moveCursor(q))return;this._log(j.PAGE_BEGIN);var r=h.getByIndexImmediate(this._setID,this._position);if(!r){this.inform('photo_fetch');this._log(j.PHOTO_FETCH);}else if(!this._isPreloaded(r))this._preload([r]);h.getByIndex(this._setID,this._position,this._updateCallback);this._loadMoreIfNecessary(q>0,p.BUFFER_SIZE);this._log(j.PAGE_COMPLETE);};p.prototype.loadMoreForwardIfNecessary=function(q){"use strict";var r=h.getAvailableRange(this._setID),s=r.offset+r.length-1,t=this._position+q;if(t>s&&!h.hasLooped(this._setID)){var u=h.getCursorByIndexImmediate(this._setID,s);h.fetchForward(this._setID,u,q,this._fetchCallback.bind(this));}else this._preloadPhotosInRange(this._position+1,t);};p.prototype.loadMoreBackwardIfNecessary=function(q){"use strict";var r=h.getAvailableRange(this._setID),s=this._position-q;if(s<r.offset&&!h.hasLooped(this._setID)){var t=h.getCursorByIndexImmediate(this._setID,r.offset);h.fetchBackward(this._setID,t,q,this._fetchCallback.bind(this));}else this._preloadPhotosInRange(s,this._position-1);};p.prototype._loadMoreIfNecessary=function(q,r){"use strict";if(q){this.loadMoreForwardIfNecessary(r);}else this.loadMoreBackwardIfNecessary(r);};p.prototype.displayFirst=function(){"use strict";if(!this._viewer.isOpen())return;h.setPreFetchCallback(this._setID,function(){this._log(j.DATA_FETCH_BEGIN);}.bind(this));var q=function(r){if(!this._isPreloaded(r))this._preload([r]);this._updateCallback(r);}.bind(this);h.getByIndex(this._setID,this._position,q);if(this._reverse){this.loadMoreBackwardIfNecessary(p.BUFFER_SIZE);}else this.loadMoreForwardIfNecessary(p.BUFFER_SIZE);};p.prototype.backward=function(){"use strict";this._page(this._reverse?1:-1);};p.prototype.forward=function(){"use strict";this._page(this._reverse?-1:1);};p.prototype._log=function(q){"use strict";this._viewer.log(q);};k(p,{BUFFER_SIZE:4});e.exports=p;},null);
__d("SpotlightViewerImage",["React","cx"],function(a,b,c,d,e,f,g,h){var i=g.createClass({displayName:"SpotlightViewerImage",render:function(){return (g.createElement("img",{className:"_4-od",src:this.props.src,style:{width:this.props.dimensions.x,height:this.props.dimensions.y}}));}});e.exports=i;},null);
__d("SpotlightViewerCoreMixin",["PhotoLogger","PhotoStore","PhotoUtils","PhotoViewState","React","SpotlightViewerImage","SpotlightViewerLoggingEvents"],function(a,b,c,d,e,f,g,h,i,j,k,l,m){var n={_displayFirstPhoto:function(){h.executePostCreate(this.props.setid,this.viewState.displayFirst.bind(this.viewState));},_getInitialPosition:function(){var o;if(!this.props.clearcache)o=h.getIndexForID(this.props.setid,this.props.photoid);if(o===(void 0)){h.clearSetCache(this.props.setid);o=0;}return o;},__displayPhoto:function(){var o=this._getInitialPosition();this.viewState=new j(this,this.props.setid,o,this._updatePhoto,this.props.reverse);this.inform('open');this._displayFirstPhoto();},componentWillMount:function(){this._logger=new g(this.getViewerID());this.log(m.OPEN_BEGIN);this.__displayPhoto();},componentDidMount:function(){this._enableSubscriptions&&this._enableSubscriptions();this.log(m.OPEN_COMPLETE);},isOpen:function(){return this.state.open;},close:function(){if(!this.isOpen())return;this.log(m.CLOSE_BEGIN);this.setState({open:false},function(){this.inform('close');this.log(m.CLOSE_COMPLETE);});},componentWillUnmount:function(){this.viewState=null;},_onClickViewport:function(o){o?this.viewState.forward():this.viewState.backward();},_getMedia:function(o,p){return (k.createElement(l,{ref:"image",src:o.uri,dimensions:p.imageDimensions}));},_getCurrentFBID:function(){return i.getFBIDFromData(this.state.photoData);},_updatePhoto:function(o){this.log(m.PHOTO_CHANGE_BEGIN);this.setState({photoData:o},function(){this.inform('photo_change',this.state.photoData);this.log(m.PHOTO_CHANGE_COMPLETE);});},getLogger:function(){return this._logger;},log:function(o){this._logger&&this._logger.logEvent(o);}};e.exports=n;},null);
__d("SpotlightViewerStageResizer",["Event","SubscriptionsHandler","Vector"],function(a,b,c,d,e,f,g,h,i){var j=520;function k(l,m){"use strict";this._subscriptionsHandler=new h();this._subscriptionsHandler.addSubscriptions(g.listen(window,'resize',this._resetStageDimensions.bind(this)));this._dimensions=l;this._minHeight=m.minHeight||j;this._minWidth=m.minWidth||j;this._resetStageDimensions();}k.prototype.destroy=function(){"use strict";this._dimensions=null;this._subscriptionsHandler.release();};k.prototype._resetStageDimensions=function(){"use strict";this._currentStageDimensions=new i(this._minWidth,this._minHeight);};k.prototype.getImageAndStageDimensions=function(l){"use strict";var m=this._dimensions.getBestFitDimensionsFromPhoto(l,this._dimensions.getMaxStageDimensions()),n=this._dimensions.getStageDimensions(m);this._currentStageDimensions=new i(Math.max(n.x,this._minWidth,this._currentStageDimensions.x),Math.max(n.y,this._minHeight,this._currentStageDimensions.y));var o=this._dimensions.getImageDimensionsForStage(m,this._currentStageDimensions);return {stageDimensions:this._currentStageDimensions,imageDimensions:o};};k.prototype.getCurrentStageDimensions=function(){"use strict";return this._currentStageDimensions;};e.exports=k;},null);
__d("SpotlightViewerDimensionMixin",["SpotlightViewerStageResizer","PhotoViewerDimensions"],function(a,b,c,d,e,f,g,h){var i={getInitialState:function(){this._dimensions=new h({verticalPadding:this.props.verticalPadding,horizontalPadding:this.props.horizontalPadding});this._resizer=new g(this._dimensions,{minHeight:this.props.minHeight,minWidth:this.props.minWidth});return {maxStageDimensions:this._dimensions.getMaxStageDimensions()};},componentWillUnmount:function(){this._resizer&&this._resizer.destroy();this._resizer=null;this._dimensions&&this._dimensions.destroy();this._dimensions=null;},getMedia:function(){if(this.state.photoData){var j=this._resizer.getImageAndStageDimensions(this.state.photoData),k=this._dimensions.getBestFitImageFromPhoto(this.state.photoData,this.state.maxStageDimensions);return this._getMedia(k,j);}else return null;},getDimensions:function(){return this._dimensions;},getStageDimensions:function(){if(this.state.photoData){return this._resizer.getImageAndStageDimensions(this.state.photoData).stageDimensions;}else return this._dimensions.getMaxStageDimensions();},getImageDimensions:function(){if(!this.state.photoData)return null;return this._resizer.getImageAndStageDimensions(this.state.photoData).imageDimensions;},onResize:function(){this.setState({maxStageDimensions:this._dimensions.getMaxStageDimensions()});}};e.exports=i;},null);
__d("SpotlightViewerInit",["DOM","React"],function(a,b,c,d,e,f,g,h){var i={render:function(j,k){var l=g.create('div');j=h.render(j,l);g.appendContent(document.body,l);j.subscribeOnce('close',function(){j.unmountComponent();g.remove(l);k&&k();});return j;}};e.exports=i;},null);
__d("PhotoTagStore",["AsyncRequest","copyProperties","isEmpty"],function(a,b,c,d,e,f,g,h,i){function j(){"use strict";this._tagList={};this._textTagList={};this._originalTagList={};this._dirtyPhotosByUid={};j.instance=this;}j.prototype.getPhotoTags=function(k){"use strict";return this._tagList[k]||{};};j.prototype.photoHasTags=function(k){"use strict";return !i(this.getPhotoTags(k));};j.prototype.clear=function(){"use strict";this._tagList={};this._textTagList={};this._originalTagList={};this._dirtyPhotosByUid={};};j.prototype.addTag=function(k,l,m,n){"use strict";k[l]=k[l]||{};var o=k[l][m]||[];o.push(n);k[l][m]=o;};j.prototype.revert=function(k){"use strict";var l=this._tagList,m=this._originalTagList;for(var n in l)if(i(m[n][k])){l[n][k]=[];}else l[n][k]=m[n][k];this._dirtyPhotosByUid={};};j.prototype.hasNewTags=function(){"use strict";return !i(this._tagList)||!i(this._textTagList);};j.prototype.userHasDirtyTags=function(k){"use strict";return !i(this._dirtyPhotosByUid[k]);};j.prototype.userDirtyTagsCount=function(k){"use strict";return Object.keys(this._dirtyPhotosByUid[k]).length;};j.prototype.handleTagFetch=function(k){"use strict";for(var l in k)this.loadTagInfo(l,k[l]);};j.prototype.saveAlbumTagsForUser=function(k,l){"use strict";var m={},n=[],o=this._dirtyPhotosByUid[k]||{};for(var p in o){var q=this._tagList[p][k];if(i(q)){n[n.length]=p;continue;}q.forEach(function(s){m[p]={x:s.x,y:s.y};});}var r={subject:k,action:'save',save_tags:m,remove_from:n};new g().setURI('/ajax/photos/album/tags.php').setData(r).setHandler(function(s){l(s.payload);}).setAllowCrossPageTransition(true).send();delete this._dirtyPhotosByUid[k];};j.prototype.getTagsFromList=function(k){"use strict";var l=[];for(var m in k)if(k.hasOwnProperty(m))for(var n in k[m])if(k[m].hasOwnProperty(n))k[m][n].forEach(function(o){return l.push(o);});return l;};j.prototype.getAllTags=function(){"use strict";var k=this.getTagsFromList(this._tagList),l=this.getTagsFromList(this._textTagList);return k.concat(l);};j.prototype.removeTag=function(k,l){"use strict";var m=this._tagList[k],n=this._originalTagList[k]||{};if(n[l]){this._dirtyPhotosByUid[l]=this._dirtyPhotosByUid[l]||{};this._dirtyPhotosByUid[l][k]=true;}else delete this._dirtyPhotosByUid[l][k];for(var o in m)if(o==l){var p=this._tagList[k][o];this._tagList[k][o]=[];if(i(this._tagList[k]))delete this._tagList[k];return p;}};j.prototype.removeTextTag=function(k,l){"use strict";var m=this._textTagList[k];if(!i(m[l])){var n=this._textTagList[k][l];this._textTagList[k][l]=[];if(i(this._textTagList[k]))delete this._textTagList[k];return n;}return [];};j.prototype.removeAllNewTagsOfUser=function(k){"use strict";var l=[];if(!this.userHasDirtyTags(k))return l;var m=this._dirtyPhotosByUid[k];for(var n in m)l=l.concat(this.removeTag(n,k));return l;};j.prototype.removeAllTagsFromPhoto=function(k){"use strict";var l=[];if(!i(this._tagList[k]))for(var m in this._tagList[k]){if(!this._tagList[k].hasOwnProperty(m))continue;l=l.concat(this.removeTag(k,m));}if(!i(this._textTagList[k]))for(var n in this._textTagList[k]){if(!this._textTagList[k].hasOwnProperty(n))continue;l=l.concat(this.removeTextTag(k,n));}return l;};j.prototype.storeTag=function(k,l,m,n,o){"use strict";this.storeTagWithOptions(k,l,m,n,{can_remove:o});};j.prototype.storeTagWithOptions=function(k,l,m,n,o){"use strict";this._dirtyPhotosByUid[l]=this._dirtyPhotosByUid[l]||{};this._dirtyPhotosByUid[l][k]=true;var p={x:m,y:n};h(p,o);if(!l){this.addTag(this._textTagList,k,p.name,p);}else this.addTag(this._tagList,k,l,p);};j.prototype.loadTagInfo=function(k,l){"use strict";this._tagList[k]={};this._originalTagList[k]={};for(var m=0;m<l.length;m++){var n=l[m];this.addTag(this._tagList,k,n.subject,n);this.addTag(this._originalTagList,k,n.subject,n);}};j.getInstance=function(){"use strict";if(j.instance===null)new j();return j.instance;};j.instance=null;e.exports=j;},null);
__d("PhotosTaggingWaterfall",["AsyncSignal","copyProperties"],function(a,b,c,d,e,f,g,h){function i(j){i._queueName=j||i._queueName;}h(i,{BEGIN:"begin",TAG_FACE:"tag_face",HOVER_TAG_FACE:"hover_tag_face",SHOW_SUGGEST:"show_suggest",ADD_NAME:"add_name",TAG_CONFIRMED:"tag_confirmed",FINISH:"finish",TYPE_NAME:'type_name',SELECT_NAME:'select_name',_queueName:null,sendSignal:function(j,k){new g('/ajax/photos/tag_waterfall.php',{data:JSON.stringify(j)}).setHandler(k).send();}});e.exports=i;},null);
__d("PhotoZoomCropImagePreview.react",["React","cx","joinClasses"],function(a,b,c,d,e,f,g,h,i){var j=g.createClass({displayName:"PhotoZoomCropImagePreview",propTypes:{dimensions:g.PropTypes.object,size:g.PropTypes.object,src:g.PropTypes.string},render:function(){var k=this.props.dimensions,l=this.props.size,m=k.getSize().x/l.x;if(m!==1)k=k.clone().setSize(l.x,l.y).setZoom(k.getZoom()/m);return (g.createElement("div",g.__spread({},this.props,{className:i(this.props.className,"_1k3v"),style:Object.assign({},(this.props.style||{}),{height:l.y,width:l.x})}),g.createElement("img",{className:"_1k3w",src:this.props.src,style:k.getPosition()})));}});e.exports=j;},null);
__d("PhotoZoomCropImage.react",["Event","Keys","React","UserAgent","Vector","Image.react","PhotoZoomCropImagePreview.react","cx","ix","fbt","joinClasses"],function(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q){var r=5,s=i.createClass({displayName:"PhotoZoomCropImage",propTypes:{dimensions:i.PropTypes.object,enableDrag:i.PropTypes.bool,src:i.PropTypes.string},getDefaultProps:function(){return {enableDrag:true};},getInitialState:function(){return {moved:false};},componentDidMount:function(){var t=j.isBrowser('IE < 9')?document.documentElement:window;this._listeners=g.listen(t,{mousemove:this._handleMouseMove,mouseup:this._handleMouseUp});},componentWillUnmount:function(){for(var t in this._listeners){this._listeners[t]&&this._listeners[t].remove();this._listeners[t]=null;}},render:function(){var t=this.props.dimensions,u=t.getSize();return (i.createElement("div",i.__spread({},this.props,{className:q(this.props.className,"_4on5"),style:Object.assign({},(this.props.style||{}),{height:u.y,width:u.x})}),i.createElement(m,{dimensions:t,onKeyDown:this._handleKeyDown,size:u,src:this.props.src,tabIndex:0}),i.createElement("div",{className:(("_3dfy")+(this.state.moved||!this.props.enableDrag?' '+"_3dfz":''))},i.createElement("span",{className:"_3df-"},i.createElement(l,{className:"_3-8_ _3df_",src:o('/images/ads/cropper/drag.png')}),"Drag to reposition photo")),i.createElement("img",{className:(("_4on7")+(!this.props.enableDrag?' '+"_3mk2":'')),onDragStart:g.prevent,onMouseDown:this._handleMouseDown,src:this.props.src,style:t.getPosition()})));},_handleKeyDown:function(t){this._position=null;var u=0,v=0;switch(g.getKeyCode(t)){case h.DOWN:v=r;break;case h.LEFT:u=-r;break;case h.RIGHT:u=r;break;case h.UP:v=-r;break;}if(u||v){this.props.onMove(u,v);this.setState({moved:true});}},_handleMouseDown:function(t){if(this._position)return;t.preventDefault();this._position=k.getEventPosition(t);},_handleMouseMove:function(t){if(!this._position||!this.props.enableDrag)return;var u=k.getEventPosition(t),v=this._position.sub(u);this.props.onMove(v.x,v.y);this.setState({moved:true});this._position=u;},_handleMouseUp:function(){this._position=null;}});e.exports=s;},null);
__d("PhotoZoomCropSlider.react",["Keys","React","AbstractRangeInput.react","clamp","cx","joinClasses"],function(a,b,c,d,e,f,g,h,i,j,k,l){var m=6,n=h.createClass({displayName:"PhotoZoomCropSlider",propTypes:{onZoom:h.PropTypes.func,zoom:h.PropTypes.number,zoomRange:h.PropTypes.object},render:function(){var o=this.props.zoomRange;return (h.createElement("div",{className:l(this.props.className,"_55vh")},h.createElement("div",{className:(("_55vi")+(o.min===this.props.zoom?' '+"_4obh":'')),onClick:this._minus,onKeyUp:this._minusIfValid,tabIndex:0},"−"),h.createElement(i,{className:"_55vj",disabled:o.max===o.min,max:o.max,min:o.min,onChange:this.props.onZoom,values:[this.props.zoom]}),h.createElement("div",{className:(("_55vk")+(o.max===this.props.zoom?' '+"_4obh":'')),onClick:this._plus,onKeyUp:this._plusIfValid,tabIndex:0},"+")));},_zoomInDirection:function(o){var p=this.props.zoomRange.max,q=this.props.zoomRange.min;this.props.onZoom([j(this.props.zoom+(o*(p-q)/m),q,p)]);},_minus:function(){this._zoomInDirection(-1);},_minusIfValid:function(event){if(event.which===g.RETURN)this._minus();},_plus:function(){this._zoomInDirection(1);},_plusIfValid:function(event){if(event.which===g.RETURN)this._plus();}});e.exports=n;},null);
__d("PhotoZoomCrop.react",["PhotoZoomCropDimensions","PhotoZoomCropImage.react","PhotoZoomCropImagePreview.react","PhotoZoomCropSlider.react","React","Image.react","cx","joinClasses","xuiglyph"],function(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o){var p=k.createClass({displayName:"PhotoZoomCrop",propTypes:{center:k.PropTypes.object,cropSizeRatio:k.PropTypes.object,enableDrag:k.PropTypes.bool,imageSize:k.PropTypes.object,previewSize:k.PropTypes.number,src:k.PropTypes.string,warningText:k.PropTypes.string},getDefaultProps:function(){return {previewSize:32};},getInitialState:function(){this._dims=new g(this.props.imageSize);if(this.props.center)this._dims.setCenter(this.props.center.x,this.props.center.y);if(this.props.cropSizeRatio){var q=this.props.cropSizeRatio.x*this.props.imageSize.x;this._dims.setZoom(this._dims.getSize().x/q);}return this._getDimensionsState();},render:function(){var q;if(this.state.zoom>1)q=k.createElement("div",{className:"_3p9d"},k.createElement(l,{className:"_3-90 _3p9e",src:o({name:'error-solid',shade:'white',size:'small'})}),this.props.warningText);return (k.createElement("div",{className:n("_4liw",this.props.className)},k.createElement(h,{className:"_1szc",dimensions:this._dims,onMove:this._handleMove,enableDrag:this.props.enableDrag||this._dims.hasSpaceToDrag(),src:this.props.src}),k.createElement(i,{className:"_1szd",dimensions:this._dims,size:{x:this.props.previewSize,y:this.props.previewSize},src:this.props.src}),k.createElement(j,{className:"_4lix",onZoom:this._handleZoom,zoom:this.state.zoom,zoomRange:this._dims.getZoomRange()}),q));},getDimensions:function(){return this._dims;},_handleZoom:function(q){this._dims.setZoom(q[0]);this.setState(this._getDimensionsState());},_handleMove:function(q,r){this._dims.moveByPixels(q,r);this.setState(this._getDimensionsState());},_getDimensionsState:function(){return {dimensions:this._dims.getPosition(),zoom:this._dims.getZoom()};}});e.exports=p;},null);
__d("PhotoTagger",["Arbiter","AsyncRequest","CSS","DOM","Event","FaceboxSourceConstants","Hovercard","Keys","Parent","PhotosConst","PhotosTaggingWaterfall","PhotosUtils","PhotoTagStore","React","SimpleXUIDialog","Style","Vector","XUIDialogCloseButton.react","copyProperties","csx","getElementPosition","removeFromArray","userAction"],function(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v,w,x,y,z,aa,ba,ca){function da(fa,ga){return ((fa%ga)+ga)%ga;}function ea(fa){"use strict";this.viewer=fa;this.version=fa.getVersionConst();this.datasources={};this.photoData={};this.tagRects={};this.ajaxURIs={tagsInit:'/ajax/photos/photo/tags/tags_init.php',tagsAlbum:'/ajax/photos/photo/tags/tags_album.php',fetchDatasource:'/ajax/photos/photo/tags/fetch_datasource.php',tagAction:'/ajax/photo_tagging_ajax.php',tagWithAction:'/ajax/with_tagging_ajax.php'};this.recognizedUsers=[];this.addedSuggestions=[];this.featuredSuggestions=[];this.albumSuggestions=[];this.friendSuggestions=[];this.suggestionAlbum=-1;ea.instances[this.version]=this;}ea.prototype.initSnowlift=function(fa,ga,ha){"use strict";this._init(fa,ga,ha,this.viewer.container);};ea.prototype.initPermalink=function(fa,ga,ha){"use strict";this._init(fa,ga,ha,this.viewer.actionList);};ea.prototype._init=function(fa,ga,ha,ia){"use strict";this.setupUserActionLogging();this.root=this.viewer.getRoot();this.tagger=fa;this.tokenizer=ga;this._qn=null;this.typeahead=ga.getTypeahead();this.userId=ha;this.makeProfilePicMenuContainer=ia;this.faceboxes=[];this.tags=[];this.currentFacebox=null;this.revokedFaceboxes=[];this.requestFaceboxNextTag=false;this.clickState=j.find(this.root,'div.stageActions');this.newTagBox=j.find(this.clickState,'div.newTagBox');this.addTagLink=j.find(this.root,this.elemNames[this.version].addTagLink);this.overlayActions=j.find(this.root,this.elemNames[this.version].overlayActions);this.setupHandlers();this.hideNewTagTimer=null;this.needAlbumSuggestionsFetch=true;this.fetchTaggingSuggestions({owner:this.photoData.owner});this.setDataSource(this.typeahead.getData());this.updateFaceboxes();this.tagAccumulating=false;return this;};ea.prototype.setTagAccumulator=function(fa){"use strict";this.tagAccumulating=fa;};ea.prototype.setupUserActionLogging=function(){"use strict";this.ua=ca(this.viewer.getSourceString()).uai('init','tagging').add_event('init');};ea.prototype.logUserActionEvent=function(fa){"use strict";this.ua.add_event(fa);};ea.prototype.fetchTaggingSuggestions=function(fa){"use strict";this.logUserActionEvent('sugg_fetch');new h().setURI(this.ajaxURIs.tagsInit).setData(fa).setOption('retries',1).setAllowCrossPageTransition(true).setHandler(function(ha){var ia=ha.getPayload();this.featuredSuggestions=ia.featuredTaggees;this.friendSuggestions=ia.friendTaggees;this.updateTypeaheadSuggestions();this.logUserActionEvent('sugg_fetch_done');}.bind(this)).send();var ga=this.typeahead.subscribe('bootstrap',function(ha,ia){if(ia&&!ia.bootstrapping){if(this.taggingMode)this.updateWithSuggestions();this.typeahead.unsubscribe(ga);this.typeahead.subscribe('focus',function(){if(this.taggingMode)this.updateWithSuggestions();}.bind(this));this.typeahead.subscribe('click',function(){if(!this.taggingMode)this.updateWithSuggestions();}.bind(this));this.tokenizer.subscribe('removeToken',this.updateWithSuggestions.bind(this));this.tokenizer.subscribe('addToken',this.addSuggestion.bind(this));this.typeahead.subscribe('respond',function(ja,ka){if(this.taggingMode&&ka&&!ka.results.length)this.updateWithSuggestions();}.bind(this));}}.bind(this));};ea.prototype.fetchAlbumTaggingSuggestions=function(){"use strict";this.logUserActionEvent('sugg_album_fetch');new h().setURI(this.ajaxURIs.tagsAlbum).setData({cachedAlbum:this.suggestionAlbum,photo:this.photoData.fbid}).setOption('retries',1).setAllowCrossPageTransition(true).setHandler(function(fa){this.needAlbumSuggestionsFetch=false;var ga=fa.getPayload();if(ga.length===0)return;this.suggestionAlbum=ga.album;this.albumSuggestions=ga.taggees;this.updateTypeaheadSuggestions();this.logUserActionEvent('sugg_album_fetch_done');}.bind(this)).send();};ea.prototype.resetAlbumTaggingSuggestions=function(){"use strict";this.needAlbumSuggestionsFetch=true;this.updateTypeaheadSuggestions();};ea.prototype.updateTypeaheadSuggestions=function(){"use strict";this.typeahead.getView().setSuggestions(this.addedSuggestions.concat(this.recognizedUsers,this.featuredSuggestions,this.needAlbumSuggestionsFetch?[]:this.albumSuggestions,this.friendSuggestions));};ea.prototype.saveClickPosition=function(fa,ga){"use strict";var ha=w.getElementPosition(fa),ia=w.getElementDimensions(fa);this.clickPercentToPhoto=new w((ga.x-ha.x)/ia.x,(ga.y-ha.y)/ia.y);};ea.prototype.getCalculatedClickPosition=function(fa){"use strict";var ga=w.getElementPosition(fa),ha=w.getElementDimensions(fa);if(ha.x===0||ha.y===0)return null;return new w(this.clickPercentToPhoto.x*ha.x+ga.x,this.clickPercentToPhoto.y*ha.y+ga.y,'document');};ea.prototype.repositionTagger=function(){"use strict";if(this.clickPercentToPhoto){var fa=this.viewer.getImage(),ga=this.getCalculatedClickPosition(fa);if(!ga)return;this.addTagFromClickPos(ga);}};ea.prototype.setupHandlers=function(){"use strict";this.handlers=[k.listen(this.clickState,'click',this.addTag.bind(this)),k.listen(this.addTagLink,'click',this.checkActions.bind(this)),k.listen(this.overlayActions,'click',this.checkActions.bind(this))];k.listen(document.documentElement,'keydown',function(event){if(!this.taggingMode)return;var fa=k.getKeyCode(event);if(fa===n.ESC){this.deactivateTagging();}else if(fa===n.TAB)this.addNextTagFromFacebox(event.shiftKey?-1:1);}.bind(this));this.subscriptions=[g.subscribe(this.viewer.getEventString('PAGE'),this.restartTagging.bind(this)),g.subscribe(this.viewer.getEventString('DATA_CHANGE'),this.setPhotoData.bind(this)),g.subscribe(this.viewer.getEventString('EXTRA_DATA_CHANGE'),this.setExtraData.bind(this)),g.subscribe(this.viewer.getEventString('CLOSE'),this.deactivateTagging.bind(this))];this.tokenizer.subscribe('addToken',this.saveTag.bind(this));this.tokenizer.subscribe('removeToken',this.removeTag.bind(this));this.tokenizer.subscribe('markTagAsSpam',this.markTagAsSpam.bind(this));};ea.prototype.updateWithSuggestions=function(fa,ga){"use strict";var ha=this.typeahead.getData().buildUids(' ',this.typeahead.getView().getSuggestions(),this.typeahead.getCore().getExclusions());if(!ha.length)return;var ia=this.typeahead.getData().respond('',ha);for(var ja=0;ja<ia.length;ja++)ia[ja].index=-1000+ja;};ea.prototype.addSuggestion=function(fa,ga){"use strict";var ha=ga.info&&ga.info.uid;if(ha){this.addedSuggestions.unshift(ha);this.updateTypeaheadSuggestions();}};ea.prototype.setQueueName=function(fa){"use strict";this._qn=fa;return this;};ea.prototype._sendWaterfallLogSignal=function(fa){"use strict";q.sendSignal({qn:this._qn,source:this.viewer.getSourceString(),step:fa,pid:this.photoData.pid});};ea.prototype._sendFaceboxSuggestionLogSignal=function(fa,ga){"use strict";q.sendSignal({step:q.SHOW_SUGGEST,photo_owner:this.photoData.owner,tagee:fa,is_first:true,source:ga});};ea.prototype._bumpQueueName=function(){"use strict";if(this._qn)this._qn+=1;};ea.prototype.activateTagging=function(){"use strict";this.logUserActionEvent('activate');g.inform('PhotoTagger.ACTIVATE_TAGGING');if(this.getDataSource()){this.dataSourceFetched(this.getDataSource());}else new h(this.ajaxURIs.fetchDatasource).setData({fbid:this.photoData.fbid,version:this.version}).send();if(this.needAlbumSuggestionsFetch)this.fetchAlbumTaggingSuggestions();};ea.prototype.restartTagging=function(){"use strict";this.hideNewTag();this.hideTagger();this.revokedFaceboxes=[];this.setCurrentFacebox(null);if(this.taggingMode){this.requestFaceboxNextTag=true;this.activateTagging();}};ea.prototype.getDataSource=function(){"use strict";return this.datasources[this.getDataSourceKey()];};ea.prototype.getDataSourceKey=function(){"use strict";if(this.photoData.ownertype=='user'&&!this.photoData.obj_id)return 'friends';return this.photoData.obj_id||this.photoData.owner;};ea.prototype.setDataSource=function(fa){"use strict";if(this.typeahead.getData()!=fa)this.typeahead.swapData(fa);this.datasources[this.getDataSourceKey()]=fa;};ea.prototype.dataSourceFetched=function(fa){"use strict";this.taggingMode=true;i.addClass(this.root,'taggingMode');g.inform('PhotoTagger.ACTIVATED_TAGGING');this._bumpQueueName();this._sendWaterfallLogSignal(q.BEGIN);this.setDataSource(fa);};ea.prototype.deactivateTagging=function(){"use strict";this.logUserActionEvent('deactivate');if(this.taggingMode===true)this._sendWaterfallLogSignal(q.FINISH);this.taggingMode=false;this.hideNewTag();this.hideTagger();this.setCurrentFacebox(null);i.removeClass(this.root,'taggingMode');g.inform('PhotoTagger.DEACTIVATED_TAGGING');};ea.prototype.checkActions=function(event){"use strict";var fa=event.getTarget();if(o.byClass(fa,'fbPhotosPhotoActionsTag'))if(this.taggingMode){this.deactivateTagging();}else{this.activateTagging();this.addNextTagFromFacebox(1);}};ea.prototype.hideTagger=function(){"use strict";i.hide(this.tagger);this.clickPercentToPhoto=null;var fa=j.scry(this.tagger,'input.textInput')[0];if(fa)fa.blur();};ea.prototype.showTagger=function(){"use strict";var fa=j.find(this.tagger,'.typeaheadContainer'),ga=j.find(fa,'.arrow .nub'),ha=aa(fa),ia=3;v.set(fa,'margin-left',0);v.set(ga,'margin-left',0);i.show(this.tagger);if(ha.x<0){v.set(fa,'margin-left',((-2*ha.x)+'px'));v.set(ga,'margin-left',(ha.x-ia)+'px');}setTimeout((function(){j.find(this.tagger,'input.textInput').focus();}).bind(this),0);this.hideNewTag();g.inform('reflow');};ea.prototype.showNewTag=function(fa){"use strict";if(!this.newTagBox)return;j.setContent(j.find(this.newTagBox,'div.tagName'),j.create('span',null,fa));i.show(this.newTagBox);this.hideNewTagTimer=setTimeout(this.hideNewTag.bind(this),3000);};ea.prototype.hideNewTag=function(){"use strict";if(!this.newTagBox)return;if(this.hideNewTagTimer!==null){clearTimeout(this.hideNewTagTimer);this.hideNewTagTimer=null;}i.hide(this.newTagBox);};ea.prototype.getTaggerPositioningOrigin=function(){"use strict";return w.getElementPosition(this.clickState,'document');};ea.prototype.setClickPosAndFacebox=function(fa){"use strict";var ga=this.viewer.getImage();this.saveClickPosition(ga,fa);var ha=r.absoluteToNormalizedPosition(ga,fa);this.setCurrentFacebox(this.findNearestFacebox(ha));};ea.prototype.addTagFromClickPos=function(fa){"use strict";if(this.currentFacebox){this.addTagFromFaceboxDontSave(this.currentFacebox);}else{this.removeSuggestionFromTagger();i.removeClass(j.find(this.tagger,'.faceBox'),'faceBoxHidden');this.addTagFromPosition(fa,this.TAG_BOX_SIZE);}};ea.prototype.addTag=function(event){"use strict";var fa=event.getTarget(),ga=o.byClass(fa,'fbPhotosPhotoButtons');if(!this.taggingMode||(ga&&fa!==ga)||o.byClass(fa,'fbPhotosPhotoActions')||o.byClass(fa,'faceboxSuggestion')||o.byClass(fa,'photoTagTypeahead'))return;var ha=w.getEventPosition(event);this.setClickPosAndFacebox(ha);this.addTagFromClickPos(ha);};ea.prototype._findNearest=function(fa,ga){"use strict";var ha=Infinity,ia=null;fa.forEach(function(ja){if(ja.rect.contains(ga)){var ka=ga.distanceTo(ja.rect.getCenter());if(ka<ha){ha=ka;ia=ja;}}});return ia;};ea.prototype.findNearestFacebox=function(fa){"use strict";return this._findNearest(this.faceboxes,fa);};ea.prototype.findNearestTag=function(fa){"use strict";return this._findNearest(this.tags,fa);};ea.prototype.addNextTagFromFacebox=function(fa){"use strict";if(this.faceboxes.length===0)return;if(!this.currentFacebox){this.setCurrentFacebox(this.faceboxes[0]);}else{var ga=this.faceboxes.indexOf(this.currentFacebox),ha=da(ga+fa,this.faceboxes.length);if(ha===ga)return;this.setCurrentFacebox(this.faceboxes[ha]);}this.addTagFromFacebox(this.currentFacebox);};ea.prototype.addTagFromFaceboxDontSave=function(fa){"use strict";i.addClass(fa.node,'active');i.addClass(j.find(this.tagger,'.faceBox'),'faceBoxHidden');var ga=fa.rect.getCenter(),ha=this.viewer.getImage(),ia=r.normalizedToAbsolutePosition(ha,ga),ja=(fa.rect.w()/100)*w.getElementDimensions(ha).x;if(fa.rect.w()>this.HUGE_FACE_THRESH&&fa.rect.h()>this.HUGE_FACE_THRESH)ja*=this.HUGE_FACE_SHRINK_FACTOR;var ka=this.getFaceboxSuggestionFromFaceboxElem(fa.node);if(ka){var la=(this.version===p.VIEWER_PERMALINK)?l.PERMALINK_DISMISS:l.SNOWLIFT_DISMISS;this.addSuggestionToTagger(fa,ka);this._sendFaceboxSuggestionLogSignal(ka.getAttribute('data-id'),la);}else this.removeSuggestionFromTagger();this.addTagFromPosition(ia,ja);return ia;};ea.prototype.getFaceboxSuggestionFromFaceboxElem=function(fa){"use strict";return j.scry(fa,"._570u")[0];};ea.prototype.addSuggestionToTagger=function(fa,ga){"use strict";this.removeSuggestionFromTagger();i.addClass(this.tagger,'suggestionActive');var ha=j.find(this.tagger,'.typeaheadContainer'),ia=ga.cloneNode(true);this.stripReactID(ia);j.appendContent(ha,ia);this.setupFaceboxSuggestionHandlers(fa,ia);};ea.prototype.stripReactID=function(fa){"use strict";fa.removeAttribute('data-reactid');for(var ga=0;ga<fa.children.length;ga++)this.stripReactID(fa.children[ga]);};ea.prototype.removeSuggestionFromTagger=function(){"use strict";i.removeClass(this.tagger,'suggestionActive');var fa=j.scry(this.tagger,'.faceboxSuggestion');fa&&fa.forEach(function(ga){j.remove(ga);});};ea.prototype.dismissFaceboxSuggestion=function(fa,ga,ha,ia){"use strict";new h().setURI('/ajax/dismiss_tag_suggest.php').setMethod('POST').setData({facebox_logs:[{facebox:fa,log_data:{photo_owner:ha,tagee:ga,is_first:true}}],closing_source:ia,closing_action:'no'}).setAllowCrossPageTransition(true).send();};ea.prototype.addTagFromFacebox=function(fa){"use strict";var ga=this.addTagFromFaceboxDontSave(fa),ha=this.viewer.getImage();this.saveClickPosition(ha,ga);};ea.prototype.addTagFromPosition=function(fa,ga){"use strict";var ha=this.viewer.getImage(),ia=this.calcTaggerPosition(ha,fa,ga);this.calcClickPoint(ha,fa);if(!ia){this.hideTagger();return;}ia.setElementPosition(this.tagger);if(this.newTagBox){ia.setElementPosition(this.newTagBox);new w(ga,ga).setElementDimensions(this.newTagBox);}var ja=w.getElementPosition(ha),ka=w.getElementDimensions(ha),la=this.typeahead.getView();if(fa.y>ja.y+ka.y*3/4){i.addClass(this.tagger,'fbPhotoTaggerFlipped');la.addTypeaheadFlip('fbPhotoTaggerFlipped');if(fa.x>ja.x+ka.x*1/2){this.flipRules('fbPhotoTaggerRight','fbPhotoTaggerLeft',la);}else this.flipRules('fbPhotoTaggerLeft','fbPhotoTaggerRight',la);}else{i.removeClass(this.tagger,'fbPhotoTaggerFlipped');i.removeClass(this.tagger,'fbPhotoTaggerLeft');i.removeClass(this.tagger,'fbPhotoTaggerRight');la.removeTypeaheadFlip('fbPhotoTaggerFlipped');la.removeTypeaheadFlip('fbPhotoTaggerLeft');la.removeTypeaheadFlip('fbPhotoTaggerRight');}this.showTagger();if(this.taggingMode){this._sendWaterfallLogSignal(q.TAG_FACE);}else this._sendWaterfallLogSignal(q.HOVER_TAG_FACE);};ea.prototype.flipRules=function(fa,ga,ha){"use strict";i.addClass(this.tagger,fa);i.removeClass(this.tagger,ga);ha.addTypeaheadFlip(fa);ha.removeTypeaheadFlip(ga);};ea.prototype.calcTaggerPosition=function(fa,ga,ha,ia){"use strict";ia=ia||ha;var ja=w.getElementPosition(fa),ka=w.getElementDimensions(fa),la=new w(ha/2,ia/2),ma=ga.sub(ja);for(var na in {x:1,y:1}){if(ga[na]<ja[na]||ga[na]>ja[na]+ka[na])return null;var oa=na==='x'?ha:ia;if(ma[na]<(oa/2)){la[na]=ma[na];}else if(ka[na]<ma[na]+(oa/2))la[na]=oa-(ka[na]-ma[na]);}var pa=3,qa=j.find(this.tagger,'.faceBox');v.set(qa,'width',(ha-pa*2)+'px');v.set(qa,'height',(ia-pa*2)+'px');var ra=ga.sub(this.getTaggerPositioningOrigin());return ra.sub(la.x,la.y);};ea.prototype.calcClickPoint=function(fa,ga){"use strict";var ha=w.getElementDimensions(fa),ia=w.getElementPosition(fa),ja=ga.sub(ia);this.clickPoint={x:ja.x/ha.x,y:ja.y/ha.y};};ea.prototype.getTaggingDataForSave=function(fa,ga){"use strict";var ha=this.getTaggingData('add',fa.isFreeform()?'':fa.getValue(),fa.getText(),ga);ha.x=this.clickPoint.x*100;ha.y=this.clickPoint.y*100;ha.from_facebox=!!this.currentFacebox;ha.tagging_mode=!!this.taggingMode;return ha;};ea.prototype.saveTag=function(fa,ga,ha){"use strict";var ia=this.getTaggingDataForSave(ga,ha);this.logUserActionEvent('save');if(this.tagAccumulating){s.getInstance().storeTagWithOptions(this.photoData.fbid,ia.subject,ia.x,ia.y,ia);}else new h().setURI(this.ajaxURIs.tagAction).setMethod('POST').setData(ia).setAllowCrossPageTransition(true).setHandler(this.tagsChangeHandler.bind(this)).setErrorHandler(this.checkError.bind(this,ga)).send();var ja=(this.userId===ia.subject);if(ja){var ka=j.scry(this.makeProfilePicMenuContainer,'[data-picid="'+this.viewer.getCurrentPhotoInfo().fbid+'"]');if(ka.length===1){var la=ka[0];i.removeClass(la,'hide');}}this.showNewTag(ga.getText());this.hideTagger();var ma=this.currentFacebox;if(ma){if(this.taggingMode)this.addNextTagFromFacebox(1);this.removeFacebox(ma);}g.inform('PhotoTagger.ADDING_TAG',{subject:ia.subject,text:ga.getText()});g.inform('PhotoTagger.SAVE_TAG',{photo_fbid:this.photoData.fbid,self_tag:ja});};ea.prototype.getTaggingData=function(fa,ga,ha,ia){"use strict";return {cs_ver:this.version,pid:this.photoData.pid,fbid:this.photoData.fbid,id:this.photoData.owner,subject:ga,name:ha,action:fa,source:ia?ia:this.viewer.getSourceString(),qn:this._qn,position:this.getPosition(),slsource:this.viewer.getViewerSource(),slset:this.viewer.getViewerSet()};};ea.prototype.getPosition=function(){"use strict";return this.viewer.getPosition();};ea.prototype.tagsChangeHandler=function(fa){"use strict";this.logUserActionEvent('save_done');};ea.prototype.checkError=function(fa,ga){"use strict";if(ga.getPayload()&&ga.getPayload().clear_tag){fa.already_untagged=true;this.tokenizer.removeToken(fa);}u.showEx(ga.errorDescription,ga.errorSummary,t.createElement(x,null));};ea.prototype.removeTag=function(fa,ga,ha){"use strict";if(ga.already_untagged)return;var ia='remove';if(j.scry(ga.element,'a.pending')[0])ia='retract';if(ga.blockUser)ia='remove_block';this.logUserActionEvent('save');if(this.tagAccumulating){if(ga.isFreeform()){s.getInstance().removeTextTag(this.photoData.fbid,ga.getInfo().text);}else s.getInstance().removeTag(this.photoData.fbid,ga.getInfo().uid);}else new h().setURI(this.ajaxURIs.tagAction).setMethod('POST').setData(this.getTaggingData(ia,ga.isFreeform()?'':ga.getInfo().uid,ga.getInfo().text)).setHandler(function(la){this.tagsChangeHandler(la);ha&&ha();}.bind(this)).setAllowCrossPageTransition(true).send();if(this.userId===parseInt(ga.getValue(),10)&&this.userId!==this.viewer.getCurrentPhotoInfo().owner){var ja=j.scry(this.makeProfilePicMenuContainer,'[data-picid="'+this.viewer.getCurrentPhotoInfo().fbid+'"]');if(ja.length===1){var ka=ja[0];i.addClass(ka,'hide');}g.inform('PhotoTagger.REMOVED_MAKE_PROFILE_PIC_OPTION');}};ea.prototype.removeTagByID=function(fa,ga,ha){"use strict";var ia=this.tokenizer.tokens;for(var ja=0;ja<ia.length;ja++)if(ia[ja].info.uid==ga)return this.removeTag(null,ia[ja],ha);};ea.prototype.removeTagByIDFromHovercardLink=function(fa,ga,ha){"use strict";this.removeTagByID(fa,ga,function(){if(m.contains(ha))m.hide(true);});};ea.prototype.removeWithTag=function(fa,ga){"use strict";new h().setURI(this.ajaxURIs.tagWithAction).setMethod('POST').setData({action:'remove_with',taggee:ga,tag:fa,version:this.version,fbid:this.photoData.fbid}).setHandler(function(ha){this.tagsChangeHandler(ha);if(window.Hovercard)window.Hovercard.hide(true);}.bind(this)).setAllowCrossPageTransition(true).send();};ea.prototype.setPhotoData=function(fa,ga){"use strict";this.clickPercentToPhoto=null;this.photoData=ga;return this;};ea.prototype.setExtraData=function(fa,ga){"use strict";this.tagRects=ga.tagRects;this.updateFaceboxes();this._setInitialFaceboxFromID(ga);if(ga.openTag)setTimeout(function(){this.activateTagging();this._setInitialFaceboxFromID(ga);if(this.faceboxes.length===1){this.addTagFromFacebox(this.currentFacebox);}else this.addNextTagFromFacebox(1);}.bind(this),0);return this;};ea.prototype._setInitialFaceboxFromID=function(fa){"use strict";if(fa.initialFaceboxID!==null&&this.faceboxes.length!==0){var ga=this.getFacebox(fa.initialFaceboxID);if(ga!==null){var ha=this.faceboxes.indexOf(ga);ha=da(ha-1,this.faceboxes.length);this.setCurrentFacebox(this.faceboxes[ha]);}}};ea.prototype.markTagAsSpam=function(fa,ga){"use strict";new h().setURI(this.ajaxURIs.tagAction).setMethod('POST').setData(this.getTaggingData('mark_as_spam',ga,null)).send();};ea.prototype.removeFacebox=function(fa){"use strict";if(fa===null)return;this.revokedFaceboxes.push(fa.rect.getCenter());ba(this.faceboxes,fa);j.remove(fa.node);if(fa===this.currentFacebox)this.setCurrentFacebox(null);};ea.prototype.setCurrentFacebox=function(fa){"use strict";if(this.currentFacebox)i.removeClass(this.currentFacebox.node,'active');this.currentFacebox=fa;if(fa){this.recognizedUsers=JSON.parse(fa.node.getAttribute('data-recognizeduids'));this.updateTypeaheadSuggestions();}};ea.prototype.updateRevokedFaceboxes=function(){"use strict";this.revokedFaceboxes=this.revokedFaceboxes.filter(function(fa){for(var ga=0;ga<this.faceboxes.length;++ga){var ha=this.faceboxes[ga],ia=fa.distanceTo(ha.rect.getCenter());if(ia<this.EPSILON)return true;}return false;}.bind(this));this.revokedFaceboxes.forEach(function(fa){var ga=this.findNearestFacebox(fa);ba(this.faceboxes,ga);j.remove(ga.node);}.bind(this));};ea.prototype.updateFaceboxes=function(){"use strict";this.faceboxes=[];this.tags=[];for(var fa in this.tagRects){var ga;if(r.isFacebox(fa)){ga=this.faceboxes;}else if(r.isTag(fa))ga=this.tags;if(ga){var ha='container';if(this.version===p.VIEWER_PERMALINK)ha='root';var ia=j.scry(this.viewer[ha],'#'+fa);if(ia.length>0)ga.push({node:ia[0],id:fa,rect:this.tagRects[fa]});}}this.updateRevokedFaceboxes();this.faceboxes.sort(function(ka,la){return ka.rect.getCenter().x-la.rect.getCenter().x;});if(this.currentFacebox){var ja=this.currentFacebox.rect.getCenter();this.setCurrentFacebox(this.findNearestFacebox(ja));i.addClass(this.currentFacebox.node,'active');}if(this.requestFaceboxNextTag){this.addNextTagFromFacebox(1);this.requestFaceboxNextTag=false;}};ea.prototype.getFacebox=function(fa){"use strict";for(var ga=0;ga<this.faceboxes.length;++ga)if(this.faceboxes[ga].id===fa)return this.faceboxes[ga];return null;};ea.prototype.setupFaceboxSuggestionHandlers=function(fa,ga){"use strict";var ha=j.find(ga,"a._570w"),ia=j.find(ga,"a._570x");this.handlers.push(k.listen(ha,'click',function(ja){var ka=this._getCurrentFaceboxID(),la=(this.version===p.VIEWER_PERMALINK)?l.PERMALINK_DISMISS:l.SNOWLIFT_DISMISS;this.dismissFaceboxSuggestion(fa.id.replace('face:',''),ga.getAttribute('data-id'),this.photoData.owner,la);this.removeSuggestionFromTagger();this.hideTagger();j.remove(this.getFaceboxSuggestionFromFaceboxElem(fa.node));g.inform('PhotoTagger.TAG_SUGGESTION_REJECTED/'+ka);}.bind(this)),k.listen(ia,'click',function(ja){var ka=this._getCurrentFaceboxID(),la={uid:ga.getAttribute('data-id'),text:ga.getAttribute('data-text')},ma=this.tokenizer.createToken(la),na=(this.version===p.VIEWER_PERMALINK)?l.PERMALINK_SUGGEST:l.SNOWLIFT_SUGGEST;this.saveTag(null,ma,na);g.inform('PhotoTagger.TAG_SUGGESTION_CONFIRMED/'+ka);}.bind(this)));};ea.prototype._getCurrentFaceboxID=function(){"use strict";return this.currentFacebox&&this.currentFacebox.id.substring(5);};ea.getInstance=function(fa){"use strict";return ea.instances[fa];};ea.resetAlbumTaggingSuggestions=function(fa){"use strict";var ga=ea.getInstance(fa);ga&&ga.resetAlbumTaggingSuggestions();};y(ea,{instances:{}});y(ea.prototype,{TAG_BOX_SIZE:100,EPSILON:.0025,HUGE_FACE_THRESH:90,HUGE_FACE_SHRINK_FACTOR:.6,elemNames:{6:{addTagLink:'div.fbPhotosPhotoOwnerButtons',overlayActions:'div.snowliftOverlayBar'}}});e.exports=ea;},null);
__d("PhotoPermalink",["Arbiter","Assert","AsyncRequest","Bootloader","CSS","DOM","Event","KeyEventController","Keys","PageTransitions","Parent","PhotoPermalinkURI","PhotosConst","PhotoSessionLog","PhotoStreamCache","PhotoTagSearchPivotLogger","PhotosUtils","PhotoTagger","PhotoViewer","Style","Vector","$","copyProperties","createArrayFromMixed","emptyFunction","ge","goURI"],function(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v,w,x,y,z,aa,ba,ca,da,ea,fa,ga){for(var ha in y)if(y.hasOwnProperty(ha))ja[ha]=y[ha];var ia=y===null?null:y.prototype;ja.prototype=Object.create(ia);ja.prototype.constructor=ja;ja.__superConstructor__=y;function ja(){"use strict";y.call(this);this.encodingMode=false;this._uriStack=[];this.replaceUrl=false;this.payloadInitialized=false;this._seenTags={};}ja.prototype.init=function(ka){"use strict";this.stream=new u();this.stream.init(s.VIEWER_PERMALINK,'PhotoViewerPagelet','pagelet_photo_viewer');this.reset();this.root=ba('fbPhotoPageContainer');this.header=ba('fbPhotoPageHeader');this.stageWrapper=l.find(this.root,'.stageContainer');this.videoStage=l.find(this.stageWrapper,'div.videoStage');this.buttonActions=l.find(this.root,'div.stageButtons');this.viewLargerLink=l.scry(this.root,'a.fbPhotoViewLarger').pop();this.feedback=fa('fbPhotoPageFeedback');this.image=fa('fbPhotoImage');this.errorBox=fa('fbPhotoPageError');this.actionList=fa('fbPhotoPageActions');this.stageActions=l.find(this.root,'div.stageActions');this.showingTypeaheadSuggestions=false;this.loadingStates={image:false,html:false};this.unhiliteTimer=null;this.source=null;if(this.image)this.imageLoadListener=m.listen(this.image,'load',this.adjustForNewData.bind(this));this.pageHandlers=[m.listen(this.root,'mouseout',this.mouseOutListener.bind(this)),m.listen(this.root,'mousemove',this.mouseMoveListener.bind(this)),m.listen(this.stageWrapper,'click',this.stageClickListener.bind(this)),m.listen(this.buttonActions,'click',this.buttonListener.bind(this)),m.listen(this.actionList,'click',this.rotateListener.bind(this)),m.listen(this.feedback,'click',function(event){var la=event.getTarget();if(q.byClass(la,'like_link')||(q.byClass(la,'UFILikeLink')&&q.byClass(la,'UIActionLinks')))k.toggleClass(l.find(this.buttonActions,'div.likeCommentGroup'),'viewerLikesThis');}.bind(this))];p.registerHandler(this.transitionHandler.bind(this));n.registerKey('LEFT',this.goNav.bind(this));n.registerKey('RIGHT',this.goNav.bind(this));t.initLogging(t.PERMALINK);this._showHover=ka.pivot_hover;g.subscribe('PhotoTagApproval.HILITE_TAG',this.onHiliteTag.bind(this));g.subscribe('PhotoTagApproval.UPDATE_TAG_BOX',this.onUpdateTagBox.bind(this));this.adjustForNewData();};ja.prototype.getEventPrefix=function(){"use strict";return 'PhotoPermalink';};ja.prototype.getSourceString=function(){"use strict";return 'permalink';};ja.prototype.getViewerSource=function(){"use strict";return this.source;};ja.prototype.getViewerSet=function(){"use strict";return this.stream.getPhotoSet();};ja.prototype.getVersionConst=function(){"use strict";return s.VIEWER_PERMALINK;};ja.prototype.saveTagsFromPayload=function(ka){"use strict";this.storeFromData(ka);if('data' in ka&&this.stream.getCursor() in ka.data)this.swapData();};ja.prototype.goNav=function(event){"use strict";var ka=m.getKeyCode(event)||event.getTarget(),la=event.type==='click'&&q.byClass(ka,'stageWrapper')&&!q.byClass(ka,'tagBoxPending')&&!q.byClass(ka,'tagBoxPendingResponse')&&!q.byClass(ka,'uiButtonGroup');if(la&&k.hasClass(this.root,'taggingMode'))return false;if(ka==o.LEFT){this.page(-1);}else if(ka==o.RIGHT||la)this.page(1);return false;};ja.prototype.pagerClick=function(ka){"use strict";if(ka=='prev'){this.page(-1);}else if(ka=='next')this.page(1);return false;};ja.prototype.setLoadingState=function(ka,la){"use strict";switch(ka){case ja.STATE_IMAGE_DATA:this.loadingStates[ka]=la;k.conditionClass(this.root,'imageLoading',la);break;case ja.STATE_HTML:this.loadingStates[ka]=la;k.conditionClass(this.root,'dataLoading',la);break;}};ja.prototype.checkState=function(ka){"use strict";if(ka!=ja.STATE_ERROR&&!this.loadingStates[ka])return;switch(ka){case ja.STATE_IMAGE_DATA:var la=this.stream.getCurrentImageData();if(la){if(la.url){this.switchImage(la.url,true);}else if(la.video)this.switchVideo(la.video,true);this.setLoadingState(ka,false);}break;case ja.STATE_HTML:if(this.stream.getCurrentHtml()){this.swapData();this.setLoadingState(ka,false);}break;default:if(this.stream.errorInCurrent()){if(this.image)k.hide(this.image);k.show(this.errorBox);}break;}};ja.prototype.reHilitePendingTag=function(){"use strict";var ka=fa(this.hilitedTag);if(ka&&k.hasClass(ka,'showPendingTagName'))return;var la=l.scry(this.root,'div.tagsWrapper div.showPendingTagName')[0];if(la)this.switchHilitedTags(la.id);};ja.prototype.setReachedLeftEnd=function(){"use strict";this.stream.setReachedLeftEnd();};ja.prototype.setReachedRightEnd=function(){"use strict";this.stream.setReachedRightEnd();};ja.prototype.isPagingAllowed=function(ka){"use strict";return this.stream.isValidMovement(ka)&&!k.hasClass(this.root,'croppingMode');};ja.prototype.page=function(ka,la){"use strict";if(!this.isPagingAllowed(ka)||!this.stream.nonCircularPhotoSetCanPage(ka))return;this._seenTags={};this.unhiliteAllTags();var ma=this.getVideoOnStage();if(ma)this.switchVideo(ma,false);this.recacheData();this.stream.moveCursor(ka);if(this.image)k.hide(this.image);if(this.stream.errorInCurrent()){this.setLoadingState(ja.STATE_HTML,true);k.show(this.errorBox);return;}var na=this.stream.getCurrentImageData();if(na){if(na.url){this.switchImage(na.url,true);if(this.viewLargerLink)this.viewLargerLink.setAttribute('href',na.info.permalink);}else if(na.video)this.switchVideo(na.video,true);if(!la){this.replaceUrl=true;ga(na.info.permalink);}}else{this.waitForLoadCount++;this.setLoadingState(ja.STATE_IMAGE_DATA,true);}if(this.stream.getCurrentHtml()){this.swapData();}else this.setLoadingState(ja.STATE_HTML,true);g.inform('PhotoPermalink.PAGE');};ja.prototype.transitionHandler=function(ka){"use strict";if(!r.isValid(ka))return false;var la=ka.getQualifiedURI().toString();if(!ka.protocol)la=la.replace(/^file:\/\//,"");if(this.replaceUrl){this.replaceUrl=false;this._uriStack.push(la);p.transitionComplete();return true;}var ma=this._uriStack.length;if(ma>=2&&this._uriStack[ma-2]===la)this._uriStack.pop();var na=this.stream.getCursorForURI(ka.getUnqualifiedURI().toString());if(na){var oa=this.stream.getRelativeMovement(na);this.page(oa,true);p.transitionComplete();return true;}return false;};ja.prototype.recacheData=function(ka){"use strict";if(!this.loadingStates.html){var la=this.stream.getCurrentHtml();for(var ma in la){var na=fa(ma);if(na)la[ma]=da(na.childNodes);if(ka!==true&&ma!=='fbPhotoPageHeader')l.empty(ba(ma));}}};ja.prototype.getCurrentPhotoInfo=function(){"use strict";var ka=this.stream.getCurrentImageData();return ka&&ka.info;};ja.prototype.getVideoOnStage=function(){"use strict";var ka=this.stream.getCurrentImageData();return ka&&ka.video;};ja.prototype.switchImage=function(ka,la){"use strict";k.hide(this.image);k.hide(this.errorBox);var ma=this.stream&&this.stream.getCurrentImageData();if(ma){t.addPhotoView(ma.info);if(this._showHover){var na=this.stream.getCurrentExtraData();if(na)v.logImageImpression('permalink',String(this.stream.getCursor()),Object.keys(na.tagRects));}}var oa=l.create('img',{id:'fbPhotoImage',className:'fbPhotoImage',alt:'',src:ka});l.replace(this.image,oa);this.image=oa;if(this.imageLoadListener)this.imageLoadListener.remove();this.imageLoadListener=m.listen(this.image,'load',this.adjustForNewData.bind(this));if(la)this.stream.preloadImages();};ja.prototype.switchVideo=function(ka,la){"use strict";var ma='swf_'+ka;if(la){k.addClass(this.stageWrapper,'showVideo');this.videoStage.id=ka;if(window[ma]&&!fa(ma))window[ma].write(ka);}else{this.videoStage.id='fbPageVideoStage';window[ma].addVariable('video_autoplay',0);l.empty(this.videoStage);k.removeClass(this.stageWrapper,'showVideo');}};ja.prototype.swapData=function(){"use strict";if(this.dataLoadTimer){this.setLoadingState(ja.STATE_HTML,true);clearTimeout(this.dataLoadTimer);this.dataLoadTimer=setTimeout(this.clearTimer.bind(this,true),100);return;}var ka,la=this.stream.getCurrentHtml();if(la){for(var ma in la){var na=la[ma];if(Array.isArray(na)&&na.length===1&&na[0]===(void 0))continue;ka=fa(ma);ka&&l.setContent(ka,la[ma]);}g.inform('PhotoPermalink.DATA_CHANGE',this.stream.getCurrentImageData().info,g.BEHAVIOR_STATE);if(this.stream.getCurrentExtraData()){g.inform('PhotoPermalink.EXTRA_DATA_CHANGE',this.stream.getCurrentExtraData(),g.BEHAVIOR_STATE);var oa=this.stream.getCurrentExtraData();if(oa&&oa.source!==(void 0)){this.source=oa.source;t.setSource(this.source);}}this.setLoadingState(ja.STATE_HTML,false);this.dataLoadTimer=setTimeout(this.clearTimer.bind(this,false),100);}this.adjustForNewData();};ja.prototype.clearTimer=function(ka){"use strict";this.dataLoadTimer=false;ka&&this.swapData();};ja.prototype.adjustForNewData=function(){"use strict";if(!this.image)return;var ka=l.scry(this.stageWrapper,'div.tagsWrapper')[0],la=aa.getElementDimensions(this.image);if(ka){z.set(ka,'width',la.x+'px');z.set(ka,'height',la.y+'px');}};ja.prototype.fetchInitBucket=function(ka){"use strict";if(!this.stream.isLoaded())return;this.stream.fetch(ka,true);};ja.prototype.addPhotoFbids=function(ka,la,ma){"use strict";var na=this.stream.getCursor()===null;this.stream.attachToFbidsList(ka,la,ma);if(ma&&na)this.page(0);};ja.prototype.attachTagger=function(ka){"use strict";l.appendContent(this.stageActions,ka);};ja.prototype.storeFromData=function(ka){"use strict";var la=this.stream.storeToCache(ka);if('init' in ka){t.setPhotoSet(this.stream.getPhotoSet());t.setLogFbids(true);t.addPhotoView(this.stream.getCurrentImageData().info);if(this._showHover){var ma=this.stream.getCurrentExtraData();if(ma)v.logImageImpression('permalink',String(this.stream.getCursor()),Object.keys(ma.tagRects));}}if('error' in la){this.checkState(ja.STATE_ERROR);return;}if('image' in la)this.checkState(ja.STATE_IMAGE_DATA);if('data' in la)this.checkState(ja.STATE_HTML);if(!this.payloadInitialized&&this.stream.getCurrentExtraData()){this.payloadInitialized=true;g.inform('PhotoPermalink.EXTRA_DATA_CHANGE',this.stream.getCurrentExtraData(),g.BEHAVIOR_STATE);}};ja.prototype.handleServerError=function(ka,la){"use strict";l.setContent(this.errorBox,ka);this.storeFromData(la);};ja.prototype.updateTotalCount=function(ka,la,ma){"use strict";var na=fa('fbPhotoPagePositionAndCount');na&&l.setContent(na,ma);this.stream.setTotalCount(ka);this.stream.setFirstCursorIndex(la);};ja.prototype.buttonListener=function(event){"use strict";var ka=event.getTarget();if(q.byClass(ka,'likeButton')){var la=l.scry(this.feedback,'button.like_link')[0];if(!la)la=l.scry(this.feedback,'a.UFILikeLink')[0];la&&la.click();}else if(q.byClass(ka,'commentButton')){var ma=l.scry(this.feedback,'div.commentBox textarea')[0];if(!ma)ma=l.scry(this.feedback,'li.UFIAddComment textarea')[0];if(ma){ma.focus();this.root.scrollTop=this.root.scrollHeight;}}};ja.prototype.rotateListener=function(event){"use strict";var ka=event.getTarget();if(q.byClass(ka,'rotateRight')){this.rotate('right');}else if(q.byClass(ka,'rotateLeft'))this.rotate('left');};ja.prototype.stageClickListener=function(event){"use strict";var ka=event.getTarget(),la=k.hasClass(ka,'faceBox'),ma=(q.byClass(ka,'fbPhotoTagApprovalBox')||q.byClass(ka,'faceboxSuggestion')||q.byClass(ka,'videoStage')||q.byClass(ka,'tag')||q.byClass(ka,'typeaheadWrapper')||q.byClass(ka,'photoTagTypeahead')||q.byClass(ka,'fbPhotoViewLarger')||la);if(la){if(!this.showingTypeaheadSuggestions){var na=this.getTagger();na.updateWithSuggestions();setTimeout((function(){l.find(na.tagger,'input.textInput').focus();}).bind(this),0);}this.showingTypeaheadSuggestions=!this.showingTypeaheadSuggestions;}if(ma){return true;}else this.goNav(event);};ja.prototype.rotate=function(ka){"use strict";var la=this.stream.getCursor();if(this.getVideoOnStage()){var ma=(ka=='left')?270:90;h.isTruthy(this.videoRotateURI,"Video rotate URI not set.");j.loadModules(["VideoRotate"],function(oa){new oa(la,this.videoRotateURI).motionRotate(ma);}.bind(this));return;}var na=ca({fbid:la,opaquecursor:this.stream.getOpaqueCursor(la),cs_ver:s.VIEWER_PERMALINK},this.stream.getPhotoSetQuery());na[ka]=1;this.setLoadingState(ja.STATE_IMAGE_DATA,true);k.hide(this.image);new i('/ajax/photos/photo/rotate/').setMethod('POST').setAllowCrossPageTransition(true).setReadOnly(false).setData(na).setFinallyHandler(this.rotateComplete.bind(this,la)).send();};ja.prototype.rotateComplete=function(ka,la){"use strict";if(ka==this.stream.getCursor()){this.setLoadingState(ja.STATE_IMAGE_DATA,false);this.switchImage(this.stream.getCurrentImageData().url);this.swapData();}};ja.prototype.mouseOutListener=function(event){"use strict";var ka=event.getTarget(),la=event.getRelatedTarget(),ma=q.byClass(ka,'stageActions'),na=q.byClass(ka,'stageWrapper'),oa=q.byClass(la,'stageActions'),pa=q.byClass(la,'stageWrapper'),qa=q.byClass(la,'uiContextualLayer'),ra=(!pa&&!qa&&(na&&!oa)||(ma&&!pa));if(ra)this.unhiliteAllTags(true);};ja.prototype.mouseMoveListener=function(event){"use strict";var ka=event.getTarget(),la=(q.byClass(ka,'faceboxSuggestion')||q.byClass(ka,'tagPointer')||q.byClass(ka,'typeaheadWrapper')||q.byClass(ka,'photoTagTypeahead')||q.byClass(ka,'arrow'));if(!q.byClass(ka,'stageActions')&&!q.byClass(ka,'stageWrapper')||la)return;this.hiliteTagsOnMouseMove(event);};ja.prototype.unhiliteAllTags=function(ka,event){"use strict";l.scry(this.stageWrapper,'div.tagsWrapper div.hover').forEach(function(ma){if(ka&&k.hasClass(ma,'tagBoxPending'))return;k.removeClass(ma,'hover');});if(ka)return;l.scry(this.stageWrapper,'div.tagsWrapper div.otherActive').forEach(function(ma){k.removeClass(ma,'otherActive');});if(this.unhiliteTimer!==null){clearTimeout(this.unhiliteTimer);this.unhiliteTimer=null;}this.hilitedTag=null;this.showingTypeaheadSuggestions=false;if(!k.hasClass(this.root,'taggingMode')){var la=this.getTagger();if(la){la.hideTagger();la.setCurrentFacebox(null);}}};ja.prototype.getTagger=function(){"use strict";return x.getInstance(s.VIEWER_PERMALINK);};ja.prototype.switchHilitedTags=function(ka,la){"use strict";this.unhiliteAllTags();this.hiliteAllBoxes();var ma=fa(ka);if(ma){this.hilitedTag=ka;if(!k.hasClass(this.root,'taggingMode')&&w.isFacebox(this.hilitedTag)){var na=this.getTagger();if(na){k.addClass(ma,'hover');var oa=na.getFacebox(ka);na.setCurrentFacebox(oa);if(oa)na.addTagFromFacebox(oa);}}else k.addClass(ma,'hover');if(k.hasClass(ma,'tagBoxPending')&&!k.hasClass(ma,'showPendingTagName')&&la===true){l.scry(this.stageWrapper,'div.tagsWrapper div.showPendingTagName').forEach(function(pa){k.removeClass(pa,'showPendingTagName');});k.addClass(ma,'showPendingTagName');}}};ja.prototype.hiliteTagsOnMouseMove=function(event){"use strict";if(!this.stream.getCurrentExtraData()||this.getVideoOnStage())return;if(this.unhiliteTimer!==null)return;var ka=event.getTarget();if(q.byClass(ka,'fbPhotoPageTagApproval')||q.byClass(ka,'tagPointer'))return;var la=q.byClass(ka,'tagBoxPending'),ma=false;if(this.hilitedTag){var na=fa(this.hilitedTag);ma=na&&k.hasClass(na,'tagBoxPending');}var oa=((!this.hilitedTag&&la)||(!ma&&la));if(oa){this.switchHilitedTags(la.id);return;}if(la&&(la.id==this.hilitedTag))return;var pa=250,qa=w.absoluteToNormalizedPosition(this.image,aa.getEventPosition(event)),ra=w.getNearestBox(this.stream.getCurrentExtraData().tagRects,qa);if(!ra){if(!ma){this.unhiliteAllTags();this.reHilitePendingTag();}return;}var sa=null;if(ma){var ta={};ta[this.hilitedTag]=this.stream.getCurrentExtraData().tagRects[this.hilitedTag];sa=w.getNearestBox(ta,qa);}if(sa!==null&&ma)return;if(this.hilitedTag!=ra)if(ma){this.unhiliteTimer=setTimeout(this.unhiliteAllTags.bind(this,false,event),pa);}else{if(this._showHover&&!this._seenTags[ra]){this._seenTags[ra]=true;v.logPivotImpression('permalnk','pivot_impression',ra);}this.switchHilitedTags(ra);}};ja.prototype.updateTagBox=function(ka,la){"use strict";this.unhiliteAllTags();var ma=fa(ka);if(!ma)return;k.addClass(ma,'tagBox');k.addClass(ma,'tagBoxPendingResponse');k.removeClass(ma,'tagBoxPending');k.hide(l.find(ma,'span.tagForm'));if(la){k.show(l.find(ma,'span.tagApproved'));}else k.show(l.find(ma,'span.tagIgnored'));};ja.prototype.reset=function(){"use strict";while(this.pageHandlers&&this.pageHandlers.length)this.pageHandlers.pop().remove();if(this.imageLoadListener){this.imageLoadListener.remove();this.imageLoadListener=null;}n.getInstance().resetHandlers();};ja.prototype.onHiliteTag=function(ka,la){"use strict";if(la.version!=s.VIEWER_PERMALINK)return;var ma=la.tag;if(ma){this.switchHilitedTags(ma,true);}else this.unhiliteAllTags();};ja.prototype.onUpdateTagBox=function(ka,la){"use strict";if(la.version==s.VIEWER_PERMALINK)this.updateTagBox(la.id,la.approve);};ja.prototype.disableAutoRefresh=function(){"use strict";clearTimeout(this.timerId);};ja.prototype.isInVideoEncodingMode=function(){"use strict";return this.encodingMode;};ja.prototype.enableAutoRefresh=function(ka){"use strict";this.encodingMode=true;this.timerId=setTimeout(function(){window.location.reload();},ka);};ja.prototype.setHasLocation=function(ka){"use strict";k.conditionClass(this.root,'hasLocation',ka);};ja.getInstance=function(){"use strict";if(!ja._instance)ja._instance=new ja();return ja._instance;};ja.addPhotoFbids=function(ka,la,ma){"use strict";ja.getInstance().addPhotoFbids(ka,la,ma);};ja.setReachedLeftEnd=function(){"use strict";ja.getInstance().setReachedLeftEnd();};ja.setReachedRightEnd=function(){"use strict";ja.getInstance().setReachedRightEnd();};ja.attachTagger=function(ka){"use strict";ja.getInstance().attachTagger(ka);};ja.disableAjaxPipeForVideo=function(){"use strict";var ka=ja.getInstance();if(ka.stream)ka.stream.setUseAjaxPipe(false);};ja.init=function(ka){"use strict";ja.getInstance().init(ka||{});};ja.recacheData=function(ka){"use strict";ja.getInstance().recacheData(ka);};ja.saveTagsFromPayload=function(ka){"use strict";ja.getInstance().saveTagsFromPayload(ka);};ja.saveTagsFromPayloadDelayed=function(ka){"use strict";setTimeout(ja.saveTagsFromPayload.bind(null,ka),2000);};ja.handleServerError=function(ka,la){"use strict";ja.getInstance().handleServerError(ka,la);};ja.setHasLocation=function(ka){"use strict";ja.getInstance().setHasLocation(ka);};ja.storeFromData=function(ka){"use strict";ja.getInstance().storeFromData(ka);};ja.swapData=function(){"use strict";ja.getInstance().swapData();};ja.updateTotalCount=function(ka,la,ma){"use strict";ja.getInstance().updateTotalCount(ka,la,ma);};ja.isInVideoEncodingMode=function(){"use strict";return ja.getInstance().isInVideoEncodingMode();};ja.disableAutoRefresh=function(){"use strict";ja.getInstance().disableAutoRefresh();};ja.enableAutoRefresh=function(ka){"use strict";ja.getInstance().enableAutoRefresh(ka);};ja.setVideoRotateURI=function(ka){"use strict";ja.getInstance().videoRotateURI=ka;};ca(ja,{STATE_ERROR:'error',STATE_HTML:'html',STATE_IMAGE_DATA:'image',MIN_TAG_DISTANCE:80,_instance:null,touchMarkup:ea});e.exports=ja;},null);
__d("PhotoPermalinkTagger",["Arbiter","Event","PhotoPermalink","PhotoTagger","$","copyProperties"],function(a,b,c,d,e,f,g,h,i,j,k,l){for(var m in j)if(j.hasOwnProperty(m))o[m]=j[m];var n=j===null?null:j.prototype;o.prototype=Object.create(n);o.prototype.constructor=o;o.__superConstructor__=j;function o(p){"use strict";j.call(this,i.getInstance(),true);this.photoData=p;}o.prototype.setupHandlers=function(){"use strict";var p=k('imagestage'),q=k('fbPhotoPageTagBoxes');this.handlers=[h.listen(this.clickState,'click',this.addTag.bind(this)),h.listen(p,'click',this.addTag.bind(this)),h.listen(q,'click',this.addTag.bind(this)),h.listen(this.addTagLink,'click',this.checkActions.bind(this)),h.listen(this.overlayActions,'click',this.checkActions.bind(this))];this.subscriptions=[g.subscribe('PhotoPermalink.PAGE',this.restartTagging.bind(this)),g.subscribe('PhotoPermalink.DATA_CHANGE',this.setPhotoData.bind(this)),g.subscribe('PhotoPermalink.EXTRA_DATA_CHANGE',this.setExtraData.bind(this))];this.tokenizer.subscribe('addToken',this.saveTag.bind(this));this.tokenizer.subscribe('removeToken',this.removeTag.bind(this));this.tokenizer.subscribe('markTagAsSpam',this.markTagAsSpam.bind(this));};o.prototype.setDataForTokenizer=function(){"use strict";this.tokenizer.setup(null,this.photoData);return this;};l(o.prototype,{elemNames:{0:{addTagLink:'div.fbPhotosPhotoActions',overlayActions:'div.fbPhotosPhotoButtons'}}});e.exports=o;},null);
__d("legacy:PhotoPermalinkTagger",["PhotoPermalinkTagger"],function(a,b,c,d){a.PhotoPermalinkTagger=b('PhotoPermalinkTagger');},3);
__d("legacy:fb-photos-permalink-js",["PhotoPermalink"],function(a,b,c,d){a.PhotoPermalink=b('PhotoPermalink');},3);
__d("PhotoTags",["Arbiter","CSS","DOM","Event","Parent","PhotosConst","cx","ge"],function(a,b,c,d,e,f,g,h,i,j,k,l,m,n){function o(p,q,r){"use strict";this.tagTargets=p;this.tagBox=q;this.version=r||l.VIEWER_PERMALINK;this.handlers=[];this.tagTargets.forEach(function(s){this.handlers.push(j.listen(s,{mouseover:this.showTag.bind(this),mouseout:this.hideTags.bind(this)}));}.bind(this));this.subscriptions=[];if(this.version==l.VIEWER_SNOWLIFT)this.subscriptions.push(g.subscribe("PhotoSnowlift.PAGE",this.hideTags.bind(this)));}o.prototype.showTag=function(event){"use strict";var p=event.getTarget(),q=h.hasClass(p,'taggee'),r=h.hasClass(p,"_54ru"),s=null;if(q){s=p.getAttribute('data-tag');}else if(r){var t=k.byTag(p,'a');s=t&&t.getAttribute('data-tag');}if(!s){p=k.byClass(p,'taggee');if(p)s=p.getAttribute('data-tag');}var u=this.version==l.VIEWER_PERMALINK?'perm:tag:'+s:'tag:'+s,v=u&&n(u);if(v){h.addClass(v,'showTag');h.addClass(this.tagBox,'showingTag');}};o.prototype.hideTags=function(){"use strict";h.removeClass(this.tagBox,'showingTag');i.scry(this.tagBox,'div.showTag').forEach(function(p){h.removeClass(p,'showTag');});};o.prototype.destroy=function(){"use strict";for(var p in this.handlers)this.handlers[p].remove();this.subscriptions.forEach(g.unsubscribe.bind(g));};e.exports=o;},null);
__d("legacy:PhotoTags",["PhotoTags"],function(a,b,c,d){a.PhotoTags=b('PhotoTags');},3);
__d("TagToken",["DOM","Token"],function(a,b,c,d,e,f,g,h){for(var i in h)if(h.hasOwnProperty(i))k[i]=h[i];var j=h===null?null:h.prototype;k.prototype=Object.create(j);k.prototype.constructor=k;k.__superConstructor__=h;function k(l){"use strict";h.call(this,l,'tag');}k.prototype.createElement=function(){"use strict";var l=this.isFreeform(),m=g.create('span',{className:'separator'},', '),n=g.create(l?'span':'a',{className:'taggee','data-tag':this.getValue()},this.getText());if(!l)n.href=this.getInfo().path;return g.create('span',{className:'tagItem'},[m,n]);};e.exports=k;},null);
__d("TagTokenizer",["Arbiter","CSS","DOM","Parent","TagToken","Tokenizer","createObjectFrom","ge","getElementText","fbt"],function(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p){for(var q in l)if(l.hasOwnProperty(q))s[q]=l[q];var r=l===null?null:l.prototype;s.prototype=Object.create(r);s.prototype.constructor=s;s.__superConstructor__=l;function s(t,u,v,w,x){"use strict";l.call(this,v,w,x);g.subscribe('PhotoInlineEditor.CANCEL_INLINE_EDITING',this.updateTokenareaVisibility.bind(this),g.SUBSCRIBE_NEW);this.appphoto=u;g.subscribe(t.getInstance().getEventString('DATA_CHANGE'),this.setup.bind(this),g.SUBSCRIBE_NEW);}s.prototype.setup=function(t,u){"use strict";this.appphoto=u.byapp;this.byowner=u.isowner;return this.reset();};s.prototype.reset=function(){"use strict";var t=this.getTokenElements().map(this.getTokenDataFromTag.bind(this));this.withTagKeys={};var u=this.getWithTagTokenElements().map(function(v){return this._tokenKey(this.getTokenDataFromTag(v));}.bind(this));this.withTagKeys=m(u);return r.reset.call(this,t);};s.prototype.processEvents=function(event,t,u){"use strict";if(j.byClass(t,'remove')){var v=this.getTokenFromElement(u);v=this.addTokenData(v,t);this.removeToken(v);event.kill();}};s.prototype.insertToken=function(t){"use strict";return null;};s.prototype.removeToken=function(t){"use strict";if(this.appphoto){return this.replaceToken(t);}else{this.inform('removeToken',t);g.inform('Form/change',{node:this.element});}};s.prototype.addTokenData=function(t,u){"use strict";if(j.byClass(u,'blockuser'))t.blockUser=true;return t;};s.prototype.getTokenDataFromTag=function(t){"use strict";return {uid:i.find(t,'input').value,text:o(i.find(t,'.taggee'))};};s.prototype.getTokenElementFromTarget=function(t){"use strict";return j.byClass(t,'tagItem');};s.prototype.getTokenElements=function(){"use strict";return i.scry(this.tokenarea,'span.tagItem').filter(this.filterNonTokenElements.bind(this));};s.prototype.getWithTagTokenElements=function(){"use strict";return i.scry(this.tokenarea,'span.withTagItem');};s.prototype.filterNonTokenElements=function(t){"use strict";return !h.hasClass(t,'markasspam')&&!h.hasClass(t,'reported')&&!h.hasClass(t,'withTagItem');};s.prototype.createToken=function(t,u){"use strict";var v=this.getToken(this._tokenKey(t));v=v||new k(t);u&&v.setElement(u);return v;};s.prototype.updateTokenareaVisibility=function(){"use strict";var t=this.getTokenElements().filter(function(w){return h.shown(w);}),u=this.getWithTagTokenElements(),v=i.scry(this.tokenarea,'span.ogTagItem');h.conditionShow(this.tokenarea,t.length!==0||u.length!==0||v.length!==0);};s.prototype.replaceToken=function(t){"use strict";if(!t)return;var u=this.tokens.indexOf(t);if(u<0)return;this.tokens.splice(this.tokens.indexOf(t),1);delete this.unique[this._tokenKey(t.getInfo())];var v=n('tagspam'+t.getValue());v&&i.remove(v);var w=[' [',"Tag Removed.",' '];w.push(i.create('a',{onclick:this.markAsSpam.bind(this,t.getValue())},"Mark tag as spam"));w.push('] ');var x=i.create('span',{className:'fbPhotosTaglistTag tagItem markasspam',id:'tagspam'+t.getValue()},w);i.replace(t.getElement(),x);this.updateTokenarea();this.inform('removeToken',t);g.inform('Form/change',{node:this.element});};s.prototype.markAsSpam=function(t){"use strict";var u=n('tagspam'+t),v=[' [',"Tag Reported",'] '],w=i.create('span',{className:'fbPhotosTaglistTag tagItem reported',id:'tagspam'+t},v);i.replace(u,w);this.inform('markTagAsSpam',t);};e.exports=s;},null);
__d("TagTypeaheadView",["AsyncRequest","ContextualTypeaheadView","CSS","DOM","Parent"],function(a,b,c,d,e,f,g,h,i,j,k){for(var l in h)if(h.hasOwnProperty(l))n[l]=h[l];var m=h===null?null:h.prototype;n.prototype=Object.create(m);n.prototype.constructor=n;n.__superConstructor__=h;function n(o,p){"use strict";h.call(this,o,p);this.hintText=p.hintText;this.userEd=p.userEd;this.origAutoSelect=p.autoSelect;this.setSuggestions(p.suggestions);}n.prototype.init=function(){"use strict";i.addClass(this.element,'uiTagTypeaheadView');m.init.call(this);};n.prototype.buildResults=function(o){"use strict";if(!this.value&&this.hintText)o.unshift({subtext:this.hintText,type:'hintText'});if(this.userEd){new g().setURI('/ajax/fof/user_education.php').setData({increment:1}).send();o.unshift({subtext:this.userEd,type:'userEdText'});}var p=m.buildResults.call(this,o);if(this.userEd)o.shift();if(!this.value)o.shift();return p;};n.prototype.show=function(){"use strict";var o=j.scry(this.context,'.typeaheadBackdrop');if(o.length>0)i.addClass(o[0],'resultsPresent');return m.show.call(this);};n.prototype.hide=function(){"use strict";var o=j.scry(this.context,'.typeaheadBackdrop');if(o.length>0)i.removeClass(o[0],'resultsPresent');return m.hide.call(this);};n.prototype.render=function(o,p,q){"use strict";this.autoSelect=this.origAutoSelect&&o.length;this.disableAutoSelect=o.length===0;m.render.call(this,o,p,q);};n.prototype.getItems=function(){"use strict";var o=m.getItems.call(this);if(!this.value)o.shift();if(this.userEd)o.shift();return o;};n.prototype.getSuggestions=function(){"use strict";return this.suggestions;};n.prototype.setSuggestions=function(o){"use strict";this.suggestions=o?o.map(String):[];this.visible=!!this.suggestions.length;};n.prototype.addSuggestion=function(o){"use strict";this.suggestions.unshift(o);};n.prototype.addTypeaheadFlip=function(o){"use strict";i.addClass(this.element,o);};n.prototype.removeTypeaheadFlip=function(o){"use strict";i.removeClass(this.element,o);};n.prototype.getContext=function(){"use strict";var o=k.byClass(this.element,'typeaheadContainer');if(o){return o;}else return m.getContext.call(this);};e.exports=n;},null);
__d("ProfilePicMenuDialogThumbnailMixin",[],function(a,b,c,d,e,f){var g={getThumbnailCoordinates:function(h,i){return {endX:Math.abs((h.x+h.width)/i.width),endY:Math.abs((h.y+h.height)/i.height),startX:Math.abs(h.x/i.width),startY:Math.abs(h.y/i.height)};}};e.exports=g;},null);
__d("ProfilePictureFlowLogging",["Arbiter","Banzai","Event","Parent","ProfilePhotoActionLogger","Run","TimelineProfilePicConfig","TimelineProfilePictureLoggerEnums","tidyEvent"],function(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o){var p=m.loading,q=m.success,r='data-action-type',s,t,u,v;function w(){v&&v.unsubscribe();v=null;}var x={action:n.actions,flow:n.flows,step:n.steps,log:function(y){var z=y||x.step.INIT;h.post('profile_pic_action',{action_type:s,flow_type:t,step_type:z});if(s===x.action.UPLOAD&&z===x.step.INIT)k.log(k.EVENT_SELECT_METHOD,u,k.METHOD_UPLOAD);t=null;if(y==='success'||y==='fail')s=null;return x;},setAction:function(y){s=y;return x;},setFlowType:function(y){t=y;return x;},setSource:function(y){u=y;return x;},init:function(y,z){if(z)u=z;if(!v){v=g.subscribe([p,q],function(aa){x.log(aa===p?n.steps.LOADING:n.steps.SUCCESS);});l.onLeave(w);}o(i.listen(y,'click',function(aa){var ba=j.byAttribute(aa.getTarget(),r);if(!ba)return;x.setAction(ba.getAttribute(r)).log();}));},initMenuItems:function(y,z,aa){x.init(y.getRoot(),aa);}};e.exports=x;},null);
__d("XProfilePicCropAsyncControllerURIBuilder",["XControllerURIBuilder"],function(a,b,c,d,e,f){e.exports=b("XControllerURIBuilder").create("\/profile\/picture\/crop_profile_pic\/",{photo_id:{type:"Int",required:true},profile_id:{type:"Int",required:true},height:{type:"Float",required:true},width:{type:"Float",required:true},x:{type:"Float",required:true},y:{type:"Float",required:true},source:{type:"Enum"},method:{type:"Enum"}});},null);
__d("XProfilePicMakeAsyncControllerURIBuilder",["XControllerURIBuilder"],function(a,b,c,d,e,f){e.exports=b("XControllerURIBuilder").create("\/profile\/picture\/make_profile_pic\/",{end_x:{type:"Float"},end_y:{type:"Float"},photo_id:{type:"Int",required:true},profile_id:{type:"Int",required:true},source:{type:"Enum"},start_x:{type:"Float"},start_y:{type:"Float"},method:{type:"Enum"}});},null);
__d("XProfilePicSaver",["AsyncRequest","ArbiterMixin","ProfilePictureFlowLogging","XProfilePicCropAsyncControllerURIBuilder","XProfilePicMakeAsyncControllerURIBuilder","mixin"],function(a,b,c,d,e,f,g,h,i,j,k,l){var m=i.step,n=l(h);for(var o in n)if(n.hasOwnProperty(o))q[o]=n[o];var p=n===null?null:n.prototype;q.prototype=Object.create(p);q.prototype.constructor=q;q.__superConstructor__=n;function q(r,s){"use strict";this.$XProfilePicSaver0=r;this.$XProfilePicSaver1=s;}q.prototype.setProfilePhotoSource=function(r){"use strict";this.$XProfilePicSaver2=r;return this;};q.prototype.setProfilePhotoMethod=function(r){"use strict";this.$XProfilePicSaver3=r;return this;};q.prototype.setFlowType=function(r){"use strict";this.$XProfilePicSaver4=r;return this;};q.prototype.saveCroppedProfilePic=function(r){"use strict";this.$XProfilePicSaver5=true;this.$XProfilePicSaver6(new j().setFloat('x',r.x).setFloat('y',r.y).setFloat('width',Math.min(r.width,1)).setFloat('height',Math.min(r.height,1)));this.$XProfilePicSaver7(m.CROP_SAVING);};q.prototype.saveAsProfilePic=function(){"use strict";this.$XProfilePicSaver8();};q.prototype.saveAsProfilePicWithPosition=function(r){"use strict";this.$XProfilePicSaver8(r);};q.prototype.$XProfilePicSaver8=function(r){"use strict";this.$XProfilePicSaver5=false;var s=new k();if(r)s.setFloat('start_x',100*r.startX).setFloat('start_y',100*r.startY).setFloat('end_x',100*r.endX).setFloat('end_y',100*r.endY);this.$XProfilePicSaver6(s);this.$XProfilePicSaver7(m.PREVIOUS_PIC_SAVING);};q.prototype.$XProfilePicSaver9=function(r){"use strict";this.inform('error',r);this.$XProfilePicSaver7(this.$XProfilePicSaver5?m.CROP_FAIL:m.PREVIOUS_PIC_FAIL);};q.prototype.$XProfilePicSaver7=function(r){"use strict";this.$XProfilePicSaver4&&i.setFlowType(this.$XProfilePicSaver4);i.log(r);};q.prototype.$XProfilePicSaver6=function(r){"use strict";r.setInt('photo_id',this.$XProfilePicSaver0).setInt('profile_id',this.$XProfilePicSaver1).setEnum('source',this.$XProfilePicSaver2||'photo_view');this.$XProfilePicSaver3&&r.setEnum('method',this.$XProfilePicSaver3);new g(r.getURI()).setErrorHandler(this.$XProfilePicSaver9.bind(this)).setHandler(this.$XProfilePicSavera.bind(this)).send();this.$XProfilePicSaver7(m.LOADING);};q.prototype.$XProfilePicSavera=function(r){"use strict";this.inform('success',r);this.$XProfilePicSaver7(this.$XProfilePicSaver5?m.CROP_SUCCESS:m.PREVIOUS_PIC_SUCCESS);this.$XProfilePicSaver7(m.SUCCESS);};e.exports=q;},null);
__d("ProfilePicCropViewerStrings",["fbt"],function(a,b,c,d,e,f,g){var h={BUTTON_CANCEL:"Cancel",BUTTON_CLOSE:"Close",BUTTON_SAVE:"Save Profile Picture",CROP_AND_SAVE:"Crop Photo",CROP_INSTRUCTIONS:"Move the box to where you want to crop your photo. Drag the corners in or out to adjust the size.",CROP_SAVING:"Saving Profile Picture...",LEAVE_WARNING_BODY:"The changes you made to your profile picture won't be saved if you close this dialog.",LEAVE_WARNING_CANCEL:"Stay on This Page",LEAVE_WARNING_OK:"Leave This Page",LEAVE_WARNING_TITLE:"Changes Not Saved",LEAVE_WARNING_UNLOAD:"The changes you made to your profile picture haven't been saved.",LOADING:"Loading...",PREV_PHOTO_ADJUST_THUMBNAIL:"You've previously used this profile picture.",PREVIOUS_PHOTO_TITLE:"Select Photo",PREVIOUS_PIC:"You've used this photo as your profile picture before. Do you want to use it again?",PROFILE_PIC_VISIBILITY:"Your current profile picture is always public.",SAVED_BODY:"Your profile picture was successfully saved.",SAVED_TITLE:"Profile Picture Saved",UPLOADING:"Uploading...",SMALL_PHOTO_WARNING:"This photo is small and your profile picture will be less clear.",ZOOM_WARNING:"Zooming in this close will make your profile picture less clear."};e.exports=h;},null);
__d("ProfilePicCropViewerMixin",["AsyncResponse","DialogX","LayerDestroyOnHide","ProfilePicCropViewerStrings","ProfilePictureFlowLogging","ProfilePicMenuDialogThumbnailMixin","React","Run","TimelineURI","XProfilePicSaver","XUIDialogButton.react","XUIDialogBody.react","XUIDialogFooter.react","XUIDialogTitle.react","tidyEvent"],function(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u){var v=360,w={propTypes:{method:m.PropTypes.string,source:m.PropTypes.string},componentDidMount:function(){this._preventClose=true;n.onBeforeUnload(function(){if(this.isMounted()&&!this._shouldAllowClose())return j.LEAVE_WARNING_UNLOAD;}.bind(this),true);this._logFlowStep(k.step.VIEWER_INIT);},componentDidUpdate:function(x,y){if(!y.photoData&&this.state.photoData)this._logFlowStep(this.state.photoData.previousprofilepic?k.step.PREVIOUS_PIC_INIT:k.step.CROP);},componentWillUnmount:function(){this._warningDialog&&this._warningDialog.destroy();this._warningDialog=null;},getViewerID:function(){return this.props.setid;},_forceClose:function(){this._preventClose=false;this.close();this._logFlowStep(k.step.CANCEL);},handleCancel:function(){if(!this.props.warnOnCancel||this._shouldAllowClose())return this._forceClose();this._showCloseWarning();},handleSave:function(){this.setState({savingMode:true});this._preventClose=false;var x=new p(this.state.photoData.id,this.props.profileID).setFlowType(this.getFlowType());this.props.method&&x.setProfilePhotoMethod(this.props.method);this.props.source&&x.setProfilePhotoSource(this.props.source);u([x.subscribe('success',this._savingSuccess),x.subscribe('error',this._savingError)]);if(this.state.photoData.previousprofilepic){if(!this.shouldGenThumbnailForReverts()){x.saveAsProfilePic();}else x.saveAsProfilePicWithPosition(this.getThumbnailCoordinates(this.getCropArea(),this.getPhotoSize()));return;}var y=this.getCropArea(),z=this.getPhotoSize();x.saveCroppedProfilePic({x:y.x/z.width,y:y.y/z.height,width:y.width/z.width,height:y.height/z.height});},_logFlowStep:function(x){k.setFlowType(this.getFlowType()).setSource(this.props.source).log(x);},_savingSuccess:function(x,y){var z=new h({addedBehaviors:[i],width:v,xui:true},m.createElement("div",null,m.createElement(t,{showCloseButton:false},j.SAVED_TITLE),m.createElement(r,null,j.SAVED_BODY)));z.subscribeOnce('aftershow',this.close);z.show();o.goToProfileID(this.props.profileID);},_savingError:function(x,y){this._preventClose=true;this.setState({savingMode:false});g.defaultErrorHandler(y);this.inform('save_error',y);},_shouldAllowClose:function(){return !this._preventClose;},_showCloseWarning:function(){if(!this._warningDialog)this._warningDialog=new h({modal:true,width:v,xui:true},m.createElement("div",null,m.createElement(t,null,j.LEAVE_WARNING_TITLE),m.createElement(r,null,j.LEAVE_WARNING_BODY),m.createElement(s,null,m.createElement(q,{action:"cancel",label:j.LEAVE_WARNING_CANCEL}),m.createElement(q,{action:"cancel",onClick:this._forceClose,label:j.LEAVE_WARNING_OK,use:"confirm"}))));this._warningDialog.show();}};e.exports=Object.assign(w,l);},null);
__d("ProfilePicViewerFooterText.react",["React","XUIGrayText.react","cx"],function(a,b,c,d,e,f,g,h,i){var j=g.createClass({displayName:"ProfilePicViewerFooterText",propTypes:{},render:function(){return (g.createElement(h,g.__spread({},this.props,{className:"_2pi2",display:"block",shade:"medium",size:"small"}),this.props.children));}});e.exports=j;},null);
__d("ProfilePicCropViewerLoading.react",["React","XUISpinner.react","cx","joinClasses"],function(a,b,c,d,e,f,g,h,i,j){var k=g.createClass({displayName:"ProfilePicCropViewerLoading",render:function(){return (g.createElement("div",{className:j("_278e",this.props.className)},g.createElement(h,{background:"dark",className:"_4-cf",size:"large"})));}});e.exports=k;},null);
__d("ZoomProfilePicDragger.react",["BasicVector","React","PhotoZoomCropDimensions","PhotoZoomCropImage.react","PhotoZoomCropImagePreview.react","cx","joinClasses"],function(a,b,c,d,e,f,g,h,i,j,k,l,m){var n=320,o=h.PropTypes,p=h.createClass({displayName:"ZoomProfilePicDragger",propTypes:{center:o.shape({x:o.number.isRequired,y:o.number.isRequired}),previewSize:o.number,photoData:o.object.isRequired,warningText:o.string},getDefaultProps:function(){return {previewSize:32};},render:function(){var q;if(this.props.warningText)q=h.createElement("div",{className:"_2a_6"},this.props.warningText);return (h.createElement("div",{className:m("_2a_7",this.props.className)},h.createElement(j,{className:"_2a_8",dimensions:this._dims,enableDrag:this._dims.hasSpaceToDrag(),onMove:this._handleMove,src:this.getImage().uri}),h.createElement(k,{className:"_2a_9",dimensions:this._dims,size:{x:this.props.previewSize,y:this.props.previewSize},src:this.getImage().uri}),q));},componentWillMount:function(){var q=this.getImage(),r=new g(q.width,q.height),s=Math.min(r.x,r.y);this._dims=new i(r);this._dims.setZoom(n/s);if(this.props.center)this._dims.setCenter(this.props.center.x,this.props.center.y);},getDimsArea:function(){return this._dims.getArea();},getImage:function(){return this.props.photoData.original;},getDimensions:function(){return this._dims;},_handleMove:function(q,r){this._dims.moveByPixels(q,r);this.setState(this._getDimensionsState());},_getDimensionsState:function(){return {dimensions:this._dims.getPosition()};}});e.exports=p;},null);
__d("ZoomProfilePicCropViewerBody.react",["BasicVector","PhotoZoomCropDimensions","ProfilePicMenuDialogRevertsGating","ProfilePicCropViewerStrings","React","SpotlightProfilePicCropOptions","SpotlightViewerDimensionMixin","Image.react","PhotoZoomCrop.react","ProfilePicCropViewerLoading.react","ZoomProfilePicDragger.react","cx"],function(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r){var s=320,t=22,u=k.createClass({displayName:"ZoomProfilePicCropViewerBody",mixins:[m],propTypes:{height:k.PropTypes.number.isRequired,photoData:k.PropTypes.object,savingMode:k.PropTypes.bool.isRequired,width:k.PropTypes.number.isRequired},render:function(){var v=this.props.photoData,w;if(!v||this.props.savingMode)w=k.createElement(p,{className:((!v?"_3mdt":''))});return (k.createElement("div",{className:"_3mds",style:{height:this.props.height}},this._getImage(),w));},_getImage:function(){var v=this.props.photoData;if(!v)return null;var w;if(v.previousprofilepic&&!i.editThumbnail){w=this.getDimensions().getImageDimensionsForStage(new g(v.image1.width,v.image1.height),new g(this.props.width-t,this.props.height-t));return (k.createElement("div",{className:"_1v1"},k.createElement(n,{className:"_3mdu",height:w.y,src:v.image1.uri,width:w.x})));}w=new g(v.original.width,v.original.height);var x=l.getOptionsAsRatio(v,w);if(v.previousprofilepic)return (k.createElement(q,{center:x.center,photoData:v,ref:"image",warningText:j.PREV_PHOTO_ADJUST_THUMBNAIL}));var y=w.x<s||w.y<s?j.SMALL_PHOTO_WARNING:j.ZOOM_WARNING;return (k.createElement(o,{className:this.props.className,center:x.center,cropSizeRatio:x.size,enableDrag:true,imageSize:w,ref:"image",src:v.original.uri,warningText:y}));},getDimensionsArea:function(){return this.refs.image.getDimensions().getArea();},hasSpaceToDrag:function(){var v=new g(this.props.photoData.original.width,this.props.photoData.original.height);return !h.isSquare(v);}});e.exports=u;},null);
__d("ZoomProfilePicCropViewer.react",["ArbiterMixin","ProfilePicCropViewerMixin","ProfilePicCropViewerStrings","ProfilePictureFlowLogging","ProfilePicMenuDialogRevertsGating","React","SpotlightViewerCoreMixin","SpotlightViewerDimensionMixin","ProfilePicViewerFooterText.react","XUIButton.react","XUIDialog.react","XUIDialogFooter.react","XUIDialogTitle.react","XUIGrayText.react","ZoomProfilePicCropViewerBody.react","WorkModeConfig"],function(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v){var w=460,x=520,y=l.createClass({displayName:"ZoomProfilePicCropViewer",mixins:[g,h,m,n],propTypes:{profileID:l.PropTypes.string.isRequired,setid:l.PropTypes.string.isRequired,uploading:l.PropTypes.bool,warnOnCancel:l.PropTypes.bool},getInitialState:function(){return {open:true,photoData:null,savingMode:false};},render:function(){var z=this.state.photoData,aa=i.CROP_AND_SAVE,ba;if(!z){aa=i.LOADING;}else if(z.previousprofilepic){aa=i.PREVIOUS_PHOTO_TITLE;}else aa=i.CROP_AND_SAVE;if(this.state.savingMode){ba=l.createElement(o,{weight:"bold"},i.CROP_SAVING);}else if(z){ba=[l.createElement(p,{label:i.BUTTON_CANCEL,onClick:this.handleCancel}),l.createElement(p,{label:i.BUTTON_SAVE,onClick:this.handleSave,use:"confirm"})];}else if(this.props.uploading)ba=l.createElement(o,{weight:"bold"},i.UPLOADING);var ca;if(!v.is_work_user)ca=l.createElement(o,null,i.PROFILE_PIC_VISIBILITY);return (l.createElement(q,{layerHideOnBlur:false,modal:true,shown:true,width:x},l.createElement(s,{showCloseButton:false},l.createElement(t,{display:"block",shade:"medium",size:"medium",weight:"bold"},aa)),l.createElement(u,{height:w,photoData:this.state.photoData,photoid:this.props.photoid,profileID:this.props.profileID,ref:"zoomBody",savingMode:this.state.savingMode,setid:this.props.setid,width:x}),l.createElement(r,{leftContent:ca},ba)));},getCropArea:function(){return this.refs.zoomBody.getDimensionsArea();},getFlowType:function(){return j.flow.ZOOMCROP;},getPhotoSize:function(){return this.state.photoData.original;},shouldGenThumbnailForReverts:function(){return (k.editThumbnail&&this.refs.zoomBody.hasSpaceToDrag());}});e.exports=y;},null);
__d("XProfilePicCropViewerAsyncControllerURIBuilder",["XControllerURIBuilder"],function(a,b,c,d,e,f){e.exports=b("XControllerURIBuilder").create("\/profile\/picture\/crop_viewer\/",{photo_id:{type:"String",required:true},photo_sizes:{type:"IntVector"},profile_id:{type:"Int",required:true},set_id:{type:"String",required:true}});},null);
__d("ProfilePicCropViewerInit",["ProfilePictureFlowLogging","React"],function(a,b,c,d,e,f,g,h){var i='profile-picture-crop',j='loading',k=g.flow,l,m;function n(){m&&m.close();}function o(q,r,s){s=s||{};d(['SpotlightViewerInit','ZoomProfilePicCropViewer.react','PhotoStore','AsyncRequest','AsyncResponse','XProfilePicCropViewerAsyncControllerURIBuilder'],function(t,u,v,w,x,y){n();l=i+':'+q+':'+r;m=t.render(h.createElement(u,{open:true,method:s.method,photoid:q,profileID:r,setid:l,source:s.source,uploading:s.uploading,warnOnCancel:s.warnOnCancel}),function(){m=null;});if(v.hasBeenCreated(l)||q===j)return;var z=new y().setString('photo_id',q).setInt('profile_id',r).setString('set_id',l).getURI(),aa=l;new w(z).setErrorHandler(function(ba){aa===l&&n();x.defaultErrorHandler(ba);}).send();});return true;}var p={close:n,getFlowType:function(){return k.ZOOMCROP;},useCropViewer:function(){return true;},loading:function(q,r){o(j,q,r);},loadID:o};e.exports=p;},null);
__d("MakeProfilePicInit",["ProfilePicCropViewerInit","URI"],function(a,b,c,d,e,f,g,h){var i={handleOptimus:function(j,k,l){l.prevent();var m=h(k.getAttribute('ajaxify')||k.href).getQueryData();g.loadID(m.fbid,m.profile_id,{source:m.pp_source});}};e.exports=i;},null);
__d("FreeformTokenizerBehavior",["Event","Input","Keys"],function(a,b,c,d,e,f,g,h,i){function j(k,l){var m=l.matcher&&new RegExp(l.matcher,'i'),n=l.splitter&&new RegExp(l.splitter),o=l.tokenize_on_blur!==false,p=l.tokenize_on_paste!==false,q=l.split_on_check===true,r=l.select_on_comma!==false,s=l.select_on_space===true,t=l.never_submit===true;function u(event){var v=h.getValue(k.getInput()).trim();if(n&&event&&event.type=='paste'){v=v.split(n);}else if(n&&q){v=v.split(n);}else v=[v];var w=false;for(var x=0;x<v.length;x++){var y=v[x].trim();if(y&&(!m||m.test(y))){var z={uid:y,text:y,freeform:true};k.addToken(k.createToken(z));w=true;}}if(event&&w){k.getTypeahead().getCore().afterSelect();event.kill();}}k.subscribe('keydown',function(v,w){var event=w.event,x=g.getKeyCode(event);if(x==i.RETURN||(r&&x==i.COMMA)||(s&&x==i.SPACE)){var y=k.getTypeahead().getView();if(y.getSelection()){y.select();event.kill();}else u(event);}if(x==i.RETURN&&t)event.kill();});k.subscribe('paste',function(v,w){if(p)setTimeout(u.bind(null,w.event),20);});k.subscribe('blur',function(v,w){if(o)u();k.getTypeahead().getCore().reset();});}e.exports=j;},null);
__d("legacy:FreeformTokenizerBehavior",["FreeformTokenizerBehavior"],function(a,b,c,d,e,f,g){if(!a.TokenizerBehaviors)a.TokenizerBehaviors={};a.TokenizerBehaviors.freeform=g;},3);
__d("TypeaheadHintText",["copyProperties","emptyFunction"],function(a,b,c,d,e,f,g,h){function i(j){"use strict";this._typeahead=j;}i.prototype.enable=function(){"use strict";this._typeahead.getCore().resetOnKeyup=false;};g(i.prototype,{disable:h});e.exports=i;},null);
__d("legacy:HintTextTypeaheadBehavior",["TypeaheadHintText"],function(a,b,c,d,e,f,g){if(!a.TypeaheadBehaviors)a.TypeaheadBehaviors={};a.TypeaheadBehaviors.hintText=function(h){h.enableBehavior(g);};},3);