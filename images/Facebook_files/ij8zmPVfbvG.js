/*!CK:259203712!*//*1418618256,*/

if (self.CavalryLogger) { CavalryLogger.start_js(["1Dkk+"]); }

__d("PhotoResizeModeConst",[],function(a,b,c,d,e,f){e.exports={CONTAIN:"s",COVER:"p"};},null);
__d("RequiredFormListener",["Event","Input"],function(a,b,c,d,e,f,g,h){g.listen(document.documentElement,'submit',function(i){var j=i.getTarget().getElementsByTagName('*');for(var k=0;k<j.length;k++)if(j[k].getAttribute('required')&&h.isEmpty(j[k])){j[k].focus();return false;}},g.Priority.URGENT);},null);
__d("MercuryLocalIDs",["PresenceUtil","randomInt"],function(a,b,c,d,e,f,g,h){'use strict';var i={generateMessageID:function(j){var k=j||Date.now(),l=h(0,4294967295),m=g.getSessionID();return ("<"+k+":"+l+"-"+m+"@mail.projektitan.com>");},generateThreadID:function(j){return 'root:'+i.generateMessageID(j);}};e.exports=i;},null);
__d("MercuryMessageActions",["CurrentUser","MercuryActionType","MercuryMessageObject","MercuryPayloadSource","MercuryServerRequests","MercurySingletonMixin"],function(a,b,c,d,e,f,g,h,i,j,k,l){'use strict';function m(n){this.$MercuryMessageActions0=n;this.$MercuryMessageActions1=i.getForFBID(this.$MercuryMessageActions0);this.$MercuryMessageActions2=k.getForFBID(this.$MercuryMessageActions0);}m.prototype.send=function(n,o,p){o=o||Function.prototype;this.$MercuryMessageActions1.normalizeNewMessage(n);this.$MercuryMessageActions2.handleUpdate(this.$MercuryMessageActions3(Object.assign({},n),j.CLIENT_SEND_MESSAGE));this.$MercuryMessageActions2.sendNewMessage(n,p);o(n.thread_id);};m.prototype.resend=function(n,o){var p=Object.assign({},n);this.$MercuryMessageActions1.normalizeResendMessage(p);this.send(p,(void 0),o);};m.prototype.addAttachmentPlaceholder=function(n,o,p){this.$MercuryMessageActions1.normalizeAddAttachmentPlaceholder(n,o,p);this.$MercuryMessageActions1.normalizeNewMessage(n);this.$MercuryMessageActions2.handleUpdate(this.$MercuryMessageActions3(Object.assign({},n),j.CLIENT_SEND_MESSAGE));};m.prototype.cancelAttachmentPlaceholder=function(n,o){this.$MercuryMessageActions2.handleUpdate(this.$MercuryMessageActions3({upload_id:n,upload_data:o,action_type:h.CANCEL_ATTACHMENT_PLACEHOLDER},j.CLIENT_SEND_MESSAGE));};m.prototype.confirmAttachmentPlaceholder=function(n,o){this.$MercuryMessageActions2.handleUpdate(this.$MercuryMessageActions3({upload_id:n,upload_data:o,action_type:h.CONFIRM_ATTACHMENT_PLACEHOLDER},j.CLIENT_SEND_MESSAGE));};m.addShareDataToExistingMessage=function(n,o,p,q){q=q||g.getID();m.getForFBID(q).addShareDataToExistingMessage(n,o,p);};m.prototype.addShareDataToExistingMessage=function(n,o,p){this.$MercuryMessageActions2.handleUpdate(this.$MercuryMessageActions4({server_id:n,attach_key:o,attach_data:p,action_type:h.ADD_SHARE_DATA_TO_EXISTING_MESSAGE},j.SERVER_ADD_SHARE_DATA_TO_EXISTING_MESSAGE));};m.prototype.markSpam=function(n,o){this.$MercuryMessageActions2.handleUpdate(this.$MercuryMessageActions5(n,o,h.MARK_MESSAGES_SPAM,j.CLIENT_MARK_MESSAGES_SPAM));};m.prototype["delete"]=function(n,o,p){this.$MercuryMessageActions2.handleUpdate(this.$MercuryMessageActions5(n,o,h.DELETE_MESSAGES,p||j.CLIENT_DELETE_MESSAGES));};m.prototype.$MercuryMessageActions3=function(n,o){return {actions:[n],from_client:true,payload_source:o};};m.prototype.$MercuryMessageActions4=function(n,o){return {actions:[n],from_client:false,payload_source:o};};m.prototype.$MercuryMessageActions5=function(n,o,p,q){return {actions:[{action_type:p,action_id:null,thread_id:n,message_ids:o}],from_client:true,payload_source:q};};Object.assign(m,l);e.exports=m;},null);
__d("MercuryThreadActions",["MercuryActionType","MercuryPayloadSource","MercuryServerRequests","MercurySingletonMixin","MessagingTag","merge"],function(a,b,c,d,e,f,g,h,i,j,k,l){'use strict';function m(n){this.$MercuryThreadActions0=n;this.$MercuryThreadActions1=i.getForFBID(this.$MercuryThreadActions0);}m.prototype.markRead=function(n){this.batchMarkRead([n]);};m.prototype.batchMarkRead=function(n){this.$MercuryThreadActions1.handleUpdate(this.$MercuryThreadActions2(n,true));};m.prototype.markUnread=function(n){this.batchMarkUnread([n]);};m.prototype.batchMarkUnread=function(n){this.$MercuryThreadActions1.handleUpdate(this.$MercuryThreadActions2(n,false));};m.prototype.archive=function(n){this.batchArchive([n]);};m.prototype.batchArchive=function(n){n.forEach(function(o){this.$MercuryThreadActions1.changeThreadArchivedStatus(o,true);}.bind(this));this.$MercuryThreadActions1.handleUpdate(this.$MercuryThreadActions3(n,true));};m.prototype.unarchive=function(n){this.batchUnarchive([n]);};m.prototype.batchUnarchive=function(n){n.forEach(function(o){this.$MercuryThreadActions1.changeThreadArchivedStatus(o,false);}.bind(this));this.$MercuryThreadActions1.handleUpdate(this.$MercuryThreadActions3(n,false));};m.prototype.markSpam=function(n){this.batchMarkSpam([n]);};m.prototype.batchMarkSpam=function(n){n.forEach(function(o){this.$MercuryThreadActions1.markThreadSpam(o);}.bind(this));this.$MercuryThreadActions1.handleUpdate(this.$MercuryThreadActions4(n,k.SPAM));};m.prototype.unmarkSpam=function(n){this.batchUnmarkSpam([n]);};m.prototype.batchUnmarkSpam=function(n){n.forEach(function(o){this.$MercuryThreadActions1.unmarkThreadSpam(o);}.bind(this));this.$MercuryThreadActions1.handleUpdate(this.$MercuryThreadActions4(n,k.INBOX));};m.prototype.changeFolder=function(n,o){this.batchChangeFolder([n],o);};m.prototype.batchChangeFolder=function(n,o){n.forEach(function(p){this.$MercuryThreadActions1.changeThreadFolder(p,o);}.bind(this));this.$MercuryThreadActions1.handleUpdate(this.$MercuryThreadActions4(n,o));};m.prototype["delete"]=function(n){this.batchDelete([n]);};m.prototype.batchDelete=function(n){n.forEach(function(o){this.$MercuryThreadActions1.deleteThread(o);}.bind(this));this.$MercuryThreadActions1.handleUpdate(this.$MercuryThreadActions5(n,g.DELETE_THREAD,h.CLIENT_DELETE_THREAD));};m.prototype.unmute=function(n){this.updateMuteSetting(n,0);};m.prototype.updateMuteSetting=function(n,o){this.$MercuryThreadActions1.changeMutingOnThread(n,o);this.$MercuryThreadActions1.handleUpdate(this.$MercuryThreadActions5([n],g.CHANGE_MUTE_SETTINGS,h.CLIENT_CHANGE_MUTE_SETTINGS,{mute_settings:o}));};m.prototype.addParticipants=function(n,o){this.$MercuryThreadActions1.handleUpdate(this.$MercuryThreadActions5([n],g.ADD_PARTICIPANTS,h.CLIENT_ADD_PARTICIPANTS,{participants:o}));};m.prototype.$MercuryThreadActions2=function(n,o){return this.$MercuryThreadActions5(n,g.CHANGE_READ_STATUS,h.CLIENT_CHANGE_READ_STATUS,{mark_as_read:o});};m.prototype.$MercuryThreadActions3=function(n,o){return this.$MercuryThreadActions5(n,g.CHANGE_ARCHIVED_STATUS,h.CLIENT_CHANGE_ARCHIVED_STATUS,{archived:o});};m.prototype.$MercuryThreadActions4=function(n,o){return this.$MercuryThreadActions5(n,g.CHANGE_FOLDER,h.CLIENT_CHANGE_FOLDER,{new_folder:o});};m.prototype.$MercuryThreadActions5=function(n,o,p,q){return {actions:n.map(function(r){return l({action_type:o,action_id:null,thread_id:r},q);}),from_client:true,payload_source:p};};Object.assign(m,j);e.exports=m;},null);
__d("MercuryThreadMuter",["AsyncDialog","AsyncRequest","CurrentUser","DOM"],function(a,b,c,d,e,f,g,h,i,j){var k={getUserIDEmail:function(){return i.getID()+'@facebook.com';},getThreadMuteSettingForUser:function(l){return l.mute_settings&&l.mute_settings[k.getUserIDEmail()];},isThreadMuted:function(l){return k.getThreadMuteSettingForUser(l)!==(void 0);},showMuteChangeDialog:function(l,m){g.send(new h('/ajax/mercury/mute_thread_dialog.php').setRelativeTo(m),function(n){n.subscribe('confirm',function(){this.hide();var o;j.scry(this.getRoot(),'input[type="radio"]').forEach(function(r){if(r.checked)o=r.value;});switch(o){case 'always':o=-1;break;case '1hour':o=3600;break;case '8am':var p=new Date(),q=new Date();q.setHours(8);q.setMinutes(0);q.setSeconds(0);if(q>p){o=q-p;}else o=q-p+(24*3600*1000);o/=1000;break;default:o=0;}d(['MercuryThreadActions'],function(r){r.get().updateMuteSetting(l,o);});}.bind(n));});}};e.exports=k;},null);
__d("ImageSourceRequest",["CurrentUser","ImageSourceType","KeyedCallbackManager","PhotoResizeModeConst","MercuryServerDispatcher","arrayContains","extendArray"],function(a,b,c,d,e,f,g,h,i,j,k,l,m){function n(){"use strict";this._request={fbid:null,type:null,width:null,height:null,resize_mode:null};this._callback=null;}n.prototype.setFBID=function(r){"use strict";this._request.fbid=r;return this;};n.prototype.setType=function(r){"use strict";if(!l([h.PROFILE_PICTURE,h.IMAGE],r))throw new TypeError('ImageSourceRequest.setType: invalid type '+r);this._request.type=r;return this;};n.prototype.setDimensions=function(r,s){"use strict";this._request.width=r;this._request.height=s;return this;};n.prototype.setResizeMode=function(r){"use strict";if(!l([j.COVER,j.CONTAIN],r))throw new TypeError('ImageSourceRequest.setResizeMode: invalid resize mode '+r);this._request.resize_mode=r;return this;};n.prototype.setCallback=function(r){"use strict";this._callback=r;return this;};n.prototype.send=function(){"use strict";if(!this._request.fbid||!this._request.width||!this._request.height||!this._request.type||!this._request.resize_mode||!this._callback)throw new Error('ImageSourceRequest: You must set all the fields');var r=p(),s=q(this._request);r.executeOrEnqueue(s,this._callback);if(r.getUnavailableResourcesFromRequest(s).length===1){k.trySend('/ajax/image_source.php',{requests:[this._request]});return true;}return false;};var o=null;function p(){if(o)return o;var r=new i();o=r;k.registerEndpoints({'/ajax/image_source.php':{request_user_id:g.getID(),mode:k.BATCH_DEFERRED_MULTI,batch_function:function(s,t){m(s.requests,t.requests);return s;},handler:function(s,t){var u=t.getData().requests;for(var v=0;v<u.length;++v)r.setResource(q(u[v]),s[v]);}}});return r;}function q(r){return [r.fbid,r.type,r.width,r.height,r.resize_mode].join('|');}e.exports=n;},null);
__d("MercuryCallbackRegistry",[],function(a,b,c,d,e,f){'use strict';function g(){this.$MercuryCallbackRegistry0=0;this.$MercuryCallbackRegistry1={};}g.prototype.add=function(h){var i=this.$MercuryCallbackRegistry0++;this.$MercuryCallbackRegistry1[i]=h;return {id:i,remove:this.remove.bind(this,i)};};g.prototype.call=function(h){for(var i=[],j=1,k=arguments.length;j<k;j++)i.push(arguments[j]);var l=this.$MercuryCallbackRegistry1[h];if(l){delete this.$MercuryCallbackRegistry1[h];l.apply(null,i);}};g.prototype.remove=function(h){delete this.$MercuryCallbackRegistry1[h];};e.exports=g;},null);
__d("MercuryParticipants",["CurrentUser","EventEmitter","ImageSourceRequest","ImageSourceType","ImmutableObject","Map","MercuryAssert","MercuryCallbackRegistry","MercuryIDs","MercuryParticipantsConstants","MercuryParticipantTypes","PhotoResizeModeConst","Set","ShortProfiles","fbt","getObjectValues","requireWeak","setImmediate"],function(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v,w,x){'use strict';var y='update';function z(aa){this.$MercuryParticipants0=aa;this.$MercuryParticipants1=new n();this.$MercuryParticipants2=new h();this.$MercuryParticipants3=new l();this.$MercuryParticipants4=new l();this.$MercuryParticipants5=false;this.$MercuryParticipants6=new s();this.$MercuryParticipants7=new s();w(['MercuryServerRequests'],function(ba){var ca=ba.getForFBID(this.$MercuryParticipants0);ca.subscribe('update-participants',function(da,ea){if(ea.participants&&ea.participants.length>0){var fa=new s();ea.participants.forEach(function(ga){this.$MercuryParticipants8(ga);fa.add(ga.id);}.bind(this));this.$MercuryParticipants2.emit(y,fa);}}.bind(this));}.bind(this));}z.prototype.subscribe=function(aa){return this.$MercuryParticipants2.addListener(y,aa);};z.prototype.getIDFromVanityOrFBID=function(aa){if(!aa)return;if(this.$MercuryParticipants4.has(aa))return this.$MercuryParticipants4.get(aa);if(/^\d+$/.test(aa))return o.getParticipantIDFromUserID(aa);};z.prototype.getNow=function(aa){return this.$MercuryParticipants3.get(aa);};z.prototype.getOrFetch=function(aa){var ba=this.getNow(aa);if(!ba&&!this.$MercuryParticipants7.has(aa))this.$MercuryParticipants6.add(aa);if(this.$MercuryParticipants6.size>0&&!this.$MercuryParticipants5)this.$MercuryParticipants9();return ba;};z.prototype.get=function(aa,ba){m.isParticipantID(aa);return this.$MercuryParticipantsa([aa],function(ca){ba(ca[aa]);});};z.prototype.getMulti=function(aa,ba){return this.$MercuryParticipantsa(aa,ba);};z.prototype.getBigImageMulti=function(aa,ba){m.allParticipantIDs(aa);var ca=p.BIG_IMAGE_SIZE;return this.$MercuryParticipantsa(aa,function(da){var ea={},fa=0,ga=new s(),ha=function(la,ma){fa++;ea[la]=ma;if(fa===aa.length){ba(ea);if(ga.size>0)this.$MercuryParticipants2.emit(y,ga);}}.bind(this),ia=function(la,ma){this.$MercuryParticipants3.set(la,k.set(this.$MercuryParticipants3.get(la),{big_image_src:ma.uri}));ga.add(la);ha(la,ma.uri);}.bind(this);for(var ja in da){var ka=da[ja];if(!ka.big_image_src){new i().setFBID(o.getUserIDFromParticipantID(ja)).setType(j.PROFILE_PICTURE).setDimensions(ca,ca).setResizeMode(r.COVER).setCallback(ia.bind(null,ja)).send();}else ha(ka.id,ka.big_image_src);}}.bind(this));};z.prototype.getOrderedBigImageMulti=function(aa,ba){return this.getBigImageMulti(aa,function(ca){ba(aa.map(function(da){return ca[da];}));});};z.prototype.$MercuryParticipantsa=function(aa,ba){m.allParticipantIDs(aa);var ca=this.$MercuryParticipants1.add(ba),da={},ea={},fa=[];aa.forEach(function(ha){if(this.$MercuryParticipants3.has(ha)){da[ha]=this.$MercuryParticipants3.get(ha);}else{var ia=o.tokenize(ha),ja=ia.type,ka=ia.value;if(ja=='fbid'){ea[ha]=ka;}else if(ja=='email'){da[ha]=this.$MercuryParticipantsb(ha);fa.push(ha);}}}.bind(this));var ga=v(ea);if(ga.length){t.getMulti(ga,function(ha){for(var ia in ea){if(!ea.hasOwnProperty(ia))return;var ja=ea[ia],ka=ha[ja],la={gender:ka.gender,href:ka.uri,id:ia,image_src:ka.thumbSrc,name:ka.name,short_name:ka.firstName,employee:ka.employee,is_employee_away:ka.is_employee_away,type:ka.type,vanity:ka.vanity,is_friend:ka.is_friend,orion_eligible:ka.orionEligible,social_snippets:ka.social_snippets};this.$MercuryParticipants8(la);da[ia]=this.$MercuryParticipants3.get(ia);}this.$MercuryParticipants1.call(ca.id,da);var ma=new s(Object.keys(ea).concat(fa));ma.size>0&&this.$MercuryParticipants2.emit(y,ma);}.bind(this));}else{this.$MercuryParticipants1.call(ca.id,da);fa.length>0&&this.$MercuryParticipants2.emit(y,new s(fa));}return ca;};z.prototype.$MercuryParticipants8=function(aa){var ba=aa.id,ca=this.$MercuryParticipantsc(aa),da=this.$MercuryParticipants3.get(ba);this.$MercuryParticipants3.set(ba,da?k.set(da,ca):new k(ca));if(aa.vanity)this.$MercuryParticipants4.set(aa.vanity,ba);};z.prototype.$MercuryParticipantsc=function(aa){var ba=aa.type===q.USER||aa.type===q.FRIEND;if(!ba)return aa;if(!aa.name&&!aa.href&&!aa.vanity){var ca="Facebook User";aa.name=ca;aa.short_name=ca;}return aa;};z.prototype.$MercuryParticipantsb=function(aa){m.isEmailParticipantID(aa);if(!this.$MercuryParticipants3.has(aa)){var ba=o.tokenize(aa).value,ca=new k({gender:p.UNKNOWN_GENDER,href:null,id:aa,image_src:p.EMAIL_IMAGE,big_image_src:p.EMAIL_IMAGE,name:ba,short_name:ba,employee:false});this.$MercuryParticipants3.set(aa,ca);}return this.$MercuryParticipants3.get(aa);};z.prototype.$MercuryParticipants9=function(){if(this.$MercuryParticipants5)return;this.$MercuryParticipants5=true;x(function(){this.$MercuryParticipants5=false;this.$MercuryParticipants6.forEach(function(aa){return this.$MercuryParticipants7.add(aa);}.bind(this));this.$MercuryParticipantsa(this.$MercuryParticipants6,function(aa){for(var ba in aa)aa.hasOwnProperty(ba)&&this.$MercuryParticipants7["delete"](ba);}.bind(this));this.$MercuryParticipants6.clear();}.bind(this));};e.exports=new z(g.getID());},null);
__d("MercuryAttachmentSnippet.react",["EmoticonsList","Image.react","MercuryAttachment","MercuryAttachmentType","MercuryConstants","MercuryIDs","MercuryParticipants","React","StickerConstants","TextWithEmoticons.react","cx","fbt","ix","joinClasses","OrionMercuryAttachmentStrings"],function(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t){'use strict';var u=b('OrionMercuryAttachmentStrings').module,v=n.createClass({displayName:"MercuryAttachmentSnippet",propTypes:{thread:n.PropTypes.object.isRequired,viewer:n.PropTypes.string.isRequired},componentWillMount:function(){this._ensureParticipant(this.props.thread.snippet_sender);this._setVariables(this.props);},componentWillReceiveProps:function(z){this._ensureParticipant(z.thread.snippet_sender);this._setVariables(z);},componentWillUnmount:function(){this._cancelParticipantFetch();},render:function(){var z=this._getSenderName();if(this._hasOnlyPhotos())return this._renderPhotoSnippet(z);if(this._hasOnlyVideo())return this._renderVideoSnippet(z);if(this._hasAudioClip())return this._renderAudioClipSnippet(z);if(this._hasSticker())return this._renderStickerSnippet(z);if(this._hasOrion())return this._renderOrionSnippet(z);if(this._hasShoerackInvitation())return this._renderShoerackInvitationSnippet(z);if(this._hasShare())return this._renderShareSnippet(z);return this._renderMixedSnippet(z);},_renderPhotoSnippet:function(z){var aa;if(this._photos.length===1){if(this._isViewerSender){aa=("You sent a photo.");}else aa=(r._("{name} sent a photo.",[r.param("name",z)]));}else if(this._isViewerSender){aa=(r._("You sent {num_photos} photos.",[r.param("num_photos",this._photos.length)]));}else aa=(r._("{name} sent {num_photos} photos.",[r.param("name",z),r.param("num_photos",this._photos.length)]));return this._renderSnippet(aa);},_renderVideoSnippet:function(z){var aa;if(this._isViewerSender){aa=("You sent a video.");}else aa=(r._("{sender name} sent a video.",[r.param("sender name",z)]));return this._renderSnippet(aa);},_renderAudioClipSnippet:function(z){var aa;if(this._isViewerSender){aa=("You sent a voice message.");}else aa=(r._("{name} sent a voice message.",[r.param("name",z)]));return this._renderSnippet(aa);},_renderStickerSnippet:function(z){if(x(this._attachments[0].metadata.stickerID)){return (n.createElement(p,{renderEmoticons:true,text:g.symbols.like}));}else if(this._isViewerSender){return (n.createElement("span",null,"You sent a sticker."));}else return (n.createElement("span",null,r._("{name} sent a sticker.",[r.param("name",z)])));},_renderOrionSnippet:function(z){if(!u)return null;var aa=u.getOrionMercuryThreadAttachmentMetadataText(this._isViewerSender,z,this._attachments[0].metadata);return (n.createElement("span",null,aa));},_renderShoerackInvitationSnippet:function(z){var aa;if(this._isViewerSender){aa=("You sent a Moments invitation.");}else aa=(r._("{sender name} invited you to share photos using Moments.",[r.param("sender name",z)]));return this._renderSnippet(aa);},_renderShareSnippet:function(z){var aa;if(this._isViewerSender){aa=("You shared a link.");}else aa=(r._("{sender name} shared a link.",[r.param("sender name",z)]));return this._renderSnippet(aa);},_renderMixedSnippet:function(z){return (n.createElement("span",null,this._attachments.filter(function(aa){return aa.attach_type===j.FILE||aa.attach_type===j.PHOTO||aa.attach_type===j.VIDEO;}).map(function(aa){return this._renderSnippet(aa.name,aa.icon_type);}.bind(this))));},_renderSnippet:function(z,aa){var ba=i.getAttachIconClass(aa||this._attachments[0].icon_type),ca=t(ba,"uiIconText _3tn");return (n.createElement("span",{className:ca},n.createElement(h,{src:s('/images/messaging/docs/generic.png')}),z));},_hasOnlyPhotos:function(){return this._photos.length===this._attachments.length;},_hasOnlyVideo:function(){return (this._attachments.length===1&&this._attachments[0].attach_type===j.VIDEO);},_hasAudioClip:function(){return !!(this._attachments.length===1&&this._attachments[0].metadata&&i.isVoiceMessage(this._attachments[0].metadata.type));},_hasSticker:function(){return (this._attachments.length===1&&this._attachments[0].attach_type===j.STICKER);},_hasOrion:function(){return this._hasSingleAttachmentOfShareDataType(k.MercurySupportedShareType.FB_ORION);},_hasShoerackInvitation:function(){return this._hasSingleAttachmentOfShareDataType(k.MercurySupportedShareType.FB_SHOERACK_INVITATION);},_hasSingleAttachmentOfShareDataType:function(z){return (this._attachments.length===1&&this._attachments[0].share_data_type===z);},_hasShare:function(){return (this._attachments.length===1&&this._attachments[0].attach_type===j.SHARE);},_setVariables:function(z){this._viewer=z.viewer;this._sender=z.thread.snippet_sender;this._attachments=z.thread.snippet_attachments;this._photos=w(this._attachments);this._isViewerSender=y(this._sender,this._viewer);},_getSenderName:function(){if(!this._sender||this._isViewerSender)return null;var z=m.getNow(this._sender);if(!z)return null;return z.short_name;},_ensureParticipant:function(z){if(!z)return;this._cancelParticipantFetch();if(!m.getNow(z))this._sub=m.get(z,function(aa){return this.forceUpdate();}.bind(this));},_cancelParticipantFetch:function(){this._sub&&this._sub.remove();}});function w(z){if(!z)return [];return z.filter(function(aa){return aa.attach_type===j.PHOTO;});}function x(z){return (z==o.LIKE_STICKER_ID||z==o.HOT_LIKE_SMALL_STICKER_ID||z==o.HOT_LIKE_MEDIUM_STICKER_ID||z==o.HOT_LIKE_LARGE_STICKER_ID);}function y(z,aa){return !!(z&&l.getParticipantIDFromUserID(aa)==z);}e.exports=v;},null);
__d("MercuryThreadImage.react",["ImmutableObject","MercuryIDs","MercuryParticipants","MercuryParticipantsConstants","Pixelz.react","React","SplitImage.react","areEqual"],function(a,b,c,d,e,f,g,h,i,j,k,l,m,n){'use strict';var o=l.createClass({displayName:"MercuryThreadImage",propTypes:{thread:l.PropTypes.instanceOf(g).isRequired,viewer:l.PropTypes.string.isRequired,size:l.PropTypes.number},getInitialState:function(){return {participantImages:[]};},componentDidMount:function(){this._getParticipantImages(this.props);},componentWillReceiveProps:function(p,q){this._getParticipantImages(p);},shouldComponentUpdate:function(p,q){return (p.thread.image_src!==this.props.thread.image_src||p.size!==this.props.size||!n(q.participantImages,this.state.participantImages));},render:function(){var p=this.props.size||j.BIG_IMAGE_SIZE;if(this.props.thread.image_src)return (l.createElement(k,{height:p,resizeMode:'cover',src:this.props.thread.image_src,width:p}));if(this.state.participantImages.length>0)return (l.createElement(m,{srcs:this.state.participantImages,border:true,size:p}));return null;},_getParticipantImages:function(p){var q=p.thread,r=p.viewer;if(q.image_src)return;var s=h.getParticipantIDFromUserID(r),t=q.participants.filter(function(v){return v!=s;}),u=[];if(!t.length){u=[s];}else if(t.length==1){u=t;}else u=t.slice(0,3);i.getOrderedBigImageMulti(u,function(v){this.isMounted()&&this.setState({participantImages:v});}.bind(this));}});e.exports=o;},null);
__d("WebMessengerThreadPermalinks",["MercuryIDs","MessagingTag","URI","WebMessengerPermalinkConstants","WWWBase","requireWeak"],function(a,b,c,d,e,f,g,h,i,j,k,l){'use strict';var m={getThreadURI:function(q,r,s){if(g.isCanonical(q)){n(q,r,s);}else o(q,r,s);}};function n(q,r,s){var t=new i(k.uri),u=g.tokenize(q).value;t.setPath(p(s)+'/'+u);r&&r(t.toString());}function o(q,r,s){l(['MercuryServerRequests'],function(t){var u=t.get();u.getServerThreadID(q,function(v){var w=new i(k.uri);w.setPath(j.getURIPathForThreadID(v,p(s)));r&&r(w.toString());});});}function p(q){var r=j.BASE_PATH;if(q&&q!=h.INBOX)r+='/'+q;return r;}e.exports=m;},null);
__d("MercuryMessages",["AsyncRequest","BanzaiODS","CurrentUser","LogHistory","MercuryActionStatus","MercuryActionType","MercuryAssert","MercuryAttachmentType","MercuryLogMessageType","MercuryMessageClientState","MercuryPayloadSource","MercurySingletonMixin","MercuryViewer","MercuryMessageActions","MercuryMessageIDs","RangedCallbackManager","ReportState","MercurySendMessageFields","MercuryServerRequests","MercuryThreadActions","MercuryThreadInformer","MercuryThreads","copyProperties","debounceAcrossTransitions","invariant","isNode","mergeDeep","setImmediate"],function(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v,w,x,y,z,aa,ba,ca,da,ea,fa,ga,ha){'use strict';var ia=j.getInstance('mercury_messages');function ja(wa,xa){var ya=xa;if(wa._localIdsMap[xa])ya=wa._localIdsMap[xa];return wa._messages[ya];}function ka(wa){switch(wa){case q.UNKNOWN:case q.SERVER_INITIAL_DATA:case q.SERVER_FETCH_THREAD_INFO:case q.SERVER_THREAD_SYNC:return true;}return false;}function la(wa){return wa&&wa.substr(0,6)==='server';}function ma(wa,xa){if(!wa._threadsToMessages[xa])wa._threadsToMessages[xa]=new v(function(ya){return ja(wa,ya).timestamp;},function(ya,za){return za-ya;});return wa._threadsToMessages[xa];}function na(wa){var xa=[];return JSON.stringify(wa,function(ya,za){if(typeof za==='object'&&za!==null){if(fa(za))return '<'+za.nodeName+'>';if(xa.indexOf(za)!==-1)return 'CIRCULAR';xa.push(za);}return za;});}w.registerCallback('mercury-messages',function(){var wa={},xa={},ya=pa._getInstances();for(var za in ya){wa[za]={};for(var ab in ya[za]._messages){var bb=ya[za]._messages[ab];if(Object.keys(bb).length===0)continue;var cb=bb.thread_id;wa[za][cb]=wa[za][cb]||{};wa[za][cb][bb.message_id]=JSON.parse(na(bb));}xa[za]=ca({},ya[za]._localIdsMap);}var db={};db.local_message_ids=xa;db.messages=wa;return db;});function oa(wa,xa,ya){xa.forEach(function(za){var ab=ma(wa,za);ab.setReachedEndOfArray();wa._threadInformer.reorderedMessages(za,ya);});}function pa(wa){this._fbid=wa;this._messageActions=t.getForFBID(this._fbid);this._serverRequests=y.getForFBID(this._fbid);this._threadInformer=aa.getForFBID(this._fbid);this._threads=ba.getForFBID(this._fbid);this._threadActions=z.getForFBID(this._fbid);this._failedHistoryFetchThreads={};this._threadsToMessages={};this._localTitanMessagesCount={};this._messages={};this._attachmentData={};this._messagesNeedingAttachmentData={};this._localIdsMap={};this._serverRequests.subscribe('update-messages',function(xa,ya){var za=(ya.actions||[]).filter(function(bb){var cb=bb.action_type,db=((bb.is_forward||bb.thread_id)&&(cb==l.LOG_MESSAGE||cb==l.USER_GENERATED_MESSAGE||cb==l.SEND_MESSAGE||cb==l.CLEAR_CHAT||cb==l.DELETE_THREAD||cb==l.DELETE_MESSAGES||cb==l.MARK_MESSAGES_SPAM)),eb=((bb.upload_id&&bb.upload_data)&&(cb==l.CANCEL_ATTACHMENT_PLACEHOLDER||cb==l.CONFIRM_ATTACHMENT_PLACEHOLDER)),fb=(cb==l.ADD_SHARE_DATA_TO_EXISTING_MESSAGE&&(bb.server_id&&bb.attach_key&&bb.attach_data));return (db||eb||fb);}),ab=ka(ya.payload_source);if(la(ya.payload_source))za.forEach(function(bb){if(!bb.is_forward&&bb.action_type!==l.ADD_SHARE_DATA_TO_EXISTING_MESSAGE){var cb=this._threads.getThreadMetaNow(bb.thread_id);if(cb)bb.is_cleared=bb.timestamp<cb.chat_clear_time;}}.bind(this));this.handleUpdates(za,ab,ya.payload_source,ya.from_client);if(ya.end_of_history)oa(this,ya.end_of_history,ya.payload_source);}.bind(this));ia.debug('constructed',{fbid:this._fbid});}ca(pa.prototype,{getMessagesFromIDs:function(wa){return (wa||[]).map(ja.bind(null,this)).filter(function(xa){return xa;});},hasLoadedNMessages:function(wa,xa){var ya=ma(this,wa);return ya.hasReachedEndOfArray()||ya.getCurrentArraySize()>=xa;},hasLoadedExactlyNMessages:function(wa,xa){var ya=ma(this,wa);return ya.getCurrentArraySize()==xa;},clearMercuryInternalState_DO_NOT_USE:function(){this._failedHistoryFetchThreads={};this._threadsToMessages={};this._localTitanMessagesCount={};this._messages={};this._attachmentData={};this._messagesNeedingAttachmentData={};this._localIdsMap={};},getThreadMessagesRange:function(wa,xa,ya,za,ab,bb){var cb=ma(this,wa),db=function(lb){za(qa(this,lb));}.bind(this),eb=cb.executeOrEnqueue(xa,ya,db),fb=cb.getUnavailableResources(eb),gb=this._failedHistoryFetchThreads[wa];if(fb.length&&!gb){var hb=cb.getCurrentArraySize(),ib=this._localTitanMessagesCount[wa]||0,jb=hb-ib,kb=fb.length+ib;ia.debug('fetch_missing_messages',{threadID:wa,offset:xa,limit:ya,missingIndices:fb,messageCount:hb,localMessageCount:ib});this._serverRequests.fetchThreadMessages(wa,jb,kb,ab,bb);}else this._failedHistoryFetchThreads[wa]=false;return eb;},getThreadMessagesSinceTimestamp:function(wa,xa){var ya=ma(this,wa),za=ya.getElementsUntil(xa);return qa(this,za);},hasLoadedAllMessages:function(wa){return ma(this,wa).hasReachedEndOfArray();},getCurrentlyLoadedMessages:function(wa){var xa=ma(this,wa).getAllResources();return qa(this,xa);},unsubscribe:function(wa,xa){m.isThreadID(xa);var ya=ma(this,xa);ya.unsubscribe(wa);},_addAttachmentData:function(wa,xa,ya){var za=ja(this,wa);if(za){var ab=za.attachments.indexOf(xa);if(ab!=-1){za.attachments=za.attachments.map(function(bb,cb){return cb===ab?ya:bb;});this._threadInformer.updatedMessage(za.thread_id,za.message_id,'attach');}}else{if(!this._attachmentData[wa])this._attachmentData[wa]=[];this._attachmentData[wa].push({attach_key:xa,data:ya});}},shouldSortOutOfOrderMessages:function(wa,xa,ya){if(wa==q.CLIENT_CHANNEL_MESSAGE){var za=this.getThreadMessagesSinceTimestamp(xa,ya);if(za.length>0){h.bumpEntityKey('chat.web','channel.messages_reordered');return true;}}return false;},_preprocessIncomingAction:function(wa,xa){var ya=wa.action_type;if(xa==q.CLIENT_CHANNEL_MESSAGE&&ya==l.USER_GENERATED_MESSAGE&&wa.threading_id&&this._localIdsMap[wa.threading_id]===wa.threading_id){wa.client_message_id=wa.threading_id;wa.status=k.SUCCESS;wa.action_type=l.SEND_MESSAGE;ya=wa.action_type;}if(xa===q.CLIENT_CHANNEL_MESSAGE&&ya==l.USER_GENERATED_MESSAGE){var za=this._threads.getThreadMetaNow(wa.thread_id);if(za&&za.folder)wa.folder=za.folder;}return wa;},handleUpdates:function(wa,xa,ya,za){var ab,bb={},cb={};for(var db=0;db<wa.length;db++){var eb=this._preprocessIncomingAction(wa[db],ya),fb=eb.action_type,gb=ja(this,eb.message_id);if(eb.is_forward||ya==q.SERVER_SEARCH){if(!this._messages[eb.message_id]){this._messages[eb.message_id]=eb;ta(this,eb);}continue;}else if(eb.client_state===p.SEND_TO_SERVER){this._messages[eb.message_id]=eb;ta(this,eb);continue;}else if(fb==l.SEND_MESSAGE){var hb=eb.client_message_id;if(hb&&this._localIdsMap[hb]&&eb.status){var ib=ja(this,hb),jb=ib.status;if(ib.status==k.SUCCESS)continue;if(eb.status==k.UNCONFIRMED){if(!cb[eb.thread_id])cb[eb.thread_id]=[];cb[eb.thread_id].push(hb);}else if(!bb[eb.thread_id])bb[eb.thread_id]=[];this._updateLocalMessage(eb);if(typeof jb!==(void 0)||eb.status==k.FAILED_UNKNOWN_REASON||eb.status==k.UNABLE_TO_CONFIRM||eb.status==k.SUCCESS||eb.status==k.ERROR)this._threadInformer.updatedMessage(eb.thread_id,ja(this,hb).message_id,ya);}continue;}else if(fb==l.DELETE_THREAD){ma(this,eb.thread_id).removeAllResources();continue;}else if(fb==l.DELETE_MESSAGES){this._deleteMessages(eb.thread_id,eb.message_ids,ya);continue;}else if(fb==l.CLEAR_CHAT){var kb=ma(this,eb.thread_id).getAllResources();kb.map(ja.bind(null,this)).forEach(function(pb){pb.is_cleared=true;});continue;}else if(fb===l.MARK_MESSAGES_SPAM){this._markMessagesSpam(eb,ya);continue;}else if((eb.threading_id&&this._localIdsMap[eb.threading_id])||(gb&&!gb.is_forward)){if(gb&&eb.ranges&&eb.ranges.length>0){gb.ranges=eb.ranges;this._threadInformer.updatedMessage(gb.thread_id,gb.message_id,'link_shim');}continue;}else if(fb===l.CONFIRM_ATTACHMENT_PLACEHOLDER){this._confirmAttachmentPlaceholder(eb.upload_id,eb.upload_data);continue;}else if(fb===l.CANCEL_ATTACHMENT_PLACEHOLDER){this._cancelAttachmentPlaceholder(eb.upload_id,eb.upload_data);continue;}else if(fb===l.ADD_SHARE_DATA_TO_EXISTING_MESSAGE){this._addAttachmentData(eb.server_id,eb.attach_key,eb.attach_data);continue;}else{if(ya===q.CLIENT_SEND_MESSAGE){this._localIdsMap[eb.message_id]=eb.message_id;if(eb.thread_id=='root:'+eb.message_id)ma(this,eb.thread_id).setReachedEndOfArray();}if(fb==l.LOG_MESSAGE&&eb.log_message_type==o.SERVER_ERROR)this._failedHistoryFetchThreads[eb.thread_id]=true;if(eb.client_state===p.DO_NOT_SEND_TO_SERVER&&eb.upload_id)this._uploadMessages[eb.upload_id]=eb;if(!bb[eb.thread_id])bb[eb.thread_id]=[];bb[eb.thread_id].push(eb.message_id);this._messages[eb.message_id]=eb;ta(this,eb);if(eb.threading_id&&eb.threading_id!=eb.message_id)u.addServerID(eb.threading_id,eb.message_id);if(eb[x.MANUAL_RETRY_CNT]>0){ab=ma(this,eb.thread_id);ab.resortResources([eb.message_id]);this._threadInformer.reorderedMessages(eb.thread_id,q.CLIENT_SEND_MESSAGE);}xa=xa||this.shouldSortOutOfOrderMessages(ya,eb.thread_id,eb.timestamp);if(!xa)this._threadInformer.receivedMessage(eb);continue;}}for(var lb in bb){ab=ma(this,lb);var mb=ab.getAllResources(),nb=mb.filter(function(pb){var qb=this._messages[pb];return qb.action_type==l.LOG_MESSAGE&&qb.log_message_type==o.SERVER_ERROR;}.bind(this));ab.removeResources(nb);if(za)ra(this,lb,bb[lb]);if(xa){ab.addResources(bb[lb]);this._threadInformer.reorderedMessages(lb,ya);}else ab.addResourcesWithoutSorting(bb[lb].reverse(),0);this._threadInformer.updatedThread(lb);}var ob=Object.keys(cb);if(ob.length)this._serverRequests.requestMessageConfirmation(cb);ia.debug('handle_updates',{localMessageCounts:ga(this._localTitanMessagesCount)});},isOutbound:function(wa){return wa.author==s.getID();},isInbound:function(wa){return !this.isOutbound(wa);},isSending:function(wa){return (wa.status===k.UNSENT||wa.status===k.UNCONFIRMED||wa.status===k.UNABLE_TO_CONFIRM||wa.status===k.RESENDING);},isFirstMessage:function(wa){var xa=ma(this,wa.thread_id);if(xa.getCurrentArraySize()===0)return false;var ya=xa.getResourceAtIndex(xa.getCurrentArraySize()-1),za=ja(this,ya).message_id,ab=ja(this,wa.message_id).message_id;return xa.hasReachedEndOfArray()&&za==ab;},_isWholeThread:function(wa,xa){var ya=ma(this,wa);return (ya.getCurrentArraySize()==xa.length&&ya.hasReachedEndOfArray());},_markMessagesSpam:function(wa,xa){var ya=wa,za=ya.thread_id,ab=ya.message_ids;if(!ab.length)return;if(this._isWholeThread(za,ab)){ha(function(){return this._threadActions.markSpam(za);}.bind(this));}else{this._deleteIndividualMessages(wa.thread_id,wa.message_ids,xa);this._serverRequests.markMessagesSpam(za,ab);}},_deleteMessages:function(wa,xa,ya){if(!xa.length)return;if(ya===q.CLIENT_CHANNEL_MESSAGE)this._deleteIndividualMessages(wa,xa,ya);if(this._isWholeThread(wa,xa)){ha(function(){return this._threadActions["delete"](wa);}.bind(this));}else{this._serverRequests.deleteMessages(wa,xa);this._deleteIndividualMessages(wa,xa,ya);}},_deleteIndividualMessages:function(wa,xa,ya){var za=xa.map(function(bb){return ja(this,bb).message_id;},this),ab=ma(this,wa);ab.removeResources(za);this._threadInformer.reorderedMessages(wa,ya);},_updateLocalMessage:function(wa){var xa=ja(this,wa.client_message_id);xa.status=wa.status;if(wa.status===k.SUCCESS||wa.error_data)xa.error_data=wa.error_data;var ya=wa.message_id,za=wa.client_message_id;if(this._messages[ya])return false;this._localIdsMap[za]=ya;this._messages[ya]=this._messages[za];u.addServerID(za,ya);this._messages[za]={};var ab=ja(this,za);if(wa.timestamp)ab.timestamp=wa.timestamp;if(wa.attachments&&wa.attachments.length){ab.raw_attachments=null;ab.attachments=wa.attachments;ta(this,ab,ya);}if(wa.log_message_data)ab.log_message_data=wa.log_message_data;if(sa(ab))this._localTitanMessagesCount[ab.thread_id]--;return true;},getNumberLocalMessages:function(wa){return this._localTitanMessagesCount[wa]||0;},_uploadMessages:{},_confirmAttachmentPlaceholder:function(wa,xa){var ya=this._popPendingAttachmentMessage(wa,xa);this._serverRequests.sendNewMessage(ya);},_cancelAttachmentPlaceholder:function(wa,xa){var ya=this._popPendingAttachmentMessage(wa,xa);this._deleteIndividualMessages(ya.thread_id,[ya.message_id]);if(this._localTitanMessagesCount[ya.thread_id])this._localTitanMessagesCount[ya.thread_id]--;},_popPendingAttachmentMessage:function(wa,xa){var ya=this._uploadMessages[wa];ea(ya);ya.image_ids=xa.image_ids;ya.client_state=p.SEND_TO_SERVER;delete this._uploadMessages[wa];return ya;}});Object.assign(pa,r);function qa(wa,xa){var ya=xa.map(ja.bind(null,wa));return ya.reverse();}function ra(wa,xa,ya){var za=ya.filter(function(ab){return sa(ja(wa,ab));});if(!wa._localTitanMessagesCount[xa])wa._localTitanMessagesCount[xa]=0;wa._localTitanMessagesCount[xa]+=za.length;}function sa(wa){var xa=wa.action_type;if(xa==l.USER_GENERATED_MESSAGE)return true;switch(wa.log_message_type){case o.SUBSCRIBE:case o.UNSUBSCRIBE:case o.SERVER_ERROR:case o.LIVE_LISTEN:return false;default:return true;}}function ta(wa,xa,ya){ya=ya||xa.message_id;var za=wa._attachmentData[ya];if(za){za.forEach(function(ab){var bb=xa.attachments.indexOf(ab.attach_key);if(bb!==-1)xa.attachments[bb]=ab.data;});delete wa._attachmentData[ya];}else if(!xa.is_forward&&ua(wa,xa)){wa._messagesNeedingAttachmentData[ya]=true;va(wa);}}function ua(wa,xa){if(!xa||!xa.attachments)return false;for(var ya=0;ya<xa.attachments.length;ya++){var za=xa.attachments[ya];if(typeof za==='string'&&za.indexOf(n.SHARE)===0)return true;}var ab=xa.forward_message_ids||[];for(ya=0;ya<ab.length;ya++){var bb=ja(wa,ab[ya]);if(ua(wa,bb))return true;}return false;}var va=da(function(wa){var xa={};for(var ya in wa._messagesNeedingAttachmentData){var za=ja(wa,ya);if(ua(wa,za))xa[ya]=true;}var ab=Object.keys(xa);if(ab.length){var bb={message_ids:ab};if(wa._fbid!=i.getID())bb.request_user_id=wa._fbid;new g('/ajax/mercury/attachments/fetch_shares.php').setData(bb).setAllowCrossPageTransition(true).send();}wa._messagesNeedingAttachmentData={};},0,this);e.exports=pa;},null);
__d("MercuryChannelHandler",["Arbiter","ChannelConstants","MercuryActionType","MercuryGlobalActionType","MercuryMessages","MercuryPayloadSource","MercuryServerRequests","MercurySingletonMixin","MercuryThreadInformer","MercuryViewer","MessagingEvent","MessagingReliabilityLogger","MessagingTag","PresenceUtil","copyProperties","mixin"],function(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v){var w=v(n);for(var x in w)if(w.hasOwnProperty(x))z[x]=w[x];var y=w===null?null:w.prototype;z.prototype=Object.create(y);z.prototype.constructor=z;z.__superConstructor__=w;function z(aa){"use strict";this.$MercuryChannelHandler0=aa;this.$MercuryChannelHandler1=m.getForFBID(this.$MercuryChannelHandler0);this.$MercuryChannelHandler2=o.getForFBID(this.$MercuryChannelHandler0);this.$MercuryChannelHandler3=k.getForFBID(this.$MercuryChannelHandler0);this.$MercuryChannelHandler4=[];}z.prototype.getInstanceFBID=function(){"use strict";return this.$MercuryChannelHandler0;};z.prototype.$MercuryChannelHandler5=function(aa,ba){"use strict";if(!this.$MercuryChannelHandler6(aa)||!ba.obj||!ba.obj.message){r.addEntry('channel_receive','invalid_data');return;}var ca=ba.obj.message,da=ca.other_user_fbid?ca.other_user_fbid:ca.thread_fbid,ea={author:ca.mercury_author_id,author_email:ca.mercury_author_email,body:ca.body,subject:ca.subject,has_attachment:ca.has_attachment,attachments:ca.attachments,html_body:ca.html_body,thread_id:ca.tid,thread_fbid:ca.thread_fbid,other_user_fbid:ca.other_user_fbid,message_id:ca.mid,coordinates:ca.mercury_coordinates,is_spoof_warning:ca.is_spoof_warning,ranges:ca.ranges,source:ca.mercury_source,source_tags:ca.mercury_source_tags,threading_id:ca.threading_id,timestamp:ca.timestamp,timestamp_absolute:ca.timestamp_absolute,timestamp_relative:ca.timestamp_relative,timestamp_time_passed:ca.timestamp_time_passed,action_type:i.USER_GENERATED_MESSAGE,is_unread:ca.is_unread,is_forward:false,forward_count:ca.forward_count||ca.forward,forward_message_ids:ca.forward_msg_ids,location_text:ca.location_text,folder:ba.obj.folder};if("sync_id" in ca){ea.sync_id=ca.sync_id;}else ea.action_id=ca.action_id;var fa=[u({},ea)];fa=fa.concat(ca.forward_actions||[]);var ga=l.CLIENT_CHANNEL_MESSAGE;this.$MercuryChannelHandler1.handleUpdateWaitForThread({actions:fa,payload_source:ga},da);if(!ca.is_unread&&p.isViewer(ca.mercury_author_id)){var ha={};ha[da]=ba.obj.folder;this.$MercuryChannelHandler7(this.__getMessagingPayloadType(),{obj:{event:q.READ,thread_fbids:ca.thread_fbid?[ca.thread_fbid]:[],other_user_fbids:ca.other_user_fbid?[ca.other_user_fbid]:[],folder_info:ha,timestamp:ca.timestamp}});}r.addEntry('channel_receive','success',[da,ea.message_id,t.getSessionID()]);};z.prototype.$MercuryChannelHandler7=function(aa,ba){"use strict";if(!this.$MercuryChannelHandler6(aa)||!ba.obj||(!ba.obj.thread_fbids&&!ba.obj.other_user_fbids))return;var ca=[],da=ba.obj.event==q.READ;(ba.obj.thread_fbids||[]).forEach(function(ea){ca.push({action_type:i.CHANGE_READ_STATUS,action_id:null,thread_fbid:ea,mark_as_read:da,timestamp:ba.obj.timestamp||0,folder:ba.obj.folder_info[ea]});});(ba.obj.other_user_fbids||[]).forEach(function(ea){ca.push({action_type:i.CHANGE_READ_STATUS,action_id:null,other_user_fbid:ea,mark_as_read:da,timestamp:ba.obj.timestamp||0,folder:ba.obj.folder_info[ea]});});this.$MercuryChannelHandler1.handleUpdate({actions:ca,payload_source:l.CLIENT_CHANNEL_MESSAGE});};z.prototype.$MercuryChannelHandler8=function(aa,ba){"use strict";if(!this.$MercuryChannelHandler6(aa)||!ba.obj||!(ba.obj.thread_fbids||ba.obj.other_user_fbids))return;var ca=[];(ba.obj.thread_fbids||[]).forEach(function(da){ca.push({action_type:i.DELETE_THREAD,action_id:null,thread_fbid:da});});(ba.obj.other_user_fbids||[]).forEach(function(da){ca.push({action_type:i.DELETE_THREAD,action_id:null,other_user_fbid:da});});this.$MercuryChannelHandler1.handleUpdate({actions:ca,payload_source:l.CLIENT_CHANNEL_MESSAGE});};z.prototype.$MercuryChannelHandler9=function(aa,ba){"use strict";if(!this.$MercuryChannelHandler6(aa)||!ba.obj||(!ba.obj.thread_fbids&&!ba.obj.other_user_fbids)||!ba.obj.mids)return;var ca=ba.obj.thread_fbids.length?ba.obj.thread_fbids[0]:null,da=ba.obj.other_user_fbids.length?ba.obj.other_user_fbids[0]:null,ea={action_type:i.DELETE_MESSAGES,action_id:null,thread_fbid:ca,other_user_fbid:da,message_ids:ba.obj.mids};this.$MercuryChannelHandler1.handleUpdate({actions:[ea],threads:[ba.obj.updated_thread],payload_source:l.CLIENT_CHANNEL_MESSAGE});};z.prototype.$MercuryChannelHandlera=function(aa,ba){"use strict";if(!this.$MercuryChannelHandler6(aa)||!ba.obj||!ba.obj.folder)return;var ca={action_type:j.MARK_ALL_READ,action_id:ba.obj.action_id,folder:ba.obj.folder};this.$MercuryChannelHandler1.handleUpdate({global_actions:[ca]});};z.prototype.$MercuryChannelHandlerb=function(aa,ba){"use strict";if(!this.$MercuryChannelHandler6(aa)||(!ba.obj.thread_fbids&&!ba.obj.other_user_fbids))return;var ca=l.CLIENT_CHANNEL_MESSAGE;(ba.obj.thread_fbids||[]).forEach(function(da){var ea={action_type:i.CHANGE_ARCHIVED_STATUS,action_id:null,thread_fbid:da,other_user_fbid:null,archived:ba.obj.state};this.$MercuryChannelHandler1.handleUpdateWaitForThread({actions:[u({},ea)],payload_source:ca},da);},this);(ba.obj.other_user_fbids||[]).forEach(function(da){var ea={action_type:i.CHANGE_ARCHIVED_STATUS,action_id:null,thread_fbid:null,other_user_fbid:da,archived:ba.obj.state};this.$MercuryChannelHandler1.handleUpdateWaitForThread({actions:[u({},ea)],payload_source:ca},da);},this);};z.prototype.$MercuryChannelHandlerc=function(aa,ba){"use strict";if(!this.$MercuryChannelHandler6(aa)||(!ba.obj.thread_fbids&&!ba.obj.other_user_fbids))return;var ca=l.CLIENT_CHANNEL_MESSAGE,da;(ba.obj.thread_fbids||[]).forEach(function(ea){if(ba.obj.event==q.TAG){da=ba.obj.tag;}else da=ba.obj.marked_as_spam?s.SPAM:s.INBOX;var fa={action_type:i.CHANGE_FOLDER,action_id:null,thread_fbid:ea,other_user_fbid:null,new_folder:da};this.$MercuryChannelHandler1.handleUpdateWaitForThread({actions:[u({},fa)],payload_source:ca},ea);},this);(ba.obj.other_user_fbids||[]).forEach(function(ea){if(ba.obj.event==q.TAG){da=ba.obj.tag;}else da=ba.obj.marked_as_spam?s.SPAM:s.INBOX;var fa={action_type:i.CHANGE_FOLDER,action_id:null,other_user_fbid:ea,thread_fbid:null,new_folder:da};this.$MercuryChannelHandler1.handleUpdateWaitForThread({actions:[u({},fa)],payload_source:ca},ea);},this);};z.prototype.$MercuryChannelHandlerd=function(aa,ba){"use strict";if(!this.$MercuryChannelHandler6(aa)||!ba.obj.tag)return;switch(ba.obj.tag){case s.ACTION_ARCHIVED:this.$MercuryChannelHandlerb(aa,ba);break;case s.INBOX:case s.OTHER:this.$MercuryChannelHandlerc(aa,ba);break;}};z.prototype.__markAsSeen=function(aa,ba){"use strict";if(!this.$MercuryChannelHandlere(aa)||!ba.obj||!ba.obj.seen_timestamp)return;this.$MercuryChannelHandler1.handleUpdate({message_counts:[{seen_timestamp:ba.obj.seen_timestamp,folder:s.INBOX}],unseen_thread_fbids:[{thread_fbids:[],other_user_fbids:[],folder:s.INBOX}],payload_source:l.CLIENT_CHANNEL_MESSAGE});};z.prototype.__updateModelsFromMercuryPayload=function(aa,ba){"use strict";if(!this.$MercuryChannelHandlerf(aa)||!ba.obj)return;this.$MercuryChannelHandler2.synchronizeInforms(function(){var ca=ba.obj,da=[];(ca.actions||[]).forEach(function(ea){var fa=i.USER_GENERATED_MESSAGE;if(ea.action_type==i.LOG_MESSAGE){var ga=l.CLIENT_CHANNEL_MESSAGE,ha;ha=ea.other_user_fbid||ea.thread_fbid;this.$MercuryChannelHandler1.handleUpdateWaitForThread({actions:[u({},ea)],payload_source:ga},ha);}else if(ea.action_type!=fa)da.push(ea);},this);ca.actions=da;ca.payload_source=l.CLIENT_CHANNEL_MESSAGE;this.$MercuryChannelHandler1.handleUpdate(ca);}.bind(this));};z.prototype.$MercuryChannelHandlerg=function(aa,ba){"use strict";this.$MercuryChannelHandler1.handleRoger(ba.obj);};z.prototype.$MercuryChannelHandlerh=function(aa,ba){"use strict";if(!this.$MercuryChannelHandler6(aa)||!ba.obj||ba.obj.mute_settings===(void 0)||(!ba.obj.thread_fbid&&!ba.obj.other_user_fbid))return;var ca=i.CHANGE_MUTE_SETTINGS,da=[{action_type:ca,action_id:null,thread_fbid:ba.obj.thread_fbid,other_user_fbid:ba.obj.other_user_fbid,mute_settings:ba.obj.mute_settings}];this.$MercuryChannelHandler1.handleUpdate({actions:da,payload_source:l.CLIENT_CHANNEL_MESSAGE});};z.prototype.__handleMessagingPayload=function(aa,ba){"use strict";switch(ba.obj.event){case q.DELIVER:this.$MercuryChannelHandler5(aa,ba);break;case q.READ:case q.UNREAD:this.$MercuryChannelHandler7(aa,ba);break;case q.READ_ALL:this.$MercuryChannelHandlera(aa,ba);break;case q.DELETE:this.$MercuryChannelHandler8(aa,ba);break;case q.DELETE_MESSAGES:this.$MercuryChannelHandler9(aa,ba);break;case q.TAG:this.$MercuryChannelHandlerd(aa,ba);break;case q.REPORT_SPAM:this.$MercuryChannelHandlerc(aa,ba);break;case q.READ_RECEIPT:this.$MercuryChannelHandlerg(aa,ba);break;case q.CHANGE_MUTE_SETTINGS:this.$MercuryChannelHandlerh(aa,ba);break;}};z.prototype.getRouting=function(){"use strict";return {mercury:this.__updateModelsFromMercuryPayload,messaging:this.__handleMessagingPayload,inbox:this.__markAsSeen};};z.prototype.__getMessagingPayloadType=function(){"use strict";return h.getArbiterType('messaging');};z.prototype.__getMercuryPayloadType=function(){"use strict";return h.getArbiterType('mercury');};z.prototype.__getInboxPayloadType=function(){"use strict";return h.getArbiterType('inbox');};z.prototype.$MercuryChannelHandler6=function(aa){"use strict";return (aa==this.__getMessagingPayloadType());};z.prototype.$MercuryChannelHandlerf=function(aa){"use strict";return (aa==this.__getMercuryPayloadType());};z.prototype.$MercuryChannelHandlere=function(aa){"use strict";return (aa==this.__getInboxPayloadType());};z.prototype.turnOn=function(){"use strict";if(!this.$MercuryChannelHandler4.length){var aa=this.getRouting();for(var ba in aa)this.$MercuryChannelHandler4.push(g.subscribe(h.getArbiterType(ba),aa[ba].bind(this)));}return this;};z.prototype.turnOff=function(){"use strict";if(this.$MercuryChannelHandler4.length){this.$MercuryChannelHandler4.forEach(g.unsubscribe);this.$MercuryChannelHandler4=[];}return this;};u(z,n);e.exports=z;},null);
__d("MercuryRoger",["Arbiter","ArbiterMixin","JSLogger","MercuryActionStatus","copyProperties","MercuryServerRequests","MercuryThreads"],function(a,b,c,d,e,f,g,h,i,j,k){var l=b('MercuryServerRequests').get(),m=b('MercuryThreads').get(),n={},o=[],p={getSeenBy:function(q,r){if(!q)return [];var s=[],t=n[q.thread_id],u=j.SUCCESS;for(var v in t)if(t[v]>q.timestamp&&(q.status===(void 0)||q.status===u)&&(!r||v!=q.author))s.push(v);return s;},getSeenTimestamp:function(q,r){var s=n[q];return s?s[r]:null;}};k(p,h);l.subscribe('update-roger',function(q,r){for(var s in r){if(!n[s])n[s]={};for(var t in r[s]){var u=m.getThreadMetaNow(s);if(u&&u.participants)if(u.participants.indexOf(t)==-1){o.push(n);continue;}var v=n[s][t],w=r[s][t];if(!v||w>v)n[s][t]=w;}}if(r)p.inform('state-changed',r);});g.subscribe(i.DUMP_EVENT,function(q,r){r.bad_read_receipts={receipts:o};});e.exports=p;},null);
__d("MercuryDelayedRoger",["ArbiterMixin","LiveTimer","MercuryActionStatus","MercuryConfig","MercuryRoger","copyProperties","setTimeoutAcrossTransitions","MercuryMessages","MercuryThreadInformer","MercuryThreads"],function(a,b,c,d,e,f,g,h,i,j,k,l,m){var n=b('MercuryMessages').get(),o=b('MercuryThreadInformer').get(),p=b('MercuryThreads').get(),q={},r={},s=j['roger.seen_delay'],t=l({getSeenBy:function(x,y){if(r[x])return [];if(!q[x]){var z=p.getThreadMetaNow(x);if(z)q[x]={thread_id:x,author:z.participants[0],timestamp:z.timestamp};}return k.getSeenBy(q[x],y);}},g);function u(x){var y=false;n.getThreadMessagesRange(x,0,1,function(z){var aa=z[0];if(!aa)return;var ba=aa.timestamp;if(aa.action_id||aa.status==i.SUCCESS)ba-=h.getServerTimeOffset();var ca=t.getSeenBy(x);if(r[x]){clearTimeout(r[x]);delete r[x];}var da=ba+s,ea=da-Date.now();if(ea>0)r[x]=m(function(){delete r[x];v(x);},ea);q[x]=aa;var fa=t.getSeenBy(x);if(ca.length||fa.length)y=true;});return y;}function v(x){var y={};y[x]=true;t.inform('state-changed',y);}function w(event,x){var y={};for(var z in x)if(u(z))y[z]=true;for(var aa in y){t.inform('state-changed',y);break;}}k.subscribe('state-changed',function(x,y){for(var z in y)!r[z]&&v(z);});o.subscribe('messages-received',w);o.subscribe('messages-reordered',w);o.subscribe('messages-updated',w);e.exports=t;},null);
__d("MercuryUnseenState",["MercuryFolders","KeyedCallbackManager","LogHistory","MercuryActionType","MercurySingletonMixin","MercuryThreadlistConstants","MessagingTag","ReportState","MercuryServerRequests","MercuryThreadInformer","MercuryThreadMuter","MercuryThreads","copyProperties","createObjectFrom","isEmpty"],function(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u){var v=l.MAX_UNSEEN_COUNT,w='unseen_thread_hash',x='unseen_thread_list',y=i.getInstance('mercury_unseen_state');function z(na){this._fbid=na;this._serverRequests=o.getForFBID(this._fbid);this._threads=r.getForFBID(this._fbid);this._threadInformer=p.getForFBID(this._fbid);this._initialUnseenCount=null;this._lastSeenTimestamp=0;this._maxCount=false;this._pendingServerUpdates=false;this._unseenResources=new h();this._serverRequests.subscribe('update-unseen',function(oa,pa){ea(this,pa);}.bind(this));this._serverRequests.subscribe('update-thread-ids',function(oa,pa){ka(this,pa);}.bind(this));}s(z.prototype,{getUnseenCount:function(){if(this.exceedsMaxCount()){y.error('unguarded_unseen_count_fetch',{});return 0;}return da(this)||0;},exceedsMaxCount:function(){return this._maxCount||(da(this)>v);},markAsSeen:function(){var na=da(this);if(na===null){this._pendingServerUpdates=true;}else if(na>0||this._maxCount){this._serverRequests.markSeen();var oa=this._serverRequests.getLastActionTimestamp();fa(this,oa,[]);}},markThreadSeen:function(na,oa){var pa={};pa[na]=0;ha(this,pa,oa);}});s(z,k);function aa(na,oa){na._unseenResources.setResource(w,oa);na._unseenResources.setResource(x,Object.keys(oa));}function ba(na,oa){var pa=na._unseenResources.executeOrEnqueue(w,oa),qa=na._unseenResources.getUnavailableResources(pa);if(qa.length)na._serverRequests.fetchUnseenThreadIDs();}function ca(na){return na._unseenResources.getResource(w);}function da(na){var oa=na._unseenResources.getResource(x);if(oa){return oa.length;}else return na._initialUnseenCount;}function ea(na,oa){var pa=ma(oa);if(oa.unseen_thread_fbids){oa.unseen_thread_fbids.forEach(function(ab){if(ab.folder!=m.INBOX)return;var bb=ab.thread_fbids||[];bb=bb.concat(ab.other_user_fbids||[]);var cb=ja(na,bb),db=na._lastSeenTimestamp;if(pa&&pa.seen_timestamp)db=pa.seen_timestamp;fa(na,db,cb);if(pa&&pa.unseen_count>v)na._maxCount=true;});}else if(pa&&pa.seen_timestamp){na._lastSeenTimestamp=pa.seen_timestamp;if(pa.unseen_count>v){na._maxCount=true;aa(na,{});}else{na._initialUnseenCount=pa.unseen_count;if(na._initialUnseenCount===0)aa(na,{});}}else{if(na._maxCount)return;var qa=oa.actions;if(!qa||!(qa.length))return;var ra={},sa={};for(var ta=0;ta<qa.length;ta++){var ua=qa[ta];if(ua.is_forward)continue;var va=ua.action_type,wa=ua.other_user_fbid?ua.other_user_fbid:ua.thread_fbid,xa=ua.thread_id?ua.thread_id:wa;if(!la(na,ua))continue;if(va==j.USER_GENERATED_MESSAGE||va==j.LOG_MESSAGE){var ya=ra[xa]?ua.timestamp>ra[xa]:false,za=ya||!ra[xa];if(ua.is_unread&&za)na._threads.getThreadMeta(xa,function(ab){var bb=false;if(ab&&ab.last_read_timestamp)if(ab.last_read_timestamp>=ua.timestamp)bb=true;if(!q.isThreadMuted(ab)&&!bb)ra[xa]=ua.timestamp;});}else if(va==j.CHANGE_READ_STATUS&&ua.mark_as_read)sa[xa]=ua.timestamp;}ga(na,ra);ha(na,sa);}if(na._pendingServerUpdates){na._pendingServerUpdates=false;na.markAsSeen();}}function fa(na,oa,pa){var qa=ca(na);if(qa===(void 0)||oa>na._lastSeenTimestamp||na._maxCount){na._lastSeenTimestamp=oa;pa=pa||[];if(pa.length<=v)na._maxCount=false;var ra={},sa=ca(na)||{};for(var ta in sa)if(sa[ta]!==true){var ua=sa[ta];if(ia(na,ua))ra[ta]=ua;}var va=s(t(pa,true),ra);aa(na,va);na._threadInformer.updatedUnseenState();}}function ga(na,oa){if(na._maxCount)return;var pa={},qa=false;for(var ra in oa){var sa=oa[ra];if(ia(na,sa)){pa[ra]=sa;qa=true;}}if(!qa)return;ba(na,function(ta){for(var ua in pa){var va=pa[ua];if(!ta[ua]&&ia(na,va))ta[ua]=pa[ua];}aa(na,ta);na._threadInformer.updatedUnseenState();});}function ha(na,oa,pa){var qa=false;if(!u(oa))qa=true;if(qa)ba(na,function(ra){var sa=false;for(var ta in oa){var ua=oa[ta],va=ua>ra[ta];if(ra[ta]&&(!ua||va)){delete ra[ta];sa=true;}}if(sa){aa(na,ra);na._threadInformer.updatedUnseenState();if(pa&&da(na)===0)na._serverRequests.markSeen();}});}function ia(na,oa){return oa>na._lastSeenTimestamp;}function ja(na,oa){return oa.map(na._serverRequests.convertThreadIDIfAvailable,na._serverRequests);}function ka(na,oa){var pa=ca(na);if(!pa)return;for(var qa in oa){var ra=oa[qa];if(pa[qa]){pa[ra]=pa[qa];delete pa[qa];}}aa(na,pa);}function la(na,oa){var pa=oa.thread_id?na._threads.getThreadMetaNow(oa.thread_id):null,qa=pa?g.getFromMeta(pa):oa.folder;return qa===m.INBOX||qa===(void 0);}function ma(na){var oa=(na.message_counts||[]);for(var pa=0;pa<oa.length;pa++)if(oa[pa].folder==m.INBOX)return oa[pa];return null;}n.registerCallback('mercury-unseen-state',function(){var na={};na.unseen={};na.unseen_max_count={};na.unseen_time={};var oa=z._getInstances();for(var pa in oa){na.unseen[pa]=s({},ca(oa[pa]));na.unseen_max_count[pa]=oa[pa]._maxCount;na.unseen_time[pa]=oa[pa]._lastSeenTimestamp;}return na;});e.exports=z;},null);
__d("MercuryParticipantListRenderer",["fbt"],function(a,b,c,d,e,f,g){'use strict';function h(){this.$MercuryParticipantListRenderer0=false;this.$MercuryParticipantListRenderer1=false;this.$MercuryParticipantListRenderer2=false;this.$MercuryParticipantListRenderer3=function(r){return this.$MercuryParticipantListRenderer1?r.short_name:r.name;}.bind(this);}h.prototype.renderParticipantList=function(r){var s=r.map(this.$MercuryParticipantListRenderer3);switch(s.length){case 0:return i(this.$MercuryParticipantListRenderer0);case 1:return j(s);case 2:return this.$MercuryParticipantListRenderer2?l(s):k(s);case 3:return this.$MercuryParticipantListRenderer2?n(s):m(s);default:return this.$MercuryParticipantListRenderer2?p(s):o(s);}};h.prototype.setIsNewThread=function(r){this.$MercuryParticipantListRenderer0=r;return this;};h.prototype.setNameRenderer=function(r){this.$MercuryParticipantListRenderer3=r;return this;};h.prototype.setUseShortName=function(r){this.$MercuryParticipantListRenderer1=r;return this;};h.prototype.setUseAndSeparator=function(r){this.$MercuryParticipantListRenderer2=r;return this;};function i(r){if(r){return ("New Message");}else return ("No Participants");}function j(r){return r[0];}function k(r){return (g._("{participant1}, {participant2}",[g.param("participant1",r[0]),g.param("participant2",r[1])]));}function l(r){return (g._("{participant1} and {participant2}",[g.param("participant1",r[0]),g.param("participant2",r[1])]));}function m(r){return (g._("{participant1}, {participant2}, {participant3}",[g.param("participant1",r[0]),g.param("participant2",r[1]),g.param("participant3",r[2])]));}function n(r){return (g._("{participant1}, {participant2} and {participant3}",[g.param("participant1",r[0]),g.param("participant2",r[1]),g.param("participant3",r[2])]));}function o(r){return (g._("{participant1}, {participant2}, {participant3}, {others_link}",[g.param("participant1",r[0]),g.param("participant2",r[1]),g.param("participant3",r[2]),g.param("others_link",q(r.length-3))]));}function p(r){return (g._("{participant1}, {participant2} and {others_link}",[g.param("participant1",r[0]),g.param("participant2",r[1]),g.param("others_link",q(r.length-2))]));}function q(r){if(r>1){return (g._("{others_count} others",[g.param("others_count",r)]));}else return ("1 other");}e.exports=h;},null);
__d("LayerHideOnSuccess",["copyProperties"],function(a,b,c,d,e,f,g){function h(i){"use strict";this._layer=i;}h.prototype.enable=function(){"use strict";this._subscription=this._layer.subscribe('success',this._layer.hide.bind(this._layer));};h.prototype.disable=function(){"use strict";if(this._subscription){this._subscription.unsubscribe();this._subscription=null;}};g(h.prototype,{_subscription:null});e.exports=h;},null);
__d("Overlay",["CSS","DataStore","DOM","Layer","LayerButtons","LayerDestroyOnHide","LayerFadeOnHide","LayerFadeOnShow","LayerFormHooks","LayerHideOnBlur","LayerHideOnEscape","LayerHideOnSuccess","LayerHideOnTransition","LayerMouseHooks","LayerTabIsolation","copyProperties"],function(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v){for(var w in j)if(j.hasOwnProperty(w))y[w]=j[w];var x=j===null?null:j.prototype;y.prototype=Object.create(x);y.prototype.constructor=y;y.__superConstructor__=j;function y(z,aa){"use strict";z=v({buildWrapper:true},z||{});this._shouldBuildWrapper=z.buildWrapper;j.call(this,z,aa);}y.prototype._configure=function(z,aa){"use strict";x._configure.call(this,z,aa);var ba=this.getRoot();this._overlay=i.scry(ba,'div.uiOverlay')[0]||ba;g.hide(ba);i.appendContent(this.getInsertParent(),ba);h.set(this._overlay,'overlay',this);var ca=h.get(this._overlay,'width');ca&&this.setWidth(ca);if(this.setFixed)this.setFixed(h.get(this._overlay,'fixed')=='true');if(h.get(this._overlay,'fadeonshow')!='false')this.enableBehavior(n);if(h.get(this._overlay,'fadeonhide')!='false')this.enableBehavior(m);if(h.get(this._overlay,'hideonsuccess')!='false')this.enableBehavior(r);if(h.get(this._overlay,'hideonblur')=='true')this.enableBehavior(p);if(h.get(this._overlay,'destroyonhide')!='false')this.enableBehavior(l);return this;};y.prototype._getDefaultBehaviors=function(){"use strict";return x._getDefaultBehaviors.call(this).concat([k,o,t,q,s,u]);};y.prototype.initWithoutBuildingWrapper=function(){"use strict";this._shouldBuildWrapper=false;return this.init.apply(this,arguments);};y.prototype._buildWrapper=function(z,aa){"use strict";aa=x._buildWrapper.call(this,z,aa);if(!this._shouldBuildWrapper){this._contentRoot=aa;return aa;}this._contentRoot=i.create('div',{className:'uiOverlayContent'},aa);return i.create('div',{className:'uiOverlay'},this._contentRoot);};y.prototype.getContentRoot=function(){"use strict";return this._contentRoot;};y.prototype.destroy=function(){"use strict";h.remove(this.getRoot(),'overlay');x.destroy.call(this);};e.exports=y;},null);
__d("ContextualDialogFooterLink",["CSS","DOM","Event","copyProperties"],function(a,b,c,d,e,f,g,h,i,j){function k(l){"use strict";this._layer=l;}k.prototype.enable=function(){"use strict";var l=this._layer.getRoot(),m=h.scry(l,'.uiContextualDialogFooterLink')[0],n='uiContextualDialogHoverFooterArrow';this._subscriptions=[i.listen(m,'mouseenter',g.addClass.bind(null,l,n)),i.listen(m,'mouseleave',g.removeClass.bind(null,l,n))];};k.prototype.disable=function(){"use strict";this._subscriptions.forEach(function(l){l.remove();});this._subscriptions=null;};j(k.prototype,{_subscriptions:null});e.exports=k;},null);
__d("LegacyContextualDialog",["Arbiter","ArbiterMixin","ARIA","Bootloader","ContextualDialogFooterLink","ContextualThing","CSS","DataStore","DOM","Event","LayerAutoFocus","LayerRefocusOnHide","Locale","Overlay","Parent","Style","Vector","$","copyProperties","getOverlayZIndex","shield"],function(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v,w,x,y,z,aa){for(var ba in t)if(t.hasOwnProperty(ba))da[ba]=t[ba];var ca=t===null?null:t.prototype;da.prototype=Object.create(ca);da.prototype.constructor=da;da.__superConstructor__=t;function da(){"use strict";if(t!==null)t.apply(this,arguments);}da.prototype._configure=function(ea,fa){"use strict";ca._configure.call(this,ea,fa);var ga=this.getRoot(),ha=n.get.bind(null,ga);this.setAlignH(ha('alignh','left'));this.setOffsetX(ha('offsetx',0));this.setOffsetY(ha('offsety',0));this.setPosition(ha('position','above'));this._hasFooter=ha('hasfooter',false);if(this._hasFooter){var ia=o.scry(ga,'.uiContextualDialogFooterLink')[0];ia&&this.enableBehavior(k);}this.enableBehaviors(this._getDefaultBehaviors());this._setContextSubscription=this.subscribe('beforeshow',function(){this.unsubscribe(this._setContextSubscription);this._setContextSubscription=null;var ka=ha('context');if(ka){this.setContext(x(ka));}else{ka=ha('contextselector');if(ka)this.setContext(o.find(document,ka));}}.bind(this));this._content=o.scry(ga,'.uiContextualDialogContent')[0];if(this._content){this._content.setAttribute('role','dialog');var ja=o.scry(this._content,'.legacyContextualDialogTitle')[0];if(ja)this._content.setAttribute('aria-labelledby',o.getID(ja));}this._showSubscription=this.subscribe('show',function(){var ka=aa(this.updatePosition,this);this._resizeListener=p.listen(window,'resize',ka);this._reflowSubscription=g.subscribe('reflow',ka);this._setupScrollListener(this._scrollParent);l.register(ga,this.context);g.inform('layer_shown',{type:'ContextualDialog'});}.bind(this));this._hideSubscription=this.subscribe('hide',function(){this._teardownResizeAndReflowListeners();this._teardownScrollListener();g.inform('layer_hidden',{type:'ContextualDialog'});}.bind(this));return this;};da.prototype._getDefaultBehaviors=function(){"use strict";return ca._getDefaultBehaviors.call(this).concat([q,r]);};da.prototype._buildWrapper=function(ea,fa){"use strict";var ga=ca._buildWrapper.call(this,ea,fa);if(!this._shouldBuildWrapper)return ga;m.addClass(ga,'uiContextualDialog');return o.create('div',{className:'uiContextualDialogPositioner'},ga);};da.prototype.setWidth=function(ea){"use strict";this._width=Math.floor(ea);return this;};da.prototype.setFixed=function(ea){"use strict";ea=!!ea;m.conditionClass(this.getRoot(),'uiContextualDialogFixed',ea);this._fixed=ea;return this;};da.prototype.setAlignH=function(ea){"use strict";this.alignH=ea;this._updateAlignmentClass();this._shown&&this.updatePosition();this.position&&this._updateArrow();return this;};da.prototype.getContent=function(){"use strict";return this._content;};da.prototype.getContext=function(){"use strict";return this.context;};da.prototype.setContext=function(ea){"use strict";if(this._setContextSubscription){this.unsubscribe(this._setContextSubscription);this._setContextSubscription=null;}ea=x(ea);if(this.context&&this.context!=ea)n.remove(this.context,'LegacyContextualDialog');this.context=ea;i.setPopup(this.getCausalElement(),this.getRoot());var fa=u.byClass(ea,'fbPhotoSnowlift');this.setInsertParent(fa||document.body);if(this._scrollListener&&this._scrollParent!==fa){this._teardownScrollListener();this._setupScrollListener(fa);}this._scrollParent=fa;var ga=z(ea,this._insertParent);v.set(this.getRoot(),'z-index',ga>200?ga:'');n.set(this.context,'LegacyContextualDialog',this);return this;};da.prototype.getCausalElement=function(){"use strict";return ca.getCausalElement.call(this)||this.context;};da.prototype.listen=function(ea,fa){"use strict";return p.listen(this.getRoot(),ea,fa);};da.prototype.setOffsetX=function(ea){"use strict";this.offsetX=parseInt(ea,10)||0;this._shown&&this.updatePosition();return this;};da.prototype.setOffsetY=function(ea){"use strict";this.offsetY=parseInt(ea,10)||0;this._shown&&this.updatePosition();return this;};da.prototype.setPosition=function(ea){"use strict";this.position=ea;for(var fa in da.POSITION_TO_CLASS)m.conditionClass(this.getRoot(),da.POSITION_TO_CLASS[fa],ea==fa);this._updateAlignmentClass();this._shown&&this.updatePosition();this._updateArrow();return this;};da.prototype.updatePosition=function(){"use strict";if(!this.context)return false;if(this._width)v.set(this._overlay,'width',this._width+'px');var ea=this._fixed?'viewport':'document',fa=w.getElementPosition(this.context,ea),ga=this._scrollParent;if(ga)fa=fa.sub(w.getElementPosition(ga,'document')).add(ga.scrollLeft,ga.scrollTop);var ha=w.getElementDimensions(this.context),ia=this.position=='above'||this.position=='below',ja=s.isRTL();if((this.position=='right'||(ia&&this.alignH=='right'))!=ja)fa=fa.add(ha.x,0);if(this.position=='below')fa=fa.add(0,ha.y);var ka=new w(0,0);if(ia&&this.alignH=='center'){ka=ka.add((ha.x-this._width)/2,0);}else{var la=ia?ha.x:ha.y,ma=2*da.ARROW_INSET;if(la<ma){var na=la/2-da.ARROW_INSET;if(ia&&(this.alignH=='right'!=ja))na=-na;ka=ka.add(ia?na:0,ia?0:na);}}ka=ka.add(this.offsetX,this.offsetY);if(ja)ka=ka.mul(-1,1);fa=fa.add(ka);if(this._fixed)fa=new w(fa.x,fa.y,'document');fa.setElementPosition(this.getRoot());this._adjustVerticalPosition();this._adjustHorizontalPosition();return true;};da.prototype.scrollTo=function(){"use strict";if(this.context)j.loadModules(["DOMScroll"],function(ea){ea.scrollTo(this.context,true,true);}.bind(this));};da.prototype.destroy=function(){"use strict";this.unsubscribe(this._showSubscription);this.unsubscribe(this._hideSubscription);if(this._setContextSubscription){this.unsubscribe(this._setContextSubscription);this._setContextSubscription=null;}this._teardownScrollListener();this._teardownResizeAndReflowListeners();this.context&&n.remove(this.context,'LegacyContextualDialog');ca.destroy.call(this);};da.prototype._adjustVerticalPosition=function(){"use strict";if(this.position!='left'&&this.position!='right'){v.set(this._overlay,'top','');return;}var ea=this.getRoot(),fa=w.getElementPosition(ea,'viewport').y,ga=w.getElementDimensions(this._overlay).y,ha=w.getViewportDimensions().y,ia=Math.min(Math.max(fa,da.MIN_TOP_GAP),da.TOP_MARGIN),ja=Math.min(Math.max(0,fa+ga+da.BOTTOM_MARGIN-ha),Math.max(-ia,fa-ia),ga-2*da.ARROW_INSET);v.set(this._overlay,'top',(-1*ja)+'px');v.set(this._arrow,'top',da.ARROW_OFFSET+'px');v.set(this._arrow,'marginTop',ja+'px');};da.prototype._adjustHorizontalPosition=function(){"use strict";if((this.position!='above'&&this.position!='below')||this.alignH!='left'){v.set(this._overlay,'left','');v.set(this._overlay,'right','');return;}var ea=this.getRoot(),fa=w.getElementPosition(ea,'viewport').x,ga=w.getElementDimensions(this._overlay).x,ha=w.getViewportDimensions().x,ia=s.isRTL(),ja;if(!ia){ja=fa+ga+da.RIGHT_MARGIN-ha;}else ja=da.LEFT_MARGIN+ga-fa;ja=Math.min(Math.max(0,ja),ga-2*da.ARROW_INSET);v.set(this._overlay,ia?'right':'left',-1*ja+'px');v.set(this._arrow,ia?'right':'left',da.ARROW_OFFSET+'px');v.set(this._arrow,ia?'marginRight':'marginLeft',ja+'px');};da.prototype._updateArrow=function(){"use strict";var ea=0;if(this.position=='above'||this.position=='below')switch(this.alignH){case 'center':ea=50;break;case 'right':ea=100;break;}this._renderArrow(da.POSITION_TO_ARROW[this.position],ea);};da.prototype._renderArrow=function(ea,fa){"use strict";for(var ga in da.ARROW_CLASS)m.conditionClass(this._overlay,da.ARROW_CLASS[ga],ea==ga);m.conditionClass(this._overlay,'uiContextualDialogWithFooterArrowBottom',ea=='bottom'&&this._hasFooter);if(ea=='none')return;if(!this._arrow){this._arrow=o.create('i',{className:'uiContextualDialogArrow'});o.appendContent(this._overlay,this._arrow);}v.set(this._arrow,'top','');v.set(this._arrow,'left','');v.set(this._arrow,'right','');v.set(this._arrow,'margin','');var ha=ea=='top'||ea=='bottom',ia=ha?(s.isRTL()?'right':'left'):'top';fa=fa||0;v.set(this._arrow,ia,fa+'%');var ja=da.ARROW_LENGTH+da.ARROW_OFFSET*2,ka=-(ja*fa/100-da.ARROW_OFFSET);v.set(this._arrow,'margin-'+ia,ka+'px');};da.prototype._updateAlignmentClass=function(){"use strict";m.conditionClass(this.getRoot(),da.RIGHT_ALIGNED_CLASS,(this.position=='above'||this.position=='below')&&this.alignH=='right');};da.prototype._setupScrollListener=function(ea){"use strict";this._scrollListener=p.listen(ea||window,'scroll',aa(this._adjustVerticalPosition,this));};da.prototype._teardownScrollListener=function(){"use strict";if(this._scrollListener){this._scrollListener.remove();this._scrollListener=null;}};da.prototype._teardownResizeAndReflowListeners=function(){"use strict";if(this._resizeListener){this._resizeListener.remove();this._resizeListener=null;}if(this._reflowSubscription){this._reflowSubscription.unsubscribe();this._reflowSubscription=null;}};da.getInstance=function(ea){"use strict";var fa=n.get(ea,'LegacyContextualDialog');if(!fa){var ga=u.byClass(ea,'uiOverlay');if(ga)fa=n.get(ga,'overlay');}return fa;};y(da,h,{ARROW_OFFSET:15,ARROW_LENGTH:16,ARROW_INSET:22,TOP_MARGIN:50,BOTTOM_MARGIN:30,LEFT_MARGIN:15,RIGHT_MARGIN:30,MIN_TOP_GAP:5,POSITION_TO_CLASS:{above:'uiContextualDialogAbove',below:'uiContextualDialogBelow',left:'uiContextualDialogLeft',right:'uiContextualDialogRight'},RIGHT_ALIGNED_CLASS:'uiContextualDialogRightAligned',ARROW_CLASS:{bottom:'uiContextualDialogArrowBottom',top:'uiContextualDialogArrowTop',right:'uiContextualDialogArrowRight',left:'uiContextualDialogArrowLeft'},POSITION_TO_ARROW:{above:'bottom',below:'top',left:'right',right:'left'}});y(da.prototype,{_scrollListener:null,_scrollParent:null,_width:null,_fixed:false,_hasFooter:false,_showSubscription:null,_hideSubscription:null,_setContextSubscription:null,_resizeListener:null,_reflowSubscription:null});e.exports=da;},null);
__d("VaultBoxURI",["URI"],function(a,b,c,d,e,f,g){var h={PHOTOS_SYNCED:'photos_synced',isVaultBoxURI:function(i){var j=new RegExp("\/"+h.PHOTOS_SYNCED+"\/?$");return i.getPath().match(j)&&i.getQueryData().hasOwnProperty('view_image');},isVaultArchiveURI:function(i){var j=new RegExp("\/"+h.PHOTOS_SYNCED+"\/?$");return i.getPath().match(j);},getSyncedTabURI:function(){return new g('/me/'+h.PHOTOS_SYNCED).getQualifiedURI();}};e.exports=h;},null);